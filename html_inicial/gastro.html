<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Examen Gastroenterol√≥gico - Algoritmo de Evaluaci√≥n Avanzado</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --secondary-gradient: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            --alert-gradient: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            --warning-gradient: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
            --normal-color: #27ae60;
            --warning-color: #ffa726;
            --alert-color: #ff6b6b;
            --info-color: #17a2b8;
            --light-bg: #f8f9fa;
            --card-bg: #ffffff;
            --dark-bg: #1a1a1a;
            --dark-card: #3d3d3d;
        }

        [data-theme="dark"] {
            --light-bg: #1a1a1a;
            --card-bg: #3d3d3d;
            color: #ffffff;
        }

        body {
            font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1600px;
            margin: 0 auto;
            padding-top: 160px;
            background-color: var(--light-bg);
            line-height: 1.6;
            transition: all 0.3s ease;
        }
        
        /* üé™ DASHBOARD SUPERIOR FIJO */
        .dashboard-fixed {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: var(--primary-gradient);
            backdrop-filter: blur(10px);
            z-index: 1000;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .dashboard-content {
            max-width: 1600px;
            margin: 0 auto;
            padding: 15px 20px;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 12px;
            margin-bottom: 10px;
        }

        .dashboard-item {
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            padding: 8px 12px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
            transition: all 0.3s ease;
            color: white;
            text-align: center;
            font-size: 12px;
        }

        .dashboard-item:hover {
            background: rgba(255,255,255,0.2);
            transform: translateY(-2px);
        }

        .dashboard-item i {
            font-size: 16px;
            margin-bottom: 4px;
            display: block;
        }

        .dashboard-alert {
            color: var(--alert-color) !important;
            animation: pulse 2s infinite;
        }

        .dashboard-warning {
            color: var(--warning-color) !important;
        }

        .dashboard-normal {
            color: var(--normal-color) !important;
        }

        /* üéõÔ∏è CONTROLES SUPERIORES */
        .control-bar {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .control-btn {
            padding: 8px 15px;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .control-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-primary { background: var(--primary-gradient); }
        .btn-success { background: var(--secondary-gradient); }
        .btn-warning { background: var(--warning-gradient); }
        .btn-danger { background: var(--alert-gradient); }

        /* üéØ PANEL LATERAL DE NAVEGACI√ìN */
        .nav-panel {
            position: fixed;
            left: 20px;
            top: 160px;
            width: 280px;
            background: var(--card-bg);
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            padding: 20px;
            max-height: calc(100vh - 180px);
            overflow-y: auto;
            z-index: 998;
            transform: translateX(-320px);
            transition: transform 0.3s ease;
        }

        .nav-panel.open {
            transform: translateX(0);
        }

        .nav-panel h3 {
            margin: 0 0 15px 0;
            color: var(--primary-color);
            font-size: 16px;
            border-bottom: 2px solid #667eea;
            padding-bottom: 8px;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 12px;
            margin: 4px 0;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 13px;
        }

        .nav-item:hover {
            background: rgba(102, 126, 234, 0.1);
        }

        .nav-item.completed {
            background: rgba(40, 167, 69, 0.1);
            color: var(--normal-color);
        }

        .nav-item.completed i {
            color: var(--normal-color);
        }

        .nav-item i {
            width: 16px;
            text-align: center;
        }

        /* üìä PANEL LATERAL STICKY - FUNCIONALIDAD PRINCIPAL */
        .sticky-panel {
            position: fixed;
            top: 160px;
            right: -420px;
            width: 400px;
            height: calc(100vh - 180px);
            background: var(--card-bg);
            border-radius: 12px 0 0 12px;
            box-shadow: -4px 0 20px rgba(0,0,0,0.15);
            z-index: 997;
            transition: right 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            overflow: hidden;
            border: 2px solid #667eea;
        }

        .sticky-panel.active {
            right: 0;
        }

        .sticky-header {
            background: var(--primary-gradient);
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 600;
            font-size: 14px;
        }

        .sticky-controls {
            display: flex;
            gap: 8px;
        }

        .sticky-btn {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            border-radius: 4px;
            padding: 6px 10px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .sticky-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: scale(1.05);
        }

        .sticky-content {
            padding: 20px;
            height: calc(100% - 70px);
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 11px;
            line-height: 1.4;
            white-space: pre-wrap;
            background: var(--light-bg);
        }

        .update-indicator {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--primary-gradient);
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            display: none;
            align-items: center;
            gap: 8px;
            font-size: 12px;
            z-index: 10;
        }

        .update-indicator.active {
            display: flex;
        }

        .spinner {
            width: 16px;
            height: 16px;
            border: 2px solid rgba(255,255,255,0.3);
            border-top: 2px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Notificaci√≥n de copia */
        .copy-notification {
            position: fixed;
            top: 200px;
            right: 20px;
            background: var(--normal-color);
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 500;
            opacity: 0;
            transform: translateX(100px);
            transition: all 0.3s ease;
            z-index: 1002;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .copy-notification.show {
            opacity: 1;
            transform: translateX(0);
        }

        /* Ajustar contenido principal cuando panel est√° activo */
        .split-view-active .main-container {
            margin-right: 420px;
            transition: margin-right 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        /* üé® CONTENEDOR PRINCIPAL CON VISTA DIVIDIDA */
        .main-container {
            background: var(--card-bg);
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            padding: 30px;
            margin: 0 20px;
            transition: all 0.3s ease;
        }

        .split-view .main-container {
            margin-left: 320px;
            margin-right: 20px;
        }

        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
            font-size: 28px;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            padding-bottom: 15px;
        }

        /* ‚úÖ SECCIONES MEJORADAS */
        .section {
            margin-bottom: 25px;
            border: 2px solid #ecf0f1;
            border-radius: 12px;
            overflow: hidden;
            transition: all 0.3s ease;
            background: var(--card-bg);
        }
        
        .section.active {
            border-color: #667eea;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.15);
        }

        .section.hidden {
            display: none;
        }
        
        .section-header {
            background: var(--primary-gradient);
            color: white;
            padding: 15px 20px;
            cursor: pointer;
            font-weight: 600;
            font-size: 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }
        
        .section-header:hover {
            box-shadow: inset 0 0 20px rgba(255,255,255,0.1);
        }
        
        .section-header .arrow {
            transition: transform 0.3s ease;
            font-size: 18px;
        }
        
        .section-header.expanded .arrow {
            transform: rotate(180deg);
        }

        .section-header .completion-badge {
            background: rgba(255,255,255,0.2);
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            margin-left: 10px;
        }

        .section-header .completion-badge.completed {
            background: var(--normal-color);
        }
        
        .section-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease-in-out;
            background: var(--light-bg);
        }
        
        .section-content.expanded {
            padding: 20px;
        }
        
        /* üìã CONTENEDORES DE EXAMEN MEJORADOS */
        .exam-container {
            background: var(--card-bg);
            border: 1px solid #e1e8ed;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }

        .exam-container:hover {
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .exam-header {
            font-size: 18px;
            font-weight: 600;
            background: var(--secondary-gradient);
            color: white;
            margin: -20px -20px 15px -20px;
            padding: 12px 20px;
            border-radius: 8px 8px 0 0;
        }
        
        .exam-section {
            background: var(--light-bg);
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
        }
        
        .exam-section h4 {
            color: #2c3e50;
            margin: 0 0 10px 0;
            font-size: 14px;
            font-weight: 600;
        }

        .sub-header {
            color: #229954;
            margin: 15px 0 8px 0;
            font-size: 13px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* ‚úÖ GRID DE CHECKBOXES MEJORADO */
        .checkbox-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 8px;
            margin-bottom: 15px;
        }
        
        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 8px;
            border-radius: 4px;
            transition: all 0.3s ease;
        }

        .checkbox-item:hover {
            background: rgba(102, 126, 234, 0.05);
        }
        
        .checkbox-item input[type="checkbox"] {
            width: 16px;
            height: 16px;
            margin: 0;
            accent-color: var(--normal-color);
        }

        .checkbox-item input[type="radio"] {
            width: 16px;
            height: 16px;
            margin: 0;
            accent-color: var(--normal-color);
        }
        
        .checkbox-item label {
            font-size: 13px;
            color: #2c3e50;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .checkbox-item input:checked + label {
            color: var(--normal-color);
            font-weight: 500;
        }

        /* üìä ESCALAS VISUALES MEJORADAS */
        .risk-meter {
            background: linear-gradient(90deg, var(--normal-color) 0%, var(--warning-color) 50%, var(--alert-color) 100%);
            height: 8px;
            border-radius: 4px;
            margin: 10px 0;
            position: relative;
            overflow: hidden;
        }

        .risk-indicator {
            position: absolute;
            top: -5px;
            width: 18px;
            height: 18px;
            background: white;
            border: 3px solid #333;
            border-radius: 50%;
            transition: left 0.3s ease;
        }

        .child-pugh-bar {
            height: 20px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            margin: 10px 0;
            transition: all 0.3s ease;
        }

        .child-pugh-a { background: var(--normal-color); }
        .child-pugh-b { background: var(--warning-color); }
        .child-pugh-c { background: var(--alert-color); }

        /* üé® ELEMENTOS VISUALES DISTINTIVOS */
        .measurement {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 5px 0;
        }
        
        .measurement label {
            font-size: 12px;
            color: #5d6d7e;
            flex-basis: 120px;
            flex-shrink: 0;
        }
        
        .input-field {
            width: 80px;
            padding: 6px 10px;
            border: 2px solid #e9ecef;
            border-radius: 6px;
            font-size: 12px;
            text-align: center;
            transition: all 0.3s ease;
        }
        
        .input-field:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        /* üó∫Ô∏è MAPA ABDOMINAL MEJORADO */
        .abdomen-map {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin: 15px 0;
            max-width: 450px;
        }

        .abdomen-quadrant {
            padding: 15px 8px;
            border: 2px solid #e1e8ed;
            border-radius: 8px;
            background: var(--card-bg);
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 11px;
            font-weight: 600;
            position: relative;
            overflow: hidden;
        }

        .abdomen-quadrant::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            transition: left 0.5s ease;
        }

        .abdomen-quadrant:hover::before {
            left: 100%;
        }

        .abdomen-quadrant.selected {
            background: linear-gradient(135deg, #d5f4e6, #a8e6cf);
            border-color: var(--normal-color);
            color: #1e8449;
            transform: scale(1.02);
        }

        .abdomen-quadrant:hover {
            background: #e8f5e8;
            transform: translateY(-2px);
        }

        /* üìà ESCALAS DE DOLOR MEJORADAS */
        .pain-scale {
            background: linear-gradient(135deg, #fff3cd, #ffe8a1);
            border: 1px solid #ffc107;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
        }

        .pain-scale h4 {
            color: #856404;
            margin: 0 0 10px 0;
            font-size: 14px;
            font-weight: 600;
        }

        /* üî¨ RESULTADOS DE PRUEBAS */
        .test-results {
            margin-top: 10px;
        }
        
        .test-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            padding: 8px 12px;
            margin: 4px 0;
            background: var(--card-bg);
            border: 1px solid #e8ecef;
            border-radius: 6px;
            transition: all 0.3s ease;
        }

        .test-item:hover {
            border-color: #667eea;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.1);
        }
        
        .test-item label {
            font-size: 12px;
            color: #2c3e50;
            flex-grow: 1;
            margin-right: 10px;
        }
        
        .test-controls {
            display: flex;
            gap: 15px;
            align-items: center;
        }
        
        .test-checkbox {
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .test-checkbox input[type="checkbox"] {
            width: 16px;
            height: 16px;
        }
        
        .test-checkbox span {
            font-size: 12px;
            font-weight: 600;
        }
        
        .positive { color: var(--alert-color) !important; }
        .negative { color: var(--normal-color) !important; }

        /* üè• √ìRGANOS Y PALPACI√ìN */
        .organ-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-top: 10px;
        }
        
        .organ-section {
            padding: 15px;
            background: var(--card-bg);
            border: 1px solid #e8ecef;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .organ-section:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }
        
        .organ-header {
            font-weight: 600;
            font-size: 14px;
            color: #34495e;
            margin-bottom: 12px;
            text-align: center;
            border-bottom: 2px solid #667eea;
            padding-bottom: 8px;
        }
        
        .palpation-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 10px;
        }
        
        .palpation-section {
            padding: 15px;
            background: var(--card-bg);
            border: 1px solid #e8ecef;
            border-radius: 8px;
        }
        
        .palpation-section h5 {
            margin: 0 0 12px 0;
            font-size: 14px;
            color: var(--normal-color);
            text-align: center;
            font-weight: 600;
        }

        /* üìã CONCLUSI√ìN MEJORADA */
        .conclusion {
            margin-top: 30px;
            padding: 25px;
            background: var(--card-bg);
            border-radius: 12px;
            border: 2px solid #dee2e6;
            position: relative;
            overflow: hidden;
        }

        .conclusion::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--primary-gradient);
        }
        
        .conclusion h3 {
            color: #2c3e50;
            margin-bottom: 15px;
        }
        
        .conclusion-text {
            padding: 20px;
            background: var(--light-bg);
            border-radius: 8px;
            border: 1px solid #dee2e6;
            min-height: 200px;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            font-size: 13px;
            line-height: 1.5;
        }

        /* üéõÔ∏è BOTONES DE CONTROL MEJORADOS */
        .control-buttons {
            margin-top: 25px;
            display: flex;
            gap: 12px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        /* üåô MODO OSCURO */
        .theme-toggle {
            position: fixed;
            top: 20px;
            left: 20px;
            background: var(--primary-gradient);
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            font-size: 20px;
            cursor: pointer;
            z-index: 1001;
            transition: all 0.3s ease;
        }

        .theme-toggle:hover {
            transform: scale(1.1);
        }

        /* üè† BOT√ìN HOME MEJORADO */
        .home-button {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--normal-color);
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            font-size: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            text-decoration: none;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 1001;
            transition: all 0.3s ease;
        }
        
        .home-button:hover {
            background-color: #229954;
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(0,0,0,0.2);
        }

        /* Elementos adicionales */
        .legend {
            display: flex;
            gap: 20px;
            margin-bottom: 15px;
            font-size: 12px;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 2px;
        }

        .inspection-color { background-color: #3498db; }
        .auscultation-color { background-color: #9b59b6; }
        .percussion-color { background-color: #f39c12; }
        .palpation-color { background-color: var(--normal-color); }

        .severity-section {
            background: #fdf2f2;
            border: 1px solid var(--alert-color);
            border-radius: 6px;
            padding: 15px;
            margin-top: 15px;
        }

        .severity-section h4 {
            color: #c53030;
            margin: 0 0 10px 0;
            font-size: 14px;
            font-weight: 600;
        }

        .description-area {
            width: 100%;
            min-height: 60px;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 12px;
            resize: vertical;
        }

        .score-calculation {
            background: #e8f5e8;
            border: 1px solid var(--normal-color);
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
        }

        .score-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 5px 0;
            font-size: 13px;
        }

        .score-value {
            font-weight: 600;
            color: #2e7d32;
        }

        .vital-signs {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            border: 1px solid var(--info-color);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .vital-signs h4 {
            color: #1565c0;
            margin: 0 0 10px 0;
            font-size: 14px;
            font-weight: 600;
        }

        .vital-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
        }

        .stool-chart {
            background: var(--light-bg);
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
        }

        .bristol-scale {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 8px;
            margin-top: 10px;
        }

        .bristol-item {
            display: flex;
            align-items: center;
            gap: 4px;
            padding: 4px;
            font-size: 11px;
        }

        .bristol-item input[type="radio"] {
            width: 12px;
            height: 12px;
        }

        /* NUEVOS ESTILOS PARA ANTECEDENTES Y REVISI√ìN POR SISTEMAS */
        .history-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        .history-item {
            background: var(--card-bg);
            border: 1px solid #e8ecef;
            border-radius: 6px;
            padding: 12px;
            transition: all 0.3s ease;
        }

        .history-item:hover {
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .quick-input {
            display: flex;
            align-items: center;
            gap: 8px;
            margin: 5px 0;
        }

        .quick-input input[type="text"] {
            flex: 1;
            padding: 4px 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 12px;
        }

        .quick-input input[type="number"] {
            width: 60px;
            padding: 4px 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 12px;
        }

        .auto-populate {
            background: rgba(40, 167, 69, 0.1);
            border: 1px solid var(--normal-color);
            color: var(--normal-color);
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 3px;
            margin-left: 5px;
            cursor: pointer;
        }

        /* üì± RESPONSIVIDAD MEJORADA */
        @media (max-width: 1200px) {
            .sticky-panel {
                width: 350px;
            }
            
            .split-view-active .main-container {
                margin-right: 370px;
            }
        }

        @media (max-width: 768px) {
            body { padding-top: 120px; }
            
            .dashboard-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .control-bar {
                position: relative;
                top: auto;
                right: auto;
                justify-content: center;
                margin: 10px 0;
            }
            
            .nav-panel {
                transform: translateX(-100%);
                width: calc(100vw - 40px);
            }
            
            .main-container {
                margin: 0 10px;
            }
            
            .split-view .main-container {
                margin-left: 10px;
            }

            .sticky-panel {
                width: calc(100vw - 20px);
                right: -100vw;
                left: 10px;
                border-radius: 12px;
            }
            
            .sticky-panel.active {
                right: auto;
                left: 10px;
            }
            
            .split-view-active .main-container {
                margin-right: 10px;
            }
            
            .checkbox-grid {
                grid-template-columns: 1fr;
            }
            
            .organ-container {
                grid-template-columns: 1fr;
            }
        }

        /* ‚ö° ANIMACIONES */
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        @keyframes slideIn {
            from { transform: translateX(-20px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .slide-in {
            animation: slideIn 0.3s ease forwards;
        }
    </style>
</head>
<body>
    <!-- üåô TOGGLE DE TEMA -->
    <button class="theme-toggle" onclick="toggleTheme()" title="Cambiar tema">
        <i class="fas fa-moon" id="theme-icon"></i>
    </button>

    <!-- üè† BOT√ìN HOME -->
    <a href="index.html" class="home-button" title="Inicio">
        <i class="fas fa-home"></i>
    </a>

    <!-- üé™ DASHBOARD SUPERIOR FIJO -->
    <div class="dashboard-fixed">
        <div class="dashboard-content">
            <div class="dashboard-grid">
                <div class="dashboard-item">
                    <i class="fas fa-user-md"></i>
                    <div>Examen</div>
                    <div id="exam-progress">0%</div>
                </div>
                <div class="dashboard-item">
                    <i class="fas fa-clipboard-list"></i>
                    <div>Secciones</div>
                    <div id="sections-completed">0/13</div>
                </div>
                <div class="dashboard-item dashboard-alert" id="alerts-item">
                    <i class="fas fa-exclamation-triangle"></i>
                    <div>Alertas</div>
                    <div id="alert-count">0</div>
                </div>
                <div class="dashboard-item dashboard-warning" id="warnings-item">
                    <i class="fas fa-exclamation-circle"></i>
                    <div>Avisos</div>
                    <div id="warning-count">0</div>
                </div>
                <div class="dashboard-item dashboard-normal" id="findings-item">
                    <i class="fas fa-search"></i>
                    <div>Hallazgos</div>
                    <div id="findings-count">0</div>
                </div>
                <div class="dashboard-item">
                    <i class="fas fa-heartbeat"></i>
                    <div>Completitud</div>
                    <div id="completeness-status">0%</div>
                </div>
            </div>
            <div class="control-bar">
                <button class="control-btn btn-primary" onclick="toggleNavPanel()">
                    <i class="fas fa-bars"></i> Navegaci√≥n
                </button>
                <button class="control-btn btn-primary" onclick="toggleStickyPanel()" id="sticky-toggle-btn">
                    <i class="fas fa-columns"></i> Vista Dividida
                </button>
                <button class="control-btn btn-success" onclick="generateConclusion()">
                    <i class="fas fa-file-medical"></i> Generar
                </button>
                <button class="control-btn btn-warning" onclick="expandAllSections()">
                    <i class="fas fa-expand-alt"></i> Expandir
                </button>
                <button class="control-btn btn-success" onclick="autoPopulateCommon()">
                    <i class="fas fa-magic"></i> Auto-rellenar
                </button>
                <button class="control-btn btn-danger" onclick="clearForm()">
                    <i class="fas fa-trash"></i> Limpiar
                </button>
            </div>
        </div>
    </div>

    <!-- üéØ PANEL LATERAL DE NAVEGACI√ìN -->
    <div class="nav-panel" id="nav-panel">
        <h3><i class="fas fa-map"></i> Navegaci√≥n R√°pida</h3>
        <div class="nav-item" onclick="scrollToSection('antecedentes')">
            <i class="fas fa-history"></i>
            <span>Antecedentes</span>
            <i class="fas fa-check" style="margin-left: auto; opacity: 0;" id="nav-antecedentes"></i>
        </div>
        <div class="nav-item" onclick="scrollToSection('revision-sistemas')">
            <i class="fas fa-list-ul"></i>
            <span>Revisi√≥n por Sistemas</span>
            <i class="fas fa-check" style="margin-left: auto; opacity: 0;" id="nav-revision-sistemas"></i>
        </div>
        <div class="nav-item" onclick="scrollToSection('anamnesis')">
            <i class="fas fa-user-edit"></i>
            <span>Anamnesis</span>
            <i class="fas fa-check" style="margin-left: auto; opacity: 0;" id="nav-anamnesis"></i>
        </div>
        <div class="nav-item" onclick="scrollToSection('oral-cavity')">
            <i class="fas fa-teeth"></i>
            <span>Cavidad Oral</span>
            <i class="fas fa-check" style="margin-left: auto; opacity: 0;" id="nav-oral-cavity"></i>
        </div>
        <div class="nav-item" onclick="scrollToSection('vital-signs')">
            <i class="fas fa-heartbeat"></i>
            <span>Signos Vitales</span>
            <i class="fas fa-check" style="margin-left: auto; opacity: 0;" id="nav-vital-signs"></i>
        </div>
        <div class="nav-item" onclick="scrollToSection('inspection')">
            <i class="fas fa-eye"></i>
            <span>Inspecci√≥n</span>
            <i class="fas fa-check" style="margin-left: auto; opacity: 0;" id="nav-inspection"></i>
        </div>
        <div class="nav-item" onclick="scrollToSection('auscultation')">
            <i class="fas fa-stethoscope"></i>
            <span>Auscultaci√≥n</span>
            <i class="fas fa-check" style="margin-left: auto; opacity: 0;" id="nav-auscultation"></i>
        </div>
        <div class="nav-item" onclick="scrollToSection('percussion')">
            <i class="fas fa-hand-paper"></i>
            <span>Percusi√≥n</span>
            <i class="fas fa-check" style="margin-left: auto; opacity: 0;" id="nav-percussion"></i>
        </div>
        <div class="nav-item" onclick="scrollToSection('palpation')">
            <i class="fas fa-hands"></i>
            <span>Palpaci√≥n</span>
            <i class="fas fa-check" style="margin-left: auto; opacity: 0;" id="nav-palpation"></i>
        </div>
        <div class="nav-item" onclick="scrollToSection('special-signs')">
            <i class="fas fa-search-plus"></i>
            <span>Signos Especiales</span>
            <i class="fas fa-check" style="margin-left: auto; opacity: 0;" id="nav-special-signs"></i>
        </div>
        <div class="nav-item" onclick="scrollToSection('organs')">
            <i class="fas fa-lungs"></i>
            <span>√ìrganos</span>
            <i class="fas fa-check" style="margin-left: auto; opacity: 0;" id="nav-organs"></i>
        </div>
        <div class="nav-item" onclick="scrollToSection('additional-exam')">
            <i class="fas fa-plus-circle"></i>
            <span>Examen Adicional</span>
            <i class="fas fa-check" style="margin-left: auto; opacity: 0;" id="nav-additional-exam"></i>
        </div>
        <div class="nav-item" onclick="scrollToSection('severity')">
            <i class="fas fa-chart-line"></i>
            <span>Escalas</span>
            <i class="fas fa-check" style="margin-left: auto; opacity: 0;" id="nav-severity"></i>
        </div>
    </div>

    <!-- üìä PANEL LATERAL STICKY - FUNCIONALIDAD PRINCIPAL -->
    <div class="sticky-panel" id="stickyConclusion">
        <div class="sticky-header">
            <span><i class="fas fa-file-medical-alt"></i> Informe en Tiempo Real</span>
            <div class="sticky-controls">
                <button class="sticky-btn" onclick="copyStickyToClipboard()" title="Copiar informe">
                    <i class="fas fa-copy"></i>
                </button>
                <button class="sticky-btn" onclick="printStickyConclusion()" title="Imprimir informe">
                    <i class="fas fa-print"></i>
                </button>
                <button class="sticky-btn" onclick="generateStickyConclusion()" title="Actualizar informe">
                    <i class="fas fa-sync-alt"></i>
                </button>
            </div>
        </div>
        <div class="sticky-content" id="stickyContent">
            Seleccione los par√°metros del examen para generar el informe en tiempo real...
        </div>
        <div class="update-indicator" id="updateIndicator">
            <div class="spinner"></div>
            <span>Actualizando informe...</span>
        </div>
    </div>

    <!-- Notificaci√≥n de copia -->
    <div class="copy-notification" id="copyNotification">
        <i class="fas fa-check-circle"></i>
        <span>¬°Informe copiado al portapapeles!</span>
    </div>

    <div class="main-container">
        <h1><i class="fas fa-user-md"></i> Examen Gastroenterol√≥gico - Algoritmo de Evaluaci√≥n Avanzado</h1>
        
        <!-- NUEVA SECCI√ìN: Antecedentes Personales -->
        <div class="section" id="section-antecedentes">
            <div class="section-header" onclick="toggleSection(this)">
                <span><i class="fas fa-history"></i> Antecedentes Personales Patol√≥gicos y No Patol√≥gicos</span>
                <div style="display: flex; align-items: center;">
                    <div class="completion-badge" id="badge-antecedentes">
                        <i class="fas fa-circle"></i>
                    </div>
                    <span class="arrow">‚ñº</span>
                </div>
            </div>
            <div class="section-content" id="antecedentes">
                <div class="exam-container">
                    <div class="exam-header"><i class="fas fa-medical-kit"></i> Historial de Enfermedades Gastrointestinales Previas</div>
                    <div class="checkbox-grid">
                        <div class="checkbox-item"><input type="checkbox" id="ant-crohn"><label for="ant-crohn">Enfermedad de Crohn</label></div>
                        <div class="checkbox-item"><input type="checkbox" id="ant-colitis-ulcerosa"><label for="ant-colitis-ulcerosa">Colitis ulcerosa</label></div>
                        <div class="checkbox-item"><input type="checkbox" id="ant-pancreatitis"><label for="ant-pancreatitis">Pancreatitis</label></div>
                        <div class="checkbox-item"><input type="checkbox" id="ant-hepatitis"><label for="ant-hepatitis">Hepatitis</label></div>
                        <div class="checkbox-item"><input type="checkbox" id="ant-cirrosis"><label for="ant-cirrosis">Cirrosis</label></div>
                        <div class="checkbox-item"><input type="checkbox" id="ant-ulceras"><label for="ant-ulceras">√ölceras gastroduodenales</label></div>
                        <div class="checkbox-item"><input type="checkbox" id="ant-polipos"><label for="ant-polipos">P√≥lipos intestinales</label></div>
                        <div class="checkbox-item"><input type="checkbox" id="ant-cancer-colorrectal"><label for="ant-cancer-colorrectal">C√°ncer colorrectal</label></div>
                        <div class="checkbox-item"><input type="checkbox" id="ant-litiasis-biliar"><label for="ant-litiasis-biliar">Litiasis biliar</label></div>
                        <div class="checkbox-item"><input type="checkbox" id="ant-reflujo"><label for="ant-reflujo">Enfermedad por reflujo</label></div>
                        <div class="checkbox-item"><input type="checkbox" id="ant-sii"><label for="ant-sii">S√≠ndrome de intestino irritable</label></div>
                        <div class="checkbox-item"><input type="checkbox" id="ant-celiaquia"><label for="ant-celiaquia">Enfermedad cel√≠aca</label></div>
                        <div class="checkbox-item"><input type="checkbox" id="ant-sin-gi"><label for="ant-sin-gi">Sin antecedentes GI</label></div>
                    </div>
                </div>

                <div class="exam-container">
                    <div class="exam-header"><i class="fas fa-cut"></i> Cirug√≠as Gastrointestinales Previas</div>
                    <div class="checkbox-grid">
                        <div class="checkbox-item"><input type="checkbox" id="cir-apendicectomia"><label for="cir-apendicectomia">Apendicectom√≠a</label></div>
                        <div class="checkbox-item"><input type="checkbox" id="cir-colecistectomia"><label for="cir-colecistectomia">Colecistectom√≠a</label></div>
                        <div class="checkbox-item"><input type="checkbox" id="cir-reseccion-intestinal"><label for="cir-reseccion-intestinal">Resecci√≥n intestinal</label></div>
                        <div class="checkbox-item"><input type="checkbox" id="cir-funduplicatura"><label for="cir-funduplicatura">Funduplicatura</label></div>
                        <div class="checkbox-item"><input type="checkbox" id="cir-hernia"><label for="cir-hernia">Cirug√≠a de hernia</label></div>
                        <div class="checkbox-item"><input type="checkbox" id="cir-hemorroides"><label for="cir-hemorroides">Cirug√≠a de hemorroides</label></div>
                        <div class="checkbox-item"><input type="checkbox" id="cir-gastrectomia"><label for="cir-gastrectomia">Gastrectom√≠a</label></div>
                        <div class="checkbox-item"><input type="checkbox" id="cir-hepatectomia"><label for="cir-hepatectomia">Hepatectom√≠a</label></div>
                        <div class="checkbox-item"><input type="checkbox" id="cir-sin-gi"><label for="cir-sin-gi">Sin cirug√≠as GI</label></div>
                    </div>
                </div>

                <div class="exam-container">
                    <div class="exam-header"><i class="fas fa-pills"></i> Medicamentos Actuales y Recientes</div>
                    <div class="history-grid">
                        <div class="history-item">
                            <h4>AINEs</h4>
                            <div class="checkbox-item"><input type="checkbox" id="med-aines"><label for="med-aines">Uso de AINEs</label></div>
                            <div class="quick-input">
                                <input type="text" id="med-aines-tipo" placeholder="Tipo de AINE...">
                                <span class="auto-populate" onclick="autoPopulate('med-aines-tipo', 'Ibuprofeno')">Auto</span>
                            </div>
                        </div>
                        <div class="history-item">
                            <h4>Anticoagulantes</h4>
                            <div class="checkbox-item"><input type="checkbox" id="med-anticoagulantes"><label for="med-anticoagulantes">Anticoagulantes</label></div>
                            <div class="quick-input">
                                <input type="text" id="med-anticoag-tipo" placeholder="Tipo...">
                                <span class="auto-populate" onclick="autoPopulate('med-anticoag-tipo', 'Warfarina')">Auto</span>
                            </div>
                        </div>
                        <div class="history-item">
                            <h4>Antibi√≥ticos</h4>
                            <div class="checkbox-item"><input type="checkbox" id="med-antibioticos"><label for="med-antibioticos">Antibi√≥ticos recientes</label></div>
                            <div class="quick-input">
                                <input type="text" id="med-antibiot-tipo" placeholder="Tipo...">
                                <span class="auto-populate" onclick="autoPopulate('med-antibiot-tipo', 'Amoxicilina')">Auto</span>
                            </div>
                        </div>
                        <div class="history-item">
                            <h4>Otros</h4>
                            <div class="checkbox-item"><input type="checkbox" id="med-ibb"><label for="med-ibb">Inhibidores bomba protones</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="med-laxantes"><label for="med-laxantes">Laxantes</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="med-antiacidos"><label for="med-antiacidos">Anti√°cidos</label></div>
                        </div>
                    </div>
                </div>

                <div class="exam-container">
                    <div class="exam-header"><i class="fas fa-allergies"></i> Alergias y H√°bitos</div>
                    <div class="history-grid">
                        <div class="history-item">
                            <h4>Alergias Conocidas</h4>
                            <div class="checkbox-item"><input type="checkbox" id="alergia-medicamentos"><label for="alergia-medicamentos">Medicamentos</label></div>
                            <div class="quick-input">
                                <input type="text" id="alergia-med-tipo" placeholder="Especificar...">
                            </div>
                            <div class="checkbox-item"><input type="checkbox" id="alergia-alimentos"><label for="alergia-alimentos">Alimentos</label></div>
                            <div class="quick-input">
                                <input type="text" id="alergia-alim-tipo" placeholder="Especificar...">
                            </div>
                        </div>
                        <div class="history-item">
                            <h4>H√°bitos T√≥xicos</h4>
                            <div class="checkbox-item"><input type="checkbox" id="habito-tabaco"><label for="habito-tabaco">Tabaquismo</label></div>
                            <div class="quick-input">
                                <input type="number" id="habito-tabaco-paq" placeholder="Paq/d√≠a">
                                <input type="number" id="habito-tabaco-a√±os" placeholder="A√±os">
                            </div>
                            <div class="checkbox-item"><input type="checkbox" id="habito-alcohol"><label for="habito-alcohol">Alcoholismo</label></div>
                            <div class="quick-input">
                                <input type="text" id="habito-alcohol-tipo" placeholder="Tipo y cantidad...">
                            </div>
                        </div>
                        <div class="history-item">
                            <h4>Historia Familiar</h4>
                            <div class="checkbox-item"><input type="checkbox" id="fam-cancer-colon"><label for="fam-cancer-colon">C√°ncer colorrectal</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="fam-eii"><label for="fam-eii">Enfermedad inflamatoria intestinal</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="fam-celiaquia"><label for="fam-celiaquia">Celiaqu√≠a</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="fam-polipos"><label for="fam-polipos">P√≥lipos</label></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- NUEVA SECCI√ìN: Revisi√≥n por Sistemas -->
        <div class="section" id="section-revision-sistemas">
            <div class="section-header" onclick="toggleSection(this)">
                <span><i class="fas fa-list-ul"></i> Revisi√≥n por Sistemas</span>
                <div style="display: flex; align-items: center;">
                    <div class="completion-badge" id="badge-revision-sistemas">
                        <i class="fas fa-circle"></i>
                    </div>
                    <span class="arrow">‚ñº</span>
                </div>
            </div>
            <div class="section-content" id="revision-sistemas">
                <div class="exam-container">
                    <div class="exam-header"><i class="fas fa-thermometer-half"></i> S√≠ntomas Constitucionales</div>
                    <div class="checkbox-grid">
                        <div class="checkbox-item"><input type="checkbox" id="const-fiebre"><label for="const-fiebre">Fiebre</label></div>
                        <div class="checkbox-item"><input type="checkbox" id="const-escalofrios"><label for="const-escalofrios">Escalofr√≠os</label></div>
                        <div class="checkbox-item"><input type="checkbox" id="const-fatiga"><label for="const-fatiga">Fatiga</label></div>
                        <div class="checkbox-item"><input type="checkbox" id="const-sudoracion"><label for="const-sudoracion">Sudoraci√≥n nocturna</label></div>
                        <div class="checkbox-item"><input type="checkbox" id="const-perdida-peso"><label for="const-perdida-peso">P√©rdida de peso involuntaria</label></div>
                        <div class="checkbox-item"><input type="checkbox" id="const-ganancia-peso"><label for="const-ganancia-peso">Ganancia de peso</label></div>
                    </div>
                </div>

                <div class="exam-container">
                    <div class="exam-header"><i class="fas fa-heart"></i> S√≠ntomas Cardiovasculares y Respiratorios</div>
                    <div class="history-grid">
                        <div class="history-item">
                            <h4>Cardiovasculares</h4>
                            <div class="checkbox-item"><input type="checkbox" id="cardio-dolor-toracico"><label for="cardio-dolor-toracico">Dolor tor√°cico</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="cardio-palpitaciones"><label for="cardio-palpitaciones">Palpitaciones</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="cardio-disnea"><label for="cardio-disnea">Disnea</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="cardio-edema"><label for="cardio-edema">Edema perif√©rico</label></div>
                        </div>
                        <div class="history-item">
                            <h4>Respiratorios</h4>
                            <div class="checkbox-item"><input type="checkbox" id="resp-tos"><label for="resp-tos">Tos cr√≥nica</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="resp-disnea"><label for="resp-disnea">Disnea</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="resp-sibilancias"><label for="resp-sibilancias">Sibilancias</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="resp-hemoptisis"><label for="resp-hemoptisis">Hemoptisis</label></div>
                        </div>
                    </div>
                </div>

                <div class="exam-container">
                    <div class="exam-header"><i class="fas fa-user-md"></i> Otros Sistemas</div>
                    <div class="history-grid">
                        <div class="history-item">
                            <h4>Genitourinarios</h4>
                            <div class="checkbox-item"><input type="checkbox" id="gu-disuria"><label for="gu-disuria">Disuria</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="gu-hematuria"><label for="gu-hematuria">Hematuria</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="gu-polaquiuria"><label for="gu-polaquiuria">Polaquiuria</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="gu-urgencia"><label for="gu-urgencia">Urgencia urinaria</label></div>
                        </div>
                        <div class="history-item">
                            <h4>Dermatol√≥gicos</h4>
                            <div class="checkbox-item"><input type="checkbox" id="derm-erupciones"><label for="derm-erupciones">Erupciones cut√°neas</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="derm-nodulos"><label for="derm-nodulos">N√≥dulos</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="derm-eritema-nodoso"><label for="derm-eritema-nodoso">Eritema nodoso</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="derm-prurito"><label for="derm-prurito">Prurito</label></div>
                        </div>
                        <div class="history-item">
                            <h4>Osteomusculares</h4>
                            <div class="checkbox-item"><input type="checkbox" id="osteo-artralgias"><label for="osteo-artralgias">Artralgias</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="osteo-mialgias"><label for="osteo-mialgias">Mialgias</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="osteo-rigidez"><label for="osteo-rigidez">Rigidez matutina</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="osteo-limitacion"><label for="osteo-limitacion">Limitaci√≥n funcional</label></div>
                        </div>
                        <div class="history-item">
                            <h4>Neurol√≥gicos</h4>
                            <div class="checkbox-item"><input type="checkbox" id="neuro-confusion"><label for="neuro-confusion">Confusi√≥n</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="neuro-cefalea"><label for="neuro-cefalea">Cefalea</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="neuro-neuropatia"><label for="neuro-neuropatia">Neuropat√≠a</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="neuro-mareos"><label for="neuro-mareos">Mareos</label></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Anamnesis y Quejas (SECCI√ìN ORIGINAL) -->
        <div class="section" id="section-anamnesis">
            <div class="section-header" onclick="toggleSection(this)">
                <span><i class="fas fa-user-edit"></i> Anamnesis y Quejas Principales</span>
                <div style="display: flex; align-items: center;">
                    <div class="completion-badge" id="badge-anamnesis">
                        <i class="fas fa-circle"></i>
                    </div>
                    <span class="arrow">‚ñº</span>
                </div>
            </div>
            <div class="section-content" id="anamnesis">
                <div class="exam-container">
                    <div class="exam-header"><i class="fas fa-clipboard-list"></i> Quejas Gastroenterol√≥gicas Principales</div>
                    <div class="checkbox-grid">
                        <div class="checkbox-item"><input type="checkbox" id="dolor-abdominal" onchange="handlePainComplaint(this)"><label for="dolor-abdominal">Dolor abdominal</label></div>
                        <div class="checkbox-item"><input type="checkbox" id="nauseas"><label for="nauseas">N√°useas</label></div>
                        <div class="checkbox-item"><input type="checkbox" id="vomitos"><label for="vomitos">V√≥mitos</label></div>
                        <div class="checkbox-item"><input type="checkbox" id="diarrea" onchange="handleStoolComplaint(this)"><label for="diarrea">Diarrea</label></div>
                        <div class="checkbox-item"><input type="checkbox" id="estre√±imiento" onchange="handleStoolComplaint(this)"><label for="estre√±imiento">Estre√±imiento</label></div>
                        <div class="checkbox-item"><input type="checkbox" id="distension-abdominal"><label for="distension-abdominal">Distensi√≥n abdominal</label></div>
                        <div class="checkbox-item"><input type="checkbox" id="acidez"><label for="acidez">Acidez/Pirosis</label></div>
                        <div class="checkbox-item"><input type="checkbox" id="regurgitacion"><label for="regurgitacion">Regurgitaci√≥n</label></div>
                        <div class="checkbox-item"><input type="checkbox" id="disfagia"><label for="disfagia">Disfagia</label></div>
                        <div class="checkbox-item"><input type="checkbox" id="odinofagia"><label for="odinofagia">Odinofagia</label></div>
                        <div class="checkbox-item"><input type="checkbox" id="melena" onchange="syncMelenaFields(this)"><label for="melena">Melena</label></div>
                        <div class="checkbox-item"><input type="checkbox" id="rectorragia"><label for="rectorragia">Rectorragia</label></div>
                        <div class="checkbox-item"><input type="checkbox" id="hematemesis"><label for="hematemesis">Hematemesis</label></div>
                        <div class="checkbox-item"><input type="checkbox" id="ictericia" onchange="syncIctericiaFields(this)"><label for="ictericia">Ictericia</label></div>
                        <div class="checkbox-item"><input type="checkbox" id="perdida-peso"><label for="perdida-peso">P√©rdida de peso</label></div>
                        <div class="checkbox-item"><input type="checkbox" id="anorexia"><label for="anorexia">Anorexia</label></div>
                        <div class="checkbox-item"><input type="checkbox" id="saciedad-precoz"><label for="saciedad-precoz">Saciedad precoz</label></div>
                        <div class="checkbox-item"><input type="checkbox" id="flatulencia"><label for="flatulencia">Flatulencia</label></div>
                        <div class="checkbox-item"><input type="checkbox" id="eructos"><label for="eructos">Eructos</label></div>
                        <div class="checkbox-item"><input type="checkbox" id="sin-quejas-gi" onchange="handleNoComplaints()"><label for="sin-quejas-gi">Sin quejas</label></div>
                    </div>
                </div>

                <!-- SECCI√ìN DE DOLOR ABDOMINAL - INICIALMENTE OCULTA -->
                <div class="exam-container hidden" id="dolor-section">
                    <div class="exam-header"><i class="fas fa-exclamation-triangle"></i> Caracter√≠sticas del Dolor Abdominal</div>
                    <div class="exam-section">
                        <h4>Localizaci√≥n del Dolor</h4>
                        <div class="abdomen-map">
                            <div class="abdomen-quadrant" onclick="toggleQuadrant(this, 'hcd')" id="hcd">HCD<br>(Hipocondrio Derecho)</div>
                            <div class="abdomen-quadrant" onclick="toggleQuadrant(this, 'epigastrio')" id="epigastrio">Epigastrio</div>
                            <div class="abdomen-quadrant" onclick="toggleQuadrant(this, 'hci')" id="hci">HCI<br>(Hipocondrio Izquierdo)</div>
                            <div class="abdomen-quadrant" onclick="toggleQuadrant(this, 'flanco-derecho')" id="flanco-derecho">Flanco<br>Derecho</div>
                            <div class="abdomen-quadrant" onclick="toggleQuadrant(this, 'mesogastrio')" id="mesogastrio">Mesogastrio<br>(Periumbilical)</div>
                            <div class="abdomen-quadrant" onclick="toggleQuadrant(this, 'flanco-izquierdo')" id="flanco-izquierdo">Flanco<br>Izquierdo</div>
                            <div class="abdomen-quadrant" onclick="toggleQuadrant(this, 'fid')" id="fid">FID<br>(Fosa Il√≠aca Derecha)</div>
                            <div class="abdomen-quadrant" onclick="toggleQuadrant(this, 'hipogastrio')" id="hipogastrio">Hipogastrio<br>(Suprap√∫bico)</div>
                            <div class="abdomen-quadrant" onclick="toggleQuadrant(this, 'fii')" id="fii">FII<br>(Fosa Il√≠aca Izquierda)</div>
                        </div>
                    </div>

                    <div class="pain-scale">
                        <h4><i class="fas fa-thermometer-half"></i> Intensidad del Dolor</h4>
                        <div class="measurement">
                            <label>Escala Visual An√°loga:</label>
                            <input type="range" id="dolor-intensidad" min="0" max="10" value="0" oninput="updateDolorValue(this.value)">
                            <span id="dolor-value">0</span><span>/10</span>
                        </div>
                        <div class="risk-meter">
                            <div class="risk-indicator" id="pain-indicator"></div>
                        </div>
                    </div>

                    <div class="exam-section">
                        <h4>Caracter√≠sticas del Dolor</h4>
                        <div class="checkbox-grid">
                            <div class="checkbox-item"><input type="radio" name="tipo-dolor" id="dolor-colico"><label for="dolor-colico">C√≥lico</label></div>
                            <div class="checkbox-item"><input type="radio" name="tipo-dolor" id="dolor-punzante"><label for="dolor-punzante">Punzante</label></div>
                            <div class="checkbox-item"><input type="radio" name="tipo-dolor" id="dolor-urente"><label for="dolor-urente">Urente</label></div>
                            <div class="checkbox-item"><input type="radio" name="tipo-dolor" id="dolor-sordo"><label for="dolor-sordo">Sordo/Constante</label></div>
                            <div class="checkbox-item"><input type="radio" name="tipo-dolor" id="dolor-opresivo"><label for="dolor-opresivo">Opresivo</label></div>
                        </div>
                        <div class="checkbox-grid">
                            <div class="checkbox-item"><input type="checkbox" id="dolor-irradiado"><label for="dolor-irradiado">Dolor irradiado</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="dolor-nocturno"><label for="dolor-nocturno">Dolor nocturno</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="dolor-postprandial"><label for="dolor-postprandial">Dolor postprandial</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="dolor-ayunas"><label for="dolor-ayunas">Dolor en ayunas</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="dolor-defecacion"><label for="dolor-defecacion">Relacionado con defecaci√≥n</label></div>
                        </div>
                    </div>
                </div>

                <!-- SECCI√ìN DE DEPOSICIONES - INICIALMENTE OCULTA -->
                <div class="exam-container hidden" id="deposiciones-section">
                    <div class="exam-header"><i class="fas fa-toilet-paper"></i> Caracter√≠sticas de las Deposiciones</div>
                    <div class="stool-chart">
                        <h4>Escala de Bristol</h4>
                        <div class="bristol-scale">
                            <div class="bristol-item"><input type="radio" name="bristol" id="bristol-1"><label for="bristol-1">Tipo 1: Terrones duros</label></div>
                            <div class="bristol-item"><input type="radio" name="bristol" id="bristol-2"><label for="bristol-2">Tipo 2: Forma de salchicha grumosa</label></div>
                            <div class="bristol-item"><input type="radio" name="bristol" id="bristol-3"><label for="bristol-3">Tipo 3: Salchicha con grietas</label></div>
                            <div class="bristol-item"><input type="radio" name="bristol" id="bristol-4"><label for="bristol-4">Tipo 4: Salchicha lisa</label></div>
                            <div class="bristol-item"><input type="radio" name="bristol" id="bristol-5"><label for="bristol-5">Tipo 5: Trozos blandos</label></div>
                            <div class="bristol-item"><input type="radio" name="bristol" id="bristol-6"><label for="bristol-6">Tipo 6: Fragmentos pastosos</label></div>
                            <div class="bristol-item"><input type="radio" name="bristol" id="bristol-7"><label for="bristol-7">Tipo 7: L√≠quida</label></div>
                        </div>
                    </div>
                    <div class="exam-section">
                        <h4>Caracter√≠sticas Adicionales</h4>
                        <div class="checkbox-grid">
                            <div class="checkbox-item"><input type="checkbox" id="heces-con-sangre"><label for="heces-con-sangre">Sangre visible</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="heces-con-moco"><label for="heces-con-moco">Moco</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="heces-con-pus"><label for="heces-con-pus">Pus</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="heces-grasosas"><label for="heces-grasosas">Esteatorrea</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="heces-negras"><label for="heces-negras">Melena</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="heces-acolia" onchange="syncAcoliaFields(this)"><label for="heces-acolia">Ac√≥licas</label></div>
                        </div>
                        <div class="measurement">
                            <label>Frecuencia diaria:</label>
                            <input type="number" class="input-field" id="frecuencia-deposiciones" min="0" max="20">
                            <span>veces/d√≠a</span>
                        </div>
                    </div>
                </div>

                <div class="exam-container">
                    <div class="exam-header"><i class="fas fa-search"></i> Factores Desencadenantes y Asociados</div>
                    <div class="checkbox-grid">
                        <div class="checkbox-item"><input type="checkbox" id="relacion-comidas"><label for="relacion-comidas">Relacionado con comidas</label></div>
                        <div class="checkbox-item"><input type="checkbox" id="estres-emocional"><label for="estres-emocional">Estr√©s emocional</label></div>
                        <div class="checkbox-item"><input type="checkbox" id="alcohol"><label for="alcohol">Consumo de alcohol</label></div>
                        <div class="checkbox-item"><input type="checkbox" id="medicamentos-nuevos"><label for="medicamentos-nuevos">Medicamentos nuevos</label></div>
                        <div class="checkbox-item"><input type="checkbox" id="viajes-recientes"><label for="viajes-recientes">Viajes recientes</label></div>
                        <div class="checkbox-item"><input type="checkbox" id="alimentos-contaminados"><label for="alimentos-contaminados">Alimentos en mal estado</label></div>
                        <div class="checkbox-item"><input type="checkbox" id="aines"><label for="aines">Uso de AINEs</label></div>
                        <div class="checkbox-item"><input type="checkbox" id="antibioticos"><label for="antibioticos">Antibi√≥ticos recientes</label></div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Examen de Cavidad Oral (SECCI√ìN ORIGINAL) -->
        <div class="section" id="section-oral-cavity">
            <div class="section-header" onclick="toggleSection(this)">
                <span><i class="fas fa-teeth"></i> Examen de Cavidad Oral</span>
                <div style="display: flex; align-items: center;">
                    <div class="completion-badge" id="badge-oral-cavity">
                        <i class="fas fa-circle"></i>
                    </div>
                    <span class="arrow">‚ñº</span>
                </div>
            </div>
            <div class="section-content" id="oral-cavity">
                <div class="exam-container">
                    <div class="exam-header"><i class="fas fa-lips"></i> Labios y Regi√≥n Perioral</div>
                    <div class="exam-section">
                        <h4>Caracter√≠sticas de los Labios</h4>
                        <div class="checkbox-grid">
                            <div class="checkbox-item"><input type="checkbox" id="labios-normales"><label for="labios-normales">Aspecto normal</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="queilitis"><label for="queilitis">Queilitis</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="fisuras-labiales"><label for="fisuras-labiales">Fisuras</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="cianosis-labial"><label for="cianosis-labial">Cianosis</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="palidez-labial"><label for="palidez-labial">Palidez</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="ulceras-labiales"><label for="ulceras-labiales">√ölceras</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="herpes-labial"><label for="herpes-labial">Herpes labial</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="sequedad-labial"><label for="sequedad-labial">Sequedad</label></div>
                        </div>
                    </div>
                </div>

                <div class="exam-container">
                    <div class="exam-header"><i class="fas fa-mouth-open"></i> Mucosa Oral y Enc√≠as</div>
                    <div class="exam-section">
                        <h4>Mucosa Bucal</h4>
                        <div class="checkbox-grid">
                            <div class="checkbox-item"><input type="checkbox" id="mucosa-normal"><label for="mucosa-normal">Mucosa rosada y h√∫meda</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="mucosa-palida"><label for="mucosa-palida">Mucosa p√°lida</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="mucosa-ict√©rica"><label for="mucosa-ict√©rica">Mucosa ict√©rica</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="mucosa-seca"><label for="mucosa-seca">Mucosa seca (xerostom√≠a)</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="petequias-orales"><label for="petequias-orales">Petequias</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="ulceras-aftosas"><label for="ulceras-aftosas">√ölceras aftosas</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="leucoplasia"><label for="leucoplasia">Leucoplasia</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="candidiasis-oral"><label for="candidiasis-oral">Candidiasis oral</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="gingivitis"><label for="gingivitis">Gingivitis</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="gingivorragia"><label for="gingivorragia">Gingivorragia</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="hipertrofia-gingival"><label for="hipertrofia-gingival">Hipertrofia gingival</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="retraccion-gingival"><label for="retraccion-gingival">Retracci√≥n gingival</label></div>
                        </div>
                    </div>
                </div>

                <div class="exam-container">
                    <div class="exam-header"><i class="fas fa-comment"></i> Lengua</div>
                    <div class="exam-section">
                        <h4>Caracter√≠sticas de la Lengua</h4>
                        <div class="checkbox-grid">
                            <div class="checkbox-item"><input type="checkbox" id="lengua-normal"><label for="lengua-normal">Aspecto normal</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="macroglosia"><label for="macroglosia">Macroglosia</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="microglosia"><label for="microglosia">Microglosia</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="lengua-saburrosa"><label for="lengua-saburrosa">Lengua saburrosa</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="lengua-geografica"><label for="lengua-geografica">Lengua geogr√°fica</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="lengua-fisurada"><label for="lengua-fisurada">Lengua fisurada</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="glositis"><label for="glositis">Glositis</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="lengua-vellosa"><label for="lengua-vellosa">Lengua vellosa negra</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="atrofia-papilar"><label for="atrofia-papilar">Atrofia papilar</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="ulceras-linguales"><label for="ulceras-linguales">√ölceras linguales</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="leucoplasia-lingual"><label for="leucoplasia-lingual">Leucoplasia lingual</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="temblor-lingual"><label for="temblor-lingual">Temblor lingual</label></div>
                        </div>
                    </div>
                    <div class="exam-section">
                        <h4>Color de la Lengua</h4>
                        <div class="checkbox-grid">
                            <div class="checkbox-item"><input type="radio" name="color-lengua" id="lengua-rosada"><label for="lengua-rosada">Rosada normal</label></div>
                            <div class="checkbox-item"><input type="radio" name="color-lengua" id="lengua-roja"><label for="lengua-roja">Roja (lengua en fresa)</label></div>
                            <div class="checkbox-item"><input type="radio" name="color-lengua" id="lengua-palida"><label for="lengua-palida">P√°lida</label></div>
                            <div class="checkbox-item"><input type="radio" name="color-lengua" id="lengua-violacea"><label for="lengua-violacea">Viol√°cea</label></div>
                            <div class="checkbox-item"><input type="radio" name="color-lengua" id="lengua-negra"><label for="lengua-negra">Negra</label></div>
                            <div class="checkbox-item"><input type="radio" name="color-lengua" id="lengua-blanquecina"><label for="lengua-blanquecina">Blanquecina</label></div>
                        </div>
                    </div>
                </div>

                <div class="exam-container">
                    <div class="exam-header"><i class="fas fa-tooth"></i> Dientes y Estado Dental</div>
                    <div class="exam-section">
                        <h4>Evaluaci√≥n Dental</h4>
                        <div class="checkbox-grid">
                            <div class="checkbox-item"><input type="checkbox" id="denticion-completa"><label for="denticion-completa">Dentici√≥n completa</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="edentulismo-parcial"><label for="edentulismo-parcial">Edentulismo parcial</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="edentulismo-total"><label for="edentulismo-total">Edentulismo total</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="caries-dental"><label for="caries-dental">Caries dental</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="restos-radiculares"><label for="restos-radiculares">Restos radiculares</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="sarro-dental"><label for="sarro-dental">Sarro/C√°lculo dental</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="movilidad-dental"><label for="movilidad-dental">Movilidad dental</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="mal-estado-dental"><label for="mal-estado-dental">Mal estado dental general</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="protesis-dental"><label for="protesis-dental">Pr√≥tesis dental</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="abscesos-dentales"><label for="abscesos-dentales">Abscesos dentales</label></div>
                        </div>
                    </div>
                </div>

                <div class="exam-container">
                    <div class="exam-header"><i class="fas fa-procedures"></i> Paladar y Orofaringe</div>
                    <div class="exam-section">
                        <h4>Paladar Duro y Blando</h4>
                        <div class="checkbox-grid">
                            <div class="checkbox-item"><input type="checkbox" id="paladar-normal"><label for="paladar-normal">Paladar normal</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="paladar-ojival"><label for="paladar-ojival">Paladar ojival</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="petequias-paladar"><label for="petequias-paladar">Petequias en paladar</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="ulceras-paladar"><label for="ulceras-paladar">√ölceras palatinas</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="torus-palatino"><label for="torus-palatino">Torus palatino</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="ictericia-paladar"><label for="ictericia-paladar">Ictericia en paladar blando</label></div>
                        </div>
                    </div>
                    <div class="exam-section">
                        <h4>Orofaringe y Am√≠gdalas</h4>
                        <div class="checkbox-grid">
                            <div class="checkbox-item"><input type="checkbox" id="orofaringe-normal"><label for="orofaringe-normal">Orofaringe normal</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="eritema-faringeo"><label for="eritema-faringeo">Eritema far√≠ngeo<div class="checkbox-item"><input type="checkbox" id="eritema-faringeo"><label for="eritema-faringeo">Eritema far√≠ngeo</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="exudado-amigdalino"><label for="exudado-amigdalino">Exudado amigdalino</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="hipertrofia-amigdalina"><label for="hipertrofia-amigdalina">Hipertrofia amigdalina</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="ulceras-faringeas"><label for="ulceras-faringeas">√ölceras far√≠ngeas</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="goteo-postnasal"><label for="goteo-postnasal">Goteo postnasal</label></div>
                        </div>
                    </div>
                </div>

                <div class="exam-container">
                    <div class="exam-header"><i class="fas fa-tint"></i> Salivaci√≥n y Halitosis</div>
                    <div class="exam-section">
                        <h4>Producci√≥n de Saliva</h4>
                        <div class="checkbox-grid">
                            <div class="checkbox-item"><input type="radio" name="salivacion" id="salivacion-normal"><label for="salivacion-normal">Salivaci√≥n normal</label></div>
                            <div class="checkbox-item"><input type="radio" name="salivacion" id="hiposialorrea"><label for="hiposialorrea">Hiposialorrea (sequedad)</label></div>
                            <div class="checkbox-item"><input type="radio" name="salivacion" id="xerostomia"><label for="xerostomia">Xerostom√≠a severa</label></div>
                            <div class="checkbox-item"><input type="radio" name="salivacion" id="hipersialorrea"><label for="hipersialorrea">Hipersialorrea</label></div>
                            <div class="checkbox-item"><input type="radio" name="salivacion" id="sialorrea"><label for="sialorrea">Sialorrea (babeo)</label></div>
                        </div>
                    </div>
                    <div class="exam-section">
                        <h4>Halitosis</h4>
                        <div class="checkbox-grid">
                            <div class="checkbox-item"><input type="checkbox" id="sin-halitosis"><label for="sin-halitosis">Sin halitosis</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="halitosis-leve"><label for="halitosis-leve">Halitosis leve</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="halitosis-moderada"><label for="halitosis-moderada">Halitosis moderada</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="halitosis-severa"><label for="halitosis-severa">Halitosis severa</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="fetor-hepaticus"><label for="fetor-hepaticus">Fetor hepaticus</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="halitosis-acetomica"><label for="halitosis-acetomica">Halitosis acet√≥nica</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="olor-uremico"><label for="olor-uremico">Olor ur√©mico</label></div>
                        </div>
                    </div>
                </div>

                <div class="exam-container">
                    <div class="exam-header"><i class="fas fa-apple-alt"></i> Signos de Deficiencias Nutricionales</div>
                    <div class="exam-section">
                        <h4>Manifestaciones Orales de D√©ficits</h4>
                        <div class="checkbox-grid">
                            <div class="checkbox-item"><input type="checkbox" id="quelosis"><label for="quelosis">Quelosis (d√©ficit vitamina B2)</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="glositis-hunter"><label for="glositis-hunter">Glositis de Hunter (d√©ficit B12)</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="escorbuto-oral"><label for="escorbuto-oral">Signos de escorbuto (d√©ficit vitamina C)</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="pelagra-oral"><label for="pelagra-oral">Signos de pelagra (d√©ficit niacina)</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="glositis-ferropenica"><label for="glositis-ferropenica">Glositis ferrop√©nica</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="estomatitis-angular"><label for="estomatitis-angular">Estomatitis angular</label></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Signos Vitales y Estado General -->
        <div class="section" id="section-vital-signs">
            <div class="section-header" onclick="toggleSection(this)">
                <span><i class="fas fa-heartbeat"></i> Signos Vitales y Estado General</span>
                <div style="display: flex; align-items: center;">
                    <div class="completion-badge" id="badge-vital-signs">
                        <i class="fas fa-circle"></i>
                    </div>
                    <span class="arrow">‚ñº</span>
                </div>
            </div>
            <div class="section-content" id="vital-signs">
                <div class="exam-container">
                    <div class="vital-signs">
                        <h4><i class="fas fa-chart-line"></i> Signos Vitales</h4>
                        <div class="vital-grid">
                            <div class="measurement">
                                <label>Presi√≥n arterial:</label>
                                <input type="number" class="input-field" id="pa-sistolica" min="60" max="250" onchange="updateVitalsSummary()">
                                <span>/</span>
                                <input type="number" class="input-field" id="pa-diastolica" min="40" max="150" onchange="updateVitalsSummary()">
                                <span>mmHg</span>
                            </div>
                            <div class="measurement">
                                <label>Frecuencia card√≠aca:</label>
                                <input type="number" class="input-field" id="frecuencia-cardiaca" min="40" max="200" onchange="updateVitalsSummary()">
                                <span>lpm</span>
                            </div>
                            <div class="measurement">
                                <label>Temperatura:</label>
                                <input type="number" class="input-field" id="temperatura" min="35" max="42" step="0.1" onchange="updateVitalsSummary()">
                                <span>¬∞C</span>
                            </div>
                            <div class="measurement">
                                <label>Saturaci√≥n O2:</label>
                                <input type="number" class="input-field" id="saturacion" min="70" max="100" onchange="updateVitalsSummary()">
                                <span>%</span>
                            </div>
                        </div>
                    </div>

                    <div class="exam-section">
                        <h4>Estado General</h4>
                        <div class="checkbox-grid">
                            <div class="checkbox-item"><input type="checkbox" id="estado-general-bueno"><label for="estado-general-bueno">Buen estado general</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="palidez" onchange="syncPalidezFields(this)"><label for="palidez">Palidez</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="ictericia-general"><label for="ictericia-general">Ictericia</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="deshidratacion"><label for="deshidratacion">Deshidrataci√≥n</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="caquexia"><label for="caquexia">Caquexia</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="edemas"><label for="edemas">Edemas</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="adenopatias"><label for="adenopatias">Adenopat√≠as</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="fiebre"><label for="fiebre">Fiebre</label></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Inspecci√≥n del Abdomen -->
        <div class="section" id="section-inspection">
            <div class="section-header" onclick="toggleSection(this)">
                <span><i class="fas fa-eye"></i> Inspecci√≥n del Abdomen</span>
                <div style="display: flex; align-items: center;">
                    <div class="completion-badge" id="badge-inspection">
                        <i class="fas fa-circle"></i>
                    </div>
                    <span class="arrow">‚ñº</span>
                </div>
            </div>
            <div class="section-content" id="inspection">
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-color inspection-color"></div>
                        <span>Inspecci√≥n</span>
                    </div>
                </div>

                <div class="exam-container">
                    <div class="exam-header"><i class="fas fa-shapes"></i> Forma y Contorno Abdominal</div>
                    <div class="exam-section">
                        <h4>Forma del Abdomen</h4>
                        <div class="checkbox-grid">
                            <div class="checkbox-item"><input type="radio" name="forma-abdomen" id="abdomen-plano"><label for="abdomen-plano">Plano</label></div>
                            <div class="checkbox-item"><input type="radio" name="forma-abdomen" id="abdomen-globoso"><label for="abdomen-globoso">Globoso</label></div>
                            <div class="checkbox-item"><input type="radio" name="forma-abdomen" id="abdomen-distendido"><label for="abdomen-distendido">Distendido</label></div>
                            <div class="checkbox-item"><input type="radio" name="forma-abdomen" id="abdomen-excavado"><label for="abdomen-excavado">Excavado</label></div>
                            <div class="checkbox-item"><input type="radio" name="forma-abdomen" id="abdomen-asimetrico"><label for="abdomen-asimetrico">Asim√©trico</label></div>
                        </div>
                    </div>
                    <div class="exam-section">
                        <h4>Hallazgos Visibles</h4>
                        <div class="checkbox-grid">
                            <div class="checkbox-item"><input type="checkbox" id="cicatrices"><label for="cicatrices">Cicatrices quir√∫rgicas</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="estrias"><label for="estrias">Estr√≠as</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="circulacion-colateral"><label for="circulacion-colateral">Circulaci√≥n colateral</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="hernias"><label for="hernias">Hernias</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="masas-visibles"><label for="masas-visibles">Masas visibles</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="ombligo-evertido"><label for="ombligo-evertido">Ombligo evertido</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="signo-cullen"><label for="signo-cullen">Signo de Cullen</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="signo-grey-turner"><label for="signo-grey-turner">Signo de Grey-Turner</label></div>
                        </div>
                    </div>
                    <div class="exam-section">
                        <h4>Movimientos</h4>
                        <div class="checkbox-grid">
                            <div class="checkbox-item"><input type="checkbox" id="movimientos-respiratorios"><label for="movimientos-respiratorios">Movimientos respiratorios normales</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="peristaltismo-visible"><label for="peristaltismo-visible">Peristaltismo visible</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="abdomen-inmovil"><label for="abdomen-inmovil">Abdomen inm√≥vil</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="respiracion-costal"><label for="respiracion-costal">Respiraci√≥n costal</label></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Auscultaci√≥n -->
        <div class="section" id="section-auscultation">
            <div class="section-header" onclick="toggleSection(this)">
                <span><i class="fas fa-stethoscope"></i> Auscultaci√≥n Abdominal</span>
                <div style="display: flex; align-items: center;">
                    <div class="completion-badge" id="badge-auscultation">
                        <i class="fas fa-circle"></i>
                    </div>
                    <span class="arrow">‚ñº</span>
                </div>
            </div>
            <div class="section-content" id="auscultation">
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-color auscultation-color"></div>
                        <span>Auscultaci√≥n</span>
                    </div>
                </div>

                <div class="exam-container">
                    <div class="exam-header"><i class="fas fa-volume-up"></i> Ruidos Hidroa√©reos</div>
                    <div class="exam-section">
                        <h4>Caracter√≠sticas de los Ruidos</h4>
                        <div class="checkbox-grid">
                            <div class="checkbox-item"><input type="radio" name="ruidos-hidroaereos" id="ruidos-normales"><label for="ruidos-normales">Normales (3-5/min)</label></div>
                            <div class="checkbox-item"><input type="radio" name="ruidos-hidroaereos" id="ruidos-aumentados"><label for="ruidos-aumentados">Aumentados (&gt;12/min)</label></div>
                            <div class="checkbox-item"><input type="radio" name="ruidos-hidroaereos" id="ruidos-disminuidos"><label for="ruidos-disminuidos">Disminuidos (&lt;3/min)</label></div>
                            <div class="checkbox-item"><input type="radio" name="ruidos-hidroaereos" id="ruidos-ausentes"><label for="ruidos-ausentes">Ausentes</label></div>
                            <div class="checkbox-item"><input type="radio" name="ruidos-hidroaereos" id="ruidos-metalicos"><label for="ruidos-metalicos">Met√°licos</label></div>
                        </div>
                        <div class="measurement">
                            <label>Frecuencia por minuto:</label>
                            <input type="number" class="input-field" id="frecuencia-ruidos" min="0" max="30">
                            <span>ruidos/min</span>
                        </div>
                    </div>
                    <div class="exam-section">
                        <h4>Soplos Vasculares</h4>
                        <div class="checkbox-grid">
                            <div class="checkbox-item"><input type="checkbox" id="soplo-aortico"><label for="soplo-aortico">Soplo a√≥rtico</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="soplo-renal"><label for="soplo-renal">Soplo renal</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="soplo-iliaco"><label for="soplo-iliaco">Soplo il√≠aco</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="soplo-femoral"><label for="soplo-femoral">Soplo femoral</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="sin-soplos"><label for="sin-soplos">Sin soplos</label></div>
                        </div>
                    </div>
                    <div class="exam-section">
                        <h4>Ruidos Anormales</h4>
                        <div class="checkbox-grid">
                            <div class="checkbox-item"><input type="checkbox" id="crepitos"><label for="crepitos">Crepitaciones</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="roces-peritoneales"><label for="roces-peritoneales">Roces peritoneales</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="galope-venoso"><label for="galope-venoso">Galope venoso hep√°tico</label></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Percusi√≥n -->
        <div class="section" id="section-percussion">
            <div class="section-header" onclick="toggleSection(this)">
                <span><i class="fas fa-hand-paper"></i> Percusi√≥n Abdominal</span>
                <div style="display: flex; align-items: center;">
                    <div class="completion-badge" id="badge-percussion">
                        <i class="fas fa-circle"></i>
                    </div>
                    <span class="arrow">‚ñº</span>
                </div>
            </div>
            <div class="section-content" id="percussion">
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-color percussion-color"></div>
                        <span>Percusi√≥n</span>
                    </div>
                </div>

                <div class="exam-container">
                    <div class="exam-header"><i class="fas fa-drum"></i> Percusi√≥n General</div>
                    <div class="exam-section">
                        <h4>Sonidos de Percusi√≥n</h4>
                        <div class="checkbox-grid">
                            <div class="checkbox-item"><input type="checkbox" id="timpanismo-normal"><label for="timpanismo-normal">Timpanismo normal</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="timpanismo-aumentado"><label for="timpanismo-aumentado">Timpanismo aumentado</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="matidez-anormal"><label for="matidez-anormal">Matidez anormal</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="submatidez"><label for="submatidez">Submatidez</label></div>
                        </div>
                    </div>
                    <div class="exam-section">
                        <h4>Presencia de L√≠quido Libre</h4>
                        <div class="test-results">
                            <div class="test-item">
                                <label>Signo de la ola</label>
                                <div class="test-controls">
                                    <div class="test-checkbox"><input type="checkbox" id="signo-ola-pos" onchange="handleMutuallyExclusive('signo-ola-pos', 'signo-ola-neg', this)"><span class="positive">+</span></div>
                                    <div class="test-checkbox"><input type="checkbox" id="signo-ola-neg" onchange="handleMutuallyExclusive('signo-ola-pos', 'signo-ola-neg', this)"><span class="negative">-</span></div>
                                </div>
                            </div>
                            <div class="test-item">
                                <label>Matidez desplazable</label>
                                <div class="test-controls">
                                    <div class="test-checkbox"><input type="checkbox" id="matidez-desplazable-pos" onchange="handleMutuallyExclusive('matidez-desplazable-pos', 'matidez-desplazable-neg', this)"><span class="positive">+</span></div>
                                    <div class="test-checkbox"><input type="checkbox" id="matidez-desplazable-neg" onchange="handleMutuallyExclusive('matidez-desplazable-pos', 'matidez-desplazable-neg', this)"><span class="negative">-</span></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="exam-section">
                        <h4>Percusi√≥n de √ìrganos</h4>
                        <div class="measurement">
                            <label>H√≠gado (l√≠nea medioclavicular):</label>
                            <input type="number" class="input-field" id="borde-hepatico" min="0" max="20">
                            <span>cm bajo reborde costal</span>
                        </div>
                        <div class="measurement">
                            <label>Matidez hep√°tica:</label>
                            <input type="number" class="input-field" id="matidez-hepatica" min="6" max="20">
                            <span>cm (normal: 6-12cm)</span>
                        </div>
                        <div class="checkbox-grid">
                            <div class="checkbox-item"><input type="checkbox" id="signo-traube"><label for="signo-traube">Espacio de Traube libre</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="signo-traube-ocupado"><label for="signo-traube-ocupado">Espacio de Traube ocupado</label></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Palpaci√≥n -->
        <div class="section" id="section-palpation">
            <div class="section-header" onclick="toggleSection(this)">
                <span><i class="fas fa-hands"></i> Palpaci√≥n Abdominal</span>
                <div style="display: flex; align-items: center;">
                    <div class="completion-badge" id="badge-palpation">
                        <i class="fas fa-circle"></i>
                    </div>
                    <span class="arrow">‚ñº</span>
                </div>
            </div>
            <div class="section-content" id="palpation">
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-color palpation-color"></div>
                        <span>Palpaci√≥n</span>
                    </div>
                </div>

                <div class="palpation-grid">
                    <div class="palpation-section">
                        <h5><i class="fas fa-hand-pointer"></i> Palpaci√≥n Superficial</h5>
                        <div class="exam-section">
                            <h4>Caracter√≠sticas Generales</h4>
                            <div class="checkbox-grid">
                                <div class="checkbox-item"><input type="checkbox" id="abdomen-blando"><label for="abdomen-blando">Abdomen blando</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="abdomen-rigido"><label for="abdomen-rigido">Abdomen r√≠gido</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="defensa-muscular"><label for="defensa-muscular">Defensa muscular</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="dolor-palpacion"><label for="dolor-palpacion">Dolor a la palpaci√≥n</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="masas-superficiales"><label for="masas-superficiales">Masas superficiales</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="hernias-palpables"><label for="hernias-palpables">Hernias palpables</label></div>
                            </div>
                        </div>
                        <div class="exam-section">
                            <h4>Temperatura y Humedad</h4>
                            <div class="checkbox-grid">
                                <div class="checkbox-item"><input type="checkbox" id="temperatura-normal"><label for="temperatura-normal">Temperatura normal</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="hipertermia-local"><label for="hipertermia-local">Hipertermia local</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="sudoracion"><label for="sudoracion">Sudoraci√≥n</label></div>
                            </div>
                        </div>
                    </div>

                    <div class="palpation-section">
                        <h5><i class="fas fa-hand-rock"></i> Palpaci√≥n Profunda</h5>
                        <div class="exam-section">
                            <h4>Hallazgos por Cuadrante</h4>
                            <div class="checkbox-grid">
                                <div class="checkbox-item"><input type="checkbox" id="masas-profundas"><label for="masas-profundas">Masas profundas</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="organomegalias"><label for="organomegalias">Organomegalias</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="pulsaciones-anormales"><label for="pulsaciones-anormales">Pulsaciones anormales</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="puntos-dolorosos"><label for="puntos-dolorosos">Puntos dolorosos espec√≠ficos</label></div>
                            </div>
                        </div>
                        <div class="exam-section">
                            <h4>Resistencia Muscular</h4>
                            <div class="checkbox-grid">
                                <div class="checkbox-item"><input type="checkbox" id="resistencia-voluntaria"><label for="resistencia-voluntaria">Resistencia voluntaria</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="resistencia-involuntaria"><label for="resistencia-involuntaria">Resistencia involuntaria</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="contractura-muscular"><label for="contractura-muscular">Contractura muscular</label></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Signos Espec√≠ficos -->
        <div class="section" id="section-special-signs">
            <div class="section-header" onclick="toggleSection(this)">
                <span><i class="fas fa-search-plus"></i> Signos Espec√≠ficos y Maniobras Especiales</span>
                <div style="display: flex; align-items: center;">
                    <div class="completion-badge" id="badge-special-signs">
                        <i class="fas fa-circle"></i>
                    </div>
                    <span class="arrow">‚ñº</span>
                </div>
            </div>
            <div class="section-content" id="special-signs">
                <div class="exam-container">
                    <div class="exam-header"><i class="fas fa-exclamation"></i> Signos de Irritaci√≥n Peritoneal</div>
                    <div class="test-results">
                        <div class="test-item">
                            <label>Signo de Blumberg (dolor de rebote)</label>
                            <div class="test-controls">
                                <div class="test-checkbox"><input type="checkbox" id="blumberg-pos" onchange="handleMutuallyExclusive('blumberg-pos', 'blumberg-neg', this)"><span class="positive">+</span></div>
                                <div class="test-checkbox"><input type="checkbox" id="blumberg-neg" onchange="handleMutuallyExclusive('blumberg-pos', 'blumberg-neg', this)"><span class="negative">-</span></div>
                            </div>
                        </div>
                        <div class="test-item">
                            <label>Signo de Rovsing</label>
                            <div class="test-controls">
                                <div class="test-checkbox"><input type="checkbox" id="rovsing-pos" onchange="handleMutuallyExclusive('rovsing-pos', 'rovsing-neg', this)"><span class="positive">+</span></div>
                                <div class="test-checkbox"><input type="checkbox" id="rovsing-neg" onchange="handleMutuallyExclusive('rovsing-pos', 'rovsing-neg', this)"><span class="negative">-</span></div>
                            </div>
                        </div>
                        <div class="test-item">
                            <label>Signo del Psoas</label>
                            <div class="test-controls">
                                <div class="test-checkbox"><input type="checkbox" id="psoas-pos" onchange="handleMutuallyExclusive('psoas-pos', 'psoas-neg', this)"><span class="positive">+</span></div>
                                <div class="test-checkbox"><input type="checkbox" id="psoas-neg" onchange="handleMutuallyExclusive('psoas-pos', 'psoas-neg', this)"><span class="negative">-</span></div>
                            </div>
                        </div>
                        <div class="test-item">
                            <label>Signo del Obturador</label>
                            <div class="test-controls">
                                <div class="test-checkbox"><input type="checkbox" id="obturador-pos" onchange="handleMutuallyExclusive('obturador-pos', 'obturador-neg', this)"><span class="positive">+</span></div>
                                <div class="test-checkbox"><input type="checkbox" id="obturador-neg" onchange="handleMutuallyExclusive('obturador-pos', 'obturador-neg', this)"><span class="negative">-</span></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="exam-container">
                    <div class="exam-header"><i class="fas fa-pills"></i> Signos Vesiculares</div>
                    <div class="test-results">
                        <div class="test-item">
                            <label>Signo de Murphy</label>
                            <div class="test-controls">
                                <div class="test-checkbox"><input type="checkbox" id="murphy-pos" onchange="handleMutuallyExclusive('murphy-pos', 'murphy-neg', this)"><span class="positive">+</span></div>
                                <div class="test-checkbox"><input type="checkbox" id="murphy-neg" onchange="handleMutuallyExclusive('murphy-pos', 'murphy-neg', this)"><span class="negative">-</span></div>
                            </div>
                        </div>
                        <div class="test-item">
                            <label>Signo de Courvoisier-Terrier</label>
                            <div class="test-controls">
                                <div class="test-checkbox"><input type="checkbox" id="courvoisier-pos" onchange="handleMutuallyExclusive('courvoisier-pos', 'courvoisier-neg', this)"><span class="positive">+</span></div>
                                <div class="test-checkbox"><input type="checkbox" id="courvoisier-neg" onchange="handleMutuallyExclusive('courvoisier-pos', 'courvoisier-neg', this)"><span class="negative">-</span></div>
                            </div>
                        </div>
                        <div class="test-item">
                            <label>Punto c√≠stico (Punto de Murphy)</label>
                            <div class="test-controls">
                                <div class="test-checkbox"><input type="checkbox" id="punto-cistico-pos" onchange="handleMutuallyExclusive('punto-cistico-pos', 'punto-cistico-neg', this)"><span class="positive">+</span></div>
                                <div class="test-checkbox"><input type="checkbox" id="punto-cistico-neg" onchange="handleMutuallyExclusive('punto-cistico-pos', 'punto-cistico-neg', this)"><span class="negative">-</span></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="exam-container">
                    <div class="exam-header"><i class="fas fa-virus"></i> Signos Pancre√°ticos</div>
                    <div class="test-results">
                        <div class="test-item">
                            <label>Signo de Cullen (equimosis periumbilical)</label>
                            <div class="test-controls">
                                <div class="test-checkbox"><input type="checkbox" id="cullen-pos" onchange="handleMutuallyExclusive('cullen-pos', 'cullen-neg', this); syncCullenFields(this)"><span class="positive">+</span></div>
                                <div class="test-checkbox"><input type="checkbox" id="cullen-neg" onchange="handleMutuallyExclusive('cullen-pos', 'cullen-neg', this)"><span class="negative">-</span></div>
                            </div>
                        </div>
                        <div class="test-item">
                            <label>Signo de Grey-Turner (equimosis en flancos)</label>
                            <div class="test-controls">
                                <div class="test-checkbox"><input type="checkbox" id="grey-turner-pos" onchange="handleMutuallyExclusive('grey-turner-pos', 'grey-turner-neg', this); syncGreyTurnerFields(this)"><span class="positive">+</span></div>
                                <div class="test-checkbox"><input type="checkbox" id="grey-turner-neg" onchange="handleMutuallyExclusive('grey-turner-pos', 'grey-turner-neg', this)"><span class="negative">-</span></div>
                            </div>
                        </div>
                        <div class="test-item">
                            <label>Maniobra de Ranson (flexi√≥n cadera)</label>
                            <div class="test-controls">
                                <div class="test-checkbox"><input type="checkbox" id="ranson-pos" onchange="handleMutuallyExclusive('ranson-pos', 'ranson-neg', this)"><span class="positive">+</span></div>
                                <div class="test-checkbox"><input type="checkbox" id="ranson-neg" onchange="handleMutuallyExclusive('ranson-pos', 'ranson-neg', this)"><span class="negative">-</span></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="exam-container">
                    <div class="exam-header"><i class="fas fa-plus-circle"></i> Otros Signos Importantes</div>
                    <div class="test-results">
                        <div class="test-item">
                            <label>Signo de McBurney (punto de McBurney)</label>
                            <div class="test-controls">
                                <div class="test-checkbox"><input type="checkbox" id="mcburney-pos" onchange="handleMutuallyExclusive('mcburney-pos', 'mcburney-neg', this)"><span class="positive">+</span></div>
                                <div class="test-checkbox"><input type="checkbox" id="mcburney-neg" onchange="handleMutuallyExclusive('mcburney-pos', 'mcburney-neg', this)"><span class="negative">-</span></div>
                            </div>
                        </div>
                        <div class="test-item">
                            <label>Signo de Carnett (diferencia pared-v√≠scera)</label>
                            <div class="test-controls">
                                <div class="test-checkbox"><input type="checkbox" id="carnett-pos" onchange="handleMutuallyExclusive('carnett-pos', 'carnett-neg', this)"><span class="positive">+</span></div>
                                <div class="test-checkbox"><input type="checkbox" id="carnett-neg" onchange="handleMutuallyExclusive('carnett-pos', 'carnett-neg', this)"><span class="negative">-</span></div>
                            </div>
                        </div>
                        <div class="test-item">
                            <label>Signo de Kehr (dolor en hombro izquierdo)</label>
                            <div class="test-controls">
                                <div class="test-checkbox"><input type="checkbox" id="kehr-pos" onchange="handleMutuallyExclusive('kehr-pos', 'kehr-neg', this)"><span class="positive">+</span></div>
                                <div class="test-checkbox"><input type="checkbox" id="kehr-neg" onchange="handleMutuallyExclusive('kehr-pos', 'kehr-neg', this)"><span class="negative">-</span></div>
                            </div>
                        </div>
                        <div class="test-item">
                            <label>Signo de Charcot (tr√≠ada: dolor, ictericia, fiebre)</label>
                            <div class="test-controls">
                                <div class="test-checkbox"><input type="checkbox" id="charcot-pos" onchange="handleMutuallyExclusive('charcot-pos', 'charcot-neg', this)"><span class="positive">+</span></div>
                                <div class="test-checkbox"><input type="checkbox" id="charcot-neg" onchange="handleMutuallyExclusive('charcot-pos', 'charcot-neg', this)"><span class="negative">-</span></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Evaluaci√≥n de √ìrganos Espec√≠ficos -->
        <div class="section" id="section-organs">
            <div class="section-header" onclick="toggleSection(this)">
                <span><i class="fas fa-lungs"></i> Evaluaci√≥n de √ìrganos Espec√≠ficos</span>
                <div style="display: flex; align-items: center;">
                    <div class="completion-badge" id="badge-organs">
                        <i class="fas fa-circle"></i>
                    </div>
                    <span class="arrow">‚ñº</span>
                </div>
            </div>
            <div class="section-content" id="organs">
                <div class="organ-container">
                    <div class="organ-section">
                        <div class="organ-header"><i class="fas fa-liver"></i> H√≠gado</div>
                        <div class="exam-section">
                            <h4>Caracter√≠sticas</h4>
                            <div class="checkbox-grid">
                                <div class="checkbox-item"><input type="checkbox" id="hepatomegalia"><label for="hepatomegalia">Hepatomegalia</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="higado-palpable"><label for="higado-palpable">H√≠gado palpable</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="higado-doloroso"><label for="higado-doloroso">Doloroso a la palpaci√≥n</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="superficie-hepatica-irregular"><label for="superficie-hepatica-irregular">Superficie irregular</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="borde-hepatico-romo"><label for="borde-hepatico-romo">Borde romo</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="consistencia-aumentada"><label for="consistencia-aumentada">Consistencia aumentada</label></div>
                            </div>
                            <div class="measurement">
                                <label>Tama√±o bajo reborde costal:</label>
                                <input type="number" class="input-field" id="hepatomegalia-cm" min="0" max="20">
                                <span>cm</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="organ-section">
                        <div class="organ-header"><i class="fas fa-circle"></i> Bazo</div>
                        <div class="exam-section">
                            <h4>Caracter√≠sticas</h4>
                            <div class="checkbox-grid">
                                <div class="checkbox-item"><input type="checkbox" id="esplenomegalia"><label for="esplenomegalia">Esplenomegalia</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="bazo-palpable"><label for="bazo-palpable">Bazo palpable</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="bazo-doloroso"><label for="bazo-doloroso">Doloroso a la palpaci√≥n</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="splenomegalia-masiva"><label for="splenomegalia-masiva">Esplenomegalia masiva</label></div>
                            </div>
                            <div class="measurement">
                                <label>Tama√±o bajo reborde costal:</label>
                                <input type="number" class="input-field" id="esplenomegalia-cm" min="0" max="20">
                                <span>cm</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="organ-section">
                        <div class="organ-header"><i class="fas fa-prescription-bottle"></i> Ves√≠cula Biliar</div>
                        <div class="exam-section">
                            <h4>Caracter√≠sticas</h4>
                            <div class="checkbox-grid">
                                <div class="checkbox-item"><input type="checkbox" id="vesicula-palpable"><label for="vesicula-palpable">Ves√≠cula palpable</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="vesicula-distendida"><label for="vesicula-distendida">Ves√≠cula distendida</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="vesicula-dolorosa"><label for="vesicula-dolorosa">Dolorosa a la palpaci√≥n</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="vesicula-fluctuante"><label for="vesicula-fluctuante">Fluctuante</label></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="organ-section">
                        <div class="organ-header"><i class="fas fa-kidneys"></i> Ri√±ones</div>
                        <div class="exam-section">
                            <h4>Palpaci√≥n Bimanual</h4>
                            <div class="checkbox-grid">
                                <div class="checkbox-item"><input type="checkbox" id="rinon-derecho-palpable"><label for="rinon-derecho-palpable">Ri√±√≥n derecho palpable</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="rinon-izquierdo-palpable"><label for="rinon-izquierdo-palpable">Ri√±√≥n izquierdo palpable</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="masa-renal"><label for="masa-renal">Masa renal</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="dolor-pu√±opercusion"><label for="dolor-pu√±opercusion">Dolor a la pu√±opercusi√≥n</label></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- NUEVA SECCI√ìN: Examen Adicional -->
        <div class="section" id="section-additional-exam">
            <div class="section-header" onclick="toggleSection(this)">
                <span><i class="fas fa-plus-circle"></i> Examen Adicional y Evaluaci√≥n de Piel</span>
                <div style="display: flex; align-items: center;">
                    <div class="completion-badge" id="badge-additional-exam">
                        <i class="fas fa-circle"></i>
                    </div>
                    <span class="arrow">‚ñº</span>
                </div>
            </div>
            <div class="section-content" id="additional-exam">
                <div class="exam-container">
                    <div class="exam-header"><i class="fas fa-eye"></i> Exploraci√≥n de Piel y Faneras</div>
                    <div class="exam-section">
                        <h4>Signos de Enfermedad Hep√°tica Cr√≥nica</h4>
                        <div class="checkbox-grid">
                            <div class="checkbox-item"><input type="checkbox" id="ara√±as-vasculares"><label for="ara√±as-vasculares">Ara√±as vasculares</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="eritema-palmar"><label for="eritema-palmar">Eritema palmar</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="telangiectasias"><label for="telangiectasias">Telangiectasias</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="angiomas"><label for="angiomas">Angiomas</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="acropaquias"><label for="acropaquias">Acropaquias (dedos en palillo)</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="xantelasmas"><label for="xantelasmas">Xantelasmas</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="contractura-dupuytren"><label for="contractura-dupuytren">Contractura de Dupuytren</label></div>
                        </div>
                    </div>
                    <div class="exam-section">
                        <h4>Evaluaci√≥n Nutricional</h4>
                        <div class="checkbox-grid">
                            <div class="checkbox-item"><input type="checkbox" id="masa-muscular-reducida"><label for="masa-muscular-reducida">Masa muscular reducida</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="grasa-subcutanea-reducida"><label for="grasa-subcutanea-reducida">Grasa subcut√°nea reducida</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="edema-periferico"><label for="edema-periferico">Edema perif√©rico</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="ascitis-clinica"><label for="ascitis-clinica">Ascitis cl√≠nica</label></div>
                        </div>
                    </div>
                </div>

                <div class="exam-container">
                    <div class="exam-header"><i class="fas fa-search"></i> Ganglios Linf√°ticos</div>
                    <div class="exam-section">
                        <h4>Palpaci√≥n Ganglionar</h4>
                        <div class="checkbox-grid">
                            <div class="checkbox-item"><input type="checkbox" id="ganglio-supraclavicular"><label for="ganglio-supraclavicular">Supraclaviculares (Virchow)</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="ganglio-cervical"><label for="ganglio-cervical">Cervicales</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="ganglio-axilar"><label for="ganglio-axilar">Axilares</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="ganglio-inguinal"><label for="ganglio-inguinal">Inguinales</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="sin-adenopatias"><label for="sin-adenopatias">Sin adenopat√≠as palpables</label></div>
                        </div>
                    </div>
                </div>

                <div class="exam-container">
                    <div class="exam-header"><i class="fas fa-hand-point-down"></i> Tacto Rectal</div>
                    <div class="exam-section">
                        <h4>Hallazgos del Tacto Rectal</h4>
                        <div class="checkbox-grid">
                            <div class="checkbox-item"><input type="checkbox" id="tacto-rectal-normal"><label for="tacto-rectal-normal">Tacto rectal normal</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="hemorroides-internas"><label for="hemorroides-internas">Hemorroides internas</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="fisuras-anales"><label for="fisuras-anales">Fisuras anales</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="masas-rectales"><label for="masas-rectales">Masas rectales</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="sangre-oculta-heces"><label for="sangre-oculta-heces">Sangre oculta en heces</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="tono-esfinter-alterado"><label for="tono-esfinter-alterado">Tono del esf√≠nter alterado</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="prostata-aumentada"><label for="prostata-aumentada">Pr√≥stata aumentada (hombres)</label></div>
                        </div>
                    </div>
                </div>

                <div class="exam-container">
                    <div class="exam-header"><i class="fas fa-venus-mars"></i> Examen de Genitales Externos</div>
                    <div class="exam-section">
                        <h4>Hallazgos Genitales</h4>
                        <div class="checkbox-grid">
                            <div class="checkbox-item"><input type="checkbox" id="genitales-normales"><label for="genitales-normales">Genitales externos normales</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="ulceras-genitales"><label for="ulceras-genitales">√ölceras genitales</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="fistulas-perianales"><label for="fistulas-perianales">F√≠stulas perianales</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="lesiones-perianales"><label for="lesiones-perianales">Lesiones perianales</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="secreciones-anormales"><label for="secreciones-anormales">Secreciones anormales</label></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Evaluaci√≥n de Severidad -->
        <div class="section" id="section-severity">
            <div class="section-header" onclick="toggleSection(this)">
                <span><i class="fas fa-chart-line"></i> Evaluaci√≥n de Severidad y Escalas</span>
                <div style="display: flex; align-items: center;">
                    <div class="completion-badge" id="badge-severity">
                        <i class="fas fa-circle"></i>
                    </div>
                    <span class="arrow">‚ñº</span>
                </div>
            </div>
            <div class="section-content" id="severity">
                <div class="exam-container">
                    <div class="exam-header"><i class="fas fa-calculator"></i> Escalas de Severidad</div>
                    <div class="score-calculation">
                        <div class="exam-section">
                            <h4><i class="fas fa-tint"></i> Escala de Glasgow-Blatchford (Hemorragia GI Alta)</h4>
                            <div class="score-item">
                                <span>Urea (mmol/L): 6.5-7.9:</span>
                                <input type="checkbox" id="gb-urea-1" onchange="calculateGlasgow()">
                                <span>2 puntos</span>
                            </div>
                            <div class="score-item">
                                <span>Urea (mmol/L): 8.0-9.9:</span>
                                <input type="checkbox" id="gb-urea-2" onchange="calculateGlasgow()">
                                <span>3 puntos</span>
                            </div>
                            <div class="score-item">
                                <span>Urea (mmol/L): 10.0-24.9:</span>
                                <input type="checkbox" id="gb-urea-3" onchange="calculateGlasgow()">
                                <span>4 puntos</span>
                            </div>
                            <div class="score-item">
                                <span>Urea (mmol/L): ‚â•25:</span>
                                <input type="checkbox" id="gb-urea-4" onchange="calculateGlasgow()">
                                <span>6 puntos</span>
                            </div>
                            <div class="score-item">
                                <span>Hemoglobina hombres &lt;12 g/dL:</span>
                                <input type="checkbox" id="gb-hb-male" onchange="calculateGlasgow()">
                                <span>1 punto</span>
                            </div>
                            <div class="score-item">
                                <span>Hemoglobina mujeres &lt;10 g/dL:</span>
                                <input type="checkbox" id="gb-hb-female" onchange="calculateGlasgow()">
                                <span>1 punto</span>
                            </div>
                            <div class="score-item">
                                <span>PAS &lt;100 mmHg:</span>
                                <input type="checkbox" id="gb-pas" onchange="calculateGlasgow()">
                                <span>1 punto</span>
                            </div>
                            <div class="score-item">
                                <span>FC ‚â•100 lpm:</span>
                                <input type="checkbox" id="gb-fc" onchange="calculateGlasgow()">
                                <span>1 punto</span>
                            </div>
                            <div class="score-item">
                                <span>Glasgow-Blatchford Total:</span>
                                <span class="score-value" id="glasgow-total">0</span>
                            </div>
                            <div class="risk-meter">
                                <div class="risk-indicator" id="glasgow-indicator"></div>
                            </div>
                        </div>
                    </div>

                    <div class="score-calculation">
                        <div class="exam-section">
                            <h4><i class="fas fa-liver"></i> Clasificaci√≥n de Child-Pugh (Cirrosis Hep√°tica)</h4>
                            <div class="score-item">
                                <span>Bilirrubina total (mg/dL):</span>
                                <select id="child-bilirrubina" onchange="calculateChildPugh()">
                                    <option value="1">&lt;2 (1 punto)</option>
                                    <option value="2">2-3 (2 puntos)</option>
                                    <option value="3">&gt;3 (3 puntos)</option>
                                </select>
                            </div>
                            <div class="score-item">
                                <span>Alb√∫mina (g/dL):</span>
                                <select id="child-albumina" onchange="calculateChildPugh()">
                                    <option value="1">&gt;3.5 (1 punto)</option>
                                    <option value="2">2.8-3.5 (2 puntos)</option>
                                    <option value="3">&lt;2.8 (3 puntos)</option>
                                </select>
                            </div>
                            <div class="score-item">
                                <span>INR:</span>
                                <select id="child-inr" onchange="calculateChildPugh()">
                                    <option value="1">&lt;1.7 (1 punto)</option>
                                    <option value="2">1.7-2.3 (2 puntos)</option>
                                    <option value="3">&gt;2.3 (3 puntos)</option>
                                </select>
                            </div>
                            <div class="score-item">
                                <span>Ascitis:</span>
                                <select id="child-ascitis" onchange="calculateChildPugh()">
                                    <option value="1">Ausente (1 punto)</option>
                                    <option value="2">Leve (2 puntos)</option>
                                    <option value="3">Moderada-severa (3 puntos)</option>
                                </select>
                            </div>
                            <div class="score-item">
                                <span>Encefalopat√≠a:</span>
                                <select id="child-encefalopatia" onchange="calculateChildPugh()">
                                    <option value="1">Ausente (1 punto)</option>
                                    <option value="2">Grado 1-2 (2 puntos)</option>
                                    <option value="3">Grado 3-4 (3 puntos)</option>
                                </select>
                            </div>
                            <div class="score-item">
                                <span>Child-Pugh Total:</span>
                                <span class="score-value" id="child-total">5</span>
                                <span id="child-class">Clase A</span>
                            </div>
                            <div class="child-pugh-bar" id="child-pugh-visual">Clase A - Compensado</div>
                        </div>
                    </div>
                </div>

                <div class="exam-container">
                    <div class="exam-header"><i class="fas fa-user-clock"></i> Impacto Funcional</div>
                    <div class="exam-section">
                        <h4>Calidad de Vida</h4>
                        <div class="checkbox-grid">
                            <div class="checkbox-item"><input type="checkbox" id="impacto-trabajo"><label for="impacto-trabajo">Impacto en trabajo</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="impacto-sueno"><label for="impacto-sueno">Alteraci√≥n del sue√±o</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="impacto-alimentacion"><label for="impacto-alimentacion">Alteraci√≥n de la alimentaci√≥n</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="impacto-social"><label for="impacto-social">Limitaci√≥n social</label></div>
                        </div>
                    </div>
                    <div class="exam-section">
                        <h4>Estado Nutricional</h4>
                        <div class="measurement">
                            <label>IMC:</label>
                            <input type="number" class="input-field" id="imc" min="10" max="50" step="0.1">
                            <span>kg/m¬≤</span>
                        </div>
                        <div class="checkbox-grid">
                            <div class="checkbox-item"><input type="checkbox" id="perdida-peso-significativa"><label for="perdida-peso-significativa">P√©rdida de peso &gt;5% en 6 meses</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="sarcopenia"><label for="sarcopenia">Signos de sarcopenia</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="malnutricion"><label for="malnutricion">Signos de malnutrici√≥n</label></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="conclusion">
            <h3><i class="fas fa-file-medical-alt"></i> Conclusi√≥n del Examen Gastroenterol√≥gico</h3>
            <div class="conclusion-text" id="conclusion-text">Seleccione los par√°metros del examen para generar la conclusi√≥n gastroenterol√≥gica...</div>
        </div>
        
        <div class="control-buttons">
            <button class="btn btn-primary" onclick="generateConclusion()">
                <i class="fas fa-file-medical"></i> Generar Conclusi√≥n
            </button>
            <button class="btn btn-primary" onclick="printConclusion()">
                <i class="fas fa-print"></i> Imprimir Conclusi√≥n
            </button>
            <button class="btn btn-secondary" onclick="clearForm()">
                <i class="fas fa-trash"></i> Limpiar Formulario
            </button>
            <button class="btn btn-secondary" onclick="expandAllSections()">
                <i class="fas fa-expand-alt"></i> Expandir Todo
            </button>
            <button class="btn btn-secondary" onclick="collapseAllSections()">
                <i class="fas fa-compress-alt"></i> Contraer Todo
            </button>
        </div>
    </div>

    <script>
        // üé® Variables globales para el dashboard
        let examProgress = 0;
        let sectionsCompleted = 0;
        let alertCount = 0;
        let warningCount = 0;
        let findingsCount = 0;
        let completenessStatus = '0%';

        // üåô Toggle de tema
        function toggleTheme() {
            const body = document.body;
            const themeIcon = document.getElementById('theme-icon');
            
            if (body.hasAttribute('data-theme')) {
                body.removeAttribute('data-theme');
                themeIcon.className = 'fas fa-moon';
                localStorage.setItem('theme', 'light');
            } else {
                body.setAttribute('data-theme', 'dark');
                themeIcon.className = 'fas fa-sun';
                localStorage.setItem('theme', 'dark');
            }
        }

        // üéØ Toggle panel de navegaci√≥n
        function toggleNavPanel() {
            const navPanel = document.getElementById('nav-panel');
            const body = document.body;
            
            navPanel.classList.toggle('open');
            body.classList.toggle('split-view');
        }

        // üìä FUNCIONES DEL PANEL STICKY - NUEVA FUNCIONALIDAD

        // Toggle panel lateral sticky
        function toggleStickyPanel() {
            const stickyPanel = document.getElementById('stickyConclusion');
            const body = document.body;
            const btn = document.getElementById('sticky-toggle-btn');
            
            stickyPanel.classList.toggle('active');
            body.classList.toggle('split-view-active');
            
            if (stickyPanel.classList.contains('active')) {
                btn.innerHTML = '<i class="fas fa-window-restore"></i> Vista Normal';
                btn.classList.add('btn-warning');
                btn.classList.remove('btn-primary');
                generateStickyConclusion();
            } else {
                btn.innerHTML = '<i class="fas fa-columns"></i> Vista Dividida';
                btn.classList.add('btn-primary');
                btn.classList.remove('btn-warning');
            }
        }

        // Generar conclusi√≥n para panel sticky
        function generateStickyConclusion() {
            const stickyContent = document.getElementById('stickyContent');
            const updateIndicator = document.getElementById('updateIndicator');
            
            // Mostrar indicador de actualizaci√≥n
            updateIndicator.classList.add('active');
            
            setTimeout(() => {
                // Reutilizar la funci√≥n generateConclusion existente
                const originalConclusionEl = document.getElementById('conclusion-text');
                const originalContent = originalConclusionEl.textContent;
                
                // Clonar contenido al panel sticky
                stickyContent.textContent = originalContent;
                
                // Ocultar indicador
                updateIndicator.classList.remove('active');
            }, 300);
        }

        // Copiar contenido del panel sticky
        function copyStickyToClipboard() {
            const stickyContent = document.getElementById('stickyContent').textContent;
            
            if (navigator.clipboard && window.isSecureContext) {
                navigator.clipboard.writeText(stickyContent).then(() => {
                    showCopyNotification();
                }).catch(err => {
                    console.error('Error al copiar con la API del portapapeles: ', err);
                    fallbackCopyToClipboard(stickyContent);
                });
            } else {
                fallbackCopyToClipboard(stickyContent);
            }
        }

        // Fallback para copiar
        function fallbackCopyToClipboard(text) {
            const textArea = document.createElement('textarea');
            textArea.value = text;
            textArea.style.position = 'fixed';
            textArea.style.opacity = '0';
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();

            try {
                document.execCommand('copy');
                showCopyNotification();
            } catch (err) {
                console.error('Error al usar el m√©todo de respaldo para copiar: ', err);
                alert('No se pudo copiar el texto. Por favor, c√≥pielo manualmente.');
            }

            document.body.removeChild(textArea);
        }

        // Mostrar notificaci√≥n de copia
        function showCopyNotification() {
            const notification = document.getElementById('copyNotification');
            notification.classList.add('show');
            setTimeout(() => {
                notification.classList.remove('show');
            }, 2500);
        }

        // Imprimir desde panel sticky
        function printStickyConclusion() {
            const conclusion = document.getElementById('stickyContent').textContent;
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                <head>
                    <title>Informe Gastroenterol√≥gico</title>
                    <style>
                        body { 
                            font-family: Arial, sans-serif; 
                            margin: 20px; 
                            line-height: 1.6;
                        }
                        pre { 
                            white-space: pre-wrap; 
                            font-family: 'Courier New', monospace; 
                            font-size: 12px;
                        }
                        .header {
                            text-align: center;
                            border-bottom: 2px solid #667eea;
                            padding-bottom: 10px;
                            margin-bottom: 20px;
                        }
                        .footer {
                            text-align: center;
                            font-size: 10px;
                            color: #666;
                            margin-top: 20px;
                            border-top: 1px solid #ddd;
                            padding-top: 10px;
                        }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>Informe Gastroenterol√≥gico</h1>
                        <p>Fecha: ${new Date().toLocaleDateString()}</p>
                        <p>Hora: ${new Date().toLocaleTimeString()}</p>
                    </div>
                    <pre>${conclusion}</pre>
                    <div class="footer">
                        <p>Generado por Sistema de Evaluaci√≥n Gastroenterol√≥gica Premium</p>
                    </div>
                </body>
                </html>
            `);
            printWindow.document.close();
            printWindow.print();
        }

        // üß≠ Navegaci√≥n a secciones
        function scrollToSection(sectionId) {
            const section = document.getElementById(`section-${sectionId}`);
            if (section) {
                section.scrollIntoView({ 
                    behavior: 'smooth', 
                    block: 'start',
                    inline: 'nearest'
                });
                
                // Expandir la secci√≥n si est√° colapsada
                const header = section.querySelector('.section-header');
                if (!header.classList.contains('expanded')) {
                    toggleSection(header);
                }
            }
        }

        // ‚úÖ Actualizar altura de secci√≥n
        function updateSectionHeight(contentElement) {
            if (contentElement && contentElement.classList.contains('expanded')) {
                setTimeout(() => {
                    contentElement.style.maxHeight = contentElement.scrollHeight + 'px';
                }, 50);
            }
        }

        // üìÇ Toggle de secciones mejorado
        function toggleSection(headerElement) {
            const content = headerElement.nextElementSibling;
            const section = headerElement.parentElement;
            
            headerElement.classList.toggle('expanded');
            section.classList.toggle('active');
            
            if (content.classList.toggle('expanded')) {
                content.style.maxHeight = content.scrollHeight + 'px';
                content.classList.add('slide-in');
            } else {
                content.style.maxHeight = '0';
                content.classList.remove('slide-in');
            }
        }

        // üîÑ Expandir/contraer todas las secciones
        function expandAllSections() {
            document.querySelectorAll('.section-header:not(.expanded)').forEach(header => {
                toggleSection(header);
            });
        }

        function collapseAllSections() {
            document.querySelectorAll('.section-header.expanded').forEach(header => {
                toggleSection(header);
            });
        }

        // üó∫Ô∏è Toggle de cuadrantes abdominales
        function toggleQuadrant(element, quadrantId) {
            element.classList.toggle('selected');
            updateDashboard();
            generateConclusion();
        }
        
        // üö´ Manejo de "Sin quejas"
        function handleNoComplaints() {
            const noComplaintsCheckbox = document.getElementById('sin-quejas-gi');
            const otherCheckboxes = document.querySelectorAll('#anamnesis input[type="checkbox"]:not(#sin-quejas-gi)');
            
            otherCheckboxes.forEach(checkbox => {
                checkbox.disabled = noComplaintsCheckbox.checked;
                if (noComplaintsCheckbox.checked) checkbox.checked = false;
            });
            
            // Ocultar secciones relacionadas si "sin quejas" est√° marcado
            const dolorSection = document.getElementById('dolor-section');
            const deposicionesSection = document.getElementById('deposiciones-section');
            
            if (noComplaintsCheckbox.checked) {
                dolorSection.classList.add('hidden');
                deposicionesSection.classList.add('hidden');
            }
            
            updateDashboard();
            generateConclusion();
        }

        // üéØ L√ìGICA CONDICIONAL MEJORADA

        // Mostrar secci√≥n de dolor cuando se marca dolor abdominal
        function handlePainComplaint(checkbox) {
            const dolorSection = document.getElementById('dolor-section');
            
            if (checkbox.checked) {
                dolorSection.classList.remove('hidden');
            } else {
                dolorSection.classList.add('hidden');
                // Limpiar campos relacionados
                document.getElementById('dolor-intensidad').value = 0;
                updateDolorValue(0);
                document.querySelectorAll('#dolor-section input').forEach(input => {
                    if (input.type === 'checkbox' || input.type === 'radio') {
                        input.checked = false;
                    }
                });
                document.querySelectorAll('.abdomen-quadrant.selected').forEach(quad => {
                    quad.classList.remove('selected');
                });
            }
            updateDashboard();
            generateConclusion();
        }

        // Mostrar secci√≥n de deposiciones cuando se marca diarrea o estre√±imiento
        function handleStoolComplaint(checkbox) {
            const deposicionesSection = document.getElementById('deposiciones-section');
            const diarreaChecked = document.getElementById('diarrea').checked;
            const estre√±imientoChecked = document.getElementById('estre√±imiento').checked;
            
            if (diarreaChecked || estre√±imientoChecked) {
                deposicionesSection.classList.remove('hidden');
            } else {
                deposicionesSection.classList.add('hidden');
                // Limpiar campos relacionados
                document.querySelectorAll('#deposiciones-section input').forEach(input => {
                    if (input.type === 'checkbox' || input.type === 'radio') {
                        input.checked = false;
                    } else if (input.type === 'number') {
                        input.value = '';
                    }
                });
            }
            updateDashboard();
            generateConclusion();
        }

        // üîó SINCRONIZACI√ìN DE CAMPOS DUPLICADOS

        // Sincronizar campos de melena
        function syncMelenaFields(sourceElement) {
            const targetId = sourceElement.id === 'melena' ? 'heces-negras' : 'melena';
            const targetElement = document.getElementById(targetId);
            if (targetElement) {
                targetElement.checked = sourceElement.checked;
            }
            updateDashboard();
            generateConclusion();
        }

        // Sincronizar campos de ictericia
        function syncIctericiaFields(sourceElement) {
            if (sourceElement.checked) {
                // Auto-marcar campos relacionados para confirmaci√≥n
                const related = ['mucosa-ict√©rica', 'ictericia-paladar', 'ictericia-general'];
                related.forEach(id => {
                    const element = document.getElementById(id);
                    if (element && !element.checked) {
                        element.style.backgroundColor = '#fff3cd';
                        element.style.border = '2px solid #ffc107';
                    }
                });
            } else {
                // Remover resaltado
                const related = ['mucosa-ict√©rica', 'ictericia-paladar', 'ictericia-general'];
                related.forEach(id => {
                    const element = document.getElementById(id);
                    if (element) {
                        element.style.backgroundColor = '';
                        element.style.border = '';
                    }
                });
            }
            updateDashboard();
            generateConclusion();
        }

        // Sincronizar campos de acolia
        function syncAcoliaFields(sourceElement) {
            updateDashboard();
            generateConclusion();
        }

        // Sincronizar campos de palidez
        function syncPalidezFields(sourceElement) {
            if (sourceElement.checked) {
                const related = ['mucosa-palida', 'palidez-labial', 'lengua-palida'];
                related.forEach(id => {
                    const element = document.getElementById(id);
                    if (element && !element.checked) {
                        element.style.backgroundColor = '#fff3cd';
                        element.style.border = '2px solid #ffc107';
                    }
                });
            } else {
                const related = ['mucosa-palida', 'palidez-labial', 'lengua-palida'];
                related.forEach(id => {
                    const element = document.getElementById(id);
                    if (element) {
                        element.style.backgroundColor = '';
                        element.style.border = '';
                    }
                });
            }
            updateDashboard();
            generateConclusion();
        }

        // Sincronizar signos de Cullen
        function syncCullenFields(sourceElement) {
            if (sourceElement.checked) {
                const targetElement = document.getElementById('signo-cullen');
                if (targetElement && !targetElement.checked) {
                    targetElement.style.backgroundColor = '#fff3cd';
                    targetElement.style.border = '2px solid #ffc107';
                }
            } else {
                const targetElement = document.getElementById('signo-cullen');
                if (targetElement) {
                    targetElement.style.backgroundColor = '';
                    targetElement.style.border = '';
                }
            }
            updateDashboard();
            generateConclusion();
        }

        // Sincronizar signos de Grey-Turner
        function syncGreyTurnerFields(sourceElement) {
            if (sourceElement.checked) {
                const targetElement = document.getElementById('signo-grey-turner');
                if (targetElement && !targetElement.checked) {
                    targetElement.style.backgroundColor = '#fff3cd';
                    targetElement.style.border = '2px solid #ffc107';
                }
            } else {
                const targetElement = document.getElementById('signo-grey-turner');
                if (targetElement) {
                    targetElement.style.backgroundColor = '';
                    targetElement.style.border = '';
                }
            }
            updateDashboard();
            generateConclusion();
        }
        
        // ‚öñÔ∏è Manejo de checkboxes mutuamente excluyentes
        function handleMutuallyExclusive(positiveId, negativeId, checkbox) {
            if (checkbox.checked) {
                const oppositeId = checkbox.id === positiveId ? negativeId : positiveId;
                const oppositeCheckbox = document.getElementById(oppositeId);
                if (oppositeCheckbox) oppositeCheckbox.checked = false;
            }
            updateDashboard();
            generateConclusion();
        }

        // üìä Actualizar valor del dolor
        function updateDolorValue(value) {
            document.getElementById('dolor-value').textContent = value;
            
            // Actualizar indicador visual
            const indicator = document.getElementById('pain-indicator');
            const percentage = (value / 10) * 100;
            indicator.style.left = `calc(${percentage}% - 9px)`;
            
            // Cambiar color seg√∫n intensidad
            if (value <= 3) {
                indicator.style.borderColor = 'var(--normal-color)';
            } else if (value <= 7) {
                indicator.style.borderColor = 'var(--warning-color)';
            } else {
                indicator.style.borderColor = 'var(--alert-color)';
            }
            
            updateDashboard();
            generateConclusion();
        }

        // üìà Calcular Glasgow-Blatchford
        function calculateGlasgow() {
            let score = 0;
            
            if (document.getElementById('gb-urea-1').checked) score += 2;
            if (document.getElementById('gb-urea-2').checked) score += 3;
            if (document.getElementById('gb-urea-3').checked) score += 4;
            if (document.getElementById('gb-urea-4').checked) score += 6;
            if (document.getElementById('gb-hb-male').checked) score += 1;
            if (document.getElementById('gb-hb-female').checked) score += 1;
            if (document.getElementById('gb-pas').checked) score += 1;
            if (document.getElementById('gb-fc').checked) score += 1;
            
            document.getElementById('glasgow-total').textContent = score;
            
            // Actualizar indicador visual
            const indicator = document.getElementById('glasgow-indicator');
            const maxScore = 23; // Puntuaci√≥n m√°xima te√≥rica
            const percentage = (score / maxScore) * 100;
            indicator.style.left = `calc(${percentage}% - 9px)`;
            
            if (score <= 6) {
                indicator.style.borderColor = 'var(--normal-color)';
            } else if (score <= 12) {
                indicator.style.borderColor = 'var(--warning-color)';
            } else {
                indicator.style.borderColor = 'var(--alert-color)';
            }
            
            updateDashboard();
            generateConclusion();
        }

        // üìä Calcular Child-Pugh
        function calculateChildPugh() {
            const bilirrubina = parseInt(document.getElementById('child-bilirrubina').value) || 1;
            const albumina = parseInt(document.getElementById('child-albumina').value) || 1;
            const inr = parseInt(document.getElementById('child-inr').value) || 1;
            const ascitis = parseInt(document.getElementById('child-ascitis').value) || 1;
            const encefalopatia = parseInt(document.getElementById('child-encefalopatia').value) || 1;
            
            const total = bilirrubina + albumina + inr + ascitis + encefalopatia;
            document.getElementById('child-total').textContent = total;
            
            let childClass = '';
            let childColor = '';
            let childText = '';
            
            if (total <= 6) {
                childClass = 'Clase A';
                childColor = 'child-pugh-a';
                childText = 'Clase A - Compensado';
            } else if (total <= 9) {
                childClass = 'Clase B';
                childColor = 'child-pugh-b';
                childText = 'Clase B - Descompensado';
            } else {
                childClass = 'Clase C';
                childColor = 'child-pugh-c';
                childText = 'Clase C - Descompensado Severo';
            }
            
            document.getElementById('child-class').textContent = childClass;
            
            // Actualizar barra visual
            const visualBar = document.getElementById('child-pugh-visual');
            visualBar.className = `child-pugh-bar ${childColor}`;
            visualBar.textContent = childText;
            
            updateDashboard();
            generateConclusion();
        }

        // üíä Actualizar resumen de signos vitales
        function updateVitalsSummary() {
            const pas = document.getElementById('pa-sistolica').value;
            const pad = document.getElementById('pa-diastolica').value;
            const fc = document.getElementById('frecuencia-cardiaca').value;
            const temp = document.getElementById('temperatura').value;
            const sat = document.getElementById('saturacion').value;
            
            let status = 'Pendiente';
            let hasAbnormal = false;
            
            if (pas || pad || fc || temp || sat) {
                status = 'Registrado';
                
                // Verificar valores anormales
                if ((pas && (pas < 90 || pas > 140)) ||
                    (pad && (pad < 60 || pad > 90)) ||
                    (fc && (fc < 60 || fc > 100)) ||
                    (temp && (temp < 36.1 || temp > 37.2)) ||
                    (sat && sat < 95)) {
                    hasAbnormal = true;
                    status = 'Anormal';
                }
            }
            
            // Actualizar clase del dashboard
            const completenessItem = document.querySelector('#completeness-status').parentElement;
            completenessItem.className = hasAbnormal ? 'dashboard-item dashboard-alert' : 
                                      status === 'Registrado' ? 'dashboard-item dashboard-normal' : 
                                      'dashboard-item';
            
            updateDashboard();
            generateConclusion();
        }

        // üéØ Auto-rellenar campos comunes
        function autoPopulateCommon() {
            // Simular examen normal b√°sico
            document.getElementById('estado-general-bueno').checked = true;
            document.getElementById('labios-normales').checked = true;
            document.getElementById('mucosa-normal').checked = true;
            document.getElementById('lengua-normal').checked = true;
            document.getElementById('lengua-rosada').checked = true;
            document.getElementById('orofaringe-normal').checked = true;
            document.getElementById('salivacion-normal').checked = true;
            document.getElementById('sin-halitosis').checked = true;
            document.getElementById('movimientos-respiratorios').checked = true;
            document.getElementById('ruidos-normales').checked = true;
            document.getElementById('sin-soplos').checked = true;
            document.getElementById('timpanismo-normal').checked = true;
            document.getElementById('abdomen-blando').checked = true;
            document.getElementById('temperatura-normal').checked = true;
            
            // Signos negativos
            document.getElementById('blumberg-neg').checked = true;
            document.getElementById('murphy-neg').checked = true;
            document.getElementById('mcburney-neg').checked = true;
            
            updateDashboard();
            generateConclusion();
        }

        // Funci√≥n auxiliar para auto-rellenar campos espec√≠ficos
        function autoPopulate(fieldId, value) {
            document.getElementById(fieldId).value = value;
        }

        // üìä ACTUALIZAR DASHBOARD
        function updateDashboard() {
            // Contar elementos completados en cada secci√≥n
            const sections = [
                'antecedentes', 'revision-sistemas', 'anamnesis', 'oral-cavity', 'vital-signs', 
                'inspection', 'auscultation', 'percussion', 'palpation', 'special-signs', 
                'organs', 'additional-exam', 'severity'
            ];
            
            let completedSections = 0;
            let totalFindings = 0;
            let totalAlerts = 0;
            let totalWarnings = 0;
            
            sections.forEach(sectionId => {
                const sectionElement = document.getElementById(sectionId);
                if (sectionElement) {
                    const checkboxes = sectionElement.querySelectorAll('input[type="checkbox"]:checked, input[type="radio"]:checked');
                    const numbers = sectionElement.querySelectorAll('input[type="number"]');
                    const selects = sectionElement.querySelectorAll('select');
                    const texts = sectionElement.querySelectorAll('input[type="text"]');
                    
                    let hasContent = checkboxes.length > 0;
                    
                    // Verificar campos num√©ricos
                    numbers.forEach(input => {
                        if (input.value && input.value !== '0') hasContent = true;
                    });
                    
                    // Verificar selects
                    selects.forEach(select => {
                        if (select.selectedIndex > 0) hasContent = true;
                    });
                    
                    // Verificar campos de texto
                    texts.forEach(input => {
                        if (input.value && input.value.trim() !== '') hasContent = true;
                    });
                    
                    if (hasContent) {
                        completedSections++;
                        totalFindings += checkboxes.length;
                        
                        // Marcar secci√≥n como completada
                        const badge = document.getElementById(`badge-${sectionId}`);
                        const navItem = document.getElementById(`nav-${sectionId}`);
                        
                        if (badge) {
                            badge.classList.add('completed');
                            badge.innerHTML = '<i class="fas fa-check"></i>';
                        }
                        
                        if (navItem) {
                            navItem.style.opacity = '1';
                            navItem.parentElement.classList.add('completed');
                        }
                        
                        // Contar alertas y warnings espec√≠ficos
                        checkboxes.forEach(checkbox => {
                            const label = checkbox.nextElementSibling ? checkbox.nextElementSibling.textContent.toLowerCase() : '';
                            
                            // Criterios de alerta
                            if (label.includes('rigido') || label.includes('defensa') || 
                                label.includes('blumberg') || label.includes('peritoneal') ||
                                checkbox.id.includes('-pos') && 
                                (checkbox.id.includes('murphy') || checkbox.id.includes('mcburney'))) {
                                totalAlerts++;
                            }
                            // Criterios de warning
                            else if (label.includes('dolor') || label.includes('distend') ||
                                    label.includes('hepatomegalia') || label.includes('esplenomegalia')) {
                                totalWarnings++;
                            }
                        });
                    } else {
                        // Limpiar marcas de completado
                        const badge = document.getElementById(`badge-${sectionId}`);
                        const navItem = document.getElementById(`nav-${sectionId}`);
                        
                        if (badge) {
                            badge.classList.remove('completed');
                            badge.innerHTML = '<i class="fas fa-circle"></i>';
                        }
                        
                        if (navItem) {
                            navItem.style.opacity = '0';
                            navItem.parentElement.classList.remove('completed');
                        }
                    }
                }
            });
            
            // Actualizar valores del dashboard
            const progress = Math.round((completedSections / sections.length) * 100);
            document.getElementById('exam-progress').textContent = `${progress}%`;
            document.getElementById('sections-completed').textContent = `${completedSections}/${sections.length}`;
            document.getElementById('alert-count').textContent = totalAlerts;
            document.getElementById('warning-count').textContent = totalWarnings;
            document.getElementById('findings-count').textContent = totalFindings;
            document.getElementById('completeness-status').textContent = `${progress}%`;
            
            // Actualizar clases del dashboard seg√∫n alertas
            const alertsItem = document.getElementById('alerts-item');
            const warningsItem = document.getElementById('warnings-item');
            const findingsItem = document.getElementById('findings-item');
            
            alertsItem.style.display = totalAlerts > 0 ? 'block' : 'block';
            warningsItem.style.display = totalWarnings > 0 ? 'block' : 'block';
            
            // Guardar valores globales
            examProgress = progress;
            sectionsCompleted = completedSections;
            alertCount = totalAlerts;
            warningCount = totalWarnings;
            findingsCount = totalFindings;
            completenessStatus = `${progress}%`;
        }

        // üìù GENERAR CONCLUSI√ìN MEJORADA (Estilo narrativo y completo)
// üìù GENERAR CONCLUSI√ìN (Estilo narrativo m√©dico similar a Endocrinolog√≠a)
        function generateConclusion() {
            const conclusionEl = document.getElementById('conclusion-text');
            let conclusion = 'INFORME DEL EXAMEN GASTROENTEROL√ìGICO:\n\n';

            // Funci√≥n auxiliar para obtener el texto de la etiqueta asociada
            const getLabelText = (id) => document.querySelector(`label[for="${id}"]`)?.textContent.toLowerCase() || '';
            // Funci√≥n auxiliar para verificar si un input (checkbox/radio) est√° marcado
            const isChecked = (id) => document.getElementById(id)?.checked;
            // Funci√≥n auxiliar para obtener el valor de un input num√©rico
            const getInputValue = (id) => document.getElementById(id)?.value;
            // Funci√≥n auxiliar para obtener el valor de un input de texto
            const getTextInputValue = (id) => document.getElementById(id)?.value?.trim() || '';
            // Funci√≥n auxiliar para unir hallazgos en una frase con conectores m√©dicos
            const formatMedicalList = (arr) => {
                if (arr.length === 0) return '';
                if (arr.length === 1) return arr[0];
                if (arr.length === 2) return `${arr[0]} y ${arr[1]}`;
                return `${arr.slice(0, -1).join(', ')} y ${arr[arr.length - 1]}`;
            };

            // --- 1. ANTECEDENTES PERSONALES PATOL√ìGICOS Y NO PATOL√ìGICOS ---
            let antecedentesSection = 'ANTECEDENTES PERSONALES:\n';
            let hasAntecedentes = false;

            const antecedentesGI = [];
            ['ant-crohn', 'ant-colitis-ulcerosa', 'ant-pancreatitis', 'ant-hepatitis', 'ant-cirrosis',
             'ant-ulceras', 'ant-polipos', 'ant-cancer-colorrectal', 'ant-litiasis-biliar',
             'ant-reflujo', 'ant-sii', 'ant-celiaquia'].forEach(id => {
                if (isChecked(id)) antecedentesGI.push(getLabelText(id));
            });
            if (isChecked('ant-sin-gi')) {
                antecedentesSection += 'El paciente no refiere antecedentes gastroenterol√≥gicos relevantes. ';
                hasAntecedentes = true;
            } else if (antecedentesGI.length > 0) {
                antecedentesSection += `Antecedentes patol√≥gicos gastroenterol√≥gicos: ${formatMedicalList(antecedentesGI)}. `;
                hasAntecedentes = true;
            }

            const cirugiasGI = [];
            ['cir-apendicectomia', 'cir-colecistectomia', 'cir-reseccion-intestinal',
             'cir-funduplicatura', 'cir-hernia', 'cir-hemorroides', 'cir-gastrectomia', 'cir-hepatectomia'].forEach(id => {
                if (isChecked(id)) cirugiasGI.push(getLabelText(id));
            });
            if (cirugiasGI.length > 0 && !isChecked('cir-sin-gi')) {
                antecedentesSection += `Cirug√≠as gastroenterol√≥gicas previas: ${formatMedicalList(cirugiasGI)}. `;
                hasAntecedentes = true;
            } else if (isChecked('cir-sin-gi')) {
                antecedentesSection += 'Sin cirug√≠as GI previas. ';
                hasAntecedentes = true;
            }

            const medicamentos = [];
            if (isChecked('med-aines')) medicamentos.push(`uso de AINEs (${getTextInputValue('med-aines-tipo') || 'no especificado'})`);
            if (isChecked('med-anticoagulantes')) medicamentos.push(`anticoagulantes (${getTextInputValue('med-anticoag-tipo') || 'no especificado'})`);
            if (isChecked('med-antibioticos')) medicamentos.push(`antibi√≥ticos recientes (${getTextInputValue('med-antibiot-tipo') || 'no especificado'})`);
            if (isChecked('med-ibb')) medicamentos.push('inhibidores bomba protones');
            if (isChecked('med-laxantes')) medicamentos.push('laxantes');
            if (isChecked('med-antiacidos')) medicamentos.push('anti√°cidos');
            if (medicamentos.length > 0) {
                antecedentesSection += `Medicaci√≥n actual: ${formatMedicalList(medicamentos)}. `;
                hasAntecedentes = true;
            }

            const alergias = [];
            if (isChecked('alergia-medicamentos')) alergias.push(`a medicamentos (${getTextInputValue('alergia-med-tipo') || 'no especificado'})`);
            if (isChecked('alergia-alimentos')) alergias.push(`a alimentos (${getTextInputValue('alergia-alim-tipo') || 'no especificado'})`);
            if (alergias.length > 0) {
                antecedentesSection += `Alergias conocidas: ${formatMedicalList(alergias)}. `;
                hasAntecedentes = true;
            } else if (antecedentesGI.length > 0 || cirugiasGI.length > 0 || medicamentos.length > 0) { // Only add if other sections are present
                 antecedentesSection += 'No se reportan alergias conocidas. ';
            }

            const habitosToxicos = [];
            if (isChecked('habito-tabaco')) {
                const paqDia = getInputValue('habito-tabaco-paq');
                const a√±osTabaco = getInputValue('habito-tabaco-a√±os');
                let tabacoDesc = 'tabaquismo';
                if (paqDia || a√±osTabaco) tabacoDesc += ` (${paqDia ? paqDia + ' paq/d√≠a' : ''}${paqDia && a√±osTabaco ? ', ' : ''}${a√±osTabaco ? a√±osTabaco + ' a√±os' : ''})`;
                habitosToxicos.push(tabacoDesc);
            }
            if (isChecked('habito-alcohol')) habitosToxicos.push(`alcoholismo (${getTextInputValue('habito-alcohol-tipo') || 'no especificado'})`);
            if (habitosToxicos.length > 0) {
                antecedentesSection += `H√°bitos t√≥xicos: ${formatMedicalList(habitosToxicos)}. `;
                hasAntecedentes = true;
            } else if (antecedentesGI.length > 0 || cirugiasGI.length > 0 || medicamentos.length > 0) { // Only add if other sections are present
                 antecedentesSection += 'No se refieren h√°bitos t√≥xicos. ';
            }

            const familiaresGI = [];
            ['fam-cancer-colon', 'fam-eii', 'fam-celiaquia', 'fam-polipos'].forEach(id => {
                if (isChecked(id)) familiaresGI.push(getLabelText(id));
            });
            if (familiaresGI.length > 0) {
                antecedentesSection += `Historia familiar de enfermedades gastroenterol√≥gicas: ${formatMedicalList(familiaresGI)}. `;
                hasAntecedentes = true;
            } else if (antecedentesGI.length > 0 || cirugiasGI.length > 0 || medicamentos.length > 0) { // Only add if other sections are present
                antecedentesSection += 'No se registran antecedentes familiares gastroenterol√≥gicos. ';
            }

            if (hasAntecedentes) {
                conclusion += antecedentesSection.trim() + '\n\n';
            }

            // --- 2. REVISI√ìN POR SISTEMAS ---
            let revisionSection = 'REVISI√ìN POR SISTEMAS:\n';
            let hasRevisionFindings = false;

            const constitucionales = [];
            ['const-fiebre', 'const-escalofrios', 'const-fatiga', 'const-sudoracion',
             'const-perdida-peso', 'const-ganancia-peso'].forEach(id => {
                if (isChecked(id)) constitucionales.push(getLabelText(id));
            });
            if (constitucionales.length > 0) {
                revisionSection += `S√≠ntomas constitucionales: ${formatMedicalList(constitucionales)}. `;
                hasRevisionFindings = true;
            } else {
                revisionSection += 'S√≠ntomas constitucionales: No presentes. ';
            }

            const cardiovasculares = [];
            ['cardio-dolor-toracico', 'cardio-palpitaciones', 'cardio-disnea', 'cardio-edema'].forEach(id => {
                if (isChecked(id)) cardiovasculares.push(getLabelText(id));
            });
            if (cardiovasculares.length > 0) {
                revisionSection += `S√≠ntomas cardiovasculares: ${formatMedicalList(cardiovasculares)}. `;
                hasRevisionFindings = true;
            } else {
                revisionSection += 'S√≠ntomas cardiovasculares: No presentes. ';
            }

            const respiratorios = [];
            ['resp-tos', 'resp-disnea', 'resp-sibilancias', 'resp-hemoptisis'].forEach(id => {
                if (isChecked(id)) respiratorios.push(getLabelText(id));
            });
            if (respiratorios.length > 0) {
                revisionSection += `S√≠ntomas respiratorios: ${formatMedicalList(respiratorios)}. `;
                hasRevisionFindings = true;
            } else {
                revisionSection += 'S√≠ntomas respiratorios: No presentes. ';
            }

            const genitourinarios = [];
            ['gu-disuria', 'gu-hematuria', 'gu-polaquiuria', 'gu-urgencia'].forEach(id => {
                if (isChecked(id)) genitourinarios.push(getLabelText(id));
            });
            if (genitourinarios.length > 0) {
                revisionSection += `S√≠ntomas genitourinarios: ${formatMedicalList(genitourinarios)}. `;
                hasRevisionFindings = true;
            } else {
                revisionSection += 'S√≠ntomas genitourinarios: No presentes. ';
            }

            const dermatologicos = [];
            ['derm-erupciones', 'derm-nodulos', 'derm-eritema-nodoso', 'derm-prurito'].forEach(id => {
                if (isChecked(id)) dermatologicos.push(getLabelText(id));
            });
            if (dermatologicos.length > 0) {
                revisionSection += `S√≠ntomas dermatol√≥gicos: ${formatMedicalList(dermatologicos)}. `;
                hasRevisionFindings = true;
            } else {
                revisionSection += 'S√≠ntomas dermatol√≥gicos: No presentes. ';
            }

            const osteomusculares = [];
            ['osteo-artralgias', 'osteo-mialgias', 'osteo-rigidez', 'osteo-limitacion'].forEach(id => {
                if (isChecked(id)) osteomusculares.push(getLabelText(id));
            });
            if (osteomusculares.length > 0) {
                revisionSection += `S√≠ntomas osteomusculares: ${formatMedicalList(osteomusculares)}. `;
                hasRevisionFindings = true;
            } else {
                revisionSection += 'S√≠ntomas osteomusculares: No presentes. ';
            }

            const neurologicos = [];
            ['neuro-confusion', 'neuro-cefalea', 'neuro-neuropatia', 'neuro-mareos'].forEach(id => {
                if (isChecked(id)) neurologicos.push(getLabelText(id));
            });
            if (neurologicos.length > 0) {
                revisionSection += `S√≠ntomas neurol√≥gicos: ${formatMedicalList(neurologicos)}. `;
                hasRevisionFindings = true;
            } else {
                revisionSection += 'S√≠ntomas neurol√≥gicos: No presentes. ';
            }

            if (hasRevisionFindings) {
                conclusion += revisionSection.trim() + '\n\n';
            }


            // --- 3. QUEJAS PRINCIPALES (ANAMNESIS) ---
            let anamnesisSection = 'ANAMNESIS Y QUEJAS PRINCIPALES:\n';
            let hasAnamnesisFindings = false;
            const complaints = [];

            if (isChecked('sin-quejas-gi')) {
                anamnesisSection += 'El paciente se encuentra asintom√°tico desde el punto de vista gastroenterol√≥gico. ';
                hasAnamnesisFindings = true;
            } else {
                if (isChecked('dolor-abdominal')) {
                    const dolorIntensidad = getInputValue('dolor-intensidad');
                    const selectedQuadrants = Array.from(document.querySelectorAll('.abdomen-quadrant.selected')).map(q => q.textContent.split('\n')[0]);
                    const tipoDolor = document.querySelector('input[name="tipo-dolor"]:checked');
                    
                    let dolorDesc = 'Dolor abdominal';
                    if (dolorIntensidad && dolorIntensidad > 0) {
                        let intensityLevel = '';
                        if (dolorIntensidad <= 3) intensityLevel = 'leve';
                        else if (dolorIntensidad <= 7) intensityLevel = 'moderado';
                        else intensityLevel = 'severo';
                        dolorDesc += ` de intensidad ${intensityLevel} (${dolorIntensidad}/10)`;
                    }
                    if (selectedQuadrants.length > 0) {
                        dolorDesc += `, localizado en ${formatMedicalList(selectedQuadrants)}`;
                    }
                    if (tipoDolor) {
                        dolorDesc += `, de tipo ${getLabelText(tipoDolor.id)}`;
                    }
                    const dolorCaracteristicas = [];
                    if (isChecked('dolor-irradiado')) dolorCaracteristicas.push('irradiado');
                    if (isChecked('dolor-nocturno')) dolorCaracteristicas.push('nocturno');
                    if (isChecked('dolor-postprandial')) dolorCaracteristicas.push('postprandial');
                    if (isChecked('dolor-ayunas')) dolorCaracteristicas.push('en ayunas');
                    if (isChecked('dolor-defecacion')) dolorCaracteristicas.push('relacionado con la defecaci√≥n');
                    if (dolorCaracteristicas.length > 0) {
                        dolorDesc += ` (${formatMedicalList(dolorCaracteristicas)})`;
                    }
                    complaints.push(dolorDesc);
                }

                if (isChecked('nauseas')) complaints.push('n√°useas');
                if (isChecked('vomitos')) complaints.push('v√≥mitos');
                if (isChecked('distension-abdominal')) complaints.push('distensi√≥n abdominal');
                if (isChecked('acidez')) complaints.push('acidez/pirosis');
                if (isChecked('regurgitacion')) complaints.push('regurgitaci√≥n');
                if (isChecked('disfagia')) complaints.push('disfagia');
                if (isChecked('odinofagia')) complaints.push('odinofagia');
                if (isChecked('melena')) complaints.push('melena');
                if (isChecked('rectorragia')) complaints.push('rectorragia');
                if (isChecked('hematemesis')) complaints.push('hematemesis');
                if (isChecked('ictericia')) complaints.push('ictericia');
                if (isChecked('perdida-peso')) complaints.push('p√©rdida de peso');
                if (isChecked('anorexia')) complaints.push('anorexia');
                if (isChecked('saciedad-precoz')) complaints.push('saciedad precoz');
                if (isChecked('flatulencia')) complaints.push('flatulencia');
                if (isChecked('eructos')) complaints.push('eructos');
                if (isChecked('diarrea')) complaints.push('diarrea');
                if (isChecked('estre√±imiento')) complaints.push('estre√±imiento');

                if (complaints.length > 0) {
                    anamnesisSection += `Quejas principales: ${formatMedicalList(complaints)}. `;
                    hasAnamnesisFindings = true;
                }

                if (isChecked('diarrea') || isChecked('estre√±imiento')) {
                    const bristol = document.querySelector('input[name="bristol"]:checked');
                    const frecuenciaDeposiciones = getInputValue('frecuencia-deposiciones');
                    
                    let deposicionesDesc = 'Caracter√≠sticas de las deposiciones: ';
                    if (bristol) {
                        deposicionesDesc += `Tipo ${getLabelText(bristol.id).split(':')[0].replace('Tipo ', '')} seg√∫n escala de Bristol. `;
                    }
                    if (frecuenciaDeposiciones) {
                        deposicionesDesc += `Frecuencia ${frecuenciaDeposiciones} veces/d√≠a. `;
                    }
                    const hecesAdicionales = [];
                    ['heces-con-sangre', 'heces-con-moco', 'heces-con-pus', 'heces-grasosas', 'heces-negras', 'heces-acolia'].forEach(id => {
                        if (isChecked(id)) hecesAdicionales.push(getLabelText(id));
                    });
                    if (hecesAdicionales.length > 0) {
                        deposicionesDesc += `Hallazgos adicionales: ${formatMedicalList(hecesAdicionales)}.`;
                    }
                    if (bristol || frecuenciaDeposiciones || hecesAdicionales.length > 0) {
                        anamnesisSection += deposicionesDesc + ' ';
                        hasAnamnesisFindings = true;
                    }
                }

                const factores = [];
                ['relacion-comidas', 'estres-emocional', 'alcohol', 'medicamentos-nuevos',
                 'viajes-recientes', 'alimentos-contaminados', 'aines', 'antibioticos'].forEach(id => {
                    if (isChecked(id)) factores.push(getLabelText(id));
                });
                if (factores.length > 0) {
                    anamnesisSection += `Factores desencadenantes o asociados: ${formatMedicalList(factores)}. `;
                    hasAnamnesisFindings = true;
                }
            }
            if (hasAnamnesisFindings) {
                conclusion += anamnesisSection.trim() + '\n\n';
            }
            
            // --- 4. EXAMEN DE CAVIDAD ORAL ---
            let oralSection = 'EXAMEN DE CAVIDAD ORAL:\n';
            let hasOralFindings = false;

            const labiosHallazgos = [];
            ['queilitis', 'fisuras-labiales', 'cianosis-labial', 'palidez-labial',
             'ulceras-labiales', 'herpes-labial', 'sequedad-labial'].forEach(id => {
                if (isChecked(id)) labiosHallazgos.push(getLabelText(id));
            });
            if (isChecked('labios-normales')) {
                oralSection += 'Labios: De aspecto normal. ';
                hasOralFindings = true;
            } else if (labiosHallazgos.length > 0) {
                oralSection += `Labios: Se observa ${formatMedicalList(labiosHallazgos)}. `;
                hasOralFindings = true;
            }

            const mucosaHallazgos = [];
            ['mucosa-palida', 'mucosa-ict√©rica', 'mucosa-seca', 'petequias-orales',
             'ulceras-aftosas', 'leucoplasia', 'candidiasis-oral', 'gingivitis',
             'gingivorragia', 'hipertrofia-gingival', 'retraccion-gingival'].forEach(id => {
                if (isChecked(id)) mucosaHallazgos.push(getLabelText(id));
            });
            if (isChecked('mucosa-normal')) {
                oralSection += 'Mucosa oral y enc√≠as: Rosadas y h√∫medas, sin alteraciones. ';
                hasOralFindings = true;
            } else if (mucosaHallazgos.length > 0) {
                oralSection += `Mucosa oral y enc√≠as: Se observa ${formatMedicalList(mucosaHallazgos)}. `;
                hasOralFindings = true;
            }

            const lenguaCaracteristicas = [];
            ['macroglosia', 'microglosia', 'lengua-saburrosa', 'lengua-geografica',
             'lengua-fisurada', 'glositis', 'lengua-vellosa', 'atrofia-papilar',
             'ulceras-linguales', 'leucoplasia-lingual', 'temblor-lingual'].forEach(id => {
                if (isChecked(id)) lenguaCaracteristicas.push(getLabelText(id));
            });
            const colorLengua = document.querySelector('input[name="color-lengua"]:checked');
            if (isChecked('lengua-normal')) { 
                let desc = 'Lengua: De aspecto normal';
                if (colorLengua && colorLengua.id !== 'lengua-rosada') desc += `, con color ${getLabelText(colorLengua.id).replace(' normal', '')}`;
                oralSection += desc + '. ';
                hasOralFindings = true;
            } else {
                if (lenguaCaracteristicas.length > 0) {
                    let desc = `Lengua: Presenta ${formatMedicalList(lenguaCaracteristicas)}`;
                    if (colorLengua) desc += `, y color ${getLabelText(colorLengua.id).replace(' normal', '')}`;
                    oralSection += desc + '. ';
                    hasOralFindings = true;
                } else if (colorLengua) {
                    oralSection += `Lengua: Color ${getLabelText(colorLengua.id).replace(' normal', '')}. `;
                    hasOralFindings = true;
                }
            }

            const dentalHallazgos = [];
            ['denticion-completa', 'edentulismo-parcial', 'edentulismo-total',
             'caries-dental', 'restos-radiculares', 'sarro-dental', 'movilidad-dental',
             'mal-estado-dental', 'protesis-dental', 'abscesos-dentales'].forEach(id => {
                if (isChecked(id)) dentalHallazgos.push(getLabelText(id));
            });
            if (dentalHallazgos.length > 0) {
                oralSection += `Dientes y estado dental: ${formatMedicalList(dentalHallazgos)}. `;
                hasOralFindings = true;
            } else {
                oralSection += 'Dientes y estado dental: No hay hallazgos patol√≥gicos significativos. ';
                hasOralFindings = true;
            }

            const paladarHallazgos = [];
            ['paladar-ojival', 'petequias-paladar', 'ulceras-paladar', 'torus-palatino', 'ictericia-paladar'].forEach(id => {
                if (isChecked(id)) paladarHallazgos.push(getLabelText(id));
            });
            if (isChecked('paladar-normal')) {
                oralSection += 'Paladar: Normal. ';
                hasOralFindings = true;
            } else if (paladarHallazgos.length > 0) {
                oralSection += `Paladar: Se observa ${formatMedicalList(paladarHallazgos)}. `;
                hasOralFindings = true;
            }

            const orofaringeHallazgos = [];
            ['eritema-faringeo', 'exudado-amigdalino', 'hipertrofia-amigdalina',
             'ulceras-faringeas', 'goteo-postnasal'].forEach(id => {
                if (isChecked(id)) orofaringeHallazgos.push(getLabelText(id));
            });
            if (isChecked('orofaringe-normal')) {
                oralSection += 'Orofaringe y am√≠gdalas: Sin alteraciones. ';
                hasOralFindings = true;
            } else if (orofaringeHallazgos.length > 0) {
                oralSection += `Orofaringe y am√≠gdalas: Se observa ${formatMedicalList(orofaringeHallazgos)}. `;
                hasOralFindings = true;
            }
            
            const salivacion = document.querySelector('input[name="salivacion"]:checked');
            if (salivacion) {
                oralSection += `Salivaci√≥n: ${getLabelText(salivacion.id)}. `;
                hasOralFindings = true;
            } else {
                oralSection += 'Salivaci√≥n: No evaluada. ';
                hasOralFindings = true; // Count as evaluated if section evaluated
            }

            const halitosis = [];
            ['halitosis-leve', 'halitosis-moderada', 'halitosis-severa',
             'fetor-hepaticus', 'halitosis-acetomica', 'olor-uremico'].forEach(id => {
                if (isChecked(id)) halitosis.push(getLabelText(id));
            });
            if (isChecked('sin-halitosis')) {
                oralSection += 'Halitosis: Ausente. ';
                hasOralFindings = true;
            } else if (halitosis.length > 0) {
                oralSection += `Halitosis: ${formatMedicalList(halitosis)}. `;
                hasOralFindings = true;
            }

            const nutricionalOral = [];
            ['quelosis', 'glositis-hunter', 'escorbuto-oral',
             'pelagra-oral', 'glositis-ferropenica', 'estomatitis-angular'].forEach(id => {
                if (isChecked(id)) nutricionalOral.push(getLabelText(id));
            });
            if (nutricionalOral.length > 0) {
                oralSection += `Signos orales de deficiencias nutricionales: ${formatMedicalList(nutricionalOral)}. `;
                hasOralFindings = true;
            } else {
                oralSection += 'Signos orales de deficiencias nutricionales: No presentes. ';
                hasOralFindings = true;
            }

            if (hasOralFindings) {
                conclusion += oralSection.trim() + '\n\n';
            }

            // --- 5. SIGNOS VITALES Y ESTADO GENERAL ---
            let vitalsGeneralSection = 'SIGNOS VITALES Y ESTADO GENERAL:\n';
            let hasVitalsGeneralFindings = false;
            const pas = getInputValue('pa-sistolica');
            const pad = getInputValue('pa-diastolica');
            const fc = getInputValue('frecuencia-cardiaca');
            const temp = getInputValue('temperatura');
            const sat = getInputValue('saturacion');
            
            let vitals = [];
            if (pas && pad) {
                let bpStatus = 'normal';
                if (pas < 90 || pad < 60) bpStatus = 'hipotensi√≥n';
                else if (pas > 140 || pad > 90) bpStatus = 'hipertensi√≥n';
                vitals.push(`PA: ${pas}/${pad} mmHg (${bpStatus})`);
                hasVitalsGeneralFindings = true;
            }
            if (fc) {
                let fcStatus = 'normal';
                if (fc < 60) fcStatus = 'bradicardia';
                else if (fc > 100) fcStatus = 'taquicardia';
                vitals.push(`FC: ${fc} lpm (${fcStatus})`);
                hasVitalsGeneralFindings = true;
            }
            if (temp) {
                let tempStatus = 'normal';
                if (temp < 36.1) tempStatus = 'hipotermia';
                else if (temp > 37.2) tempStatus = 'fiebre';
                vitals.push(`T¬∞: ${temp}¬∞C (${tempStatus})`);
                hasVitalsGeneralFindings = true;
            }
            if (sat) {
                let satStatus = 'normal';
                if (sat < 95) satStatus = 'desaturaci√≥n';
                vitals.push(`SatO2: ${sat}% (${satStatus})`);
                hasVitalsGeneralFindings = true;
            }
            if (vitals.length > 0) {
                vitalsGeneralSection += `Signos vitales: ${formatMedicalList(vitals)}. `;
            } else {
                vitalsGeneralSection += 'Signos vitales: No registrados. ';
            }

            const estadoGeneralHallazgos = [];
            ['palidez', 'ictericia-general', 'deshidratacion', 'caquexia', 'edemas', 'adenopatias', 'fiebre'].forEach(id => {
                if (isChecked(id)) estadoGeneralHallazgos.push(getLabelText(id));
            });
            if (isChecked('estado-general-bueno')) {
                vitalsGeneralSection += 'Estado General: Bueno. ';
                hasVitalsGeneralFindings = true;
            } else if (estadoGeneralHallazgos.length > 0) {
                vitalsGeneralSection += `Estado General: Se observa ${formatMedicalList(estadoGeneralHallazgos)}. `;
                hasVitalsGeneralFindings = true;
            } else {
                vitalsGeneralSection += 'Estado General: No evaluado. ';
            }
            if (hasVitalsGeneralFindings) {
                conclusion += vitalsGeneralSection.trim() + '\n\n';
            }

            // --- 6. INSPECCI√ìN DEL ABDOMEN ---
            let inspectionSection = 'INSPECCI√ìN ABDOMINAL:\n';
            let hasInspectionFindings = false;
            const formaAbdomen = document.querySelector('input[name="forma-abdomen"]:checked');
            if (formaAbdomen) {
                inspectionSection += `Abdomen de forma ${getLabelText(formaAbdomen.id)}. `;
                hasInspectionFindings = true;
            } else {
                inspectionSection += 'Abdomen: Forma no especificada. ';
            }

            const hallazgosVisibles = [];
            ['cicatrices', 'estrias', 'circulacion-colateral', 'hernias', 'masas-visibles',
             'ombligo-evertido', 'signo-cullen', 'signo-grey-turner'].forEach(id => {
                if (isChecked(id)) hallazgosVisibles.push(getLabelText(id));
            });
            if (hallazgosVisibles.length > 0) {
                inspectionSection += `Hallazgos visibles: Se observan ${formatMedicalList(hallazgosVisibles)}. `;
                hasInspectionFindings = true;
            } else {
                inspectionSection += 'Hallazgos visibles: No hay lesiones cut√°neas ni hernias aparentes. ';
                hasInspectionFindings = true;
            }

            const movimientosAbdominales = [];
            ['movimientos-respiratorios', 'peristaltismo-visible', 'abdomen-inmovil', 'respiracion-costal'].forEach(id => {
                if (isChecked(id)) movimientosAbdominales.push(getLabelText(id));
            });
            if (movimientosAbdominales.length > 0) {
                inspectionSection += `Movimientos abdominales: ${formatMedicalList(movimientosAbdominales)}. `;
                hasInspectionFindings = true;
            } else {
                inspectionSection += 'Movimientos abdominales: No evaluados. ';
            }
            if (hasInspectionFindings) {
                conclusion += inspectionSection.trim() + '\n\n';
            }

            // --- 7. AUSCULTACI√ìN ABDOMINAL ---
            let auscultationSection = 'AUSCULTACI√ìN ABDOMINAL:\n';
            let hasAuscultationFindings = false;
            const ruidosHidroaereos = document.querySelector('input[name="ruidos-hidroaereos"]:checked');
            if (ruidosHidroaereos) {
                let ruidosDesc = getLabelText(ruidosHidroaereos.id);
                const frecuenciaRuidos = getInputValue('frecuencia-ruidos');
                if (frecuenciaRuidos) {
                    ruidosDesc += ` (${frecuenciaRuidos} ruidos/min)`;
                }
                auscultationSection += `Ruidos hidroa√©reos: ${ruidosDesc}. `;
                hasAuscultationFindings = true;
            } else {
                auscultationSection += 'Ruidos hidroa√©reos: No evaluados. ';
                hasAuscultationFindings = true;
            }

            const soplosVasculares = [];
            ['soplo-aortico', 'soplo-renal', 'soplo-iliaco', 'soplo-femoral'].forEach(id => {
                if (isChecked(id)) soplosVasculares.push(getLabelText(id));
            });
            if (soplosVasculares.length > 0) {
                auscultationSection += `Soplos vasculares: Se ausculta ${formatMedicalList(soplosVasculares)}. `;
                hasAuscultationFindings = true;
            } else if (isChecked('sin-soplos')) {
                auscultationSection += 'Soplos vasculares: Ausentes. ';
                hasAuscultationFindings = true;
            }
            
            const ruidosAnormales = [];
            ['crepitos', 'roces-peritoneales', 'galope-venoso'].forEach(id => {
                if (isChecked(id)) ruidosAnormales.push(getLabelText(id));
            });
            if (ruidosAnormales.length > 0) {
                auscultationSection += `Ruidos anormales: Se ausculta ${formatMedicalList(ruidosAnormales)}. `;
                hasAuscultationFindings = true;
            } else {
                auscultationSection += 'Ruidos anormales: No auscultados. ';
                hasAuscultationFindings = true;
            }

            if (hasAuscultationFindings) {
                conclusion += auscultationSection.trim() + '\n\n';
            }

            // --- 8. PERCUSI√ìN ABDOMINAL ---
            let percussionSection = 'PERCUSI√ìN ABDOMINAL:\n';
            let hasPercussionFindings = false;
            const sonidosPercusion = [];
            ['timpanismo-normal', 'timpanismo-aumentado', 'matidez-anormal', 'submatidez'].forEach(id => {
                if (isChecked(id)) sonidosPercusion.push(getLabelText(id));
            });
            if (sonidosPercusion.length > 0) {
                percussionSection += `Sonidos de percusi√≥n: ${formatMedicalList(sonidosPercusion)}. `;
                hasPercussionFindings = true;
            } else {
                percussionSection += 'Sonidos de percusi√≥n: No evaluados. ';
                hasPercussionFindings = true;
            }

            if (isChecked('signo-ola-pos')) { percussionSection += 'Signo de la ola: Positivo. '; hasPercussionFindings = true; }
            else if (isChecked('signo-ola-neg')) { percussionSection += 'Signo de la ola: Negativo. '; hasPercussionFindings = true; }
            
            if (isChecked('matidez-desplazable-pos')) { percussionSection += 'Matidez desplazable: Positivo. '; hasPercussionFindings = true; }
            else if (isChecked('matidez-desplazable-neg')) { percussionSection += 'Matidez desplazable: Negativo. '; hasPercussionFindings = true; }

            const bordeHepatico = getInputValue('borde-hepatico');
            const matidezHepatica = getInputValue('matidez-hepatica');
            if (bordeHepatico) {
                percussionSection += `Borde hep√°tico: palpable a ${bordeHepatico} cm bajo reborde costal. `;
                hasPercussionFindings = true;
            }
            if (matidezHepatica) {
                percussionSection += `Matidez hep√°tica: ${matidezHepatica} cm (normal: 6-12cm). `;
                hasPercussionFindings = true;
            }
            
            if (isChecked('signo-traube')) { percussionSection += 'Espacio de Traube: Libre. '; hasPercussionFindings = true; }
            else if (isChecked('signo-traube-ocupado')) { percussionSection += 'Espacio de Traube: Ocupado. '; hasPercussionFindings = true; }

            if (hasPercussionFindings) {
                conclusion += percussionSection.trim() + '\n\n';
            }

            // --- 9. PALPACI√ìN ABDOMINAL ---
            let palpationSection = 'PALPACI√ìN ABDOMINAL:\n';
            let hasPalpationFindings = false;
            const superficialHallazgos = [];
            if (isChecked('abdomen-blando')) superficialHallazgos.push('abdomen blando');
            if (isChecked('abdomen-rigido')) superficialHallazgos.push('abdomen r√≠gido');
            if (isChecked('defensa-muscular')) superficialHallazgos.push('defensa muscular');
            if (isChecked('dolor-palpacion')) superficialHallazgos.push('dolor a la palpaci√≥n');
            if (isChecked('masas-superficiales')) superficialHallazgos.push('masas superficiales');
            if (isChecked('hernias-palpables')) superficialHallazgos.push('hernias palpables');
            if (superficialHallazgos.length > 0) {
                palpationSection += `Palpaci√≥n superficial: Se encuentra ${formatMedicalList(superficialHallazgos)}. `;
                hasPalpationFindings = true;
            } else {
                palpationSection += 'Palpaci√≥n superficial: Abdomen blando y depresible, no doloroso. ';
                hasPalpationFindings = true;
            }

            const temperaturaHumedad = [];
            if (isChecked('temperatura-normal')) temperaturaHumedad.push('temperatura normal');
            if (isChecked('hipertermia-local')) temperaturaHumedad.push('hipertermia local');
            if (isChecked('sudoracion')) temperaturaHumedad.push('sudoraci√≥n');
            if (temperaturaHumedad.length > 0) {
                palpationSection += `Piel abdominal: ${formatMedicalList(temperaturaHumedad)}. `;
                hasPalpationFindings = true;
            } else {
                palpationSection += 'Piel abdominal: Sin alteraciones de temperatura o humedad. ';
                hasPalpationFindings = true;
            }

            const profundaHallazgos = [];
            ['masas-profundas', 'organomegalias', 'pulsaciones-anormales', 'puntos-dolorosos'].forEach(id => {
                if (isChecked(id)) profundaHallazgos.push(getLabelText(id));
            });
            if (profundaHallazgos.length > 0) {
                palpationSection += `Palpaci√≥n profunda: Se detecta ${formatMedicalList(profundaHallazgos)}. `;
                hasPalpationFindings = true;
            } else {
                palpationSection += 'Palpaci√≥n profunda: Sin masas u organomegalias palpables. ';
                hasPalpationFindings = true;
            }

            const resistenciaMuscular = [];
            ['resistencia-voluntaria', 'resistencia-involuntaria', 'contractura-muscular'].forEach(id => {
                if (isChecked(id)) resistenciaMuscular.push(getLabelText(id));
            });
            if (resistenciaMuscular.length > 0) {
                palpationSection += `Resistencia muscular: ${formatMedicalList(resistenciaMuscular)}. `;
                hasPalpationFindings = true;
            } else {
                palpationSection += 'Resistencia muscular: No se observa. ';
                hasPalpationFindings = true;
            }

            if (hasPalpationFindings) {
                conclusion += palpationSection.trim() + '\n\n';
            }

            // --- 10. SIGNOS ESPEC√çFICOS Y MANIOBRAS ESPECIALES ---
            let specificSignsSection = 'SIGNOS Y MANIOBRAS ESPECIALES:\n';
            let hasSpecificSignsFindings = false;
            
            const peritonealSigns = [];
            if (isChecked('blumberg-pos')) peritonealSigns.push('Blumberg (+)'); else if (isChecked('blumberg-neg')) peritonealSigns.push('Blumberg (-)');
            if (isChecked('rovsing-pos')) peritonealSigns.push('Rovsing (+)'); else if (isChecked('rovsing-neg')) peritonealSigns.push('Rovsing (-)');
            if (isChecked('psoas-pos')) peritonealSigns.push('Psoas (+)'); else if (isChecked('psoas-neg')) peritonealSigns.push('Psoas (-)');
            if (isChecked('obturador-pos')) peritonealSigns.push('Obturador (+)'); else if (isChecked('obturador-neg')) peritonealSigns.push('Obturador (-)');
            if (peritonealSigns.length > 0) { specificSignsSection += `Signos de irritaci√≥n peritoneal: ${formatMedicalList(peritonealSigns)}. `; hasSpecificSignsFindings = true; }

            const vesicularSigns = [];
            if (isChecked('murphy-pos')) vesicularSigns.push('Murphy (+)'); else if (isChecked('murphy-neg')) vesicularSigns.push('Murphy (-)');
            if (isChecked('courvoisier-pos')) vesicularSigns.push('Courvoisier-Terrier (+)'); else if (isChecked('courvoisier-neg')) vesicularSigns.push('Courvoisier-Terrier (-)');
            if (isChecked('punto-cistico-pos')) vesicularSigns.push('Punto c√≠stico (+)'); else if (isChecked('punto-cistico-neg')) vesicularSigns.push('Punto c√≠stico (-)');
            if (vesicularSigns.length > 0) { specificSignsSection += `Signos vesiculares: ${formatMedicalList(vesicularSigns)}. `; hasSpecificSignsFindings = true; }

            const pancreaticSigns = [];
            if (isChecked('cullen-pos')) pancreaticSigns.push('Cullen (+)'); else if (isChecked('cullen-neg')) pancreaticSigns.push('Cullen (-)');
            if (isChecked('grey-turner-pos')) pancreaticSigns.push('Grey-Turner (+)'); else if (isChecked('grey-turner-neg')) pancreaticSigns.push('Grey-Turner (-)');
            if (isChecked('ranson-pos')) pancreaticSigns.push('Ranson (+)'); else if (isChecked('ranson-neg')) pancreaticSigns.push('Ranson (-)');
            if (pancreaticSigns.length > 0) { specificSignsSection += `Signos pancre√°ticos: ${formatMedicalList(pancreaticSigns)}. `; hasSpecificSignsFindings = true; }

            const otherSigns = [];
            if (isChecked('mcburney-pos')) otherSigns.push('McBurney (+)'); else if (isChecked('mcburney-neg')) otherSigns.push('McBurney (-)');
            if (isChecked('carnett-pos')) otherSigns.push('Carnett (+)'); else if (isChecked('carnett-neg')) otherSigns.push('Carnett (-)');
            if (isChecked('kehr-pos')) otherSigns.push('Kehr (+)'); else if (isChecked('kehr-neg')) otherSigns.push('Kehr (-)');
            if (isChecked('charcot-pos')) otherSigns.push('Charcot (+)'); else if (isChecked('charcot-neg')) otherSigns.push('Charcot (-)');
            if (otherSigns.length > 0) { specificSignsSection += `Otros signos importantes: ${formatMedicalList(otherSigns)}. `; hasSpecificSignsFindings = true; }

            if (hasSpecificSignsFindings) {
                conclusion += specificSignsSection.trim() + '\n\n';
            } else {
                conclusion += 'SIGNOS Y MANIOBRAS ESPECIALES:\nNo se identifican signos especiales relevantes.\n\n';
            }

            // --- 11. EVALUACI√ìN DE √ìRGANOS ESPEC√çFICOS ---
            let organEvaluationSection = 'EVALUACI√ìN DE √ìRGANOS ESPEC√çFICOS:\n';
            let hasOrganFindings = false;

            const higadoHallazgos = [];
            ['hepatomegalia', 'higado-palpable', 'higado-doloroso', 'superficie-hepatica-irregular',
             'borde-hepatico-romo', 'consistencia-aumentada'].forEach(id => {
                if (isChecked(id)) higadoHallazgos.push(getLabelText(id));
            });
            const hepatomegaliaCm = getInputValue('hepatomegalia-cm');
            if (hepatomegaliaCm) {
                higadoHallazgos.push(`tama√±o de ${hepatomegaliaCm} cm bajo reborde costal`);
            }
            if (higadoHallazgos.length > 0) {
                organEvaluationSection += `H√≠gado: ${formatMedicalList(higadoHallazgos)}. `;
                hasOrganFindings = true;
            } else {
                organEvaluationSection += 'H√≠gado: No palpable, sin organomegalia aparente. ';
            }

            const bazoHallazgos = [];
            ['esplenomegalia', 'bazo-palpable', 'bazo-doloroso', 'splenomegalia-masiva'].forEach(id => {
                if (isChecked(id)) bazoHallazgos.push(getLabelText(id));
            });
            const esplenomegaliaCm = getInputValue('esplenomegalia-cm');
            if (esplenomegaliaCm) {
                bazoHallazgos.push(`tama√±o de ${esplenomegaliaCm} cm bajo reborde costal`);
            }
            if (bazoHallazgos.length > 0) {
                organEvaluationSection += `Bazo: ${formatMedicalList(bazoHallazgos)}. `;
                hasOrganFindings = true;
            } else {
                organEvaluationSection += 'Bazo: No palpable. ';
            }

            const vesiculaHallazgos = [];
            ['vesicula-palpable', 'vesicula-distendida', 'vesicula-dolorosa', 'vesicula-fluctuante'].forEach(id => {
                if (isChecked(id)) vesiculaHallazgos.push(getLabelText(id));
            });
            if (vesiculaHallazgos.length > 0) {
                organEvaluationSection += `Ves√≠cula Biliar: ${formatMedicalList(vesiculaHallazgos)}. `;
                hasOrganFindings = true;
            } else {
                organEvaluationSection += 'Ves√≠cula Biliar: No palpable. ';
            }

            const rinonHallazgos = [];
            ['rinon-derecho-palpable', 'rinon-izquierdo-palpable', 'masa-renal', 'dolor-pu√±opercusion'].forEach(id => {
                if (isChecked(id)) rinonHallazgos.push(getLabelText(id));
            });
            if (rinonHallazgos.length > 0) {
                organEvaluationSection += `Ri√±ones: ${formatMedicalList(rinonHallazgos)}. `;
                hasOrganFindings = true;
            } else {
                organEvaluationSection += 'Ri√±ones: No palpables, pu√±opercusi√≥n negativa. ';
            }

            if (hasOrganFindings) {
                conclusion += organEvaluationSection.trim() + '\n\n';
            }

            // --- 12. EXAMEN ADICIONAL Y EVALUACI√ìN DE PIEL ---
            let additionalExamSection = 'EXAMEN ADICIONAL:\n';
            let hasAdditionalFindings = false;
            
            const pielHallazgos = [];
            ['ara√±as-vasculares', 'eritema-palmar', 'telangiectasias', 'angiomas',
             'acropaquias', 'xantelasmas', 'contractura-dupuytren'].forEach(id => {
                if (isChecked(id)) pielHallazgos.push(getLabelText(id));
            });
            if (pielHallazgos.length > 0) {
                additionalExamSection += `Piel y faneras: Se observan ${formatMedicalList(pielHallazgos)}. `;
                hasAdditionalFindings = true;
            } else {
                additionalExamSection += 'Piel y faneras: Sin signos de enfermedad hep√°tica cr√≥nica o lesiones dermatol√≥gicas relevantes. ';
                hasAdditionalFindings = true;
            }

            const nutricionalHallazgos = [];
            if (getInputValue('imc')) {
                nutricionalHallazgos.push(`IMC: ${getInputValue('imc')} kg/m¬≤`);
            }
            if (isChecked('perdida-peso-significativa')) nutricionalHallazgos.push('p√©rdida de peso >5% en 6 meses');
            if (isChecked('masa-muscular-reducida')) nutricionalHallazgos.push('masa muscular reducida');
            if (isChecked('grasa-subcutanea-reducida')) nutricionalHallazgos.push('grasa subcut√°nea reducida');
            if (isChecked('edema-periferico')) nutricionalHallazgos.push('edema perif√©rico');
            if (isChecked('ascitis-clinica')) nutricionalHallazgos.push('ascitis cl√≠nica');
            if (isChecked('sarcopenia')) nutricionalHallazgos.push('signos de sarcopenia');
            if (isChecked('malnutricion')) nutricionalHallazgos.push('signos de malnutrici√≥n');
            if (nutricionalHallazgos.length > 0) {
                additionalExamSection += `Evaluaci√≥n nutricional: ${formatMedicalList(nutricionalHallazgos)}. `;
                hasAdditionalFindings = true;
            } else {
                additionalExamSection += 'Evaluaci√≥n nutricional: Sin signos de malnutrici√≥n o sarcopenia. ';
                hasAdditionalFindings = true;
            }

            const gangliosHallazgos = [];
            ['ganglio-supraclavicular', 'ganglio-cervical', 'ganglio-axilar', 'ganglio-inguinal'].forEach(id => {
                if (isChecked(id)) gangliosHallazjs.push(getLabelText(id));
            });
            if (gangliosHallazgos.length > 0) {
                additionalExamSection += `Ganglios linf√°ticos: Palpables en ${formatMedicalList(gangliosHallazgos)}. `;
                hasAdditionalFindings = true;
            } else if (isChecked('sin-adenopatias')) {
                additionalExamSection += 'Ganglios linf√°ticos: Sin adenopat√≠as palpables. ';
                hasAdditionalFindings = true;
            }

            const tactoRectalHallazgos = [];
            ['hemorroides-internas', 'fisuras-anales', 'masas-rectales', 'sangre-oculta-heces',
             'tono-esfinter-alterado', 'prostata-aumentada'].forEach(id => {
                if (isChecked(id)) tactoRectalHallazgos.push(getLabelText(id));
            });
            if (isChecked('tacto-rectal-normal')) {
                additionalExamSection += 'Tacto rectal: Tono esfinteriano y ampolla normales, sin masas ni sangre en guante. ';
                hasAdditionalFindings = true;
            } else if (tactoRectalHallazgos.length > 0) {
                additionalExamSection += `Tacto rectal: Se detecta ${formatMedicalList(tactoRectalHallazgos)}. `;
                hasAdditionalFindings = true;
            } else {
                additionalExamSection += 'Tacto rectal: No realizado o no especificado. ';
                hasAdditionalFindings = true;
            }

            const genitalesHallazgos = [];
            ['ulceras-genitales', 'fistulas-perianales', 'lesiones-perianales', 'secreciones-anormales'].forEach(id => {
                if (isChecked(id)) genitalesHallazgos.push(getLabelText(id));
            });
            if (isChecked('genitales-normales')) {
                additionalExamSection += 'Genitales externos: De aspecto normal, sin lesiones ni secreciones. ';
                hasAdditionalFindings = true;
            } else if (genitalesHallazgos.length > 0) {
                additionalExamSection += `Genitales externos: Se observan ${formatMedicalList(genitalesHallazgos)}. `;
                hasAdditionalFindings = true;
            } else {
                additionalExamSection += 'Genitales externos: No evaluados. ';
                hasAdditionalFindings = true;
            }

            if (hasAdditionalFindings) {
                conclusion += additionalExamSection.trim() + '\n\n';
            }

            // --- 13. EVALUACI√ìN DE SEVERIDAD Y ESCALAS ---
            let severitySection = 'EVALUACI√ìN DE SEVERIDAD Y ESCALAS:\n';
            let hasSeverityFindings = false;

            const glasgowTotal = document.getElementById('glasgow-total').textContent;
            if (glasgowTotal && parseInt(glasgowTotal) !== 0) {
                let riskLevel = '';
                const score = parseInt(glasgowTotal);
                if (score <= 1) riskLevel = 'muy bajo';
                else if (score <= 6) riskLevel = 'bajo';
                else if (score <= 12) riskLevel = 'intermedio';
                else riskLevel = 'alto';
                severitySection += `Escala de Glasgow-Blatchford: ${glasgowTotal} puntos (riesgo ${riskLevel} de resangrado/mortalidad en hemorragia digestiva alta). `;
                hasSeverityFindings = true;
            } else {
                 severitySection += 'Escala de Glasgow-Blatchford: No aplicable o 0 puntos. ';
            }

            const childTotal = document.getElementById('child-total').textContent;
            const childClass = document.getElementById('child-class').textContent;
            if (childTotal && parseInt(childTotal) !== 5 || isChecked('child-bilirrubina') || isChecked('child-albumina') || isChecked('child-inr') || isChecked('child-ascitis') || isChecked('child-encefalopatia')) {
                severitySection += `Clasificaci√≥n de Child-Pugh: ${childTotal} puntos (${childClass}). `;
                hasSeverityFindings = true;
            } else {
                severitySection += 'Clasificaci√≥n de Child-Pugh: No aplicable o Clase A (compensado). ';
            }

            const impactoFuncional = [];
            ['impacto-trabajo', 'impacto-sueno', 'impacto-alimentacion', 'impacto-social'].forEach(id => {
                if (isChecked(id)) impactoFuncional.push(getLabelText(id));
            });
            if (impactoFuncional.length > 0) {
                severitySection += `Impacto funcional: ${formatMedicalList(impactoFuncional)}. `;
                hasSeverityFindings = true;
            } else {
                severitySection += 'Impacto funcional: No se refiere impacto significativo en la calidad de vida. ';
            }

            if (hasSeverityFindings) {
                conclusion += severitySection.trim() + '\n\n';
            }

            // --- RESUMEN FINAL Y CONCLUSIONES ---
            if (conclusion.trim() === 'INFORME DEL EXAMEN GASTROENTEROL√ìGICO:') {
                conclusion = 'Seleccione los par√°metros del examen para generar la conclusi√≥n gastroenterol√≥gica...';
            } else {
                conclusion += 'RESUMEN Y CONCLUSI√ìN:\n';
                if (alertCount > 0) {
                    conclusion += `Se identifican ${alertCount} **alertas cr√≠ticas** que requieren atenci√≥n inmediata. `;
                }
                if (warningCount > 0) {
                    conclusion += `Existen ${warningCount} **hallazgos importantes** que deben ser considerados. `;
                }
                if (findingsCount > 0) {
                    conclusion += `Un total de ${findingsCount} hallazgos relevantes han sido registrados en este examen. `;
                } else {
                    conclusion += `El examen no ha revelado hallazgos significativos. `;
                }
                conclusion += '\n\n';

                conclusion += 'IMPRESI√ìN DIAGN√ìSTICA:\n';
                conclusion += '[Pendiente de evaluaci√≥n cl√≠nica completa y resultados de estudios complementarios]\n\n';
                conclusion += 'RECOMENDACIONES:\n';
                conclusion += '[A determinar seg√∫n la impresi√≥n diagn√≥stica y la condici√≥n del paciente]\n\n';
                conclusion += `COMPLETITUD DEL EXAMEN: ${examProgress}%`;
            }

            conclusionEl.textContent = conclusion;
            
            // Actualizar panel sticky si est√° activo
            const stickyPanel = document.getElementById('stickyConclusion');
            if (stickyPanel && stickyPanel.classList.contains('active')) {
                // Peque√±o retardo para asegurar que el DOM se actualice antes de copiar
                setTimeout(() => generateStickyConclusion(), 100); 
            }
        }
        
        // üñ®Ô∏è Imprimir conclusi√≥n
        function printConclusion() {
            const conclusion = document.getElementById('conclusion-text').textContent;
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                <head>
                    <title>Conclusi√≥n Examen Gastroenterol√≥gico</title>
                    <style>
                        body { 
                            font-family: Arial, sans-serif; 
                            margin: 20px; 
                            line-height: 1.6;
                        }
                        pre { 
                            white-space: pre-wrap; 
                            font-family: 'Courier New', monospace; 
                            font-size: 12px;
                        }
                        .header {
                            text-align: center;
                            border-bottom: 2px solid #667eea;
                            padding-bottom: 10px;
                            margin-bottom: 20px;
                        }
                        .footer {
                            text-align: center;
                            font-size: 10px;
                            color: #666;
                            margin-top: 20px;
                            border-top: 1px solid #ddd;
                            padding-top: 10px;
                        }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>Examen Gastroenterol√≥gico - Conclusi√≥n</h1>
                        <p>Fecha: ${new Date().toLocaleDateString()}</p>
                    </div>
                    <pre>${conclusion}</pre>
                    <div class="footer">
                        <p>Generado por Sistema de Evaluaci√≥n Gastroenterol√≥gica Avanzado</p>
                    </div>
                </body>
                </html>
            `);
            printWindow.document.close();
            printWindow.print();
        }

        // üóëÔ∏è Limpiar formulario
        function clearForm() {
            if (confirm('¬øEst√° seguro de que desea limpiar todos los datos del formulario?')) {
                document.querySelectorAll('input[type="checkbox"]').forEach(cb => {
                    cb.checked = false;
                    cb.disabled = false;
                    cb.style.backgroundColor = '';
                    cb.style.border = '';
                });
                document.querySelectorAll('input[type="radio"]').forEach(rb => rb.checked = false);
                document.querySelectorAll('input[type="number"]').forEach(nb => nb.value = '');
                document.querySelectorAll('input[type="text"]').forEach(tb => tb.value = '');
                document.querySelectorAll('input[type="range"]').forEach(rb => rb.value = 0);
                document.querySelectorAll('select').forEach(sel => sel.selectedIndex = 0);
                document.querySelectorAll('textarea').forEach(ta => ta.value = '');
                
                // Resetear valores espec√≠ficos
                document.getElementById('dolor-value').textContent = '0';
                document.getElementById('glasgow-total').textContent = '0';
                document.getElementById('child-total').textContent = '5';
                document.getElementById('child-class').textContent = 'Clase A';
                document.getElementById('completeness-status').textContent = '0%';
                
                // Limpiar cuadrantes seleccionados
                document.querySelectorAll('.abdomen-quadrant.selected').forEach(quad => {
                    quad.classList.remove('selected');
                });
                
                // Ocultar secciones condicionales
                document.getElementById('dolor-section').classList.add('hidden');
                document.getElementById('deposiciones-section').classList.add('hidden');
                
                // Resetear indicadores visuales
                updateDolorValue(0);
                calculateChildPugh();
                calculateGlasgow();
                
                // Actualizar dashboard
                updateDashboard();
                generateConclusion();
            }
        }
        
        // üöÄ Inicializaci√≥n del sistema
        document.addEventListener('DOMContentLoaded', () => {
            // Cargar tema guardado
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark') {
                document.body.setAttribute('data-theme', 'dark');
                document.getElementById('theme-icon').className = 'fas fa-sun';
            }

            // Event listeners para actualizar dashboard
            document.querySelectorAll('input, select, textarea').forEach(el => {
                el.addEventListener('change', () => {
                    updateDashboard();
                    generateConclusion();
                });
                el.addEventListener('input', () => {
                    updateDashboard();
                    generateConclusion();
                });
            });
             
            // Actualizar altura de secciones al cambiar contenido
            document.querySelector('.main-container').addEventListener('change', (event) => {
                const sectionContent = event.target.closest('.section-content.expanded');
                if (sectionContent) {
                    updateSectionHeight(sectionContent);
                }
            });
             
            // Expandir la primera secci√≥n por defecto
            toggleSection(document.querySelector('.section-header'));
            
            // Inicializar valores de escalas
            calculateChildPugh();
            calculateGlasgow();
            updateDashboard();
            generateConclusion();

            // Mostrar mensaje de bienvenida
            setTimeout(() => {
                console.log('üéâ Sistema de Evaluaci√≥n Gastroenterol√≥gica Avanzado con Panel Sticky cargado exitosamente!');
            }, 1000);
        });
    </script>
</body>
</html>