<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Examen Hematol√≥gico - Algoritmo de Evaluaci√≥n</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Variables CSS para el tema y colores (Adaptado de gastro.html con tu paleta roja principal) */
        :root {
            --primary-gradient: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%); /* Tu rojo actual, en gradiente */
            --secondary-gradient: linear-gradient(135deg, #28a745 0%, #20c997 100%); /* Verde para √©xito/normal */
            --alert-gradient: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%); /* Rojo para alertas */
            --warning-gradient: linear-gradient(135deg, #f39c12 0%, #e67e22 100%); /* Naranja para avisos */
            --normal-color: #27ae60; /* Verde para positivo/normal */
            --warning-color: #ffa726; /* Naranja para advertencias */
            --alert-color: #ff6b6b; /* Rojo m√°s brillante para alertas */
            --info-color: #17a2b8; /* Azul para informaci√≥n/secundario */
            --light-bg: #f8f9fa;
            --card-bg: #ffffff;
            --dark-bg: #1a1a1a; /* Fondo oscuro (para modo oscuro) */
            --dark-card: #3d3d3d; /* Fondo de tarjeta oscuro (para modo oscuro) */
            --text-color-light: #2c3e50; /* Color de texto principal para tema claro */
            --text-color-dark: #ffffff; /* Color de texto principal para tema oscuro */
        }

        /* Modo Oscuro (Copiado de gastro.html) */
        [data-theme="dark"] {
            --light-bg: var(--dark-bg);
            --card-bg: var(--dark-card);
            color: var(--text-color-dark);
        }

        /* Estilos generales del cuerpo (Modificado para usar variables y padding-top para el dashboard fijo) */
        body {
            font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; /* Usar Inter como principal */
            max-width: 1600px;
            margin: 0 auto;
            padding-top: 160px; /* Espacio para el dashboard fijo */
            background-color: var(--light-bg);
            line-height: 1.6;
            transition: all 0.3s ease; /* Transici√≥n suave para el cambio de tema */
            color: var(--text-color-light); /* Color de texto inicial */
        }
        
        /* üé™ DASHBOARD SUPERIOR FIJO (Copiado de gastro.html) */
        .dashboard-fixed {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: var(--primary-gradient);
            backdrop-filter: blur(10px);
            z-index: 1000;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .dashboard-content {
            max-width: 1600px;
            margin: 0 auto;
            padding: 15px 20px;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 12px;
            margin-bottom: 10px;
        }

        .dashboard-item {
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            padding: 8px 12px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
            transition: all 0.3s ease;
            color: white;
            text-align: center;
            font-size: 12px;
        }

        .dashboard-item:hover {
            background: rgba(255,255,255,0.2);
            transform: translateY(-2px);
        }

        .dashboard-item i {
            font-size: 16px;
            margin-bottom: 4px;
            display: block;
        }

        .dashboard-alert {
            color: var(--alert-color) !important;
            animation: pulse 2s infinite;
        }

        .dashboard-warning {
            color: var(--warning-color) !important;
        }

        .dashboard-normal {
            color: var(--normal-color) !important;
        }

        /* üéõÔ∏è CONTROLES SUPERIORES (Copiado de gastro.html) */
        .control-bar {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .control-btn {
            padding: 8px 15px;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .control-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(231, 76, 60, 0.4); /* Adaptado a tu color principal */
        }

        /* Colores de botones usando variables */
        .btn-primary { background: var(--primary-gradient); }
        .btn-success { background: var(--secondary-gradient); }
        .btn-warning { background: var(--warning-gradient); }
        .btn-danger { background: var(--alert-gradient); }

        /* üéØ PANEL LATERAL DE NAVEGACI√ìN (Copiado y adaptado de gastro.html) */
        .nav-panel {
            position: fixed;
            left: 20px;
            top: 160px; /* Ajustado para debajo del dashboard */
            width: 250px;
            background: var(--card-bg);
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            padding: 20px;
            max-height: calc(100vh - 180px);
            overflow-y: auto;
            z-index: 998;
            transform: translateX(-280px); /* Oculto por defecto */
            transition: transform 0.3s ease;
        }

        .nav-panel.open {
            transform: translateX(0);
        }

        .nav-panel h3 {
            margin: 0 0 15px 0;
            color: var(--primary-gradient); /* Usar gradiente para el t√≠tulo */
            font-size: 16px;
            border-bottom: 2px solid var(--primary-gradient);
            padding-bottom: 8px;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 12px;
            margin: 4px 0;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 13px;
        }

        .nav-item:hover {
            background: rgba(231, 76, 60, 0.1); /* Adaptado a tu color principal */
        }

        .nav-item.completed {
            background: rgba(40, 167, 69, 0.1); /* Verde para completado */
            color: var(--normal-color);
        }

        .nav-item.completed i {
            color: var(--normal-color);
        }

        .nav-item i {
            width: 16px;
            text-align: center;
        }

        /* üìä PANEL LATERAL STICKY - FUNCIONALIDAD PRINCIPAL (Copiado y adaptado de gastro.html) */
        .sticky-panel {
            position: fixed;
            top: 160px; /* Ajustado para debajo del dashboard */
            right: -420px; /* Oculto por defecto */
            width: 400px;
            height: calc(100vh - 180px);
            background: var(--card-bg);
            border-radius: 12px 0 0 12px;
            box-shadow: -4px 0 20px rgba(0,0,0,0.15);
            z-index: 997;
            transition: right 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            overflow: hidden;
            border: 2px solid var(--primary-gradient);
        }

        .sticky-panel.active {
            right: 0;
        }

        .sticky-header {
            background: var(--primary-gradient);
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 600;
            font-size: 14px;
        }

        .sticky-controls {
            display: flex;
            gap: 8px;
        }

        .sticky-btn {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            border-radius: 4px;
            padding: 6px 10px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .sticky-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: scale(1.05);
        }

        .sticky-content {
            padding: 20px;
            height: calc(100% - 70px);
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 11px;
            line-height: 1.4;
            white-space: pre-wrap;
            background: var(--light-bg);
        }

        .update-indicator {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--primary-gradient);
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            display: none;
            align-items: center;
            gap: 8px;
            font-size: 12px;
            z-index: 10;
        }

        .update-indicator.active {
            display: flex;
        }

        .spinner {
            width: 16px;
            height: 16px;
            border: 2px solid rgba(255,255,255,0.3);
            border-top: 2px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Notificaci√≥n de copia (Copiado de gastro.html) */
        .copy-notification {
            position: fixed;
            top: 200px;
            right: 20px;
            background: var(--normal-color);
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 500;
            opacity: 0;
            transform: translateX(100px);
            transition: all 0.3s ease;
            z-index: 1002;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .copy-notification.show {
            opacity: 1;
            transform: translateX(0);
        }

        /* Ajustar contenido principal cuando panel est√° activo (Copiado y adaptado de gastro.html) */
        /* Aplicado al body para simplicidad, como en gastro.html */
        body.split-view-active .main-container {
            margin-right: 420px;
            transition: margin-right 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }
        body.split-view .main-container { /* Para el panel de navegaci√≥n izquierdo */
            margin-left: 290px;
            margin-right: 20px; /* Asegura que no se solape con el sticky si ambos est√°n abiertos */
            transition: margin-left 0.3s ease, margin-right 0.3s ease;
        }

        /* Contenedor principal (Modificado para usar variables y mejores sombras) */
        .main-container {
            background: var(--card-bg);
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            padding: 30px;
            margin: 0 20px; /* Ajuste para espacio en los lados */
            transition: all 0.3s ease;
        }
        
        /* T√≠tulo principal (Modificado para usar gradiente de texto) */
        h1 {
            color: var(--text-color-light); /* Fallback */
            text-align: center;
            margin-bottom: 30px;
            font-size: 28px;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            padding-bottom: 15px; /* Reemplaza border-bottom con gradiente de texto */
        }
        
        /* Secciones (Mejorado de gastro.html) */
        .section {
            margin-bottom: 25px;
            border: 2px solid #ecf0f1; /* Color de borde por defecto */
            border-radius: 12px; /* M√°s redondeado */
            overflow: hidden;
            transition: all 0.3s ease;
            background: var(--card-bg); /* Fondo de secci√≥n */
        }
        
        .section.active {
            border-color: var(--primary-gradient); /* Borde con gradiente al estar activo */
            box-shadow: 0 4px 15px rgba(231, 76, 60, 0.15); /* Sombra m√°s pronunciada al estar activo */
        }
        
        .section-header {
            background: var(--primary-gradient); /* Usar variable de gradiente */
            color: white;
            padding: 15px 20px;
            cursor: pointer;
            font-weight: 600;
            font-size: 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease; /* Transici√≥n para hover */
        }
        
        .section-header:hover {
            box-shadow: inset 0 0 20px rgba(255,255,255,0.1); /* Efecto de sombra interna al pasar el rat√≥n */
        }
        
        .section-header .arrow {
            transition: transform 0.3s ease;
            font-size: 18px;
        }
        
        .section-header.expanded .arrow {
            transform: rotate(180deg);
        }

        /* Badge de completado (Copiado de gastro.html) */
        .section-header .completion-badge {
            background: rgba(255,255,255,0.2);
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            margin-left: 10px;
        }

        .section-header .completion-badge.completed {
            background: var(--normal-color);
        }
        
        .section-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease-in-out;
            background: var(--light-bg); /* Fondo de la secci√≥n de contenido */
        }
        
        .section-content.expanded {
            padding: 20px;
        }
        
        /* Contenedores de examen (Modificado para usar variables y sombras en hover) */
        .exam-container {
            background: var(--card-bg);
            border: 1px solid #e1e8ed;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            transition: all 0.3s ease; /* Transici√≥n para hover */
        }
        .exam-container:hover {
            box-shadow: 0 2px 10px rgba(0,0,0,0.05); /* Sombra suave al pasar el rat√≥n */
        }
        
        .exam-header {
            font-size: 18px;
            font-weight: 600;
            background: var(--primary-gradient); /* Usar gradiente para el encabezado del examen */
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin: -20px -20px 15px -20px; /* Extender el fondo */
            padding: 12px 20px;
            border-radius: 8px 8px 0 0; /* Bordes redondeados en la parte superior */
            border-bottom: none; /* Eliminar el borde inferior que ten√≠as */
        }
        
        .exam-section {
            background: var(--light-bg);
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
        }
        
        .exam-section h4 {
            color: var(--text-color-light); /* Color de texto principal */
            margin: 0 0 10px 0;
            font-size: 14px;
            font-weight: 600;
        }

        .sub-header {
            color: var(--primary-gradient); /* Usar tu color primario para sub-headers */
            margin: 15px 0 8px 0;
            font-size: 13px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        /* Checkbox grid (Mejorado de gastro.html) */
        .checkbox-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 8px;
            margin-bottom: 15px;
        }
        
        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 8px; /* M√°s padding */
            border-radius: 4px;
            transition: all 0.3s ease;
        }
        .checkbox-item:hover {
            background: rgba(231, 76, 60, 0.05); /* Color de hover sutil */
        }
        
        .checkbox-item input[type="checkbox"] {
            width: 16px;
            height: 16px;
            margin: 0;
            accent-color: var(--normal-color); /* Color del checkbox al marcar */
        }
        .checkbox-item input[type="radio"] {
            width: 16px;
            height: 16px;
            margin: 0;
            accent-color: var(--normal-color); /* Color del radio al marcar */
        }
        
        .checkbox-item label {
            font-size: 13px;
            color: var(--text-color-light);
            cursor: pointer;
            transition: color 0.3s ease;
        }
        .checkbox-item input:checked + label {
            color: var(--normal-color);
            font-weight: 500;
        }
        
        .measurement {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 5px 0;
        }
        
        .measurement label {
            font-size: 12px;
            color: #5d6d7e;
            flex-basis: 120px;
            flex-shrink: 0;
        }
        
        .input-field {
            width: 80px;
            padding: 6px 10px; /* M√°s padding */
            border: 2px solid #e9ecef; /* Borde m√°s grueso y claro */
            border-radius: 6px; /* M√°s redondeado */
            font-size: 12px;
            text-align: center;
            transition: all 0.3s ease; /* Transici√≥n para el foco */
        }
        
        .input-field:focus {
            outline: none;
            border-color: var(--primary-gradient); /* Color de borde al enfocar */
            box-shadow: 0 0 0 3px rgba(231, 76, 60, 0.1); /* Sombra suave al enfocar */
        }

        .bilateral-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-top: 10px;
        }
        
        .side-container {
            padding: 15px;
            background: var(--card-bg);
            border: 1px solid #e8ecef;
            border-radius: 8px; /* M√°s redondeado */
            transition: all 0.3s ease; /* Transici√≥n para hover */
        }
        .side-container:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }
        
        .side-header {
            font-weight: 600;
            font-size: 14px;
            color: var(--text-color-light); /* Color de texto principal */
            margin-bottom: 12px;
            text-align: center;
            border-bottom: 2px solid var(--primary-gradient); /* Borde con gradiente */
            padding-bottom: 8px;
        }

        /* Secciones de evaluaci√≥n espec√≠ficas (adaptadas para usar variables y transparencia) */
        .bleeding-assessment {
            background: rgba(231, 76, 60, 0.08); /* Fondo suave del color principal */
            border: 1px solid var(--alert-color);
            border-radius: 8px; /* M√°s redondeado */
            padding: 15px;
            margin-top: 15px;
        }

        .bleeding-assessment h4 {
            color: var(--alert-color);
            margin: 0 0 10px 0;
            font-size: 14px;
            font-weight: 600;
        }

        .anemia-assessment {
            background: rgba(243, 156, 18, 0.08); /* Fondo suave del color de advertencia */
            border: 1px solid var(--warning-color);
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
        }

        .anemia-assessment h4 {
            color: var(--warning-color);
            margin: 0 0 10px 0;
            font-size: 14px;
            font-weight: 600;
        }

        .severity-section {
            background: rgba(231, 76, 60, 0.08); /* Usa el mismo fondo que bleeding-assessment */
            border: 1px solid var(--alert-color);
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
        }

        .severity-section h4 {
            color: var(--alert-color);
            margin: 0 0 10px 0;
            font-size: 14px;
            font-weight: 600;
        }

        .severity-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 8px;
        }

        .severity-item {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 3px;
        }

        .severity-item input[type="radio"] {
            width: 14px;
            height: 14px;
            accent-color: var(--normal-color);
        }

        .severity-item label {
            font-size: 12px;
            color: var(--text-color-light); /* Color de texto principal */
            cursor: pointer;
        }
        
        .test-results {
            margin-top: 10px;
        }
        
        .test-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            padding: 8px 12px; /* M√°s padding */
            margin: 4px 0;
            background: var(--card-bg);
            border: 1px solid #e8ecef;
            border-radius: 6px; /* M√°s redondeado */
            transition: all 0.3s ease; /* Transici√≥n para hover */
        }
        .test-item:hover {
            border-color: var(--primary-gradient); /* Borde con gradiente al pasar el rat√≥n */
            box-shadow: 0 2px 8px rgba(231, 76, 60, 0.1); /* Sombra suave al pasar el rat√≥n */
        }
        
        .test-item label {
            font-size: 12px;
            color: var(--text-color-light);
            flex-grow: 1;
            margin-right: 10px;
        }
        
        .test-controls {
            display: flex;
            gap: 15px;
            align-items: center;
        }
        
        .test-checkbox {
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .test-checkbox input[type="checkbox"] {
            width: 16px; /* M√°s grande */
            height: 16px; /* M√°s grande */
            accent-color: var(--normal-color);
        }
        
        .test-checkbox span {
            font-size: 12px; /* M√°s grande */
            font-weight: 600; /* M√°s negrita */
        }
        
        .positive { color: var(--alert-color) !important; }
        .negative { color: var(--normal-color) !important; }
        
        .lymph-nodes {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .node-group {
            border: 1px solid #ddd;
            border-radius: 8px; /* M√°s redondeado */
            padding: 12px; /* M√°s padding */
            background: var(--card-bg);
            transition: all 0.3s ease;
        }
        .node-group:hover {
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .node-group h5 {
            margin: 0 0 8px 0;
            font-size: 13px; /* M√°s grande */
            font-weight: 600;
            text-align: center;
            color: var(--primary-gradient); /* Usar gradiente para el t√≠tulo */
            border-bottom: 1px solid var(--primary-gradient); /* Borde inferior */
            padding-bottom: 5px;
        }

        .node-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 5px 0; /* M√°s padding */
            font-size: 12px; /* M√°s grande */
        }

        .node-checkboxes {
            display: flex;
            gap: 8px; /* M√°s espacio */
            align-items: center;
        }

        .node-checkboxes input[type="checkbox"] {
            width: 14px; /* M√°s grande */
            height: 14px; /* M√°s grande */
            accent-color: var(--normal-color);
        }

        .node-size {
            width: 50px; /* M√°s ancho */
            padding: 3px 6px; /* M√°s padding */
            border: 2px solid #ddd; /* Borde m√°s grueso */
            border-radius: 4px;
            font-size: 11px;
            text-align: center;
            transition: all 0.3s ease;
        }
        .node-size:focus {
            outline: none;
            border-color: var(--primary-gradient);
            box-shadow: 0 0 0 3px rgba(231, 76, 60, 0.1);
        }

        .score-calculation {
            background: rgba(39, 174, 96, 0.08); /* Fondo suave del color normal */
            border: 1px solid var(--normal-color);
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
        }

        .score-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 5px 0;
            font-size: 13px;
        }

        .score-value {
            font-weight: 600;
            color: var(--normal-color);
        }

        .organomegaly-assessment {
            background: rgba(23, 162, 184, 0.08); /* Fondo suave del color info */
            border: 1px solid var(--info-color);
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
        }

        .organomegaly-assessment h4 {
            color: var(--info-color);
            margin: 0 0 10px 0;
            font-size: 14px;
            font-weight: 600;
        }

        /* Conclusi√≥n (Mejorado de gastro.html) */
        .conclusion {
            margin-top: 30px;
            padding: 25px; /* M√°s padding */
            background: var(--card-bg);
            border-radius: 12px; /* M√°s redondeado */
            border: 2px solid #dee2e6;
            position: relative;
            overflow: hidden;
        }

        .conclusion::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--primary-gradient);
        }
        
        .conclusion h3 {
            color: var(--text-color-light);
            margin-bottom: 15px;
        }
        
        .conclusion-text {
            padding: 20px; /* M√°s padding */
            background: var(--light-bg);
            border-radius: 8px; /* M√°s redondeado */
            border: 1px solid #dee2e6;
            min-height: 200px;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            font-size: 13px;
            line-height: 1.5; /* M√°s espacio entre l√≠neas */
        }

        /* Botones de control (Mejorado de gastro.html) */
        .control-buttons {
            margin-top: 25px;
            display: flex;
            gap: 12px; /* M√°s espacio */
            justify-content: center;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 24px; /* M√°s padding */
            border: none;
            border-radius: 8px; /* M√°s redondeado */
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease; /* Transici√≥n general */
            display: flex; /* Para √≠conos */
            align-items: center;
            gap: 8px;
        }

        .btn:hover {
            transform: translateY(-2px); /* Efecto de elevaci√≥n */
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        /* Colores de botones usando gradientes y variables */
        .btn-primary {
            background: var(--primary-gradient);
            color: white;
        }

        .btn-primary:hover {
            box-shadow: 0 4px 15px rgba(231, 76, 60, 0.4); /* Sombra m√°s fuerte para primario */
        }

        .btn-secondary {
            background-color: var(--info-color); /* Usar color info */
            color: white;
        }

        .btn-secondary:hover {
            background-color: #138496; /* Color m√°s oscuro al pasar el rat√≥n */
            box-shadow: 0 4px 15px rgba(23, 162, 184, 0.3); /* Sombra para secundario */
        }

        /* TOGGLE DE TEMA (Copiado de gastro.html) */
        .theme-toggle {
            position: fixed;
            top: 20px;
            left: 20px;
            background: var(--primary-gradient);
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            font-size: 20px;
            cursor: pointer;
            z-index: 1001;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15); /* Sombra */
        }

        .theme-toggle:hover {
            transform: scale(1.1);
        }

        /* BOT√ìN HOME (Copiado de gastro.html) */
        .home-button {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--normal-color); /* Color verde para home */
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            font-size: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            text-decoration: none;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 1001;
            transition: all 0.3s ease;
        }
        
        .home-button:hover {
            background-color: #229954;
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(0,0,0,0.2);
        }

        /* Leyendas (Modificado para usar variables) */
        .legend {
            display: flex;
            gap: 20px;
            margin-bottom: 15px;
            font-size: 12px;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 2px;
        }

        .bleeding-color { background-color: var(--alert-color); }
        .anemia-color { background-color: var(--warning-color); }
        .lymph-color { background-color: var(--primary-gradient); } /* Adaptado a tu primario */
        .organomegaly-color { background-color: var(--info-color); }

        .description-area {
            width: 100%;
            min-height: 60px;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 12px;
            resize: vertical;
            background: var(--light-bg); /* Fondo acorde al tema */
            color: var(--text-color-light);
        }

        .functional-status {
            background: rgba(156, 39, 176, 0.08); /* Morado suave para funcional */
            border: 1px solid #9c27b0;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
        }

        .functional-status h4 {
            color: #7b1fa2;
            margin: 0 0 10px 0;
            font-size: 14px;
            font-weight: 600;
        }

        /* Animaciones (Copiado de gastro.html) */
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        @keyframes slideIn {
            from { transform: translateX(-20px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .slide-in {
            animation: slideIn 0.3s ease forwards;
        }

        /* Responsividad (Adaptado de gastro.html) */
        @media (max-width: 1200px) {
            .sticky-panel {
                width: 350px;
            }
            
            body.split-view-active .main-container {
                margin-right: 370px;
            }
        }

        @media (max-width: 768px) {
            body { padding-top: 120px; } /* Ajuste para m√≥viles */
            
            .dashboard-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .control-bar {
                position: relative;
                top: auto;
                right: auto;
                justify-content: center;
                margin: 10px 0;
            }
            
            .nav-panel {
                transform: translateX(-100%);
                width: calc(100vw - 40px);
            }
            
            .main-container {
                margin: 0 10px;
            }
            
            body.split-view .main-container {
                margin-left: 10px;
            }

            .sticky-panel {
                width: calc(100vw - 20px);
                right: -100vw;
                left: 10px;
                border-radius: 12px;
            }
            
            .sticky-panel.active {
                right: auto;
                left: 10px;
            }
            
            body.split-view-active .main-container {
                margin-right: 10px;
            }
            
            .checkbox-grid {
                grid-template-columns: 1fr;
            }
            
            .bilateral-container {
                grid-template-columns: 1fr;
            }
            .lymph-nodes {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <button class="theme-toggle" onclick="toggleTheme()" title="Cambiar tema">
        <i class="fas fa-moon" id="theme-icon"></i>
    </button>

    <a href="index.html" class="home-button" title="Inicio">
        <i class="fas fa-home"></i>
    </a>

    <div class="dashboard-fixed">
        <div class="dashboard-content">
            <div class="dashboard-grid">
                <div class="dashboard-item">
                    <i class="fas fa-user-md"></i>
                    <div>Examen</div>
                    <div id="exam-progress">0%</div>
                </div>
                <div class="dashboard-item">
                    <i class="fas fa-clipboard-list"></i>
                    <div>Secciones</div>
                    <div id="sections-completed">0/5</div> </div>
                <div class="dashboard-item dashboard-alert" id="alerts-item">
                    <i class="fas fa-exclamation-triangle"></i>
                    <div>Alertas</div>
                    <div id="alert-count">0</div>
                </div>
                <div class="dashboard-item dashboard-warning" id="warnings-item">
                    <i class="fas fa-exclamation-circle"></i>
                    <div>Avisos</div>
                    <div id="warning-count">0</div>
                </div>
                <div class="dashboard-item dashboard-normal" id="findings-item">
                    <i class="fas fa-search"></i>
                    <div>Hallazgos</div>
                    <div id="findings-count">0</div>
                </div>
                <div class="dashboard-item" id="vitals-item"> <i class="fas fa-heartbeat"></i>
                    <div>Signos Vitales</div>
                    <div id="vitals-status">Pendiente</div>
                </div>
            </div>
            <div class="control-bar">
                <button class="control-btn btn-primary" onclick="toggleNavPanel()">
                    <i class="fas fa-bars"></i> Navegaci√≥n
                </button>
                <button class="control-btn btn-primary" onclick="toggleStickyPanel()" id="sticky-toggle-btn">
                    <i class="fas fa-columns"></i> Vista Dividida
                </button>
                <button class="control-btn btn-success" onclick="generateConclusion()">
                    <i class="fas fa-file-medical"></i> Generar
                </button>
                <button class="control-btn btn-warning" onclick="expandAllSections()">
                    <i class="fas fa-expand-alt"></i> Expandir
                </button>
                <button class="control-btn btn-danger" onclick="clearForm()">
                    <i class="fas fa-trash"></i> Limpiar
                </button>
            </div>
        </div>
    </div>

    <div class="nav-panel" id="nav-panel">
        <h3><i class="fas fa-map"></i> Navegaci√≥n R√°pida</h3>
        <div class="nav-item" onclick="scrollToSection('anamnesis')">
            <i class="fas fa-user-edit"></i>
            <span>Anamnesis</span>
            <i class="fas fa-check" style="margin-left: auto; opacity: 0;" id="nav-anamnesis"></i>
        </div>
        <div class="nav-item" onclick="scrollToSection('physical-exam')">
            <i class="fas fa-user"></i>
            <span>Examen F√≠sico Gral.</span>
            <i class="fas fa-check" style="margin-left: auto; opacity: 0;" id="nav-physical-exam"></i>
        </div>
        <div class="nav-item" onclick="scrollToSection('lymph-nodes')">
            <i class="fas fa-node"></i>
            <span>Ganglios Linf√°ticos</span>
            <i class="fas fa-check" style="margin-left: auto; opacity: 0;" id="nav-lymph-nodes"></i>
        </div>
        <div class="nav-item" onclick="scrollToSection('abdominal-exam')">
            <i class="fas fa-hand-holding-medical"></i>
            <span>Abdomen y Org.</span>
            <i class="fas fa-check" style="margin-left: auto; opacity: 0;" id="nav-abdominal-exam"></i>
        </div>
        <div class="nav-item" onclick="scrollToSection('hematologic-scales')">
            <i class="fas fa-calculator"></i>
            <span>Escalas Hematol√≥gicas</span>
            <i class="fas fa-check" style="margin-left: auto; opacity: 0;" id="nav-hematologic-scales"></i>
        </div>
    </div>

    <div class="sticky-panel" id="stickyConclusion">
        <div class="sticky-header">
            <span><i class="fas fa-file-medical-alt"></i> Informe en Tiempo Real</span>
            <div class="sticky-controls">
                <button class="sticky-btn" onclick="copyStickyToClipboard()" title="Copiar informe">
                    <i class="fas fa-copy"></i>
                </button>
                <button class="sticky-btn" onclick="printStickyConclusion()" title="Imprimir informe">
                    <i class="fas fa-print"></i>
                </button>
                <button class="sticky-btn" onclick="generateStickyConclusion()" title="Actualizar informe">
                    <i class="fas fa-sync-alt"></i>
                </button>
            </div>
        </div>
        <div class="sticky-content" id="stickyContent">
            Seleccione los par√°metros del examen para generar el informe en tiempo real...
        </div>
        <div class="update-indicator" id="updateIndicator">
            <div class="spinner"></div>
            <span>Actualizando informe...</span>
        </div>
    </div>

    <div class="copy-notification" id="copyNotification">
        <i class="fas fa-check-circle"></i>
        <span>¬°Informe copiado al portapapeles!</span>
    </div>

    <div class="main-container">
        <h1>Examen Hematol√≥gico - Algoritmo de Evaluaci√≥n</h1>
        
        <div class="section" id="section-anamnesis"> <div class="section-header" onclick="toggleSection(this)">
                <span><i class="fas fa-user-edit"></i> Anamnesis y Quejas Principales</span> <div style="display: flex; align-items: center;">
                    <div class="completion-badge" id="badge-anamnesis"> <i class="fas fa-circle"></i>
                    </div>
                    <span class="arrow">‚ñº</span>
                </div>
            </div>
            <div class="section-content" id="anamnesis">
                <div class="exam-container">
                    <div class="exam-header"><i class="fas fa-clipboard-list"></i> Quejas Hematol√≥gicas Principales</div> <div class="checkbox-grid">
                        <div class="checkbox-item"><input type="checkbox" id="fatiga-astenia"><label for="fatiga-astenia">Fatiga/Astenia</label></div>
                        <div class="checkbox-item"><input type="checkbox" id="palidez" onchange="syncPalidezFields(this)"><label for="palidez">Palidez</label></div> <div class="checkbox-item"><input type="checkbox" id="disnea-esfuerzo"><label for="disnea-esfuerzo">Disnea de esfuerzo</label></div>
                        <div class="checkbox-item"><input type="checkbox" id="palpitaciones"><label for="palpitaciones">Palpitaciones</label></div>
                        <div class="checkbox-item"><input type="checkbox" id="sangrado-espontaneo"><label for="sangrado-espontaneo">Sangrado espont√°neo</label></div>
                        <div class="checkbox-item"><input type="checkbox" id="equimosis-faciles"><label for="equimosis-faciles">Equimosis f√°ciles</label></div>
                        <div class="checkbox-item"><input type="checkbox" id="petequias"><label for="petequias">Petequias</label></div>
                        <div class="checkbox-item"><input type="checkbox" id="sangrado-menstrual"><label for="sangrado-menstrual">Sangrado menstrual abundante</label></div>
                        <div class="checkbox-item"><input type="checkbox" id="epistaxis"><label for="epistaxis">Epistaxis</label></div>
                        <div class="checkbox-item"><input type="checkbox" id="sangrado-gingival"><label for="sangrado-gingival">Sangrado gingival</label></div>
                        <div class="checkbox-item"><input type="checkbox" id="adenopatias-palpables"><label for="adenopatias-palpables">Adenopat√≠as palpables</label></div>
                        <div class="checkbox-item"><input type="checkbox" id="fiebre"><label for="fiebre">Fiebre</label></div>
                        <div class="checkbox-item"><input type="checkbox" id="sudoracion-nocturna"><label for="sudoracion-nocturna">Sudoraci√≥n nocturna</label></div>
                        <div class="checkbox-item"><input type="checkbox" id="perdida-peso"><label for="perdida-peso">P√©rdida de peso involuntaria</label></div>
                        <div class="checkbox-item"><input type="checkbox" id="dolor-oseo"><label for="dolor-oseo">Dolor √≥seo</label></div>
                        <div class="checkbox-item"><input type="checkbox" id="infecciones-recurrentes"><label for="infecciones-recurrentes">Infecciones recurrentes</label></div>
                        <div class="checkbox-item"><input type="checkbox" id="ictericia" onchange="syncIctericiaFields(this)"><label for="ictericia">Ictericia</label></div> <div class="checkbox-item"><input type="checkbox" id="orinas-oscuras"><label for="orinas-oscuras">Orinas oscuras</label></div>
                        <div class="checkbox-item"><input type="checkbox" id="sin-quejas-hemato" onchange="handleNoComplaints()"><label for="sin-quejas-hemato">Sin quejas</label></div>
                    </div>
                </div>

                <div class="exam-container">
                    <div class="exam-header"><i class="fas fa-search"></i> Caracterizaci√≥n de S√≠ntomas</div> <div class="bleeding-assessment">
                        <h4>Evaluaci√≥n de Sangrado</h4>
                        <div class="measurement">
                            <label>Escala EVA sangrado:</label>
                            <input type="range" id="bleeding-intensity" min="0" max="10" value="0" oninput="updateBleedingValue(this.value)">
                            <span id="bleeding-value">0</span><span>/10</span>
                        </div>
                        <div class="checkbox-grid">
                            <div class="checkbox-item"><input type="checkbox" id="sangrado-cutaneo"><label for="sangrado-cutaneo">Sangrado cut√°neo</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="sangrado-mucosas"><label for="sangrado-mucosas">Sangrado mucosas</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="sangrado-gastrointestinal"><label for="sangrado-gastrointestinal">Sangrado gastrointestinal</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="sangrado-genitourinario"><label for="sangrado-genitourinario">Sangrado genitourinario</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="sangrado-post-trauma"><label for="sangrado-post-trauma">Sangrado post-trauma</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="sangrado-post-cirugia"><label for="sangrado-post-cirugia">Sangrado post-cirug√≠a</label></div>
                        </div>
                    </div>

                    <div class="anemia-assessment">
                        <h4>S√≠ntomas de Anemia</h4>
                        <div class="measurement">
                            <label>Tolerancia al ejercicio:</label>
                            <select id="exercise-tolerance" onchange="evaluateAnemiaSeverity()">
                                <option value="">Seleccionar</option>
                                <option value="0">Normal</option>
                                <option value="1">Levemente reducida</option>
                                <option value="2">Moderadamente reducida</option>
                                <option value="3">Severamente limitada</option>
                                <option value="4">S√≠ntomas en reposo</option>
                            </select>
                        </div>
                        <div class="score-item">
                            <span>Severidad de anemia:</span>
                            <span class="score-value" id="anemia-severity">--</span>
                        </div>
                    </div>
                </div>

                <div class="exam-container">
                    <div class="exam-header"><i class="fas fa-history"></i> Antecedentes Hematol√≥gicos</div> <div class="exam-section">
                        <h4>Historia Personal</h4>
                        <div class="checkbox-grid">
                            <div class="checkbox-item"><input type="checkbox" id="anemia-previa"><label for="anemia-previa">Anemia previa</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="transfusiones"><label for="transfusiones">Transfusiones previas</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="trombosis-previa"><label for="trombosis-previa">Trombosis previa</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="sangrado-quirurgico"><label for="sangrado-quirurgico">Sangrado quir√∫rgico previo</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="cancer-hematologico"><label for="cancer-hematologico">C√°ncer hematol√≥gico</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="quimioterapia"><label for="quimioterapia">Quimioterapia previa</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="radioterapia"><label for="radioterapia">Radioterapia previa</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="esplenectomia"><label for="esplenectomia">Esplenectom√≠a</label></div>
                        </div>
                    </div>
                    <div class="exam-section">
                        <h4>Historia Familiar</h4>
                        <div class="checkbox-grid">
                            <div class="checkbox-item"><input type="checkbox" id="familia-anemia"><label for="familia-anemia">Anemia familiar</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="familia-hemofilia"><label for="familia-hemofilia">Hemofilia</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="familia-trombofilia"><label for="familia-trombofilia">Trombofilia</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="familia-leucemia"><label for="familia-leucemia">Leucemia</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="familia-linfoma"><label for="familia-linfoma">Linfoma</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="familia-sangrado"><label for="familia-sangrado">Trastornos de sangrado</label></div>
                        </div>
                    </div>
                    <div class="exam-section">
                        <h4>Medicamentos</h4>
                        <div class="checkbox-grid">
                            <div class="checkbox-item"><input type="checkbox" id="medicamento-anticoagulantes"><label for="medicamento-anticoagulantes">Anticoagulantes</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="medicamento-antiplaquetarios"><label for="medicamento-antiplaquetarios">Antiplaquetarios</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="medicamento-aines"><label for="medicamento-aines">AINEs</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="medicamento-hierro"><label for="medicamento-hierro">Suplementos de hierro</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="medicamento-b12"><label for="medicamento-b12">Vitamina B12</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="medicamento-folato"><label for="medicamento-folato">√Åcido f√≥lico</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="medicamento-corticoides"><label for="medicamento-corticoides">Corticosteroides</label></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="section" id="section-physical-exam"> <div class="section-header" onclick="toggleSection(this)">
                <span><i class="fas fa-user"></i> Examen F√≠sico General</span> <div style="display: flex; align-items: center;">
                    <div class="completion-badge" id="badge-physical-exam">
                        <i class="fas fa-circle"></i>
                    </div>
                    <span class="arrow">‚ñº</span>
                </div>
            </div>
            <div class="section-content" id="physical-exam">
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-color anemia-color"></div>
                        <span>Anemia</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color bleeding-color"></div>
                        <span>Sangrado</span>
                    </div>
                </div>

                <div class="exam-container">
                    <div class="exam-header"><i class="fas fa-eye"></i> Inspecci√≥n General</div> <div class="anemia-assessment">
                        <h4>Signos de Anemia</h4>
                        <div class="checkbox-grid">
                            <div class="checkbox-item"><input type="checkbox" id="palidez-piel"><label for="palidez-piel">Palidez de piel</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="palidez-conjuntival"><label for="palidez-conjuntival">Palidez conjuntival</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="palidez-lechos-ungueales"><label for="palidez-lechos-ungueales">Palidez de lechos ungueales</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="palidez-mucosa-oral" onchange="syncPalidezFields(this)"><label for="palidez-mucosa-oral">Palidez de mucosa oral</label></div> <div class="checkbox-item"><input type="checkbox" id="taquicardia"><label for="taquicardia">Taquicardia</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="soplo-funcional"><label for="soplo-funcional">Soplo funcional</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="unas-coiloniquia"><label for="unas-coiloniquia">Coiloniquia (u√±as en cuchara)</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="sindrome-piernas-inquietas"><label for="sindrome-piernas-inquietas">S√≠ndrome piernas inquietas</label></div>
                        </div>
                        <div class="measurement">
                            <label>Grado de palidez conjuntival:</label>
                            <select id="conjunctival-pallor" onchange="evaluatePallor()">
                                <option value="">Seleccionar</option>
                                <option value="0">Normal</option>
                                <option value="1">Leve</option>
                                <option value="2">Moderada</option>
                                <option value="3">Severa</option>
                            </select>
                        </div>
                    </div>

                    <div class="bleeding-assessment">
                        <h4>Signos de Sangrado</h4>
                        <div class="checkbox-grid">
                            <div class="checkbox-item"><input type="checkbox" id="petequias-fisico"><label for="petequias-fisico">Petequias</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="purpura"><label for="purpura">P√∫rpura</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="equimosis"><label for="equimosis">Equimosis</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="hematomas"><label for="hematomas">Hematomas</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="sangrado-gingival-fisico"><label for="sangrado-gingival-fisico">Sangrado gingival</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="epistaxis-activa"><label for="epistaxis-activa">Epistaxis activa</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="hemorragias-retinianas"><label for="hemorragias-retinianas">Hemorragias retinianas</label></div>
                        </div>
                        <div class="measurement">
                            <label>Distribuci√≥n de petequias:</label>
                            <div class="checkbox-grid">
                                <div class="checkbox-item"><input type="checkbox" id="petequias-miembros-inf"><label for="petequias-miembros-inf">Miembros inferiores</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="petequias-tronco"><label for="petequias-tronco">Tronco</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="petequias-brazos"><label for="petequias-brazos">Brazos</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="petequias-cara"><label for="petequias-cara">Cara</label></div>
                            </div>
                        </div>
                    </div>

                    <div class="exam-section">
                        <h4>Otros Hallazgos</h4>
                        <div class="checkbox-grid">
                            <div class="checkbox-item"><input type="checkbox" id="ictericia-fisico" onchange="syncIctericiaFields(this)"><label for="ictericia-fisico">Ictericia</label></div> <div class="checkbox-item"><input type="checkbox" id="cianosis"><label for="cianosis">Cianosis</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="edema"><label for="edema">Edema</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="ulceras-miembros"><label for="ulceras-miembros">√ölceras en miembros</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="lesiones-cutaneas"><label for="lesiones-cutaneas">Lesiones cut√°neas espec√≠ficas</label></div>
                        </div>
                    </div>
                </div>

                <div class="exam-container">
                    <div class="exam-header"><i class="fas fa-heartbeat"></i> Signos Vitales</div> <div class="exam-section">
                        <h4>Mediciones</h4>
                        <div class="measurement">
                            <label>Frecuencia card√≠aca:</label>
                            <input type="number" class="input-field" id="frecuencia-cardiaca" min="40" max="200" onchange="evaluateVitalSigns()">
                            <span>lpm</span>
                        </div>
                        <div class="measurement">
                            <label>Presi√≥n arterial sist√≥lica:</label>
                            <input type="number" class="input-field" id="pas" min="70" max="250" onchange="evaluateVitalSigns()">
                            <span>mmHg</span>
                        </div>
                        <div class="measurement">
                            <label>Presi√≥n arterial diast√≥lica:</label>
                            <input type="number" class="input-field" id="pad" min="40" max="150" onchange="evaluateVitalSigns()">
                            <span>mmHg</span>
                        </div>
                        <div class="measurement">
                            <label>Temperatura:</label>
                            <input type="number" class="input-field" id="temperatura" min="35" max="42" step="0.1" onchange="evaluateVitalSigns()">
                            <span>¬∞C</span>
                        </div>
                        <div class="score-item">
                            <span>Evaluaci√≥n cardiovascular:</span>
                            <span class="score-value" id="cardiovascular-assessment">--</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="section" id="section-lymph-nodes"> <div class="section-header" onclick="toggleSection(this)">
                <span><i class="fas fa-node"></i> Examen de Ganglios Linf√°ticos</span> <div style="display: flex; align-items: center;">
                    <div class="completion-badge" id="badge-lymph-nodes">
                        <i class="fas fa-circle"></i>
                    </div>
                    <span class="arrow">‚ñº</span>
                </div>
            </div>
            <div class="section-content" id="lymph-nodes">
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-color lymph-color"></div>
                        <span>Evaluaci√≥n Linf√°tica</span>
                    </div>
                </div>

                <div class="exam-container">
                    <div class="exam-header"><i class="fas fa-sitemap"></i> Cadenas Ganglionares</div> <div class="bilateral-container">
                        <div class="side-container">
                            <div class="side-header">Lado Derecho</div>
                            <div class="lymph-nodes">
                                <div class="node-group">
                                    <h5>Cuello</h5>
                                    <div class="node-item">
                                        <span>Cervicales anteriores</span>
                                        <div class="node-checkboxes">
                                            <input type="checkbox" id="cervical-ant-der-palpable">
                                            <input type="number" class="node-size" id="cervical-ant-der-size" placeholder="cm">
                                            <label><input type="checkbox" id="cervical-ant-der-doloroso">D</label>
                                            <label><input type="checkbox" id="cervical-ant-der-duro">Dur</label>
                                            <label><input type="checkbox" id="cervical-ant-der-fijo">F</label>
                                        </div>
                                    </div>
                                    <div class="node-item">
                                        <span>Cervicales posteriores</span>
                                        <div class="node-checkboxes">
                                            <input type="checkbox" id="cervical-post-der-palpable">
                                            <input type="number" class="node-size" id="cervical-post-der-size" placeholder="cm">
                                            <label><input type="checkbox" id="cervical-post-der-doloroso">D</label>
                                            <label><input type="checkbox" id="cervical-post-der-duro">Dur</label>
                                            <label><input type="checkbox" id="cervical-post-der-fijo">F</label>
                                        </div>
                                    </div>
                                    <div class="node-item">
                                        <span>Supraclaviculares</span>
                                        <div class="node-checkboxes">
                                            <input type="checkbox" id="supraclavicular-der-palpable">
                                            <input type="number" class="node-size" id="supraclavicular-der-size" placeholder="cm">
                                            <label><input type="checkbox" id="supraclavicular-der-doloroso">D</label>
                                            <label><input type="checkbox" id="supraclavicular-der-duro">Dur</label>
                                            <label><input type="checkbox" id="supraclavicular-der-fijo">F</label>
                                        </div>
                                    </div>
                                </div>
                                <div class="node-group">
                                    <h5>Axila</h5>
                                    <div class="node-item">
                                        <span>Axilares</span>
                                        <div class="node-checkboxes">
                                            <input type="checkbox" id="axilar-der-palpable">
                                            <input type="number" class="node-size" id="axilar-der-size" placeholder="cm">
                                            <label><input type="checkbox" id="axilar-der-doloroso">D</label>
                                            <label><input type="checkbox" id="axilar-der-duro">Dur</label>
                                            <label><input type="checkbox" id="axilar-der-fijo">F</label>
                                        </div>
                                    </div>
                                </div>
                                <div class="node-group">
                                    <h5>Ingle</h5>
                                    <div class="node-item">
                                        <span>Inguinales</span>
                                        <div class="node-checkboxes">
                                            <input type="checkbox" id="inguinal-der-palpable">
                                            <input type="number" class="node-size" id="inguinal-der-size" placeholder="cm">
                                            <label><input type="checkbox" id="inguinal-der-doloroso">D</label>
                                            <label><input type="checkbox" id="inguinal-der-duro">Dur</label>
                                            <label><input type="checkbox" id="inguinal-der-fijo">F</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="side-container">
                            <div class="side-header">Lado Izquierdo</div>
                            <div class="lymph-nodes">
                                <div class="node-group">
                                    <h5>Cuello</h5>
                                    <div class="node-item">
                                        <span>Cervicales anteriores</span>
                                        <div class="node-checkboxes">
                                            <input type="checkbox" id="cervical-ant-izq-palpable">
                                            <input type="number" class="node-size" id="cervical-ant-izq-size" placeholder="cm">
                                            <label><input type="checkbox" id="cervical-ant-izq-doloroso">D</label>
                                            <label><input type="checkbox" id="cervical-ant-izq-duro">Dur</label>
                                            <label><input type="checkbox" id="cervical-ant-izq-fijo">F</label>
                                        </div>
                                    </div>
                                    <div class="node-item">
                                        <span>Cervicales posteriores</span>
                                        <div class="node-checkboxes">
                                            <input type="checkbox" id="cervical-post-izq-palpable">
                                            <input type="number" class="node-size" id="cervical-post-izq-size" placeholder="cm">
                                            <label><input type="checkbox" id="cervical-post-izq-doloroso">D</label>
                                            <label><input type="checkbox" id="cervical-post-izq-duro">Dur</label>
                                            <label><input type="checkbox" id="cervical-post-izq-fijo">F</label>
                                        </div>
                                    </div>
                                    <div class="node-item">
                                        <span>Supraclaviculares</span>
                                        <div class="node-checkboxes">
                                            <input type="checkbox" id="supraclavicular-izq-palpable">
                                            <input type="number" class="node-size" id="supraclavicular-izq-size" placeholder="cm">
                                            <label><input type="checkbox" id="supraclavicular-izq-doloroso">D</label>
                                            <label><input type="checkbox" id="supraclavicular-izq-duro">Dur</label>
                                            <label><input type="checkbox" id="supraclavicular-izq-fijo">F</label>
                                        </div>
                                    </div>
                                </div>
                                <div class="node-group">
                                    <h5>Axila</h5>
                                    <div class="node-item">
                                        <span>Axilares</span>
                                        <div class="node-checkboxes">
                                            <input type="checkbox" id="axilar-izq-palpable">
                                            <input type="number" class="node-size" id="axilar-izq-size" placeholder="cm">
                                            <label><input type="checkbox" id="axilar-izq-doloroso">D</label>
                                            <label><input type="checkbox" id="axilar-izq-duro">Dur</label>
                                            <label><input type="checkbox" id="axilar-izq-fijo">F</label>
                                        </div>
                                    </div>
                                </div>
                                <div class="node-group">
                                    <h5>Ingle</h5>
                                    <div class="node-item">
                                        <span>Inguinales</span>
                                        <div class="node-checkboxes">
                                            <input type="checkbox" id="inguinal-izq-palpable">
                                            <input type="number" class="node-size" id="inguinal-izq-size" placeholder="cm">
                                            <label><input type="checkbox" id="inguinal-izq-doloroso">D</label>
                                            <label><input type="checkbox" id="inguinal-izq-duro">Dur</label>
                                            <label><input type="checkbox" id="inguinal-izq-fijo">F</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="exam-section">
                        <div style="font-size: 10px; color: #7f8c8d; margin-top: 10px;">
                            D = Doloroso, Dur = Duro, F = Fijo
                        </div>
                    </div>
                </div>

                <div class="exam-container">
                    <div class="exam-header"><i class="fas fa-chart-bar"></i> Evaluaci√≥n Global de Adenopat√≠as</div> <div class="score-calculation">
                        <h4>Resumen de Hallazgos</h4>
                        <div class="score-item">
                            <span>N√∫mero de cadenas afectadas:</span>
                            <span class="score-value" id="affected-chains">0</span>
                        </div>
                        <div class="score-item">
                            <span>Tama√±o m√°ximo:</span>
                            <span class="score-value" id="max-node-size">0 cm</span>
                        </div>
                        <div class="score-item">
                            <span>Caracter√≠sticas preocupantes:</span>
                            <span class="score-value" id="concerning-features">Ninguna</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="section" id="section-abdominal-exam"> <div class="section-header" onclick="toggleSection(this)">
                <span><i class="fas fa-hand-holding-medical"></i> Examen Abdominal y Organomegalias</span> <div style="display: flex; align-items: center;">
                    <div class="completion-badge" id="badge-abdominal-exam">
                        <i class="fas fa-circle"></i>
                    </div>
                    <span class="arrow">‚ñº</span>
                </div>
            </div>
            <div class="section-content" id="abdominal-exam">
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-color organomegaly-color"></div>
                        <span>Organomegalias</span>
                    </div>
                </div>

                <div class="exam-container">
                    <div class="exam-header"><i class="fas fa-liver"></i> Hepatomegalia</div> <div class="organomegaly-assessment">
                        <h4>Evaluaci√≥n del H√≠gado</h4>
                        <div class="measurement">
                            <label>Borde hep√°tico palpable:</label>
                            <div class="test-controls">
                                <div class="test-checkbox"><input type="checkbox" id="hepatomegalia" onchange="evaluateOrganomegaly()"><span>S√≠</span></div>
                            </div>
                        </div>
                        <div class="measurement">
                            <label>Distancia reborde costal:</label>
                            <input type="number" class="input-field" id="hepatomegalia-cm" min="0" max="20" step="0.5" onchange="evaluateOrganomegaly()">
                            <span>cm</span>
                        </div>
                        <div class="measurement">
                            <label>Consistencia hep√°tica:</label>
                            <select id="hepatic-consistency" onchange="generateConclusion()"> <option value="">Seleccionar</option>
                                <option value="blanda">Blanda</option>
                                <option value="firme">Firme</option>
                                <option value="dura">Dura</option>
                                <option value="nodular">Nodular</option>
                            </select>
                        </div>
                        <div class="checkbox-grid">
                            <div class="checkbox-item"><input type="checkbox" id="hepatomegalia-dolorosa"><label for="hepatomegalia-dolorosa">Dolorosa</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="hepatomegalia-lisa"><label for="hepatomegalia-lisa">Lisa</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="hepatomegalia-irregular"><label for="hepatomegalia-irregular">Irregular</label></div>
                        </div>
                        <div class="score-item">
                            <span>Grado de hepatomegalia:</span>
                            <span class="score-value" id="hepatomegaly-grade">--</span>
                        </div>
                    </div>
                </div>

                <div class="exam-container">
                    <div class="exam-header"><i class="fas fa-circle"></i> Esplenomegalia</div> <div class="organomegaly-assessment">
                        <h4>Evaluaci√≥n del Bazo</h4>
                        <div class="measurement">
                            <label>Bazo palpable:</label>
                            <div class="test-controls">
                                <div class="test-checkbox"><input type="checkbox" id="esplenomegalia" onchange="evaluateOrganomegaly()"><span>S√≠</span></div>
                            </div>
                        </div>
                        <div class="measurement">
                            <label>Distancia reborde costal:</label>
                            <input type="number" class="input-field" id="esplenomegalia-cm" min="0" max="20" step="0.5" onchange="evaluateOrganomegaly()">
                            <span>cm</span>
                        </div>
                        <div class="measurement">
                            <label>Clasificaci√≥n de Hackett:</label>
                            <select id="spleen-hackett" onchange="evaluateOrganomegaly()">
                                <option value="">Seleccionar</option>
                                <option value="0">Grado 0 (no palpable)</option>
                                <option value="1">Grado 1 (palpable)</option>
                                <option value="2">Grado 2 (no rebasa l√≠nea media)</option>
                                <option value="3">Grado 3 (rebasa l√≠nea media)</option>
                                <option value="4">Grado 4 (llega a fosa il√≠aca)</option>
                                <option value="5">Grado 5 (rebasa fosa il√≠aca)</option>
                            </select>
                        </div>
                        <div class="checkbox-grid">
                            <div class="checkbox-item"><input type="checkbox" id="esplenomegalia-dolorosa"><label for="esplenomegalia-dolorosa">Dolorosa</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="esplenomegalia-lisa"><label for="esplenomegalia-lisa">Lisa</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="esplenomegalia-irregular"><label for="esplenomegalia-irregular">Irregular</label></div>
                        </div>
                        <div class="score-item">
                            <span>Grado de esplenomegalia:</span>
                            <span class="score-value" id="splenomegaly-grade">--</span>
                        </div>
                    </div>
                </div>

                <div class="exam-container">
                    <div class="exam-header"><i class="fas fa-diagnoses"></i> Otros Hallazgos Abdominales</div> <div class="exam-section">
                        <h4>Masas y Otros Hallazgos</h4>
                        <div class="checkbox-grid">
                            <div class="checkbox-item"><input type="checkbox" id="masas-abdominales"><label for="masas-abdominales">Masas abdominales</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="ascitis"><label for="ascitis">Ascitis</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="circulacion-colateral"><label for="circulacion-colateral">Circulaci√≥n colateral</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="dolor-abdominal"><label for="dolor-abdominal">Dolor abdominal</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="signo-murphy"><label for="signo-murphy">Signo de Murphy</label></div>
                        </div>
                        <div class="measurement">
                            <label>Descripci√≥n de masas:</label>
                            <textarea class="description-area" id="abdominal-masses-description" placeholder="Describir localizaci√≥n, tama√±o, caracter√≠sticas..."></textarea>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="section" id="section-hematologic-scales"> <div class="section-header" onclick="toggleSection(this)">
                <span><i class="fas fa-calculator"></i> Escalas de Evaluaci√≥n Hematol√≥gica</span> <div style="display: flex; align-items: center;">
                    <div class="completion-badge" id="badge-hematologic-scales">
                        <i class="fas fa-circle"></i>
                    </div>
                    <span class="arrow">‚ñº</span>
                </div>
            </div>
            <div class="section-content" id="hematologic-scales">
                <div class="exam-container">
                    <div class="exam-header"><i class="fas fa-walking"></i> Escala ECOG Performance Status</div> <div class="functional-status">
                        <h4>Estado Funcional</h4>
                        <div class="severity-grid">
                            <div class="severity-item"><input type="radio" name="ecog-status" id="ecog-0" value="0" onchange="calculateECOGScore()"><label for="ecog-0">ECOG 0: Completamente activo</label></div>
                            <div class="severity-item"><input type="radio" name="ecog-status" id="ecog-1" value="1" onchange="calculateECOGScore()"><label for="ecog-1">ECOG 1: Actividad limitada</label></div>
                            <div class="severity-item"><input type="radio" name="ecog-status" id="ecog-2" value="2" onchange="calculateECOGScore()"><label for="ecog-2">ECOG 2: Ambulatorio &gt;50% tiempo</label></div>
                            <div class="severity-item"><input type="radio" name="ecog-status" id="ecog-3" value="3" onchange="calculateECOGScore()"><label for="ecog-3">ECOG 3: Limitado al sill√≥n/cama &gt;50%</label></div>
                            <div class="severity-item"><input type="radio" name="ecog-status" id="ecog-4" value="4" onchange="calculateECOGScore()"><label for="ecog-4">ECOG 4: Completamente discapacitado</label></div>
                        </div>
                        <div class="score-item">
                            <span>ECOG Score:</span>
                            <span class="score-value" id="ecog-score">--</span>
                        </div>
                    </div>
                </div>

                <div class="exam-container">
                    <div class="exam-header"><i class="fas fa-blood-droplet"></i> Escala de Sangrado ISTH</div> <div class="bleeding-assessment">
                        <h4>Evaluaci√≥n de Sangrado Seg√∫n ISTH</h4>
                        <div class="exam-section">
                            <h4>Sangrado Menstrual (mujeres)</h4>
                            <div class="severity-grid">
                                <div class="severity-item"><input type="radio" name="isth-menstrual" id="isth-menstrual-0" value="0" onchange="calculateISThScore()"><label for="isth-menstrual-0">0: Normal</label></div>
                                <div class="severity-item"><input type="radio" name="isth-menstrual" id="isth-menstrual-1" value="1" onchange="calculateISThScore()"><label for="isth-menstrual-1">1: Levemente aumentado</label></div>
                                <div class="severity-item"><input type="radio" name="isth-menstrual" id="isth-menstrual-2" value="2" onchange="calculateISThScore()"><label for="isth-menstrual-2">2: Claramente aumentado</label></div>
                                <div class="severity-item"><input type="radio" name="isth-menstrual" id="isth-menstrual-3" value="3" onchange="calculateISThScore()"><label for="isth-menstrual-3">3: Severo</label></div>
                            </div>
                        </div>
                        <div class="exam-section">
                            <h4>Sangrado Post-parto</h4>
                            <div class="severity-grid">
                                <div class="severity-item"><input type="radio" name="isth-postparto" id="isth-postparto-0" value="0" onchange="calculateISThScore()"><label for="isth-postparto-0">0: Normal</label></div>
                                <div class="severity-item"><input type="radio" name="isth-postparto" id="isth-postparto-1" value="1" onchange="calculateISThScore()"><label for="isth-postparto-1">1: Requeri√≥ tratamiento</label></div>
                                <div class="severity-item"><input type="radio" name="isth-postparto" id="isth-postparto-2" value="2" onchange="calculateISThScore()"><label for="isth-postparto-2">2: Requeri√≥ transfusi√≥n</label></div>
                            </div>
                        </div>
                        <div class="exam-section">
                            <h4>Sangrado relacionado con Cirug√≠a</h4>
                            <div class="severity-grid">
                                <div class="severity-item"><input type="radio" name="isth-cirugia" id="isth-cirugia-0" value="0" onchange="calculateISThScore()"><label for="isth-cirugia-0">0: Normal</label></div>
                                <div class="severity-item"><input type="radio" name="isth-cirugia" id="isth-cirugia-1" value="1" onchange="calculateISThScore()"><label for="isth-cirugia-1">1: Requeri√≥ revisi√≥n</label></div>
                                <div class="severity-item"><input type="radio" name="isth-cirugia" id="isth-cirugia-2" value="2" onchange="calculateISThScore()"><label for="isth-cirugia-2">2: Requeri√≥ transfusi√≥n</label></div>
                            </div>
                        </div>
                        <div class="exam-section">
                            <h4>Sangrado dental</h4>
                            <div class="severity-grid">
                                <div class="severity-item"><input type="radio" name="isth-dental" id="isth-dental-0" value="0" onchange="calculateISThScore()"><label for="isth-dental-0">0: Normal</label></div>
                                <div class="severity-item"><input type="radio" name="isth-dental" id="isth-dental-1" value="1" onchange="calculateISThScore()"><label for="isth-dental-1">1: Reportado por paciente/dentista</label></div>
                                <div class="severity-item"><input type="radio" name="isth-dental" id="isth-dental-2" value="2" onchange="calculateISThScore()"><label for="isth-dental-2">2: Requeri√≥ intervenci√≥n</label></div>
                            </div>
                        </div>
                        <div class="score-item">
                            <span>Puntuaci√≥n ISTH total:</span>
                            <span class="score-value" id="isth-total-score">0</span>
                        </div>
                        <div class="score-item">
                            <span>Interpretaci√≥n:</span>
                            <span class="score-value" id="isth-interpretation">--</span>
                        </div>
                    </div>
                </div>

                <div class="exam-container">
                    <div class="exam-header"><i class="fas fa-notes-medical"></i> S√≠ntomas B (Linfomas)</div> <div class="score-calculation">
                        <h4>Evaluaci√≥n de S√≠ntomas B</h4>
                        <div class="test-item">
                            <label>Fiebre &gt;38¬∞C sin causa aparente</label>
                            <div class="test-controls">
                                <div class="test-checkbox"><input type="checkbox" id="sintoma-b-fiebre" onchange="calculateBSymptoms()"><span class="positive">Presente</span></div>
                            </div>
                        </div>
                        <div class="test-item">
                            <label>Sudoraci√≥n nocturna profusa</label>
                            <div class="test-controls">
                                <div class="test-checkbox"><input type="checkbox" id="sintoma-b-sudoracion" onchange="calculateBSymptoms()"><span class="positive">Presente</span></div>
                            </div>
                        </div>
                        <div class="test-item">
                            <label>P√©rdida de peso &gt;10% en 6 meses</label>
                            <div class="test-controls">
                                <div class="test-checkbox"><input type="checkbox" id="sintoma-b-peso" onchange="calculateBSymptoms()"><span class="positive">Presente</span></div>
                            </div>
                        </div>
                        <div class="score-item">
                            <span>S√≠ntomas B presentes:</span>
                            <span class="score-value" id="b-symptoms-count">0</span>
                            <span>/3</span>
                        </div>
                        <div class="score-item">
                            <span>Clasificaci√≥n:</span>
                            <span class="score-value" id="b-symptoms-classification">--</span>
                        </div>
                    </div>
                </div>

                <div class="exam-container">
                    <div class="exam-header"><i class="fas fa-medkit"></i> √çndice de Comorbilidad de Charlson</div> <div class="score-calculation">
                        <h4>Comorbilidades</h4>
                        <div class="exam-section">
                            <h4>Puntuaci√≥n 1</h4>
                            <div class="checkbox-grid">
                                <div class="checkbox-item"><input type="checkbox" id="charlson-iam" onchange="calculateCharlson()"><label for="charlson-iam">IAM</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="charlson-icc" onchange="calculateCharlson()"><label for="charlson-icc">ICC</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="charlson-evc" onchange="calculateCharlson()"><label for="charlson-evc">EVC</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="charlson-demencia" onchange="calculateCharlson()"><label for="charlson-demencia">Demencia</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="charlson-epoc" onchange="calculateCharlson()"><label for="charlson-epoc">EPOC</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="charlson-colagenosis" onchange="calculateCharlson()"><label for="charlson-colagenosis">Colagenosis</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="charlson-ulcera" onchange="calculateCharlson()"><label for="charlson-ulcera">√ölcera p√©ptica</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="charlson-hepatopatia-leve" onchange="calculateCharlson()"><label for="charlson-hepatopatia-leve">Hepatopat√≠a leve</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="charlson-diabetes" onchange="calculateCharlson()"><label for="charlson-diabetes">Diabetes</label></div>
                            </div>
                        </div>
                        <div class="exam-section">
                            <h4>Puntuaci√≥n 2</h4>
                            <div class="checkbox-grid">
                                <div class="checkbox-item"><input type="checkbox" id="charlson-hemiplejia" onchange="calculateCharlson()"><label for="charlson-hemiplejia">Hemiplej√≠a</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="charlson-renal-moderada" onchange="calculateCharlson()"><label for="charlson-renal-moderada">Insuficiencia renal moderada</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="charlson-diabetes-complicada" onchange="calculateCharlson()"><label for="charlson-diabetes-complicada">Diabetes complicada</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="charlson-tumor" onchange="calculateCharlson()"><label for="charlson-tumor">Tumor</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="charlson-leucemia" onchange="calculateCharlson()"><label for="charlson-leucemia">Leucemia</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="charlson-linfoma" onchange="calculateCharlson()"><label for="charlson-linfoma">Linfoma</label></div>
                            </div>
                        </div>
                        <div class="exam-section">
                            <h4>Puntuaci√≥n 3</h4>
                            <div class="checkbox-grid">
                                <div class="checkbox-item"><input type="checkbox" id="charlson-hepatopatia-severa" onchange="calculateCharlson()"><label for="charlson-hepatopatia-severa">Hepatopat√≠a severa</label></div>
                            </div>
                        </div>
                        <div class="exam-section">
                            <h4>Puntuaci√≥n 6</h4>
                            <div class="checkbox-grid">
                                <div class="checkbox-item"><input type="checkbox" id="charlson-tumor-metastasico" onchange="calculateCharlson()"><label for="charlson-tumor-metastasico">Tumor metast√°sico</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="charlson-sida" onchange="calculateCharlson()"><label for="charlson-sida">SIDA</label></div>
                            </div>
                        </div>
                        <div class="score-item">
                            <span>√çndice de Charlson:</span>
                            <span class="score-value" id="charlson-score">0</span>
                        </div>
                        <div class="score-item">
                            <span>Supervivencia estimada a 10 a√±os:</span>
                            <span class="score-value" id="charlson-survival">--</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="conclusion">
            <h3><i class="fas fa-file-medical-alt"></i> Conclusi√≥n del Examen Hematol√≥gico</h3> <div class="conclusion-text" id="conclusion-text">Seleccione los par√°metros del examen para generar la conclusi√≥n hematol√≥gica...</div>
        </div>
        
        <div class="control-buttons">
            <button class="btn btn-primary" onclick="generateConclusion()">
                <i class="fas fa-file-medical"></i> Generar Conclusi√≥n
            </button>
            <button class="btn btn-primary" onclick="printConclusion()">
                <i class="fas fa-print"></i> Imprimir Conclusi√≥n
            </button>
            <button class="btn btn-secondary" onclick="clearForm()">
                <i class="fas fa-trash"></i> Limpiar Formulario
            </button>
            <button class="btn btn-secondary" onclick="expandAllSections()">
                <i class="fas fa-expand-alt"></i> Expandir Todo
            </button>
            <button class="btn btn-secondary" onclick="collapseAllSections()">
                <i class="fas fa-compress-alt"></i> Contraer Todo
            </button>
        </div>
    </div>

    <script>
        // üé® Variables globales para el dashboard (Copiado de gastro.html)
        let examProgress = 0;
        let sectionsCompleted = 0;
        let alertCount = 0;
        let warningCount = 0;
        let findingsCount = 0;
        let vitalsStatus = 'Pendiente';

        // üåô Toggle de tema (Copiado de gastro.html)
        function toggleTheme() {
            const body = document.body;
            const themeIcon = document.getElementById('theme-icon');
            
            if (body.hasAttribute('data-theme')) {
                body.removeAttribute('data-theme');
                themeIcon.className = 'fas fa-moon';
                localStorage.setItem('theme', 'light');
            } else {
                body.setAttribute('data-theme', 'dark');
                themeIcon.className = 'fas fa-sun';
                localStorage.setItem('theme', 'dark');
            }
        }

        // üéØ Toggle panel de navegaci√≥n (Copiado de gastro.html)
        function toggleNavPanel() {
            const navPanel = document.getElementById('nav-panel');
            const body = document.body;
            
            navPanel.classList.toggle('open');
            body.classList.toggle('split-view'); // Aplica al body para afectar el main-container
        }

        // üìä FUNCIONES DEL PANEL STICKY (Copiado de gastro.html)

        // Toggle panel lateral sticky
        function toggleStickyPanel() {
            const stickyPanel = document.getElementById('stickyConclusion');
            const body = document.body; // Se aplica al body para afectar el main-container
            const btn = document.getElementById('sticky-toggle-btn');
            
            stickyPanel.classList.toggle('active');
            body.classList.toggle('split-view-active'); // Aplica al body para afectar el main-container
            
            if (stickyPanel.classList.contains('active')) {
                btn.innerHTML = '<i class="fas fa-window-restore"></i> Vista Normal';
                btn.classList.add('btn-warning');
                btn.classList.remove('btn-primary');
                generateStickyConclusion();
            } else {
                btn.innerHTML = '<i class="fas fa-columns"></i> Vista Dividida';
                btn.classList.add('btn-primary');
                btn.classList.remove('btn-warning');
            }
        }

        // Generar conclusi√≥n para panel sticky
        function generateStickyConclusion() {
            const stickyContent = document.getElementById('stickyContent');
            const updateIndicator = document.getElementById('updateIndicator');
            
            updateIndicator.classList.add('active');
            
            setTimeout(() => {
                const originalConclusionEl = document.getElementById('conclusion-text');
                const originalContent = originalConclusionEl.textContent;
                
                stickyContent.textContent = originalContent;
                
                updateIndicator.classList.remove('active');
            }, 300);
        }

        // Copiar contenido del panel sticky
        function copyStickyToClipboard() {
            const stickyContent = document.getElementById('stickyContent').textContent;
            
            if (navigator.clipboard && window.isSecureContext) {
                navigator.clipboard.writeText(stickyContent).then(() => {
                    showCopyNotification();
                }).catch(err => {
                    console.error('Error al copiar con la API del portapapeles: ', err);
                    fallbackCopyToClipboard(stickyContent);
                });
            } else {
                fallbackCopyToClipboard(stickyContent);
            }
        }

        // Fallback para copiar
        function fallbackCopyToClipboard(text) {
            const textArea = document.createElement('textarea');
            textArea.value = text;
            textArea.style.position = 'fixed';
            textArea.style.opacity = '0';
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();

            try {
                document.execCommand('copy');
                showCopyNotification();
            } catch (err) {
                console.error('Error al usar el m√©todo de respaldo para copiar: ', err);
                alert('No se pudo copiar el texto. Por favor, c√≥pielo manualmente.');
            }

            document.body.removeChild(textArea);
        }

        // Mostrar notificaci√≥n de copia
        function showCopyNotification() {
            const notification = document.getElementById('copyNotification');
            notification.classList.add('show');
            setTimeout(() => {
                notification.classList.remove('show');
            }, 2500);
        }

        // Imprimir desde panel sticky
        function printStickyConclusion() {
            const conclusion = document.getElementById('stickyContent').textContent;
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                <head>
                    <title>Informe Hematol√≥gico</title>
                    <style>
                        body { 
                            font-family: Arial, sans-serif; 
                            margin: 20px; 
                            line-height: 1.6;
                        }
                        pre { 
                            white-space: pre-wrap; 
                            font-family: 'Courier New', monospace; 
                            font-size: 12px;
                        }
                        .header {
                            text-align: center;
                            border-bottom: 2px solid #e74c3c; /* Adaptado al color hematol√≥gico */
                            padding-bottom: 10px;
                            margin-bottom: 20px;
                        }
                        .footer {
                            text-align: center;
                            font-size: 10px;
                            color: #666;
                            margin-top: 20px;
                            border-top: 1px solid #ddd;
                            padding-top: 10px;
                        }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>Informe Hematol√≥gico</h1>
                        <p>Fecha: ${new Date().toLocaleDateString()}</p>
                        <p>Hora: ${new Date().toLocaleTimeString()}</p>
                    </div>
                    <pre>${conclusion}</pre>
                    <div class="footer">
                        <p>Generado por Sistema de Evaluaci√≥n Hematol√≥gica Premium</p>
                    </div>
                </body>
                </html>
            `);
            printWindow.document.close();
            printWindow.print();
        }

        // üß≠ Navegaci√≥n a secciones (Copiado y adaptado de gastro.html)
        function scrollToSection(sectionId) {
            const section = document.getElementById(`section-${sectionId}`); // Usa el ID de la secci√≥n principal
            if (section) {
                section.scrollIntoView({ 
                    behavior: 'smooth', 
                    block: 'start',
                    inline: 'nearest'
                });
                
                const header = section.querySelector('.section-header');
                if (header && !header.classList.contains('expanded')) {
                    toggleSection(header);
                }
            }
        }

        // ‚úÖ Actualizar altura de secci√≥n (Copiado de gastro.html)
        function updateSectionHeight(contentElement) {
            if (contentElement && contentElement.classList.contains('expanded')) {
                setTimeout(() => {
                    contentElement.style.maxHeight = contentElement.scrollHeight + 'px';
                }, 50);
            }
        }

        // üìÇ Toggle de secciones mejorado (Copiado de gastro.html)
        function toggleSection(headerElement) {
            const content = headerElement.nextElementSibling;
            const section = headerElement.parentElement;
            
            headerElement.classList.toggle('expanded');
            section.classList.toggle('active');
            
            if (content.classList.toggle('expanded')) {
                content.style.maxHeight = content.scrollHeight + 'px';
                content.classList.add('slide-in');
            } else {
                content.style.maxHeight = '0';
                content.classList.remove('slide-in');
            }
        }

        // üîÑ Expandir/contraer todas las secciones (Copiado de gastro.html)
        function expandAllSections() {
            document.querySelectorAll('.section-header:not(.expanded)').forEach(header => {
                toggleSection(header);
            });
        }

        function collapseAllSections() {
            document.querySelectorAll('.section-header.expanded').forEach(header => {
                toggleSection(header);
            });
        }
        
        // üö´ Manejo de "Sin quejas" (Existente, pero modificado para llamar a updateDashboard)
        function handleNoComplaints() {
            const noComplaintsCheckbox = document.getElementById('sin-quejas-hemato');
            const otherCheckboxes = document.querySelectorAll('#anamnesis input[type="checkbox"]:not(#sin-quejas-hemato)');
            
            otherCheckboxes.forEach(checkbox => {
                checkbox.disabled = noComplaintsCheckbox.checked;
                if (noComplaintsCheckbox.checked) checkbox.checked = false;
            });
            updateDashboard(); // Llamada a updateDashboard
        }
        
        // ‚öñÔ∏è Manejo de checkboxes mutuamente excluyentes (Existente, pero modificado para llamar a updateDashboard)
        function handleMutuallyExclusive(positiveId, negativeId, checkbox) {
            if (checkbox.checked) {
                const oppositeId = checkbox.id === positiveId ? negativeId : positiveId;
                const oppositeCheckbox = document.getElementById(oppositeId);
                if (oppositeCheckbox) oppositeCheckbox.checked = false;
            }
            updateDashboard(); // Llamada a updateDashboard
        }

        // Sincronizaci√≥n de palidez (Nuevo, inspirado en gastro.html)
        function syncPalidezFields(sourceElement) {
            if (sourceElement.checked) {
                const related = ['palidez-piel', 'palidez-conjuntival', 'palidez-lechos-ungueales', 'palidez-mucosa-oral'];
                related.forEach(id => {
                    const element = document.getElementById(id);
                    if (element && !element.checked) {
                        element.style.backgroundColor = '#fff3cd'; /* Color de advertencia suave */
                        element.style.border = '2px solid var(--warning-color)';
                    }
                });
            } else {
                const related = ['palidez-piel', 'palidez-conjuntival', 'palidez-lechos-ungueales', 'palidez-mucosa-oral'];
                related.forEach(id => {
                    const element = document.getElementById(id);
                    if (element) {
                        element.style.backgroundColor = '';
                        element.style.border = '';
                    }
                });
            }
            updateDashboard();
        }

        // Sincronizaci√≥n de Ictericia (Nuevo, inspirado en gastro.html)
        function syncIctericiaFields(sourceElement) {
            if (sourceElement.checked) {
                const related = ['ictericia-fisico'];
                related.forEach(id => {
                    const element = document.getElementById(id);
                    if (element && !element.checked) {
                        element.style.backgroundColor = '#fff3cd';
                        element.style.border = '2px solid var(--warning-color)';
                    }
                });
            } else {
                const related = ['ictericia-fisico'];
                related.forEach(id => {
                    const element = document.getElementById(id);
                    if (element) {
                        element.style.backgroundColor = '';
                        element.style.border = '';
                    }
                });
            }
            updateDashboard();
        }

        // üìä Actualizar valor de sangrado (Existente, modificado para llamar a updateDashboard)
        function updateBleedingValue(value) {
            document.getElementById('bleeding-value').textContent = value;
            updateDashboard();
        }

        // Evaluar severidad de anemia (Existente, modificado para llamar a updateDashboard)
        function evaluateAnemiaSeverity() {
            const tolerance = document.getElementById('exercise-tolerance').value;
            const severityEl = document.getElementById('anemia-severity');
            
            if (!tolerance) {
                severityEl.textContent = '--';
                severityEl.style.color = '';
                updateDashboard(); // Importante para que el dashboard refleje el estado
                return;
            }
            
            const severityLevels = {
                '0': { text: 'Sin anemia cl√≠nica', color: 'var(--normal-color)' },
                '1': { text: 'Anemia leve', color: 'var(--warning-color)' },
                '2': { text: 'Anemia moderada', color: 'var(--warning-color)' },
                '3': { text: 'Anemia severa', color: 'var(--alert-color)' },
                '4': { text: 'Anemia cr√≠tica', color: 'var(--alert-color)' }
            };
            
            const severity = severityLevels[tolerance];
            severityEl.textContent = severity.text;
            severityEl.style.color = severity.color;
            updateDashboard(); // Llamada a updateDashboard
        }

        // Evaluar palidez (Existente, modificado para llamar a updateDashboard)
        function evaluatePallor() {
            // L√≥gica adicional para palidez si es necesario
            updateDashboard(); // Llamada a updateDashboard
        }

        // Evaluar signos vitales (Existente, modificado para llamar a updateDashboard y estado del dashboard item)
        function evaluateVitalSigns() {
            const hr = parseFloat(document.getElementById('frecuencia-cardiaca').value);
            const sbp = parseFloat(document.getElementById('pas').value);
            const dbp = parseFloat(document.getElementById('pad').value);
            const temp = parseFloat(document.getElementById('temperatura').value);

            const assessmentEl = document.getElementById('cardiovascular-assessment');
            const vitalsItem = document.getElementById('vitals-item');
            
            let assessment = '';
            let hasAbnormal = false;
            
            if (!hr && !sbp && !dbp && !temp) {
                assessmentEl.textContent = '--';
                assessmentEl.style.color = '';
                vitalsStatus = 'Pendiente';
                vitalsItem.className = 'dashboard-item';
                updateDashboard();
                return;
            }

            vitalsStatus = 'Registrado'; // Por defecto si hay alg√∫n valor

            if (hr) {
                if (hr > 100) { assessment += 'Taquicardia '; hasAbnormal = true; }
                else if (hr < 60) { assessment += 'Bradicardia '; hasAbnormal = true; }
            }
            if (sbp && dbp) {
                if (sbp < 90 || dbp < 60) { assessment += 'Hipotensi√≥n '; hasAbnormal = true; }
                else if (sbp > 140 || dbp > 90) { assessment += 'Hipertensi√≥n '; hasAbnormal = true; }
            }
            if (temp) {
                if (temp > 37.5) { assessment += 'Fiebre '; hasAbnormal = true; }
                else if (temp < 36.0) { assessment += 'Hipotermia '; hasAbnormal = true; }
            }
            
            if (assessment === '') {
                assessment = 'Normal';
                assessmentEl.style.color = 'var(--normal-color)';
            } else {
                assessmentEl.style.color = 'var(--alert-color)';
                vitalsStatus = 'Anormal'; // Si hay alg√∫n hallazgo
            }
            
            assessmentEl.textContent = assessment || 'Par√°metros cardiovasculares normales';
            document.getElementById('vitals-status').textContent = vitalsStatus;
            vitalsItem.className = hasAbnormal ? 'dashboard-item dashboard-alert' : 
                                  'dashboard-item dashboard-normal';
            updateDashboard(); // Llamada a updateDashboard
        }

        // Evaluar organomegalia (Existente, modificado para llamar a updateDashboard)
        function evaluateOrganomegaly() {
            // Evaluaci√≥n de hepatomegalia
            const hepatomegalyCm = parseFloat(document.getElementById('hepatomegalia-cm').value) || 0;
            const hepatomegalyCheckbox = document.getElementById('hepatomegalia');
            const hepatomegalyGradeEl = document.getElementById('hepatomegaly-grade');
            
            if (hepatomegalyCheckbox.checked && hepatomegalyCm > 0) {
                if (hepatomegalyCm < 3) {
                    hepatomegalyGradeEl.textContent = 'Leve';
                } else if (hepatomegalyCm < 6) {
                    hepatomegalyGradeEl.textContent = 'Moderada';
                } else {
                    hepatomegalyGradeEl.textContent = 'Severa';
                }
            } else if (hepatomegalyCheckbox.checked && hepatomegalyCm == 0) {
                hepatomegalyGradeEl.textContent = 'Palpable, sin tama√±o definido';
            }
            else {
                hepatomegalyGradeEl.textContent = '--';
            }
            
            // Evaluaci√≥n de esplenomegalia
            const spleenHackett = document.getElementById('spleen-hackett').value;
            const splenomegalyCheckbox = document.getElementById('esplenomegalia');
            const splenomegalyCm = parseFloat(document.getElementById('esplenomegalia-cm').value) || 0;
            const splenomegalyGradeEl = document.getElementById('splenomegaly-grade');
            
            if (splenomegalyCheckbox.checked && spleenHackett) {
                const grades = {
                    '0': 'No palpable',
                    '1': 'Leve (Palpable)',
                    '2': 'Moderada (No rebasa l√≠nea media)',
                    '3': 'Moderada-severa (Rebasa l√≠nea media)',
                    '4': 'Severa (Llega a fosa il√≠aca)',
                    '5': 'Muy severa (Rebasa fosa il√≠aca)'
                };
                splenomegalyGradeEl.textContent = grades[spleenHackett];
            } else if (splenomegalyCheckbox.checked && !spleenHackett) {
                splenomegalyGradeEl.textContent = 'Palpable, sin clasificaci√≥n Hackett';
            }
            else {
                splenomegalyGradeEl.textContent = '--';
            }
            
            updateDashboard(); // Llamada a updateDashboard
        }

        // Calcular estad√≠sticas de ganglios linf√°ticos (Existente, modificado para llamar a updateDashboard)
        function calculateLymphNodeStats() {
            const nodeGroups = [
                'cervical-ant', 'cervical-post', 'supraclavicular', 'axilar', 'inguinal'
            ];
            const sides = ['der', 'izq'];
            
            let affectedChains = 0;
            let maxSize = 0;
            let concerningFeatures = [];
            
            nodeGroups.forEach(group => {
                sides.forEach(side => {
                    const palpable = document.getElementById(`${group}-${side}-palpable`);
                    if (palpable && palpable.checked) {
                        affectedChains++;
                        
                        const sizeInput = document.getElementById(`${group}-${side}-size`);
                        if (sizeInput && sizeInput.value) {
                            const size = parseFloat(sizeInput.value);
                            maxSize = Math.max(maxSize, size);
                        }
                        
                        if (document.getElementById(`${group}-${side}-doloroso`) && document.getElementById(`${group}-${side}-doloroso`).checked) {
                            concerningFeatures.push('Doloroso');
                        }
                        if (document.getElementById(`${group}-${side}-duro`) && document.getElementById(`${group}-${side}-duro`).checked) {
                            concerningFeatures.push('Duro');
                        }
                        if (document.getElementById(`${group}-${side}-fijo`) && document.getElementById(`${group}-${side}-fijo`).checked) {
                            concerningFeatures.push('Fijo');
                        }
                        if (group.includes('supraclavicular') && !concerningFeatures.includes('Localizaci√≥n supraclavicular')) {
                            concerningFeatures.push('Localizaci√≥n supraclavicular');
                        }
                    }
                });
            });
            
            document.getElementById('affected-chains').textContent = affectedChains;
            document.getElementById('max-node-size').textContent = maxSize > 0 ? `${maxSize} cm` : '0 cm';
            document.getElementById('concerning-features').textContent = 
                concerningFeatures.length > 0 ? [...new Set(concerningFeatures)].join(', ') : 'Ninguna';
            
            updateDashboard(); // Llamada a updateDashboard
        }

        // Calcular ECOG Score (Existente, modificado para llamar a updateDashboard)
        function calculateECOGScore() {
            const ecogRadio = document.querySelector('input[name="ecog-status"]:checked');
            const ecogScoreEl = document.getElementById('ecog-score');
            
            if (ecogRadio) {
                ecogScoreEl.textContent = ecogRadio.value;
            } else {
                ecogScoreEl.textContent = '--';
            }
            updateDashboard(); // Llamada a updateDashboard
        }

        // Calcular ISTH Score (Existente, modificado para llamar a updateDashboard)
        function calculateISThScore() {
            const categories = ['menstrual', 'postparto', 'cirugia', 'dental'];
            let total = 0;
            
            categories.forEach(category => {
                const radio = document.querySelector(`input[name="isth-${category}"]:checked`);
                if (radio) {
                    total += parseInt(radio.value);
                }
            });
            
            document.getElementById('isth-total-score').textContent = total;
            
            let interpretation = '';
            if (total >= 4) {
                interpretation = 'Sugiere trastorno hemorr√°gico';
            } else if (total >= 2) {
                interpretation = 'Posible trastorno hemorr√°gico';
            } else {
                interpretation = 'Bajo riesgo hemorr√°gico';
            }
            
            document.getElementById('isth-interpretation').textContent = interpretation;
            updateDashboard(); // Llamada a updateDashboard
        }

        // Calcular S√≠ntomas B (Existente, modificado para llamar a updateDashboard)
        function calculateBSymptoms() {
            let count = 0;
            
            if (document.getElementById('sintoma-b-fiebre').checked) count++;
            if (document.getElementById('sintoma-b-sudoracion').checked) count++;
            if (document.getElementById('sintoma-b-peso').checked) count++;
            
            document.getElementById('b-symptoms-count').textContent = count;
            
            let classification = '';
            if (count > 0) {
                classification = 'S√≠ntomas B presentes';
            } else {
                classification = 'S√≠ntomas B ausentes';
            }
            
            document.getElementById('b-symptoms-classification').textContent = classification;
            updateDashboard(); // Llamada a updateDashboard
        }

        // Calcular Charlson (Existente, modificado para llamar a updateDashboard)
        function calculateCharlson() {
            const items = {
                'charlson-iam': 1, 'charlson-icc': 1, 'charlson-evc': 1, 'charlson-demencia': 1,
                'charlson-epoc': 1, 'charlson-colagenosis': 1, 'charlson-ulcera': 1,
                'charlson-hepatopatia-leve': 1, 'charlson-diabetes': 1,
                'charlson-hemiplejia': 2, 'charlson-renal-moderada': 2, 'charlson-diabetes-complicada': 2,
                'charlson-tumor': 2, 'charlson-leucemia': 2, 'charlson-linfoma': 2,
                'charlson-hepatopatia-severa': 3,
                'charlson-tumor-metastasico': 6, 'charlson-sida': 6
            };
            
            let total = 0;
            Object.keys(items).forEach(id => {
                if (document.getElementById(id) && document.getElementById(id).checked) {
                    total += items[id];
                }
            });
            
            document.getElementById('charlson-score').textContent = total;
            
            let survival = '';
            if (total === 0) survival = '98%';
            else if (total === 1) survival = '96%';
            else if (total === 2) survival = '90%';
            else if (total === 3) survival = '77%';
            else if (total === 4) survival = '53%';
            else if (total >= 5) survival = '21%';
            
            document.getElementById('charlson-survival').textContent = survival;
            updateDashboard(); // Llamada a updateDashboard
        }

        // üìä ACTUALIZAR DASHBOARD (Copiado y adaptado de gastro.html)
        function updateDashboard() {
            const sections = [
                'anamnesis', 'physical-exam', 'lymph-nodes', 'abdominal-exam', 'hematologic-scales'
            ];
            
            let currentCompletedSections = 0; // Renombrado para evitar conflicto con la variable global
            let currentAlertCount = 0;
            let currentWarningCount = 0;
            let currentFindingsCount = 0;
            
            sections.forEach(sectionId => {
                const sectionElement = document.getElementById(sectionId);
                if (sectionElement) {
                    const checkboxes = sectionElement.querySelectorAll('input[type="checkbox"]:checked, input[type="radio"]:checked');
                    const numbers = sectionElement.querySelectorAll('input[type="number"]');
                    const selects = sectionElement.querySelectorAll('select');
                    
                    let hasContent = false;
                    if (checkboxes.length > 0) hasContent = true;
                    numbers.forEach(input => {
                        if (input.value && input.value !== '0') hasContent = true;
                    });
                    selects.forEach(select => {
                        if (select.value && select.value !== '') hasContent = true;
                    });
                    
                    if (hasContent) {
                        currentCompletedSections++;
                        currentFindingsCount += checkboxes.length;
                        
                        const badge = document.getElementById(`badge-${sectionId}`);
                        const navItem = document.getElementById(`nav-${sectionId}`);
                        
                        if (badge) {
                            badge.classList.add('completed');
                            badge.innerHTML = '<i class="fas fa-check"></i>';
                        }
                        if (navItem) {
                            navItem.style.opacity = '1';
                            navItem.parentElement.classList.add('completed');
                        }
                        
                        // Criterios de alerta y warning espec√≠ficos para hematolog√≠a
                        checkboxes.forEach(checkbox => {
                            const label = checkbox.nextElementSibling ? checkbox.nextElementSibling.textContent.toLowerCase() : '';
                            const id = checkbox.id;
                            
                            // Criterios de alerta (m√°s cr√≠tico)
                            if (id === 'sangrado-espontaneo' || id === 'petequias' || id === 'purpura' ||
                                id === 'hematomas' || id === 'sangrado-gingival-fisico' || id === 'epistaxis-activa' ||
                                id === 'hemorragias-retinianas' || id === 'sintoma-b-fiebre' || 
                                id === 'sintoma-b-sudoracion' || id === 'sintoma-b-peso' ||
                                (id.includes('-palpable') && (id.includes('-duro') || id.includes('-fijo') || id.includes('supraclavicular')))) {
                                currentAlertCount++;
                            }
                            // Criterios de warning (menos cr√≠tico, pero requiere atenci√≥n)
                            else if (id === 'fatiga-astenia' || id === 'palidez' || id === 'disnea-esfuerzo' ||
                                    id === 'palpitaciones' || id === 'taquicardia' || id === 'soplo-funcional' ||
                                    id === 'unas-coiloniquia' || id === 'sindrome-piernas-inquietas' || id === 'ictericia' ||
                                    id === 'hepatomegalia' || id === 'esplenomegalia' || id === 'dolor-oseo' ||
                                    id === 'infecciones-recurrentes') {
                                currentWarningCount++;
                            }
                        });

                        // A√±adir alertas/warnings de escalas
                        const anemiaSevText = document.getElementById('anemia-severity').textContent;
                        if (anemiaSevText.includes('cr√≠tica') || anemiaSevText.includes('severa')) currentAlertCount++;
                        else if (anemiaSevText.includes('moderada')) currentWarningCount++;

                        const charlsonScoreVal = parseInt(document.getElementById('charlson-score').textContent);
                        if (charlsonScoreVal >= 5) currentAlertCount++;
                        else if (charlsonScoreVal >= 2) currentWarningCount++;

                        const isthScoreVal = parseInt(document.getElementById('isth-total-score').textContent);
                        if (isthScoreVal >= 4) currentAlertCount++;
                        else if (isthScoreVal >= 2) currentWarningCount++;
                    } else {
                        const badge = document.getElementById(`badge-${sectionId}`);
                        const navItem = document.getElementById(`nav-${sectionId}`);
                        
                        if (badge) {
                            badge.classList.remove('completed');
                            badge.innerHTML = '<i class="fas fa-circle"></i>';
                        }
                        if (navItem) {
                            navItem.style.opacity = '0';
                            navItem.parentElement.classList.remove('completed');
                        }
                    }
                }
            });
            
            const progress = Math.round((currentCompletedSections / sections.length) * 100);
            document.getElementById('exam-progress').textContent = `${progress}%`;
            document.getElementById('sections-completed').textContent = `${currentCompletedSections}/${sections.length}`;
            document.getElementById('alert-count').textContent = currentAlertCount;
            document.getElementById('warning-count').textContent = currentWarningCount;
            document.getElementById('findings-count').textContent = currentFindingsCount;
            
            const alertsItem = document.getElementById('alerts-item');
            const warningsItem = document.getElementById('warnings-item');
            const findingsItem = document.getElementById('findings-item');
            
            // Si quieres que siempre se muestren, no necesitas el display='flex' condicional
            alertsItem.style.display = 'flex'; 
            warningsItem.style.display = 'flex';
            findingsItem.style.display = 'flex';
            
            alertsItem.classList.toggle('dashboard-alert', currentAlertCount > 0);
            warningsItem.classList.toggle('dashboard-warning', currentWarningCount > 0);
            findingsItem.classList.toggle('dashboard-normal', currentFindingsCount > 0);

            // Guardar valores globales
            examProgress = progress;
            sectionsCompleted = currentCompletedSections;
            alertCount = currentAlertCount;
            warningCount = currentWarningCount;
            findingsCount = currentFindingsCount;

            generateConclusion(); // Llama a generateConclusion al final de updateDashboard
        }

        // üìù GENERAR CONCLUSI√ìN MEJORADA (Adaptada para hematolog√≠a)
      // üìù GENERAR CONCLUSI√ìN MEJORADA (Adaptada para hematolog√≠a - VERSI√ìN FINAL)
        function generateConclusion() {
            const conclusionEl = document.getElementById('conclusion-text');
            const realTimeEl = document.getElementById('stickyContent'); // Apunta al sticky-content
            let conclusion = 'INFORME DEL EXAMEN HEMATOL√ìGICO:\n\n';

            // Funciones auxiliares para simplificar el c√≥digo y la legibilidad
            const getLabelText = (id) => document.querySelector(`label[for="${id}"]`)?.textContent.toLowerCase() || '';
            const isChecked = (id) => document.getElementById(id)?.checked;
            const getInputValue = (id) => document.getElementById(id)?.value;
            const getSelectedValue = (id) => document.getElementById(id)?.value;
            const getSelectedText = (id) => {
                const select = document.getElementById(id);
                return select && select.selectedIndex > -1 ? select.options[select.selectedIndex].textContent.toLowerCase() : '';
            };
            const capitalizeFirstLetter = (string) => string.charAt(0).toUpperCase() + string.slice(1);
            const getRadioButtonValue = (name) => {
                const radio = document.querySelector(`input[name="${name}"]:checked`);
                return radio ? getLabelText(radio.id) : '';
            };
            // Funci√≥n para formatear listas de hallazgos
            const formatList = (arr) => {
                if (arr.length === 0) return '';
                if (arr.length === 1) return arr[0];
                const last = arr.pop();
                return arr.join(', ') + ' y ' + last;
            };

            // --- 1. ANAMNESIS Y QUEJAS PRINCIPALES ---
            let anamnesisAdded = false;
            let quejasText = '';
            const quejasReport = [];
            const sinQuejasMarcado = isChecked('sin-quejas-hemato');

            if (sinQuejasMarcado) {
                quejasReport.push('el paciente no refiere quejas hematol√≥gicas');
            } else {
                ['fatiga-astenia', 'palidez', 'disnea-esfuerzo', 'palpitaciones',
                 'sangrado-espontaneo', 'equimosis-faciles', 'petequias', 'sangrado-menstrual',
                 'epistaxis', 'sangrado-gingival', 'adenopatias-palpables', 'fiebre',
                 'sudoracion-nocturna', 'perdida-peso', 'dolor-oseo', 'infecciones-recurrentes',
                 'ictericia', 'orinas-oscuras'].forEach(id => {
                    if (isChecked(id)) {
                        quejasReport.push(getLabelText(id));
                    }
                });
            }
            
            if (quejasReport.length > 0 || sinQuejasMarcado) { // Si hay quejas o se marc√≥ 'sin quejas'
                anamnesisAdded = true;
                if (sinQuejasMarcado) {
                    quejasText += `Motivo de consulta: Consulta de rutina, ${formatList(quejasReport)}. `;
                } else {
                    quejasText += `Motivo de consulta: Paciente consulta por ${formatList(quejasReport)}. `;

                    // Caracterizaci√≥n de S√≠ntomas: Evaluaci√≥n de Sangrado
                    const bleedingIntensity = getInputValue('bleeding-intensity');
                    const bleedingTypes = [];
                    ['sangrado-cutaneo', 'sangrado-mucosas', 'sangrado-gastrointestinal',
                     'sangrado-genitourinario', 'sangrado-post-trauma', 'sangrado-post-cirugia'].forEach(id => {
                        if (isChecked(id)) bleedingTypes.push(getLabelText(id));
                    });

                    if (bleedingIntensity && bleedingIntensity !== '0' || bleedingTypes.length > 0) {
                        quejasText += `Detalles de sangrado: `;
                        if (bleedingIntensity && bleedingIntensity !== '0') quejasText += `Intensidad EVA: ${bleedingIntensity}/10. `;
                        if (bleedingTypes.length > 0) quejasText += `Tipos de sangrado referidos: ${formatList(bleedingTypes)}. `;
                    } else if (document.querySelectorAll('#anamnesis .bleeding-assessment input').length > 0) { // Si hay inputs en la secci√≥n
                        quejasText += `Detalles de sangrado: No refiere sangrado activo o caracterizado. `;
                    }

                    // Caracterizaci√≥n de S√≠ntomas: S√≠ntomas de Anemia
                    const anemiaSeverity = document.getElementById('anemia-severity').textContent;
                    const exerciseToleranceText = getSelectedText('exercise-tolerance');

                    if (anemiaSeverity !== '--' || (exerciseToleranceText && exerciseToleranceText !== 'seleccionar')) {
                        quejasText += `S√≠ntomas de anemia: `;
                        if (anemiaSeverity !== '--') quejasText += `Severidad cl√≠nica: ${anemiaSeverity}. `;
                        if (exerciseToleranceText && exerciseToleranceText !== 'seleccionar') quejasText += `Tolerancia al ejercicio: ${exerciseToleranceText}. `;
                    } else if (document.querySelectorAll('#anamnesis .anemia-assessment select').length > 0) { // Si hay selects en la secci√≥n
                        quejasText += `S√≠ntomas de anemia: No refiere o no evaluados. `;
                    }
                }
            }

            // Antecedentes Hematol√≥gicos: Historia Personal
            const personalHistory = [];
            ['anemia-previa', 'transfusiones', 'trombosis-previa', 'sangrado-quirurgico',
             'cancer-hematologico', 'quimioterapia', 'radioterapia', 'esplenectomia'].forEach(id => {
                if (isChecked(id)) personalHistory.push(getLabelText(id));
            });
            if (personalHistory.length > 0) {
                anamnesisAdded = true;
                quejasText += `Antecedentes personales hematol√≥gicos: ${formatList(personalHistory)}. `;
            } else if (document.querySelectorAll('#anamnesis .exam-container:nth-of-type(3) .exam-section:nth-of-type(1) input[type="checkbox"]').length > 0) {
                anamnesisAdded = true;
                quejasText += `Antecedentes personales hematol√≥gicos: No refiere. `;
            }

            // Antecedentes Hematol√≥gicos: Historia Familiar
            const familiarHistory = [];
            ['familia-anemia', 'familia-hemofilia', 'familia-trombofilia',
             'familia-leucemia', 'familia-linfoma', 'familia-sangrado'].forEach(id => {
                if (isChecked(id)) familiarHistory.push(getLabelText(id));
            });
            if (familiarHistory.length > 0) {
                anamnesisAdded = true;
                quejasText += `Antecedentes familiares hematol√≥gicos: ${formatList(familiarHistory)}. `;
            } else if (document.querySelectorAll('#anamnesis .exam-container:nth-of-type(3) .exam-section:nth-of-type(2) input[type="checkbox"]').length > 0) {
                anamnesisAdded = true;
                quejasText += `Antecedentes familiares hematol√≥gicos: No refiere. `;
            }

            // Antecedentes Hematol√≥gicos: Medicamentos
            const medications = [];
            ['medicamento-anticoagulantes', 'medicamento-antiplaquetarios', 'medicamento-aines',
             'medicamento-hierro', 'medicamento-b12', 'medicamento-folato', 'medicamento-corticoides'].forEach(id => {
                if (isChecked(id)) medications.push(getLabelText(id));
            });
            if (medications.length > 0) {
                anamnesisAdded = true;
                quejasText += `Medicamentos relevantes: ${formatList(medications)}. `;
            } else if (document.querySelectorAll('#anamnesis .exam-container:nth-of-type(3) .exam-section:nth-of-type(3) input[type="checkbox"]').length > 0) {
                anamnesisAdded = true;
                quejasText += `Medicamentos relevantes: No refiere. `;
            }
            
            if (anamnesisAdded) {
                conclusion += `ANAMNESIS Y QUEJAS PRINCIPALES:\n${quejasText.trim()}\n\n`;
            }

            // --- 2. EXAMEN F√çSICO GENERAL ---
            let physicalExamAdded = false;
            let physicalExamText = '';

            // Inspecci√≥n General: Signos de Anemia
            const anemiaSignsPhysical = [];
            ['palidez-piel', 'palidez-conjuntival', 'palidez-lechos-ungueales',
             'palidez-mucosa-oral', 'taquicardia', 'soplo-funcional', 'unas-coiloniquia',
             'sindrome-piernas-inquietas'].forEach(id => {
                if (isChecked(id)) anemiaSignsPhysical.push(getLabelText(id));
            });
            const conjunctivalPallorText = getSelectedText('conjunctival-pallor');

            if (anemiaSignsPhysical.length > 0 || (conjunctivalPallorText && conjunctivalPallorText !== 'seleccionar')) {
                physicalExamAdded = true;
                physicalExamText += `Signos de anemia: ${formatList(anemiaSignsPhysical)}. `;
                if (conjunctivalPallorText && conjunctivalPallorText !== 'seleccionar') physicalExamText += `Palidez conjuntival: ${conjunctivalPallorText}. `;
            } else if (document.querySelectorAll('#physical-exam .anemia-assessment input').length > 0) {
                 physicalExamAdded = true;
                 physicalExamText += `Signos de anemia: No evidentes. `;
            }

            // Inspecci√≥n General: Signos de Sangrado
            const bleedingSignsPhysical = [];
            ['petequias-fisico', 'purpura', 'equimosis', 'hematomas',
             'sangrado-gingival-fisico', 'epistaxis-activa', 'hemorragias-retinianas'].forEach(id => {
                if (isChecked(id)) bleedingSignsPhysical.push(getLabelText(id));
            });
            const petechiaeDistribution = [];
            ['petequias-miembros-inf', 'petequias-tronco', 'petequias-brazos', 'petequias-cara'].forEach(id => {
                if (isChecked(id)) petechiaeDistribution.push(getLabelText(id));
            });

            if (bleedingSignsPhysical.length > 0) {
                physicalExamAdded = true;
                physicalExamText += `Signos de sangrado: ${formatList(bleedingSignsPhysical)}. `;
                if (petechiaeDistribution.length > 0) physicalExamText += `Distribuci√≥n de petequias: ${formatList(petechiaeDistribution)}. `;
            } else if (document.querySelectorAll('#physical-exam .bleeding-assessment input').length > 0) {
                 physicalExamAdded = true;
                 physicalExamText += `Signos de sangrado: No evidentes. `;
            }


            // Inspecci√≥n General: Otros Hallazgos
            const otherPhysicalFindings = [];
            ['ictericia-fisico', 'cianosis', 'edema', 'ulceras-miembros', 'lesiones-cutaneas'].forEach(id => {
                if (isChecked(id)) otherPhysicalFindings.push(getLabelText(id));
            });
            if (otherPhysicalFindings.length > 0) {
                physicalExamAdded = true;
                physicalExamText += `Otros hallazgos: ${formatList(otherPhysicalFindings)}. `;
            } else if (document.querySelectorAll('#physical-exam .exam-section:last-of-type input').length > 0) {
                 physicalExamAdded = true;
                 physicalExamText += `Otros hallazgos: No evidentes. `;
            }


            // Signos Vitales
            const pas = getInputValue('pas');
            const pad = getInputValue('pad');
            const fc = getInputValue('frecuencia-cardiaca');
            const temp = getInputValue('temperatura');
            const cardiovascularAssessment = document.getElementById('cardiovascular-assessment').textContent;

            if (pas || pad || fc || temp || (cardiovascularAssessment && cardiovascularAssessment !== '--')) {
                physicalExamAdded = true;
                physicalExamText += `Signos vitales: `;
                if (fc) physicalExamText += `Frecuencia card√≠aca: ${fc} lpm. `;
                if (pas && pad) physicalExamText += `Presi√≥n arterial: ${pas}/${pad} mmHg. `;
                if (temp) physicalExamText += `Temperatura: ${temp}¬∞C. `;
                if (cardiovascularAssessment && cardiovascularAssessment !== '--') physicalExamText += `Evaluaci√≥n cardiovascular: ${cardiovascularAssessment}. `;
            } else if (document.querySelectorAll('#physical-exam .exam-container:nth-of-type(2) input').length > 0) {
                 physicalExamAdded = true;
                 physicalExamText += `Signos vitales: No registrados o no evaluados. `;
            }

            if (physicalExamAdded) {
                conclusion += `EXAMEN F√çSICO GENERAL:\n${physicalExamText.trim()}\n\n`;
            }

            // --- 3. EXAMEN DE GANGLIOS LINF√ÅTICOS ---
            let lymphNodesAdded = false;
            let lymphNodesText = '';

            const nodeGroups = ['cervical-ant', 'cervical-post', 'supraclavicular', 'axilar', 'inguinal'];
            const sides = ['der', 'izq'];
            let anyNodeInputGiven = false; // Para saber si se ha interactuado con los inputs de nodos

            let specificNodeFindings = []; // Para almacenar los detalles de cada nodo

            nodeGroups.forEach(group => {
                sides.forEach(side => {
                    const palpableId = `${group}-${side}-palpable`;
                    const sizeId = `${group}-${side}-size`;
                    const dolorosoId = `${group}-${side}-doloroso`;
                    const duroId = `${group}-${side}-duro`;
                    const fijoId = `${group}-${side}-fijo`;

                    const palpable = isChecked(palpableId);
                    const size = getInputValue(sizeId);
                    const doloroso = isChecked(dolorosoId);
                    const duro = isChecked(duroId);
                    const fijo = isChecked(fijoId);

                    if (palpable || size || doloroso || duro || fijo || document.getElementById(palpableId)) { // Si existe el checkbox o se ha interactuado
                        anyNodeInputGiven = true;
                    }
                    
                    let nodeDescription = `${capitalizeFirstLetter(group.replace('-', ' '))} ${capitalizeFirstLetter(side)}`;
                    let hasSpecificDetails = false;

                    if (palpable) {
                        nodeDescription += `: Palpable`;
                        if (size) nodeDescription += ` (${size} cm)`;
                        let characteristics = [];
                        if (doloroso) characteristics.push('doloroso');
                        if (duro) characteristics.push('duro');
                        if (fijo) characteristics.push('fijo');
                        if (characteristics.length > 0) nodeDescription += `, ${formatList(characteristics)}`;
                        hasSpecificDetails = true;
                    } else if (document.getElementById(palpableId) && (size || doloroso || duro || fijo)) { // Si no es palpable pero tiene detalles
                        nodeDescription += `: No palpable, pero con detalles `;
                        let characteristics = [];
                        if (size) characteristics.push(`tama√±o ${size} cm (no palpable)`);
                        if (doloroso) characteristics.push('doloroso');
                        if (duro) characteristics.push('duro');
                        if (fijo) characteristics.push('fijo');
                        if (characteristics.length > 0) nodeDescription += `(${formatList(characteristics)})`;
                        hasSpecificDetails = true;
                    } else if (document.getElementById(palpableId)) { // Si existe el checkbox pero no est√° marcado ni tiene detalles
                        nodeDescription += `: No palpable`;
                        hasSpecificDetails = true;
                    }

                    if (hasSpecificDetails) {
                         specificNodeFindings.push(nodeDescription);
                    }
                });
            });

            if (specificNodeFindings.length > 0) {
                lymphNodesAdded = true;
                lymphNodesText += `Cadenas ganglionares: ${specificNodeFindings.join('; ')}. `;
            } else if (anyNodeInputGiven) { // Se ha interactuado pero no se marc√≥ nada palpable
                lymphNodesAdded = true;
                lymphNodesText += `Cadenas ganglionares: No se palpan adenopat√≠as. `;
            } else if (document.querySelectorAll('.node-group').length > 0) { // Si la secci√≥n existe pero no hubo interacci√≥n
                lymphNodesAdded = true;
                lymphNodesText += `Ganglios linf√°ticos: No evaluados o sin hallazgos. `;
            }


            // Evaluaci√≥n Global de Adenopat√≠as
            const affectedChains = document.getElementById('affected-chains')?.textContent;
            const maxNodeSize = document.getElementById('max-node-size')?.textContent;
            const concerningFeatures = document.getElementById('concerning-features')?.textContent;
            
            const anyGlobalNodeInputGiven = (affectedChains && affectedChains !== '0') || (maxNodeSize && maxNodeSize !== '0 cm') || (concerningFeatures && concerningFeatures !== 'Ninguna');

            if (anyGlobalNodeInputGiven) {
                lymphNodesAdded = true;
                lymphNodesText += `Evaluaci√≥n global de adenopat√≠as: Cadenas afectadas: ${affectedChains}. Tama√±o m√°ximo: ${maxNodeSize}. `;
                if (concerningFeatures && concerningFeatures !== 'Ninguna') lymphNodesText += `Caracter√≠sticas preocupantes: ${concerningFeatures}. `;
                else lymphNodesText += `No se identifican caracter√≠sticas preocupantes. `;
            } else if (document.getElementById('affected-chains')) { // Si la secci√≥n de resumen de adenopat√≠as existe
                 lymphNodesAdded = true;
                 lymphNodesText += `Evaluaci√≥n global de adenopat√≠as: Sin hallazgos significativos. `;
            }


            if (lymphNodesAdded) {
                conclusion += `EXAMEN DE GANGLIOS LINF√ÅTICOS:\n${lymphNodesText.trim()}\n\n`;
            }

            // --- 4. EXAMEN ABDOMINAL Y ORGANOMEGALIAS ---
            let abdominalExamAdded = false;
            let abdominalExamText = '';

            // Hepatomegalia
            const hepatomegaliaChecked = isChecked('hepatomegalia');
            const hepatomegaliaCm = getInputValue('hepatomegalia-cm');
            const hepaticConsistencyText = getSelectedText('hepatic-consistency');
            const hepatomegalyDolorosaChecked = isChecked('hepatomegalia-dolorosa');
            const hepatomegalyLisaChecked = isChecked('hepatomegalia-lisa');
            const hepatomegalyIrregularChecked = isChecked('hepatomegalia-irregular');
            const hepatomegalyGrade = document.getElementById('hepatomegaly-grade').textContent;

            const anyHepaticInputGiven = hepatomegaliaChecked || hepatomegaliaCm || (hepaticConsistencyText && hepaticConsistencyText !== 'seleccionar') || hepatomegalyDolorosaChecked || hepatomegalyLisaChecked || hepatomegalyIrregularChecked || document.getElementById('hepatomegalia');

            if (anyHepaticInputGiven) {
                abdominalExamAdded = true;
                if (hepatomegaliaChecked) {
                    abdominalExamText += `H√≠gado: Hepatomegalia palpable. `;
                    if (hepatomegaliaCm) abdominalExamText += `Distancia reborde costal: ${hepatomegaliaCm} cm. `;
                    if (hepaticConsistencyText && hepaticConsistencyText !== 'seleccionar') abdominalExamText += `Consistencia: ${hepaticConsistencyText}. `;
                    const hepaticCharacteristics = [];
                    if (hepatomegalyDolorosaChecked) hepaticCharacteristics.push('dolorosa');
                    if (hepatomegalyLisaChecked) hepaticCharacteristics.push('lisa');
                    if (hepatomegalyIrregularChecked) hepaticCharacteristics.push('irregular');
                    if (hepaticCharacteristics.length > 0) abdominalExamText += `Caracter√≠sticas: ${formatList(hepaticCharacteristics)}. `;
                    if (hepatomegalyGrade && hepatomegalyGrade !== '--') abdominalExamText += `Grado de hepatomegalia: ${hepatomegalyGrade}. `;
                } else {
                    abdominalExamText += `H√≠gado: No se palpa hepatomegalia. `; // Si el checkbox no est√° marcado
                    if (hepatomegaliaCm) abdominalExamText += `A pesar de no ser palpable, se registr√≥ una distancia de ${hepatomegaliaCm} cm. `;
                    if (hepaticConsistencyText && hepaticConsistencyText !== 'seleccionar') abdominalExamText += `Consistencia referida: ${hepaticConsistencyText}. `;
                }
            }


            // Esplenomegalia
            const esplenomegaliaChecked = isChecked('esplenomegalia');
            const esplenomegaliaCm = getInputValue('esplenomegalia-cm');
            const spleenHackettText = getSelectedText('spleen-hackett');
            const splenomegalyDolorosaChecked = isChecked('esplenomegalia-dolorosa');
            const splenomegalyLisaChecked = isChecked('esplenomegalia-lisa');
            const splenomegalyIrregularChecked = isChecked('esplenomegalia-irregular');
            const splenomegalyGrade = document.getElementById('splenomegaly-grade').textContent;

            const anySplenicInputGiven = esplenomegaliaChecked || esplenomegaliaCm || (spleenHackettText && spleenHackettText !== 'seleccionar') || splenomegalyDolorosaChecked || splenomegalyLisaChecked || splenomegalyIrregularChecked || document.getElementById('esplenomegalia');


            if (anySplenicInputGiven) {
                abdominalExamAdded = true;
                if (esplenomegaliaChecked) {
                    abdominalExamText += `Bazo: Esplenomegalia palpable. `;
                    if (esplenomegaliaCm) abdominalExamText += `Distancia reborde costal: ${esplenomegaliaCm} cm. `;
                    if (spleenHackettText && spleenHackettText !== 'seleccionar') abdominalExamText += `Clasificaci√≥n de Hackett: ${spleenHackettText}. `;
                    const splenicCharacteristics = [];
                    if (splenomegalyDolorosaChecked) splenicCharacteristics.push('dolorosa');
                    if (splenomegalyLisaChecked) splenicCharacteristics.push('lisa');
                    if (splenomegalyIrregularChecked) splenicCharacteristics.push('irregular');
                    if (splenicCharacteristics.length > 0) abdominalExamText += `Caracter√≠sticas: ${formatList(splenicCharacteristics)}. `;
                    if (splenomegalyGrade && splenomegalyGrade !== '--') abdominalExamText += `Grado de esplenomegalia: ${splenomegalyGrade}. `;
                } else {
                    abdominalExamText += `Bazo: No se palpa esplenomegalia. `; // Si el checkbox no est√° marcado
                    if (esplenomegaliaCm) abdominalExamText += `A pesar de no ser palpable, se registr√≥ una distancia de ${esplenomegaliaCm} cm. `;
                    if (spleenHackettText && spleenHackettText !== 'seleccionar') abdominalExamText += `Clasificaci√≥n de Hackett referida: ${spleenHackettText}. `;
                }
            }


            // Otros Hallazgos Abdominales
            const abdominalFindingsReport = [];
            ['masas-abdominales', 'ascitis', 'circulacion-colateral', 'dolor-abdominal', 'signo-murphy'].forEach(id => {
                if (isChecked(id)) abdominalFindingsReport.push(getLabelText(id));
            });
            const abdominalMassesDescription = getInputValue('abdominal-masses-description');

            const anyOtherAbdominalInputGiven = abdominalFindingsReport.length > 0 || (abdominalMassesDescription && abdominalMassesDescription.trim()) || document.querySelectorAll('#abdominal-exam .exam-section:last-of-type input').length > 0;

            if (anyOtherAbdominalInputGiven) {
                abdominalExamAdded = true;
                abdominalExamText += `Otros hallazgos abdominales: ${formatList(abdominalFindingsReport)}. `;
                if (abdominalMassesDescription && abdominalMassesDescription.trim()) abdominalExamText += `Descripci√≥n de masas: ${abdominalMassesDescription.trim()}. `;
                else if (document.getElementById('abdominal-masses-description')) abdominalExamText += `Descripci√≥n de masas: No especificada. `; // Si el campo existe pero est√° vac√≠o
            }


            if (abdominalExamAdded) {
                conclusion += `EXAMEN ABDOMINAL Y ORGANOMEGALIAS:\n${abdominalExamText.trim()}\n\n`;
            }

            // --- 5. ESCALAS DE EVALUACI√ìN HEMATOL√ìGICA ---
            let scalesAdded = false;
            let scalesText = '';

            // Escala ECOG Performance Status
            const ecogScore = document.getElementById('ecog-score')?.textContent;
            const ecogStatusRadio = getRadioButtonValue('ecog-status');
            
            const anyEcogInputGiven = (ecogScore && ecogScore !== '--') || (ecogStatusRadio && ecogStatusRadio !== 'seleccionar') || document.querySelectorAll('#hematologic-scales .exam-container:nth-of-type(1) input').length > 0;

            if (anyEcogInputGiven) {
                scalesAdded = true;
                scalesText += `ECOG Performance Status: ${ecogScore || 'no evaluado'}${ecogStatusRadio ? ` (${capitalizeFirstLetter(ecogStatusRadio)})` : ''}. `;
            }


            // Escala de Sangrado ISTH
            const isthTotalScore = document.getElementById('isth-total-score')?.textContent;
            const isthInterpretation = document.getElementById('isth-interpretation')?.textContent;
            
            const isthMenstrual = getRadioButtonValue('isth-menstrual');
            const isthPostparto = getRadioButtonValue('isth-postparto');
            const isthCirugia = getRadioButtonValue('isth-cirugia');
            const isthDental = getRadioButtonValue('isth-dental');

            const anyIsthInputGiven = (isthTotalScore && isthTotalScore !== '0') || isthMenstrual || isthPostparto || isthCirugia || isthDental || document.querySelectorAll('#hematologic-scales .exam-container:nth-of-type(2) input').length > 0;

            if (anyIsthInputGiven) {
                scalesAdded = true;
                scalesText += `Escala de Sangrado ISTH: Puntuaci√≥n total ${isthTotalScore || '0'}. Interpretaci√≥n: ${isthInterpretation || 'No evaluada'}. `;
                let isthDetails = [];
                if (isthMenstrual) isthDetails.push(`menstrual: ${isthMenstrual}`);
                if (isthPostparto) isthDetails.push(`post-parto: ${isthPostparto}`);
                if (isthCirugia) isthDetails.push(`cirug√≠a: ${isthCirugia}`);
                if (isthDental) isthDetails.push(`dental: ${isthDental}`);
                if (isthDetails.length > 0) scalesText += `Detalles: ${isthDetails.join('; ')}. `;
                else if (document.querySelectorAll('#hematologic-scales .exam-container:nth-of-type(2) input[type="radio"]').length > 0) scalesText += `Detalles: No especificados. `;
            }


            // S√≠ntomas B (Linfomas)
            const bSymptomsCount = document.getElementById('b-symptoms-count')?.textContent;
            const bSymptomsClassification = document.getElementById('b-symptoms-classification')?.textContent;
            const sintomaBFiebreChecked = isChecked('sintoma-b-fiebre');
            const sintomaBSudoracionChecked = isChecked('sintoma-b-sudoracion');
            const sintomaBPesoChecked = isChecked('sintoma-b-peso');

            const anyBSymptomInputGiven = (bSymptomsCount && bSymptomsCount !== '0') || sintomaBFiebreChecked || sintomaBSudoracionChecked || sintomaBPesoChecked || document.querySelectorAll('#hematologic-scales .exam-container:nth-of-type(3) input').length > 0;

            if (anyBSymptomInputGiven) {
                scalesAdded = true;
                scalesText += `S√≠ntomas B (Linfomas): ${bSymptomsCount || '0'}/3 presentes. Clasificaci√≥n: ${bSymptomsClassification || 'No evaluada'}. `;
                let bSymptomsDetails = [];
                if (sintomaBFiebreChecked) bSymptomsDetails.push('fiebre >38¬∞C');
                if (sintomaBSudoracionChecked) bSymptomsDetails.push('sudoraci√≥n nocturna profusa');
                if (sintomaBPesoChecked) bSymptomsDetails.push('p√©rdida de peso >10% en 6 meses');
                if (bSymptomsDetails.length > 0) scalesText += `Detalles: ${formatList(bSymptomsDetails)}. `;
                else if (document.querySelectorAll('#hematologic-scales .exam-container:nth-of-type(3) input[type="checkbox"]').length > 0) scalesText += `Detalles: No especificados. `;
            }


            // √çndice de Comorbilidad de Charlson
            const charlsonScore = document.getElementById('charlson-score')?.textContent;
            const charlsonSurvival = document.getElementById('charlson-survival')?.textContent;
            const charlsonAnyChecked = document.querySelectorAll('#hematologic-scales .exam-container:nth-of-type(4) input[type="checkbox"]:checked').length > 0;

            const anyCharlsonInputGiven = (charlsonScore && charlsonScore !== '0') || charlsonAnyChecked || document.querySelectorAll('#hematologic-scales .exam-container:nth-of-type(4) input').length > 0;

            if (anyCharlsonInputGiven) {
                scalesAdded = true;
                scalesText += `√çndice de Comorbilidad de Charlson: Puntuaci√≥n ${charlsonScore || '0'}. Supervivencia estimada a 10 a√±os: ${charlsonSurvival || 'No evaluada'}. `;
                const charlsonComorbidities = [];
                const charlsonItemsMap = { // Mapping IDs to more descriptive names
                    'charlson-iam': 'Infarto Agudo de Miocardio', 'charlson-icc': 'Insuficiencia Card√≠aca Congestiva',
                    'charlson-evc': 'Enfermedad Vascular Cerebral', 'charlson-demencia': 'Demencia',
                    'charlson-epoc': 'EPOC', 'charlson-colagenosis': 'Colagenosis',
                    'charlson-ulcera': '√ölcera P√©ptica', 'charlson-hepatopatia-leve': 'Hepatopat√≠a Leve',
                    'charlson-diabetes': 'Diabetes', 'charlson-hemiplejia': 'Hemiplej√≠a',
                    'charlson-renal-moderada': 'Insuficiencia Renal Moderada', 'charlson-diabetes-complicada': 'Diabetes Complicada',
                    'charlson-tumor': 'Tumor', 'charlson-leucemia': 'Leucemia',
                    'charlson-linfoma': 'Linfoma', 'charlson-hepatopatia-severa': 'Hepatopat√≠a Severa',
                    'charlson-tumor-metastasico': 'Tumor Metast√°sico', 'charlson-sida': 'SIDA'
                };
                Object.keys(charlsonItemsMap).forEach(id => {
                    if (isChecked(id)) charlsonComorbidities.push(charlsonItemsMap[id]);
                });
                if (charlsonComorbidities.length > 0) scalesText += `Comorbilidades: ${formatList(charlsonComorbidities)}. `;
                else if (document.querySelectorAll('#hematologic-scales .exam-container:nth-of-type(4) input[type="checkbox"]').length > 0) scalesText += `Comorbilidades: No especificadas. `;
            }

            if (scalesAdded) {
                conclusion += `ESCALAS DE EVALUACI√ìN HEMATOL√ìGICA:\n${scalesText.trim()}\n\n`;
            }

            // --- CONCLUSI√ìN FINAL Y PLAN ---
            if (conclusion.trim() === 'INFORME DEL EXAMEN HEMATOL√ìGICO:') {
                conclusion = 'Seleccione los par√°metros del examen para generar la conclusi√≥n hematol√≥gica...';
            } else {
                // Resumen de hallazgos del dashboard
                if (alertCount > 0 || warningCount > 0 || findingsCount > 0) {
                    conclusion += '‚ö†Ô∏è RESUMEN DE HALLAZGOS DEL EXAMEN:\n';
                    if (alertCount > 0) {
                        conclusion += `‚Ä¢ ALERTAS CR√çTICAS: ${alertCount}\n`;
                    } else if (warningCount > 0 || findingsCount > 0) { // Si hay warnings/findings pero no alertas
                        conclusion += `‚Ä¢ No se identifican alertas cr√≠ticas. `;
                    }

                    if (warningCount > 0) {
                        conclusion += `‚Ä¢ HALLAZGOS DE ATENCI√ìN: ${warningCount}\n`;
                    } else if (alertCount > 0 || findingsCount > 0) { // Si hay alertas/findings pero no warnings
                         conclusion += `‚Ä¢ No se identifican hallazgos de atenci√≥n. `;
                    }
                    conclusion += `‚Ä¢ TOTAL DE HALLAZGOS REGISTRADOS: ${findingsCount}\n\n`;
                }

                conclusion += 'üéØ IMPRESI√ìN DIAGN√ìSTICA:\n';
                conclusion += '[Pendiente de correlaci√≥n con hemograma completo, frotis de sangre perif√©rica, y estudios espec√≠ficos (ej., bioqu√≠mica, pruebas de coagulaci√≥n, biopsia de m√©dula √≥sea) seg√∫n los hallazgos cl√≠nicos y antecedentes. Considerar diagn√≥sticos diferenciales seg√∫n el perfil de s√≠ntomas.]\n\n';
                conclusion += 'üìã PLAN DE MANEJO:\n';
                conclusion += '[El plan de manejo se establecer√° en funci√≥n de la impresi√≥n diagn√≥stica confirmada y la severidad de la condici√≥n hematol√≥gica. Podr√≠a incluir terapia farmacol√≥gica (ej., suplementos, inmunosupresores, quimioterapia), transfusiones, o procedimientos espec√≠ficos. Se ajustar√° a la respuesta del paciente.]\n\n';
                conclusion += 'üìù SEGUIMIENTO:\n';
                conclusion += '[Se recomienda un seguimiento hematol√≥gico peri√≥dico para monitorear la evoluci√≥n de la enfermedad, la respuesta al tratamiento y la aparici√≥n de posibles complicaciones o recurrencias.]\n\n';
                conclusion += `üìä COMPLETITUD DEL EXAMEN: ${examProgress}%`;
            }

            conclusionEl.textContent = conclusion;
            realTimeEl.textContent = conclusion;
        }
        // üñ®Ô∏è Imprimir conclusi√≥n (Copiado y adaptado de gastro.html)
        function printConclusion() {
            const conclusion = document.getElementById('conclusion-text').textContent;
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                <head>
                    <title>Conclusi√≥n Examen Hematol√≥gico</title>
                    <style>
                        body { 
                            font-family: Arial, sans-serif; 
                            margin: 20px; 
                            line-height: 1.6;
                        }
                        pre { 
                            white-space: pre-wrap; 
                            font-family: 'Courier New', monospace; 
                            font-size: 12px;
                        }
                        .header {
                            text-align: center;
                            border-bottom: 2px solid #e74c3c; /* Adaptado al color hematol√≥gico */
                            padding-bottom: 10px;
                            margin-bottom: 20px;
                        }
                        .footer {
                            text-align: center;
                            font-size: 10px;
                            color: #666;
                            margin-top: 20px;
                            border-top: 1px solid #ddd;
                            padding-top: 10px;
                        }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>Examen Hematol√≥gico - Conclusi√≥n</h1>
                        <p>Fecha: ${new Date().toLocaleDateString()}</p>
                    </div>
                    <pre>${conclusion}</pre>
                    <div class="footer">
                        <p>Generado por Sistema de Evaluaci√≥n Hematol√≥gica</p>
                    </div>
                </body>
                </html>
            `);
            printWindow.document.close();
            printWindow.print();
        }

        // üóëÔ∏è Limpiar formulario (Existente, ampliado para los nuevos elementos y dashboard)
        function clearForm() {
            if (confirm('¬øEst√° seguro de que desea limpiar todos los datos del formulario?')) {
                document.querySelectorAll('input[type="checkbox"]').forEach(cb => {
                    cb.checked = false;
                    cb.disabled = false; // Habilitar checkboxes de "sin quejas"
                    cb.style.backgroundColor = ''; // Quitar resaltado de sincronizaci√≥n
                    cb.style.border = '';
                });
                document.querySelectorAll('input[type="radio"]').forEach(rb => rb.checked = false);
                document.querySelectorAll('input[type="number"]').forEach(nb => nb.value = '');
                document.querySelectorAll('input[type="range"]').forEach(rb => rb.value = 0);
                document.querySelectorAll('select').forEach(sel => sel.selectedIndex = 0);
                document.querySelectorAll('textarea').forEach(ta => ta.value = '');
                
                // Resetear valores espec√≠ficos
                document.getElementById('bleeding-value').textContent = '0';
                document.getElementById('anemia-severity').textContent = '--';
                document.getElementById('anemia-severity').style.color = '';
                document.getElementById('cardiovascular-assessment').textContent = '--';
                document.getElementById('cardiovascular-assessment').style.color = '';
                document.getElementById('hepatomegaly-grade').textContent = '--';
                document.getElementById('splenomegaly-grade').textContent = '--';
                document.getElementById('affected-chains').textContent = '0';
                document.getElementById('max-node-size').textContent = '0 cm';
                document.getElementById('concerning-features').textContent = 'Ninguna';
                document.getElementById('ecog-score').textContent = '--';
                document.getElementById('isth-total-score').textContent = '0';
                document.getElementById('isth-interpretation').textContent = '--';
                document.getElementById('b-symptoms-count').textContent = '0';
                document.getElementById('b-symptoms-classification').textContent = '--';
                document.getElementById('charlson-score').textContent = '0';
                document.getElementById('charlson-survival').textContent = '--';
                
                // Resetear dashboard variables y display
                examProgress = 0;
                sectionsCompleted = 0;
                alertCount = 0;
                warningCount = 0;
                findingsCount = 0;
                vitalsStatus = 'Pendiente';

                document.getElementById('exam-progress').textContent = '0%';
                document.getElementById('sections-completed').textContent = '0/5'; // Ajusta el total de secciones
                document.getElementById('alert-count').textContent = '0';
                document.getElementById('warning-count').textContent = '0';
                document.getElementById('findings-count').textContent = '0';
                document.getElementById('vitals-status').textContent = 'Pendiente';
                
                document.getElementById('alerts-item').classList.remove('dashboard-alert');
                document.getElementById('warnings-item').classList.remove('dashboard-warning');
                document.getElementById('findings-item').classList.remove('dashboard-normal');
                document.getElementById('vitals-item').classList.remove('dashboard-normal', 'dashboard-alert'); // Limpiar clases
                document.getElementById('vitals-item').classList.add('dashboard-item');


                // Re-evaluar todas las escalas para limpiar el estado visual y del modelo
                evaluateAnemiaSeverity();
                evaluateVitalSigns();
                evaluateOrganomegaly();
                calculateLymphNodeStats();
                calculateECOGScore();
                calculateISThScore();
                calculateBSymptoms();
                calculateCharlson();
                
                updateDashboard(); // Forzar actualizaci√≥n del dashboard y conclusi√≥n
            }
        }
        
        // üöÄ Inicializaci√≥n del sistema (Copiado y adaptado de gastro.html)
        document.addEventListener('DOMContentLoaded', () => {
            // Cargar tema guardado
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark') {
                document.body.setAttribute('data-theme', 'dark');
                document.getElementById('theme-icon').className = 'fas fa-sun';
            }

            // Event listeners para actualizar dashboard y conclusi√≥n
            // Se a√±aden listeners a todos los inputs, selects y textareas
            // Luego, las funciones espec√≠ficas de c√°lculo llamar√°n a updateDashboard()
            document.querySelectorAll('input, select, textarea').forEach(el => {
                el.addEventListener('change', updateDashboard);
                el.addEventListener('input', updateDashboard);
            });
             
            // Se asegura que las funciones que calculan valores complejos tambi√©n llamen a updateDashboard()
            // (esto se ha hecho en cada funci√≥n de c√°lculo/evaluaci√≥n arriba)
             
            // Ajustar altura de secciones al cambiar contenido
            document.querySelector('.main-container').addEventListener('change', (event) => {
                const sectionContent = event.target.closest('.section-content.expanded');
                if (sectionContent) {
                    updateSectionHeight(sectionContent);
                }
            });
             
            // Expandir la primera secci√≥n por defecto
            toggleSection(document.querySelector('.section-header'));
            
            // Inicializar todas las evaluaciones y c√°lculos al cargar la p√°gina
            evaluateAnemiaSeverity();
            evaluateVitalSigns();
            evaluateOrganomegaly();
            calculateLymphNodeStats();
            calculateECOGScore();
            calculateISThScore();
            calculateBSymptoms();
            calculateCharlson();
            
            // Forzar una actualizaci√≥n inicial completa del dashboard y la conclusi√≥n
            updateDashboard();

            // Mostrar mensaje de bienvenida
            setTimeout(() => {
                console.log('üéâ Sistema de Evaluaci√≥n Hematol√≥gica Premium con Panel Sticky cargado exitosamente!');
            }, 1000);
        });
    </script>
</body>
</html>