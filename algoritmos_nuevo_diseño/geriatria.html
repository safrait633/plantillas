<!DOCTYPE html>
<html lang="es" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Geriatría Avanzada - MedScap</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/main.css">
    <style>
        body {
            background: linear-gradient(135deg, #1e1b4b 0%, #1e293b 50%, #1e3a8a 100%);
            min-height: 100vh;
            color: white;
            padding-top: 120px;
        }

        .dashboard-fixed {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: linear-gradient(135deg, #95a5a6 0%, #7f8c8d 100%);
            backdrop-filter: blur(10px);
            z-index: 1000;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            padding: 15px 0;
        }

        .section {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(16px);
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
            border: 1px solid rgba(255,255,255,0.2);
            overflow: hidden;
        }

        .section-header {
            background: linear-gradient(135deg, #95a5a6 0%, #7f8c8d 100%);
            color: white;
            padding: 20px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }

        .section-content {
            padding: 0;
            max-height: 0;
            overflow: hidden;
            transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            background: rgba(255,255,255,0.05);
        }

        .section-content.expanded {
            padding: 25px;
            max-height: 2000px;
        }

        .geriatric-scale {
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .scale-item {
            display: flex;
            align-items: center;
            padding: 10px;
            margin: 8px 0;
            background: rgba(255,255,255,0.05);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .scale-item:hover {
            background: rgba(255,255,255,0.1);
        }

        .scale-item input {
            margin-right: 12px;
            accent-color: #95a5a6;
        }

        .scale-item label {
            color: white;
            cursor: pointer;
            flex: 1;
        }
    </style>
</head>
<body>
    <!-- Botón de volver -->
    <a href="index.html" class="back-button" style="position: fixed; top: 20px; left: 20px; background: rgba(255,255,255,0.1); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.2); color: white; padding: 10px 15px; border-radius: 8px; text-decoration: none; transition: all 0.3s ease; z-index: 1001;">
        <i class="fas fa-arrow-left" style="margin-right: 8px;"></i>
        Volver al Portal
    </a>

    <!-- Dashboard Fijo Superior -->
    <div class="dashboard-fixed">
        <div class="dashboard-content">
            <div class="dashboard-grid">
                <div class="dashboard-item">
                    <i class="fas fa-user-clock"></i>
                    <div>Edad: <span id="age-display">--</span> años</div>
                </div>
                <div class="dashboard-item">
                    <i class="fas fa-brain"></i>
                    <div>MMSE: <span id="mmse-score">--</span>/30</div>
                </div>
                <div class="dashboard-item">
                    <i class="fas fa-walking"></i>
                    <div>Barthel: <span id="barthel-score">--</span>/100</div>
                </div>
                <div class="dashboard-item">
                    <i class="fas fa-balance-scale"></i>
                    <div>Riesgo Caídas: <span id="fall-risk">--</span></div>
                </div>
                <div class="dashboard-item">
                    <i class="fas fa-pills"></i>
                    <div>Medicamentos: <span id="medication-count">0</span></div>
                </div>
                <div class="dashboard-item">
                    <i class="fas fa-heart"></i>
                    <div>Estado: <span id="overall-status">Evaluando</span></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Contenedor Principal -->
    <div class="main-container">
        <div class="main-content">
            <!-- Evaluación Cognitiva -->
            <div class="section">
                <div class="section-header" onclick="toggleSection('cognitive-content')">
                    <div class="section-title">
                        <i class="fas fa-brain"></i>
                        <span>EVALUACIÓN COGNITIVA</span>
                    </div>
                    <div class="section-indicators">
                        <span class="section-counter">0/10</span>
                        <i class="fas fa-chevron-down section-arrow"></i>
                    </div>
                </div>
                <div class="section-content" id="cognitive-content">
                    <div class="geriatric-scale">
                        <h4 style="color: white; margin-bottom: 15px;">🧠 Mini Mental State Examination (MMSE)</h4>
                        <div class="scale-item">
                            <input type="checkbox" id="mmse-orientacion-temporal">
                            <label for="mmse-orientacion-temporal">Orientación temporal (5 puntos)</label>
                        </div>
                        <div class="scale-item">
                            <input type="checkbox" id="mmse-orientacion-espacial">
                            <label for="mmse-orientacion-espacial">Orientación espacial (5 puntos)</label>
                        </div>
                        <div class="scale-item">
                            <input type="checkbox" id="mmse-registro">
                            <label for="mmse-registro">Registro de palabras (3 puntos)</label>
                        </div>
                        <div class="scale-item">
                            <input type="checkbox" id="mmse-atencion">
                            <label for="mmse-atencion">Atención y cálculo (5 puntos)</label>
                        </div>
                        <div class="scale-item">
                            <input type="checkbox" id="mmse-recuerdo">
                            <label for="mmse-recuerdo">Recuerdo diferido (3 puntos)</label>
                        </div>
                        <div class="scale-item">
                            <input type="checkbox" id="mmse-lenguaje">
                            <label for="mmse-lenguaje">Lenguaje (9 puntos)</label>
                        </div>
                        <div style="margin-top: 15px; padding: 15px; background: rgba(255,255,255,0.1); border-radius: 8px;">
                            <button onclick="calculateMMSE()" style="background: linear-gradient(135deg, #95a5a6 0%, #7f8c8d 100%); color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer;">
                                Calcular MMSE
                            </button>
                            <div id="mmse-result" style="margin-top: 10px; color: white;"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Evaluación Funcional -->
            <div class="section">
                <div class="section-header" onclick="toggleSection('functional-content')">
                    <div class="section-title">
                        <i class="fas fa-walking"></i>
                        <span>EVALUACIÓN FUNCIONAL</span>
                    </div>
                    <div class="section-indicators">
                        <span class="section-counter">0/10</span>
                        <i class="fas fa-chevron-down section-arrow"></i>
                    </div>
                </div>
                <div class="section-content" id="functional-content">
                    <div class="geriatric-scale">
                        <h4 style="color: white; margin-bottom: 15px;">🚿 Índice de Barthel</h4>
                        <div class="scale-item">
                            <input type="radio" name="barthel-alimentacion" value="10" onchange="calculateBarthel()">
                            <label>Alimentación: Independiente (10)</label>
                        </div>
                        <div class="scale-item">
                            <input type="radio" name="barthel-alimentacion" value="5" onchange="calculateBarthel()">
                            <label>Alimentación: Necesita ayuda (5)</label>
                        </div>
                        <div class="scale-item">
                            <input type="radio" name="barthel-alimentacion" value="0" onchange="calculateBarthel()">
                            <label>Alimentación: Dependiente (0)</label>
                        </div>
                        
                        <div class="scale-item">
                            <input type="radio" name="barthel-bano" value="5" onchange="calculateBarthel()">
                            <label>Baño: Independiente (5)</label>
                        </div>
                        <div class="scale-item">
                            <input type="radio" name="barthel-bano" value="0" onchange="calculateBarthel()">
                            <label>Baño: Dependiente (0)</label>
                        </div>

                        <div class="scale-item">
                            <input type="radio" name="barthel-vestido" value="10" onchange="calculateBarthel()">
                            <label>Vestido: Independiente (10)</label>
                        </div>
                        <div class="scale-item">
                            <input type="radio" name="barthel-vestido" value="5" onchange="calculateBarthel()">
                            <label>Vestido: Necesita ayuda (5)</label>
                        </div>
                        <div class="scale-item">
                            <input type="radio" name="barthel-vestido" value="0" onchange="calculateBarthel()">
                            <label>Vestido: Dependiente (0)</label>
                        </div>

                        <div style="margin-top: 15px; padding: 15px; background: rgba(255,255,255,0.1); border-radius: 8px;">
                            <div id="barthel-result" style="color: white;">
                                <strong>Índice de Barthel: <span id="barthel-total">0</span>/100</strong>
                                <div id="barthel-interpretation" style="margin-top: 5px; color: #a0a0a0;"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Evaluación de Riesgo de Caídas -->
            <div class="section">
                <div class="section-header" onclick="toggleSection('falls-content')">
                    <div class="section-title">
                        <i class="fas fa-exclamation-triangle"></i>
                        <span>RIESGO DE CAÍDAS</span>
                    </div>
                    <div class="section-indicators">
                        <span class="section-counter">0/8</span>
                        <i class="fas fa-chevron-down section-arrow"></i>
                    </div>
                </div>
                <div class="section-content" id="falls-content">
                    <div class="geriatric-scale">
                        <h4 style="color: white; margin-bottom: 15px;">⚠️ Factores de Riesgo de Caídas</h4>
                        <div class="checkbox-grid">
                            <div class="checkbox-item">
                                <input type="checkbox" id="fall-history" onchange="calculateFallRisk()">
                                <label for="fall-history">Historia de caídas previas</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="fall-medication" onchange="calculateFallRisk()">
                                <label for="fall-medication">Polifarmacia (≥4 medicamentos)</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="fall-vision" onchange="calculateFallRisk()">
                                <label for="fall-vision">Problemas visuales</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="fall-mobility" onchange="calculateFallRisk()">
                                <label for="fall-mobility">Problemas de movilidad</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="fall-cognitive" onchange="calculateFallRisk()">
                                <label for="fall-cognitive">Deterioro cognitivo</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="fall-incontinence" onchange="calculateFallRisk()">
                                <label for="fall-incontinence">Incontinencia urinaria</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="fall-depression" onchange="calculateFallRisk()">
                                <label for="fall-depression">Depresión</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="fall-environment" onchange="calculateFallRisk()">
                                <label for="fall-environment">Riesgos ambientales</label>
                            </div>
                        </div>
                        <div style="margin-top: 15px; padding: 15px; background: rgba(255,255,255,0.1); border-radius: 8px;">
                            <div id="fall-risk-result" style="color: white;">
                                <strong>Riesgo de Caídas: <span id="fall-risk-level">Bajo</span></strong>
                                <div id="fall-risk-interpretation" style="margin-top: 5px; color: #a0a0a0;"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Panel Lateral -->
        <div class="sticky-panel">
            <h3 style="color: white; margin-bottom: 20px;">👴 Evaluación Geriátrica Integral</h3>
            <div id="geriatric-conclusion" style="color: white; line-height: 1.6;">
                <p>Complete las evaluaciones para generar la valoración geriátrica integral.</p>
            </div>
        </div>
    </div>

    <script src="assets/js/main.js"></script>
    <script>
        function calculateMMSE() {
            let score = 0;
            const checkboxes = document.querySelectorAll('#cognitive-content input[type="checkbox"]:checked');
            
            // Puntuación simplificada basada en secciones completadas
            checkboxes.forEach(checkbox => {
                switch(checkbox.id) {
                    case 'mmse-orientacion-temporal':
                    case 'mmse-orientacion-espacial':
                    case 'mmse-atencion':
                        score += 5;
                        break;
                    case 'mmse-registro':
                    case 'mmse-recuerdo':
                        score += 3;
                        break;
                    case 'mmse-lenguaje':
                        score += 9;
                        break;
                }
            });

            document.getElementById('mmse-score').textContent = score;
            
            let interpretation = '';
            let color = '';

            if (score >= 24) {
                interpretation = 'Función cognitiva normal';
                color = '#27ae60';
            } else if (score >= 18) {
                interpretation = 'Deterioro cognitivo leve';
                color = '#f39c12';
            } else {
                interpretation = 'Deterioro cognitivo moderado-severo';
                color = '#e74c3c';
            }

            document.getElementById('mmse-result').innerHTML = `<span style="color: ${color};">${interpretation}</span>`;
            updateGeriatricDashboard();
        }

        function calculateBarthel() {
            let score = 0;
            
            const alimentacion = document.querySelector('input[name="barthel-alimentacion"]:checked');
            const bano = document.querySelector('input[name="barthel-bano"]:checked');
            const vestido = document.querySelector('input[name="barthel-vestido"]:checked');
            
            if (alimentacion) score += parseInt(alimentacion.value);
            if (bano) score += parseInt(bano.value);
            if (vestido) score += parseInt(vestido.value);

            document.getElementById('barthel-score').textContent = score;
            document.getElementById('barthel-total').textContent = score;

            let interpretation = '';
            let color = '';

            if (score >= 80) {
                interpretation = 'Independencia funcional';
                color = '#27ae60';
            } else if (score >= 60) {
                interpretation = 'Dependencia leve';
                color = '#f1c40f';
            } else if (score >= 40) {
                interpretation = 'Dependencia moderada';
                color = '#f39c12';
            } else {
                interpretation = 'Dependencia severa';
                color = '#e74c3c';
            }

            document.getElementById('barthel-interpretation').innerHTML = `<span style="color: ${color};">${interpretation}</span>`;
            updateGeriatricDashboard();
        }

        function calculateFallRisk() {
            const riskFactors = document.querySelectorAll('#falls-content input[type="checkbox"]:checked').length;
            
            let riskLevel = '';
            let color = '';
            let interpretation = '';

            if (riskFactors >= 4) {
                riskLevel = 'Alto';
                color = '#e74c3c';
                interpretation = 'Requiere intervención inmediata para prevención de caídas';
            } else if (riskFactors >= 2) {
                riskLevel = 'Moderado';
                color = '#f39c12';
                interpretation = 'Implementar medidas preventivas';
            } else {
                riskLevel = 'Bajo';
                color = '#27ae60';
                interpretation = 'Mantener vigilancia rutinaria';
            }

            document.getElementById('fall-risk').textContent = riskLevel;
            document.getElementById('fall-risk-level').textContent = riskLevel;
            document.getElementById('fall-risk-interpretation').innerHTML = `<span style="color: ${color};">${interpretation}</span>`;
            
            updateGeriatricDashboard();
        }

        function updateGeriatricDashboard() {
            // Actualizar conteo de medicamentos (simulado)
            document.getElementById('medication-count').textContent = Math.floor(Math.random() * 8);
            
            // Actualizar estado general
            const mmseScore = parseInt(document.getElementById('mmse-score').textContent) || 0;
            const barthelScore = parseInt(document.getElementById('barthel-score').textContent) || 0;
            const fallRisk = document.getElementById('fall-risk').textContent;
            
            let overallStatus = 'Evaluando';
            if (mmseScore > 0 || barthelScore > 0) {
                if (mmseScore >= 24 && barthelScore >= 80 && fallRisk === 'Bajo') {
                    overallStatus = 'Óptimo';
                } else if (mmseScore >= 18 && barthelScore >= 60) {
                    overallStatus = 'Estable';
                } else {
                    overallStatus = 'Requiere Atención';
                }
            }
            
            document.getElementById('overall-status').textContent = overallStatus;
            generateGeriatricConclusion();
        }

        function generateGeriatricConclusion() {
            const mmseScore = document.getElementById('mmse-score').textContent;
            const barthelScore = document.getElementById('barthel-score').textContent;
            const fallRisk = document.getElementById('fall-risk').textContent;
            
            let conclusion = '<h4 style="color: #95a5a6; margin-bottom: 15px;">👴 VALORACIÓN GERIÁTRICA INTEGRAL</h4>';
            
            if (mmseScore !== '--') {
                conclusion += `<p><strong>Función Cognitiva:</strong> MMSE ${mmseScore}/30</p>`;
            }
            
            if (barthelScore !== '--') {
                conclusion += `<p><strong>Función Física:</strong> Barthel ${barthelScore}/100</p>`;
            }
            
            if (fallRisk !== '--') {
                conclusion += `<p><strong>Riesgo de Caídas:</strong> ${fallRisk}</p>`;
            }

            conclusion += '<div style="margin-top: 15px; padding: 10px; background: rgba(149, 165, 166, 0.1); border-radius: 6px;">';
            conclusion += '<strong style="color: #95a5a6;">Recomendaciones:</strong>';
            conclusion += '<ul style="margin-top: 5px; padding-left: 20px;">';
            
            if (mmseScore !== '--' && parseInt(mmseScore) < 24) {
                conclusion += '<li>Evaluación neuropsicológica detallada</li>';
            }
            
            if (barthelScore !== '--' && parseInt(barthelScore) < 80) {
                conclusion += '<li>Programa de rehabilitación funcional</li>';
            }
            
            if (fallRisk === 'Alto' || fallRisk === 'Moderado') {
                conclusion += '<li>Implementar medidas de prevención de caídas</li>';
            }
            
            conclusion += '</ul></div>';

            document.getElementById('geriatric-conclusion').innerHTML = conclusion;
        }

        function toggleSection(sectionId) {
            const content = document.getElementById(sectionId);
            const header = content.previousElementSibling;
            const arrow = header.querySelector('.section-arrow');
            
            if (content.classList.contains('expanded')) {
                content.classList.remove('expanded');
                arrow.style.transform = 'rotate(0deg)';
            } else {
                content.classList.add('expanded');
                arrow.style.transform = 'rotate(180deg)';
            }
        }

        function toggleTheme() {
            if (window.themeManager) {
                window.themeManager.toggleTheme();
            }
        }

        function printReport() {
            window.print();
        }

        function exportPDF() {
            alert('Función de exportación PDF en desarrollo');
        }

        // Inicialización
        document.addEventListener('DOMContentLoaded', function() {
            toggleSection('cognitive-content');
            updateGeriatricDashboard();
            console.log('👴 Módulo de Geriatría cargado exitosamente');
        });
    </script>
</body>
</html>