<!DOCTYPE html>
<html lang="es" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cardiolog√≠a Avanzada - Framework Universal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div id="root">
        <!-- Bot√≥n "Volver" arriba a la izquierda -->
        <button class="absolute top-4 left-4 z-10 inline-flex items-center justify-center gap-2 whitespace-nowrap text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 border hover:text-accent-foreground h-9 rounded-md px-3 bg-white/10 border-white/20 text-white hover:bg-white/20 backdrop-blur-md">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-arrow-left w-4 h-4 mr-2">
                <path d="m12 19-7-7 7-7"></path>
                <path d="M19 12H5"></path>
            </svg>
            Volver
        </button>

        <!-- Fondo gradient principal -->
        <div class="min-h-screen bg-gradient-to-br from-indigo-900 via-slate-900 to-blue-800">
            
            <!-- Header con backdrop-blur -->
            <div class="backdrop-blur-md bg-black/30 border-b border-white/10 p-6">
                <div class="max-w-7xl mx-auto">
                    <div class="flex items-center justify-between">
                        
                        <!-- T√≠tulo con icono de especialidad -->
                        <div class="flex items-center gap-4">
                            <div class="p-3 bg-indigo-500/20 rounded-full border border-indigo-500/30">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-heart h-8 w-8 text-indigo-300">
                                    <path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.29 1.51 4.04 3 5.5l7 7Z"/>
                                </svg>
                            </div>
                            <div>
                                <h1 class="text-3xl font-bold text-white">Cardiolog√≠a Avanzada</h1>
                                <p class="text-white/70">Framework Universal - Principio ZERO-TYPING</p>
                            </div>
                        </div>
                        
                        <!-- Badges de progreso y bot√≥n informe -->
                        <div class="flex items-center gap-3">
                            <div class="inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 hover:bg-primary/80 bg-indigo-500/20 text-indigo-200 border border-indigo-500/30" id="progreso-badge">
                                0% Completado
                            </div>
                            <button class="inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 border hover:text-accent-foreground h-10 px-4 py-2 bg-white/10 border-white/20 text-white hover:bg-white/20">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-file-text w-4 h-4 mr-2">
                                    <path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"></path>
                                    <path d="M14 2v4a2 2 0 0 0 2 2h4"></path>
                                    <path d="M10 9H8"></path>
                                    <path d="M16 13H8"></path>
                                    <path d="M16 17H8"></path>
                                </svg>
                                Ver Informe
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- LAYOUT PRINCIPAL (Flex con 2 columnas) -->
            <div class="flex gap-6 p-6">
                <!-- COLUMNA PRINCIPAL (Izquierda) -->
                <div class="transition-all duration-300 w-full max-w-4xl mx-auto">
                    <div class="space-y-4"
            color: #e0e0e0;
        }
        
        body.dark-mode .section {
            border-color: #444;
        }
        
        body.dark-mode .section-header {
            background: linear-gradient(135deg, #c0392b, #a93226);
        }
        
        body.dark-mode .section-content {
            background: #333;
        }
        
        body.dark-mode .form-group {
            background: #383838;
            border-color: #555;
        }
        
        body.dark-mode .checkbox-item {
            background: #404040;
        }
        
        body.dark-mode .measurement {
            background: #404040;
        }
        
        body.dark-mode input, body.dark-mode select, body.dark-mode textarea {
            background: #404040;
            color: #e0e0e0;
            border-color: #555;
        }
        
        body.dark-mode .conclusion {
            background: linear-gradient(135deg, #333, #2a2a2a);
            border-color: #555;
        }
        
        body.dark-mode .conclusion-text {
            background: #404040;
            color: #e0e0e0;
            border-color: #555;
        }

        /* === DASHBOARD SUPERIOR FIJO A√ëADIDO === */
        .dashboard-fixed {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: var(--primary-gradient);
            backdrop-filter: blur(10px);
            z-index: 1000;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .dashboard-content {
            max-width: 1600px;
            margin: 0 auto;
            padding: 15px 20px;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 12px;
            margin-bottom: 10px;
        }

        .dashboard-item {
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            padding: 8px 12px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
            transition: all 0.3s ease;
            color: white;
            text-align: center;
            font-size: 12px;
        }

        .dashboard-item:hover {
            background: rgba(255,255,255,0.2);
            transform: translateY(-2px);
        }

        .dashboard-item i {
            font-size: 16px;
            margin-bottom: 4px;
            display: block;
        }

        .dashboard-alert {
            color: var(--alert-color) !important;
            animation: pulse 2s infinite;
        }

        .dashboard-warning {
            color: var(--warning-color) !important;
        }

        .dashboard-normal {
            color: var(--normal-color) !important;
        }

        /* === CONTROLES SUPERIORES A√ëADIDOS === */
        .control-bar {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .control-btn {
            padding: 8px 15px;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .control-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-primary { background: var(--primary-gradient); }
        .btn-success { background: var(--secondary-gradient); }
        .btn-warning { background: var(--warning-gradient); }
        .btn-danger { background: var(--alert-gradient); }

        /* === PANEL LATERAL DE NAVEGACI√ìN A√ëADIDO === */
        .nav-panel {
            position: fixed;
            left: 20px;
            top: 160px;
            width: 250px;
            background: var(--card-bg);
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            padding: 20px;
            max-height: calc(100vh - 180px);
            overflow-y: auto;
            z-index: 998;
            transform: translateX(-280px);
            transition: transform 0.3s ease;
        }

        .nav-panel.open {
            transform: translateX(0);
        }

        .nav-panel h3 {
            margin: 0 0 15px 0;
            color: var(--primary-color);
            font-size: 16px;
            border-bottom: 2px solid #667eea;
            padding-bottom: 8px;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 12px;
            margin: 4px 0;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 13px;
        }

        .nav-item:hover {
            background: rgba(102, 126, 234, 0.1);
        }

        .nav-item.completed {
            background: rgba(40, 167, 69, 0.1);
            color: var(--normal-color);
        }

        .nav-item.completed i {
            color: var(--normal-color);
        }

        .nav-item i {
            width: 16px;
            text-align: center;
        }

        /* === PANEL LATERAL STICKY A√ëADIDO === */
        .sticky-panel {
            position: fixed;
            top: 160px;
            right: -420px;
            width: 400px;
            height: calc(100vh - 180px);
            background: var(--card-bg);
            border-radius: 12px 0 0 12px;
            box-shadow: -4px 0 20px rgba(0,0,0,0.15);
            z-index: 997;
            transition: right 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            overflow: hidden;
            border: 2px solid #667eea;
        }

        .sticky-panel.active {
            right: 0;
        }

        .sticky-header {
            background: var(--primary-gradient);
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 600;
            font-size: 14px;
        }

        .sticky-controls {
            display: flex;
            gap: 8px;
        }

        .sticky-btn {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            border-radius: 4px;
            padding: 6px 10px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .sticky-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: scale(1.05);
        }

        .sticky-content {
            padding: 20px;
            height: calc(100% - 70px);
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 11px;
            line-height: 1.4;
            white-space: pre-wrap;
            background: var(--light-bg);
        }

        .update-indicator {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--primary-gradient);
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            display: none;
            align-items: center;
            gap: 8px;
            font-size: 12px;
            z-index: 10;
        }

        .update-indicator.active {
            display: flex;
        }

        .spinner {
            width: 16px;
            height: 16px;
            border: 2px solid rgba(255,255,255,0.3);
            border-top: 2px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Notificaci√≥n de copia A√ëADIDA */
        .copy-notification {
            position: fixed;
            top: 200px;
            right: 20px;
            background: var(--normal-color);
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 500;
            opacity: 0;
            transform: translateX(100px);
            transition: all 0.3s ease;
            z-index: 1002;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .copy-notification.show {
            opacity: 1;
            transform: translateX(0);
        }

        /* Ajustar contenido principal cuando panel est√° activo A√ëADIDO */
        .split-view-active .main-container {
            margin-right: 420px;
            transition: margin-right 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        /* === RESTO DEL CSS ORIGINAL MANTENIDO === */
        .main-container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            padding: 30px;
            margin: 0 20px;
            transition: all 0.3s ease;
        }

        .split-view .main-container {
            margin-left: 290px;
            margin-right: 20px;
        }
        
        /* === CONTROLES SUPERIORES === */
        .top-controls {
            position: fixed;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 100;
            flex-wrap: wrap;
        }
        
        .control-btn-old {
            background: #e74c3c;
            color: white;
            padding: 10px 15px;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 600;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
            font-size: 14px;
        }
        
        .control-btn-old:hover {
            background: #c0392b;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .control-btn-old.secondary {
            background: #95a5a6;
        }
        
        .control-btn-old.secondary:hover {
            background: #7f8c8d;
        }

        /* === MODO OSCURO/CLARO TOGGLE A√ëADIDO === */
        .theme-toggle {
            position: fixed;
            top: 20px;
            left: 20px;
            background: var(--primary-gradient);
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            font-size: 20px;
            cursor: pointer;
            z-index: 1001;
            transition: all 0.3s ease;
        }

        .theme-toggle:hover {
            transform: scale(1.1);
        }

        /* === BOT√ìN HOME MEJORADO A√ëADIDO === */
        .home-button {
            position: fixed;
            top: 80px;
            left: 20px;
            background: var(--normal-color);
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            font-size: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            text-decoration: none;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 1001;
            transition: all 0.3s ease;
        }

        .home-button:hover {
            background-color: #229954;
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(0,0,0,0.2);
        }
        
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
            font-size: 28px;
            border-bottom: 3px solid #e74c3c;
            padding-bottom: 15px;
        }
        
        body.dark-mode h1 {
            color: #e0e0e0;
        }
        
        .section {
            margin-bottom: 25px;
            border: 2px solid #ecf0f1;
            border-radius: 8px;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        
        .section.active {
            border-color: #e74c3c;
            box-shadow: 0 2px 8px rgba(231, 76, 60, 0.2);
        }
        
        .section-header {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
            padding: 15px 20px;
            cursor: pointer;
            font-weight: 600;
            font-size: 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background 0.3s ease;
        }
        
        .section-header:hover {
            background: linear-gradient(135deg, #c0392b, #a93226);
        }
        
        .section-header .arrow {
            transition: transform 0.3s ease;
            font-size: 18px;
        }
        
        .section-header.expanded .arrow {
            transform: rotate(180deg);
        }

        /* === BADGES DE COMPLETITUD A√ëADIDOS === */
        .section-header .completion-badge {
            background: rgba(255,255,255,0.2);
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            margin-left: 10px;
        }

        .section-header .completion-badge.completed {
            background: var(--normal-color);
        }
        
        /* === ICONOS EN SECCIONES === */
        .section-icon {
            margin-right: 10px;
            font-size: 18px;
        }
        
        .section-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease-in-out;
            background: #fafbfc;
        }
        
        .section-content.expanded {
            padding: 20px;
        }
        
        /* === AGRUPACI√ìN VISUAL MEJORADA === */
        .clinical-group {
            background: #ffffff;
            border: 1px solid #e8ecef;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 4px solid #3498db;
        }
        
        body.dark-mode .clinical-group {
            background: #383838;
            border-color: #555;
        }
        
        .clinical-group-header {
            font-weight: 600;
            font-size: 14px;
            color: #2c3e50;
            margin-bottom: 10px;
            padding-bottom: 5px;
            border-bottom: 1px solid #e8ecef;
        }
        
        body.dark-mode .clinical-group-header {
            color: #e0e0e0;
            border-bottom-color: #555;
        }
        
        .form-group {
            margin-bottom: 20px;
            padding: 15px;
            background: white;
            border-radius: 6px;
            border: 1px solid #e1e8ed;
        }
        
        .form-group label {
            display: block;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 8px;
            font-size: 14px;
        }
        
        body.dark-mode .form-group label {
            color: #e0e0e0;
        }
        
        .form-group select, .form-group input, .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e8ed;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s ease;
            background: white;
        }
        
        .form-group select:focus, .form-group input:focus, .form-group textarea:focus {
            outline: none;
            border-color: #e74c3c;
            box-shadow: 0 0 0 3px rgba(231, 76, 60, 0.1);
        }
        
        /* === INDICADORES VISUALES DE NORMALIDAD === */
        .vital-indicator {
            display: inline-flex;
            align-items: center;
            margin-left: 10px;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .vital-indicator.normal {
            background: #d4edda;
            color: #155724;
        }
        
        .vital-indicator.warning {
            background: #fff3cd;
            color: #856404;
        }
        
        .vital-indicator.danger {
            background: #f8d7da;
            color: #721c24;
        }
        
        body.dark-mode .vital-indicator.normal {
            background: #1e4620;
            color: #75dd79;
        }
        
        body.dark-mode .vital-indicator.warning {
            background: #4d3e1a;
            color: #ffd93d;
        }
        
        body.dark-mode .vital-indicator.danger {
            background: #4a1a1d;
            color: #f5a9b8;
        }
        
        .checkbox-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
            margin-top: 10px;
        }
        
        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px;
            background: #f8f9fa;
            border-radius: 4px;
            transition: background-color 0.3s ease;
        }
        
        .checkbox-item:hover {
            background: #e9ecef;
        }
        
        body.dark-mode .checkbox-item:hover {
            background: #4a4a4a;
        }
        
        .checkbox-item input[type="checkbox"] {
            width: 16px;
            height: 16px;
            margin: 0;
        }
        
        .checkbox-item label {
            font-size: 13px;
            color: #2c3e50;
            cursor: pointer;
            margin: 0;
        }
        
        .measurement {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 8px 0;
            padding: 8px;
            background: #f8f9fa;
            border-radius: 4px;
        }
        
        .measurement label {
            font-size: 13px;
            color: #5d6d7e;
            flex-basis: 140px;
            flex-shrink: 0;
            margin: 0;
        }
        
        body.dark-mode .measurement label {
            color: #b0b0b0;
        }
        
        .input-field {
            width: 80px;
            padding: 6px 10px;
            border: 1px solid #bdc3c7;
            border-radius: 4px;
            font-size: 13px;
            text-align: center;
        }
        
        .input-field:focus {
            outline: none;
            border-color: #e74c3c;
            box-shadow: 0 0 0 2px rgba(231, 76, 60, 0.2);
        }

        .bilateral-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-top: 15px;
        }
        
        .side-container {
            padding: 15px;
            background: #ffffff;
            border: 1px solid #e8ecef;
            border-radius: 6px;
        }
        
        body.dark-mode .side-container {
            background: #383838;
            border-color: #555;
        }
        
        .side-header {
            font-weight: 600;
            font-size: 14px;
            color: #34495e;
            margin-bottom: 12px;
            text-align: center;
            border-bottom: 1px solid #f0f3f4;
            padding-bottom: 8px;
        }
        
        body.dark-mode .side-header {
            color: #e0e0e0;
            border-bottom-color: #555;
        }

        .subsection {
            margin-top: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 6px;
            border-left: 4px solid #e74c3c;
            display: none;
            animation: slideDown 0.3s ease;
        }
        
        body.dark-mode .subsection {
            background: #333;
        }
        
        .subsection.visible {
            display: block;
        }
        
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .severity-assessment {
            background: #fdf2f2;
            border: 1px solid #e74c3c;
            border-radius: 6px;
            padding: 15px;
            margin-top: 15px;
        }

        body.dark-mode .severity-assessment {
            background: #3d2a2a;
            border-color: #c0392b;
        }

        .severity-assessment h4 {
            color: #c53030;
            margin: 0 0 10px 0;
            font-size: 14px;
            font-weight: 600;
        }

        body.dark-mode .severity-assessment h4 {
            color: #f5a9b8;
        }

        .functional-assessment {
            background: #f3e5f5;
            border: 1px solid #9c27b0;
            border-radius: 6px;
            padding: 15px;
            margin-top: 15px;
        }

        body.dark-mode .functional-assessment {
            background: #2d1b2f;
            border-color: #7b1fa2;
        }

        .functional-assessment h4 {
            color: #7b1fa2;
            margin: 0 0 10px 0;
            font-size: 14px;
            font-weight: 600;
        }

        body.dark-mode .functional-assessment h4 {
            color: #d1a7dd;
        }

        .risk-assessment {
            background: #fff3e0;
            border: 1px solid #ff9800;
            border-radius: 6px;
            padding: 15px;
            margin-top: 15px;
        }

        body.dark-mode .risk-assessment {
            background: #2d2516;
            border-color: #e65100;
        }

        .risk-assessment h4 {
            color: #e65100;
            margin: 0 0 10px 0;
            font-size: 14px;
            font-weight: 600;
        }

        body.dark-mode .risk-assessment h4 {
            color: #ffb74d;
        }
        
        .warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 12px;
            border-radius: 6px;
            margin-top: 10px;
            font-size: 13px;
        }

        body.dark-mode .warning {
            background: #4d3e1a;
            border-color: #a67c00;
            color: #ffd93d;
        }
        
        .error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
            padding: 12px;
            border-radius: 6px;
            margin-top: 10px;
            font-size: 13px;
        }

        body.dark-mode .error {
            background: #4a1a1d;
            border-color: #8b2635;
            color: #f5a9b8;
        }
        
        .normal {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
            padding: 12px;
            border-radius: 6px;
            margin-top: 10px;
            font-size: 13px;
        }

        body.dark-mode .normal {
            background: #1e4620;
            border-color: #2e7d32;
            color: #75dd79;
        }
        
        .row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }
        
        .heart-sounds {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 15px;
        }

        .heart-focus {
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 12px;
            background: white;
        }

        body.dark-mode .heart-focus {
            background: #383838;
            border-color: #555;
        }

        .heart-focus h5 {
            margin: 0 0 10px 0;
            font-size: 13px;
            font-weight: 600;
            text-align: center;
            color: #e74c3c;
            border-bottom: 1px solid #f0f3f4;
            padding-bottom: 5px;
        }

        body.dark-mode .heart-focus h5 {
            color: #f5a9b8;
            border-bottom-color: #555;
        }

        .sound-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 4px 0;
            font-size: 12px;
        }

        .sound-checkboxes {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .sound-checkboxes input[type="checkbox"] {
            width: 14px;
            height: 14px;
        }

        .sound-checkboxes select {
            width: auto;
            padding: 2px 4px;
            font-size: 11px;
            border: 1px solid #ddd;
        }

        .pulse-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .pulse-group {
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 10px;
            background: white;
        }

        body.dark-mode .pulse-group {
            background: #383838;
            border-color: #555;
        }

        .pulse-group h5 {
            margin: 0 0 8px 0;
            font-size: 12px;
            font-weight: 600;
            text-align: center;
            color: #e74c3c;
            border-bottom: 1px solid #f0f3f4;
            padding-bottom: 4px;
        }

        body.dark-mode .pulse-group h5 {
            color: #f5a9b8;
            border-bottom-color: #555;
        }

        .pulse-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 3px 0;
            font-size: 11px;
        }

        .pulse-intensity {
            display: flex;
            gap: 4px;
            align-items: center;
        }

        .pulse-intensity input[type="radio"] {
            width: 12px;
            height: 12px;
            margin: 0;
        }

        .pulse-intensity label {
            font-size: 9px;
            margin: 0;
        }

        .score-calculation {
            background: #e8f5e8;
            border: 1px solid #4caf50;
            border-radius: 6px;
            padding: 15px;
            margin-top: 15px;
        }

        body.dark-mode .score-calculation {
            background: #1e2f1e;
            border-color: #2e7d32;
        }

        .score-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 6px 0;
            font-size: 13px;
        }

        .score-value {
            font-weight: 600;
            color: #2e7d32;
        }

        body.dark-mode .score-value {
            color: #75dd79;
        }

        /* === VISTA DIVIDIDA === */
        .split-view-container {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 20px;
            align-items: start;
        }
        
        .split-view-toggle {
            margin-bottom: 20px;
        }
        
        .sticky-conclusion {
            position: sticky;
            top: 20px;
            height: calc(100vh - 40px);
            overflow-y: auto;
        }
        
        .split-view-container .conclusion {
            margin-top: 0;
            height: 100%;
            display: flex;
            flex-direction: column;
        }
        
        .split-view-container .conclusion-text {
            flex: 1;
            min-height: 300px;
            resize: none;
        }

        .conclusion {
            margin-top: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-radius: 8px;
            border: 2px solid #dee2e6;
        }
        
        body.dark-mode .conclusion {
            background: linear-gradient(135deg, #333, #2a2a2a);
            border-color: #555;
        }
        
        .conclusion h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 18px;
        }
        
        body.dark-mode .conclusion h3 {
            color: #e0e0e0;
        }
        
        .conclusion-text {
            padding: 15px;
            background: white;
            border-radius: 6px;
            border: 1px solid #dee2e6;
            min-height: 200px;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            font-size: 12px;
            line-height: 1.4;
        }

        .control-buttons {
            margin-top: 20px;
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .btn-primary-old {
            background-color: #e74c3c;
            color: white;
        }

        .btn-primary-old:hover {
            background-color: #c0392b;
            transform: translateY(-1px);
        }

        .btn-secondary {
            background-color: #95a5a6;
            color: white;
        }

        .btn-secondary:hover {
            background-color: #7f8c8d;
            transform: translateY(-1px);
        }

        .legend {
            display: flex;
            gap: 20px;
            margin-bottom: 15px;
            font-size: 11px;
            flex-wrap: wrap;
            color: #7f8c8d;
        }

        body.dark-mode .legend {
            color: #b0b0b0;
        }

        .edema-assessment {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .edema-location {
            padding: 8px;
            background: #f8f9fa;
            border-radius: 4px;
            border: 1px solid #dee2e6;
        }

        body.dark-mode .edema-location {
            background: #404040;
            border-color: #555;
        }

        .edema-location label {
            font-size: 11px;
            margin-bottom: 4px;
            display: block;
        }

        .edema-location select {
            font-size: 11px;
            padding: 4px;
            width: 100%;
        }

        .range-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .range-container input[type="range"] {
            flex: 1;
        }

        .range-value {
            min-width: 30px;
            font-weight: 600;
            color: #e74c3c;
        }

        body.dark-mode .range-value {
            color: #f5a9b8;
        }
        
        /* === RESPONSIVIDAD === */
        @media (max-width: 1200px) {
            .sticky-panel {
                width: 350px;
            }
            
            .split-view-active .main-container {
                margin-right: 370px;
            }
        }

        @media (max-width: 768px) {
            body { padding-top: 120px; }
            
            .dashboard-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .control-bar {
                position: relative;
                top: auto;
                right: auto;
                justify-content: center;
                margin: 10px 0;
            }
            
            .nav-panel {
                transform: translateX(-100%);
                width: calc(100vw - 40px);
            }
            
            .main-container {
                margin: 0 10px;
            }
            
            .split-view .main-container {
                margin-left: 10px;
            }

            .sticky-panel {
                width: calc(100vw - 20px);
                right: -100vw;
                left: 10px;
                border-radius: 12px;
            }
            
            .sticky-panel.active {
                right: auto;
                left: 10px;
            }
            
            .split-view-active .main-container {
                margin-right: 10px;
            }
            
            .checkbox-grid {
                grid-template-columns: 1fr;
            }

            .split-view-container {
                grid-template-columns: 1fr;
            }
            
            .sticky-conclusion {
                position: static;
                height: auto;
            }
            
            .top-controls {
                position: static;
                justify-content: center;
                margin-bottom: 20px;
            }
            
            .top-controls .control-btn-old {
                padding: 8px 12px;
                font-size: 12px;
            }
        }
        
        /* === NUEVAS SECCIONES DIN√ÅMICAS === */
        .dynamic-section {
            margin-top: 15px;
            padding: 15px;
            background: #f0f8ff;
            border: 1px solid #3498db;
            border-radius: 6px;
            border-left: 4px solid #3498db;
            display: none;
            animation: slideDown 0.3s ease;
        }
        
        body.dark-mode .dynamic-section {
            background: #1e2a3a;
            border-color: #3498db;
        }
        
        .dynamic-section.visible {
            display: block;
        }
        
        .dynamic-section h4 {
            color: #2980b9;
            margin: 0 0 10px 0;
            font-size: 14px;
            font-weight: 600;
        }
        
        body.dark-mode .dynamic-section h4 {
            color: #74b9ff;
        }
        
        /* === TOOLTIP MEJORAS === */
        .tooltip-trigger {
            position: relative;
            cursor: help;
            color: #3498db;
        }
        
        .tooltip-trigger:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: #2c3e50;
            color: white;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 12px;
            white-space: nowrap;
            z-index: 1000;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }
        
        body.dark-mode .tooltip-trigger:hover::after {
            background: #ecf0f1;
            color: #2c3e50;
        }
        
        /* === NOTIFICACI√ìN COPIADO === */
        .copy-notification-old {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #27ae60;
            color: white;
            padding: 15px 25px;
            border-radius: 8px;
            font-weight: 600;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s ease;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }
        
        .copy-notification-old.show {
            opacity: 1;
        }
        
        body.dark-mode .copy-notification-old {
            background: #2d5a3d;
            color: #75dd79;
        }

        /* === ANIMACIONES A√ëADIDAS === */
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        @keyframes slideIn {
            from { transform: translateX(-20px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .slide-in {
            animation: slideIn 0.3s ease forwards;
        }
    </style>
</head>
<body>
    <!-- === CONTROLES SUPERIORES ORIGINALES MANTENIDOS === -->
    <div class="top-controls">
        <button class="control-btn-old" onclick="toggleSplitView()">
            <i class="fas fa-columns"></i> Vista Dividida
        </button>
        <button class="control-btn-old secondary" onclick="toggleDarkMode()">
            <i class="fas fa-moon"></i> Modo Oscuro
        </button>
        <a href="index.html" class="control-btn-old">
            <i class="fas fa-home"></i> Inicio
        </a>
    </div>

    <!-- === ELEMENTOS A√ëADIDOS === -->
    <!-- üåô TOGGLE DE TEMA -->
    <button class="theme-toggle" onclick="toggleTheme()" title="Cambiar tema">
        <i class="fas fa-moon" id="theme-icon"></i>
    </button>

    <!-- üè† BOT√ìN HOME -->
    <a href="index.html" class="home-button" title="Inicio">
        <i class="fas fa-home"></i>
    </a>

    <!-- üé™ DASHBOARD SUPERIOR FIJO A√ëADIDO -->
    <div class="dashboard-fixed">
        <div class="dashboard-content">
            <div class="dashboard-grid">
                <div class="dashboard-item">
                    <i class="fas fa-heartbeat"></i>
                    <div>Cardiovascular</div>
                    <div id="exam-progress">0%</div>
                </div>
                <div class="dashboard-item">
                    <i class="fas fa-clipboard-list"></i>
                    <div>Secciones</div>
                    <div id="sections-completed">0/7</div>
                </div>
                <div class="dashboard-item dashboard-alert" id="alerts-item">
                    <i class="fas fa-exclamation-triangle"></i>
                    <div>Alertas</div>
                    <div id="alert-count">0</div>
                </div>
                <div class="dashboard-item dashboard-warning" id="warnings-item">
                    <i class="fas fa-exclamation-circle"></i>
                    <div>Avisos</div>
                    <div id="warning-count">0</div>
                </div>
                <div class="dashboard-item dashboard-normal" id="findings-item">
                    <i class="fas fa-search"></i>
                    <div>Hallazgos</div>
                    <div id="findings-count">0</div>
                </div>
                <div class="dashboard-item">
                    <i class="fas fa-heartbeat"></i>
                    <div>Signos Vitales</div>
                    <div id="vitals-status">Pendiente</div>
                </div>
            </div>
            <div class="control-bar">
                <button class="control-btn btn-primary" onclick="toggleNavPanel()">
                    <i class="fas fa-bars"></i> Navegaci√≥n
                </button>
                <button class="control-btn btn-primary" onclick="toggleStickyPanel()" id="sticky-toggle-btn">
                    <i class="fas fa-columns"></i> Vista Dividida
                </button>
                <button class="control-btn btn-success" onclick="generateConclusion()">
                    <i class="fas fa-file-medical"></i> Generar
                </button>
                <button class="control-btn btn-warning" onclick="expandAllSections()">
                    <i class="fas fa-expand-alt"></i> Expandir
                </button>
                <button class="control-btn btn-danger" onclick="clearForm()">
                    <i class="fas fa-trash"></i> Limpiar
                </button>
            </div>
        </div>
    </div>

    <!-- üéØ PANEL LATERAL DE NAVEGACI√ìN A√ëADIDO -->
    <div class="nav-panel" id="nav-panel">
        <h3><i class="fas fa-map"></i> Navegaci√≥n R√°pida</h3>
        <div class="nav-item" onclick="scrollToSection('anamnesis')">
            <i class="fas fa-stethoscope"></i>
            <span>Anamnesis</span>
            <i class="fas fa-check" style="margin-left: auto; opacity: 0;" id="nav-anamnesis"></i>
        </div>
        <div class="nav-item" onclick="scrollToSection('signos-vitales')">
            <i class="fas fa-heartbeat"></i>
            <span>Signos Vitales</span>
            <i class="fas fa-check" style="margin-left: auto; opacity: 0;" id="nav-signos-vitales"></i>
        </div>
        <div class="nav-item" onclick="scrollToSection('examen-fisico')">
            <i class="fas fa-user-md"></i>
            <span>Examen F√≠sico</span>
            <i class="fas fa-check" style="margin-left: auto; opacity: 0;" id="nav-examen-fisico"></i>
        </div>
        <div class="nav-item" onclick="scrollToSection('auscultacion')">
            <i class="fas fa-stethoscope"></i>
            <span>Auscultaci√≥n</span>
            <i class="fas fa-check" style="margin-left: auto; opacity: 0;" id="nav-auscultacion"></i>
        </div>
        <div class="nav-item" onclick="scrollToSection('circulacion-periferica')">
            <i class="fas fa-wave-square"></i>
            <span>Circulaci√≥n</span>
            <i class="fas fa-check" style="margin-left: auto; opacity: 0;" id="nav-circulacion-periferica"></i>
        </div>
        <div class="nav-item" onclick="scrollToSection('vascular-periferico')">
            <i class="fas fa-heart-pulse"></i>
            <span>Vascular</span>
            <i class="fas fa-check" style="margin-left: auto; opacity: 0;" id="nav-vascular-periferico"></i>
        </div>
        <div class="nav-item" onclick="scrollToSection('electrocardiograma')">
            <i class="fas fa-heartbeat"></i>
            <span>ECG</span>
            <i class="fas fa-check" style="margin-left: auto; opacity: 0;" id="nav-electrocardiograma"></i>
        </div>
        <div class="nav-item" onclick="scrollToSection('escalas-riesgo')">
            <i class="fas fa-calculator"></i>
            <span>Escalas</span>
            <i class="fas fa-check" style="margin-left: auto; opacity: 0;" id="nav-escalas-riesgo"></i>
        </div>
    </div>

    <!-- üìä PANEL LATERAL STICKY A√ëADIDO -->
    <div class="sticky-panel" id="stickyConclusion">
        <div class="sticky-header">
            <span><i class="fas fa-file-medical-alt"></i> Informe Cardiovascular en Tiempo Real</span>
            <div class="sticky-controls">
                <button class="sticky-btn" onclick="copyStickyToClipboard()" title="Copiar informe">
                    <i class="fas fa-copy"></i>
                </button>
                <button class="sticky-btn" onclick="printStickyConclusion()" title="Imprimir informe">
                    <i class="fas fa-print"></i>
                </button>
                <button class="sticky-btn" onclick="generateStickyConclusion()" title="Actualizar informe">
                    <i class="fas fa-sync-alt"></i>
                </button>
            </div>
        </div>
        <div class="sticky-content" id="stickyContent">
            Seleccione los par√°metros del examen cardiovascular para generar el informe en tiempo real...
        </div>
        <div class="update-indicator" id="updateIndicator">
            <div class="spinner"></div>
            <span>Actualizando informe...</span>
        </div>
    </div>

    <!-- Notificaci√≥n de copia A√ëADIDA -->
    <div class="copy-notification" id="copyNotification">
        <i class="fas fa-check-circle"></i>
        <span>¬°Informe copiado al portapapeles!</span>
    </div>

    <!-- === NOTIFICACI√ìN DE COPIADO ORIGINAL MANTENIDA === -->
    <div class="copy-notification-old" id="copyNotificationOld">
        <i class="fas fa-check-circle"></i> ¬°Contenido copiado al portapapeles!
    </div>

    <div class="main-container" id="mainContainer">
        <h1><i class="fas fa-heartbeat section-icon"></i>Sistema Cardiovascular - Algoritmo de Examen</h1>
        
        <!-- === TOGGLE VISTA DIVIDIDA === -->


        <div class="content-wrapper" id="contentWrapper">
            <div class="form-sections">
                <!-- Anamnesis y Quejas Principales -->
                <div class="section">
                    <div class="section-header" onclick="toggleSection('anamnesis')">
                        <span><i class="fas fa-stethoscope section-icon"></i>Anamnesis y Quejas Principales</span>
                        <div style="display: flex; align-items: center;">
                            <div class="completion-badge" id="badge-anamnesis">
                                <i class="fas fa-circle"></i>
                            </div>
                            <span class="arrow">‚ñº</span>
                        </div>
                    </div>
                    <div class="section-content" id="anamnesis">
                        <div class="clinical-group">
                            <div class="clinical-group-header">
                                <i class="fas fa-exclamation-triangle"></i> Quejas Cardiovasculares
                            </div>
                            <div class="form-group">
                                <label>Quejas Cardiovasculares Principales:</label>
                                <div class="checkbox-grid">
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="sin-quejas" onchange="handleNoComplaints()">
                                        <label for="sin-quejas">Sin quejas</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="dolor-toracico" onchange="handleChestPainToggle()">
                                        <label for="dolor-toracico">Dolor tor√°cico</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="disnea" onchange="handleDyspneaToggle()">
                                        <label for="disnea">Disnea</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="palpitaciones">
                                        <label for="palpitaciones">Palpitaciones</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="sincope">
                                        <label for="sincope">S√≠ncope</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="presincope">
                                        <label for="presincope">Pres√≠ncope</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="edema">
                                        <label for="edema">Edema</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="fatiga">
                                        <label for="fatiga">Fatiga</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="ortopnea">
                                        <label for="ortopnea">Ortopnea</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="disnea-paroxistica">
                                        <label for="disnea-paroxistica">Disnea parox√≠stica nocturna</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="claudicacion">
                                        <label for="claudicacion">Claudicaci√≥n intermitente</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="cianosis">
                                        <label for="cianosis">Cianosis</label>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- === NUEVA SECCI√ìN DIN√ÅMICA: DOLOR TOR√ÅCICO DETALLADO === -->
                        <div class="dynamic-section" id="chest-pain-details">
                            <h4><i class="fas fa-heart-broken"></i> Evaluaci√≥n Detallada del Dolor Tor√°cico</h4>
                            <div class="severity-assessment">
                                <h4>Evaluaci√≥n del Dolor Tor√°cico</h4>
                                <div class="measurement">
                                    <label>Intensidad del dolor (EVA):</label>
                                    <div class="range-container">
                                        <input type="range" id="dolor-intensidad" min="0" max="10" value="0" oninput="updateDolorValue()">
                                        <span class="range-value" id="dolor-value">0</span><span>/10</span>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label>Caracter√≠sticas del dolor:</label>
                                    <div class="checkbox-grid">
                                        <div class="checkbox-item">
                                            <input type="radio" name="dolor-tipo" id="dolor-opresivo">
                                            <label for="dolor-opresivo">Opresivo <span class="tooltip-trigger" data-tooltip="Sensaci√≥n de peso o apret√≥n">‚ìò</span></label>
                                        </div>
                                        <div class="checkbox-item">
                                            <input type="radio" name="dolor-tipo" id="dolor-punzante">
                                            <label for="dolor-punzante">Punzante</label>
                                        </div>
                                        <div class="checkbox-item">
                                            <input type="radio" name="dolor-tipo" id="dolor-urente">
                                            <label for="dolor-urente">Urente</label>
                                        </div>
                                        <div class="checkbox-item">
                                            <input type="radio" name="dolor-tipo" id="dolor-pesadez">
                                            <label for="dolor-pesadez">Pesadez</label>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="form-group">
                                        <label>Irradiaci√≥n del dolor:</label>
                                        <div class="checkbox-grid">
                                            <div class="checkbox-item">
                                                <input type="checkbox" id="irradiacion-brazo-izq">
                                                <label for="irradiacion-brazo-izq">Brazo izquierdo</label>
                                            </div>
                                            <div class="checkbox-item">
                                                <input type="checkbox" id="irradiacion-mandibula">
                                                <label for="irradiacion-mandibula">Mand√≠bula</label>
                                            </div>
                                            <div class="checkbox-item">
                                                <input type="checkbox" id="irradiacion-espalda">
                                                <label for="irradiacion-espalda">Espalda</label>
                                            </div>
                                            <div class="checkbox-item">
                                                <input type="checkbox" id="irradiacion-cuello">
                                                <label for="irradiacion-cuello">Cuello</label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label>Duraci√≥n del episodio:</label>
                                        <select id="dolor-duracion">
                                            <option value="">Seleccione...</option>
                                            <option value="segundos">Segundos</option>
                                            <option value="minutos">Minutos (2-10)</option>
                                            <option value="prolongado">Prolongado (>20 min)</option>
                                            <option value="persistente">Persistente (horas)</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label>Factores desencadenantes:</label>
                                    <div class="checkbox-grid">
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="dolor-ejercicio">
                                            <label for="dolor-ejercicio">Ejercicio</label>
                                        </div>
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="dolor-emociones">
                                            <label for="dolor-emociones">Emociones</label>
                                        </div>
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="dolor-frio">
                                            <label for="dolor-frio">Fr√≠o</label>
                                        </div>
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="dolor-reposo">
                                            <label for="dolor-reposo">En reposo</label>
                                        </div>
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="dolor-movimientos">
                                            <label for="dolor-movimientos">Movimientos respiratorios</label>
                                        </div>
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="dolor-palpacion">
                                            <label for="dolor-palpacion">Palpaci√≥n tor√°cica</label>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label>Factores que alivian:</label>
                                    <div class="checkbox-grid">
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="alivio-reposo">
                                            <label for="alivio-reposo">Reposo</label>
                                        </div>
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="alivio-nitroglicerina">
                                            <label for="alivio-nitroglicerina">Nitroglicerina</label>
                                        </div>
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="alivio-antiacidos">
                                            <label for="alivio-antiacidos">Anti√°cidos</label>
                                        </div>
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="alivio-posicion">
                                            <label for="alivio-posicion">Cambio de posici√≥n</label>
                                        </div>
                                    </div>
                                </div>
                                <div class="score-item">
                                    <span>Probabilidad de origen coronario:</span>
                                    <span class="score-value" id="probabilidad-coronaria">--</span>
                                </div>
                            </div>
                        </div>

                        <!-- === NUEVA SECCI√ìN DIN√ÅMICA: DISNEA DETALLADA === -->
                        <div class="dynamic-section" id="dyspnea-details">
                            <h4><i class="fas fa-lungs"></i> Evaluaci√≥n Detallada de la Disnea</h4>
                            <div class="functional-assessment">
                                <h4>Evaluaci√≥n Funcional (NYHA)</h4>
                                <div class="form-group">
                                    <label>Tolerancia al ejercicio f√≠sico:</label>
                                    <select id="ejercicio-tolerancia" onchange="evaluateNYHA()">
                                        <option value="">Seleccione...</option>
                                        <option value="1">NYHA I - Sin limitaci√≥n de la actividad f√≠sica habitual</option>
                                        <option value="2">NYHA II - Ligera limitaci√≥n de la actividad f√≠sica habitual</option>
                                        <option value="3">NYHA III - Marcada limitaci√≥n de la actividad f√≠sica</option>
                                        <option value="4">NYHA IV - Incapacidad para cualquier actividad f√≠sica sin molestias</option>
                                    </select>
                                </div>
                                <div class="row">
                                    <div class="measurement">
                                        <label>Intensidad de disnea (EVA):</label>
                                        <div class="range-container">
                                            <input type="range" id="disnea-intensidad" min="0" max="10" value="0" oninput="updateDisneaValue()">
                                            <span class="range-value" id="disnea-value">0</span><span>/10</span>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label>Tipo de disnea:</label>
                                        <select id="disnea-tipo">
                                            <option value="">Seleccione...</option>
                                            <option value="esfuerzo">De esfuerzo</option>
                                            <option value="reposo">De reposo</option>
                                            <option value="ortopnea">Ortopnea</option>
                                            <option value="paroxistica">Parox√≠stica nocturna</option>
                                            <option value="platopnea">Platopnea</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label>S√≠ntomas asociados:</label>
                                    <div class="checkbox-grid">
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="disnea-tos">
                                            <label for="disnea-tos">Tos</label>
                                        </div>
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="disnea-esputo">
                                            <label for="disnea-esputo">Esputo</label>
                                        </div>
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="disnea-hemoptisis">
                                            <label for="disnea-hemoptisis">Hemoptisis</label>
                                        </div>
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="disnea-sibilancias">
                                            <label for="disnea-sibilancias">Sibilancias</label>
                                        </div>
                                    </div>
                                </div>
                                <div class="score-item">
                                    <span>Clase funcional NYHA:</span>
                                    <span class="score-value" id="nyha-class">--</span>
                                </div>
                            </div>
                        </div>

                        <div class="clinical-group">
                            <div class="clinical-group-header">
                                <i class="fas fa-pills"></i> Medicaci√≥n Cardiovascular Actual
                            </div>
                            <div class="form-group">
                                <label>Medicamentos cardiovasculares actuales:</label>
                                <textarea id="medicacion-actual" rows="4" 
                                    placeholder="Ejemplo: Enalapril 10mg BID, Metoprolol 50mg BID, Aspirina 100mg/d√≠a, Atorvastatina 20mg/d√≠a..."></textarea>
                            </div>
                        </div>

                        <div class="clinical-group">
                            <div class="clinical-group-header">
                                <i class="fas fa-history"></i> Antecedentes Cardiovasculares
                            </div>
                            <div class="form-group">
                                <label>Antecedentes Cardiovasculares:</label>
                                <div class="checkbox-grid">
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="hipertension">
                                        <label for="hipertension">Hipertensi√≥n arterial</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="diabetes">
                                        <label for="diabetes">Diabetes mellitus</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="dislipidemia">
                                        <label for="dislipidemia">Dislipidemia</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="tabaquismo">
                                        <label for="tabaquismo">Tabaquismo</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="iam-previo">
                                        <label for="iam-previo">IAM previo</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="icc-previa">
                                        <label for="icc-previa">Insuficiencia card√≠aca</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="fibrilacion-auricular">
                                        <label for="fibrilacion-auricular">Fibrilaci√≥n auricular</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="cirugia-cardiaca">
                                        <label for="cirugia-cardiaca">Cirug√≠a card√≠aca</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Signos Vitales y Par√°metros Hemodin√°micos -->
                <div class="section">
                    <div class="section-header" onclick="toggleSection('signos-vitales')">
                        <span><i class="fas fa-heartbeat section-icon"></i>Signos Vitales y Par√°metros Hemodin√°micos</span>
                        <div style="display: flex; align-items: center;">
                            <div class="completion-badge" id="badge-signos-vitales">
                                <i class="fas fa-circle"></i>
                            </div>
                            <span class="arrow">‚ñº</span>
                        </div>
                    </div>
                    <div class="section-content" id="signos-vitales">
                        <div class="clinical-group">
                            <div class="clinical-group-header">
                                <i class="fas fa-thermometer-three-quarters"></i> Signos Vitales Principales
                            </div>
                            <div class="row">
                                <div class="form-group">
                                    <label>Presi√≥n Arterial (brazo derecho):</label>
                                    <div class="measurement">
                                        <input type="number" id="pas-derecho" class="input-field" min="60" max="250" placeholder="120" onchange="evaluateBloodPressure()">
                                        <span>/</span>
                                        <input type="number" id="pad-derecho" class="input-field" min="30" max="150" placeholder="80" onchange="evaluateBloodPressure()">
                                        <span>mmHg</span>
                                        <span class="vital-indicator" id="pa-indicator"></span>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label>Presi√≥n Arterial (brazo izquierdo):</label>
                                    <div class="measurement">
                                        <input type="number" id="pas-izquierdo" class="input-field" min="60" max="250" placeholder="120" onchange="evaluateBloodPressure()">
                                        <span>/</span>
                                        <input type="number" id="pad-izquierdo" class="input-field" min="30" max="150" placeholder="80" onchange="evaluateBloodPressure()">
                                        <span>mmHg</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="subsection" id="pa-assessment">
                                <!-- La evaluaci√≥n se agregar√° din√°micamente -->
                            </div>
                            
                            <div class="row">
                                <div class="form-group">
                                    <label>Frecuencia Card√≠aca:</label>
                                    <div class="measurement">
                                        <input type="number" id="frecuencia-cardiaca" class="input-field" min="30" max="220" onchange="evaluateHeartRate()" placeholder="70">
                                        <span>lpm</span>
                                        <span class="vital-indicator" id="fc-indicator"></span>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label>Frecuencia Respiratoria:</label>
                                    <div class="measurement">
                                        <input type="number" id="frecuencia-respiratoria" class="input-field" min="8" max="40" placeholder="16">
                                        <span>rpm</span>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="form-group">
                                    <label>Saturaci√≥n de Ox√≠geno:</label>
                                    <div class="measurement">
                                        <input type="number" id="saturacion-oxigeno" class="input-field" min="70" max="100" placeholder="98" onchange="evaluateSaturation()">
                                        <span>%</span>
                                        <span class="vital-indicator" id="spo2-indicator"></span>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label>Temperatura:</label>
                                    <div class="measurement">
                                        <input type="number" id="temperatura" class="input-field" min="35" max="42" step="0.1" placeholder="36.5">
                                        <span>¬∞C</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="clinical-group">
                            <div class="clinical-group-header">
                                <i class="fas fa-wave-square"></i> Caracter√≠sticas del Pulso
                            </div>
                            <div class="form-group">
                                <label>Caracter√≠sticas del pulso:</label>
                                <select id="pulso-caracter" onchange="handlePulseCharacter()">
                                    <option value="">Seleccione...</option>
                                    <option value="ritmico-normal">R√≠tmico, de buen llenado</option>
                                    <option value="ritmico-debil">R√≠tmico, de llenado d√©bil</option>
                                    <option value="ritmico-lleno">R√≠tmico, lleno</option>
                                    <option value="arritmico">Arr√≠tmico</option>
                                    <option value="no-palpable">No palpable</option>
                                </select>
                            </div>
                            
                            <div class="subsection" id="pulso-detalles">
                                <div class="form-group">
                                    <label>Tipo de arritmia:</label>
                                    <select id="arritmia-tipo">
                                        <option value="">Seleccione...</option>
                                        <option value="extrasistoles">Extras√≠stoles</option>
                                        <option value="fibrilacion-auricular">Fibrilaci√≥n auricular</option>
                                        <option value="flutter-auricular">Flutter auricular</option>
                                        <option value="ritmo-irregular">Ritmo irregular</option>
                                    </select>
                                </div>
                                
                                <div class="measurement">
                                    <label>D√©ficit de pulso:</label>
                                    <input type="number" id="deficit-pulso" class="input-field" min="0" max="100">
                                    <span>lpm</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Examen F√≠sico Cardiovascular -->
                <div class="section">
                    <div class="section-header" onclick="toggleSection('examen-fisico')">
                        <span><i class="fas fa-user-md section-icon"></i>Examen F√≠sico Cardiovascular</span>
                        <div style="display: flex; align-items: center;">
                            <div class="completion-badge" id="badge-examen-fisico">
                                <i class="fas fa-circle"></i>
                            </div>
                            <span class="arrow">‚ñº</span>
                        </div>
                    </div>
                    <div class="section-content" id="examen-fisico">
                        <div class="clinical-group">
                            <div class="clinical-group-header">
                                <i class="fas fa-eye"></i> Inspecci√≥n General
                            </div>
                            <div class="form-group">
                                <label>Aspecto General:</label>
                                <div class="checkbox-grid">
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="aspecto-normal">
                                        <label for="aspecto-normal">Aspecto general normal</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="palidez">
                                        <label for="palidez">Palidez</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="cianosis-central">
                                        <label for="cianosis-central">Cianosis central</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="cianosis-periferica">
                                        <label for="cianosis-periferica">Cianosis perif√©rica</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="diaforesis">
                                        <label for="diaforesis">Diaforesis</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="ingurgitacion-yugular">
                                        <label for="ingurgitacion-yugular">Ingurgitaci√≥n yugular</label>
                                    </div>
                                </div>
                            </div>

                            <div class="form-group">
                                <label>Inspecci√≥n de la regi√≥n card√≠aca:</label>
                                <select id="inspeccion-cardiaca" onchange="handleInspeccionCardiaca()">
                                    <option value="">Seleccione...</option>
                                    <option value="normal">No se observan cambios patol√≥gicos</option>
                                    <option value="latido-apical-visible">Latido apical visible</option>
                                    <option value="deformidad-toracica">Deformidad del t√≥rax en regi√≥n card√≠aca</option>
                                    <option value="giba-cardiaca">Giba card√≠aca</option>
                                    <option value="pulsacion-patologica">Pulsaci√≥n patol√≥gica visible</option>
                                </select>
                            </div>
                            
                            <div class="subsection" id="inspeccion-detalles">
                                <div class="form-group">
                                    <label>Descripci√≥n de los cambios:</label>
                                    <textarea id="inspeccion-descripcion" rows="3" placeholder="Describa la localizaci√≥n, car√°cter e intensidad de los cambios observados..."></textarea>
                                </div>
                            </div>
                        </div>

                        <div class="clinical-group">
                            <div class="clinical-group-header">
                                <i class="fas fa-hand-paper"></i> Palpaci√≥n Card√≠aca
                            </div>
                            <div class="form-group">
                                <label>Palpaci√≥n del latido apical:</label>
                                <select id="latido-apical" onchange="handleLatidoApical()">
                                    <option value="">Seleccione...</option>
                                    <option value="normal">V EIC en l√≠nea medioclavicular izquierda</option>
                                    <option value="desplazado-izquierda">Desplazado a la izquierda</option>
                                    <option value="desplazado-abajo">Desplazado hacia abajo</option>
                                    <option value="desplazado-izquierda-abajo">Desplazado a la izquierda y abajo</option>
                                    <option value="debilitado">Debilitado</option>
                                    <option value="aumentado">Aumentado</option>
                                    <option value="no-palpable">No palpable</option>
                                </select>
                            </div>
                            
                            <div class="subsection" id="latido-detalles">
                                <div class="measurement">
                                    <label>Localizaci√≥n espec√≠fica:</label>
                                    <input type="text" id="latido-localizacion" placeholder="ej: VI espacio intercostal, fuera de l√≠nea medioclavicular">
                                </div>
                                <div class="form-group">
                                    <label>Caracter√≠sticas del latido:</label>
                                    <div class="checkbox-grid">
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="latido-difuso">
                                            <label for="latido-difuso">Difuso</label>
                                        </div>
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="latido-fuerte">
                                            <label for="latido-fuerte">Fuerte</label>
                                        </div>
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="latido-prolongado">
                                            <label for="latido-prolongado">Prolongado</label>
                                        </div>
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="latido-sostenido">
                                            <label for="latido-sostenido">Sostenido</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="clinical-group">
                            <div class="clinical-group-header">
                                <i class="fas fa-hand-fist"></i> Percusi√≥n Card√≠aca
                            </div>
                            <div class="form-group">
                                <label>Percusi√≥n de l√≠mites card√≠acos:</label>
                                <select id="limites-cardiacos" onchange="handleLimitesCardiacos()">
                                    <option value="">Seleccione...</option>
                                    <option value="normales">Dentro de l√≠mites normales</option>
                                    <option value="agrandados-izquierda">Agrandados a la izquierda</option>
                                    <option value="agrandados-derecha">Agrandados a la derecha</option>
                                    <option value="agrandados-superior">Agrandados hacia arriba</option>
                                    <option value="agrandados-todas">Agrandados en todas las direcciones</option>
                                </select>
                            </div>
                            
                            <div class="subsection" id="limites-detalles">
                                <div class="row">
                                    <div class="measurement">
                                        <label>L√≠mite derecho:</label>
                                        <input type="text" id="limite-derecho" placeholder="ej: IV EIC, borde derecho esternal">
                                    </div>
                                    <div class="measurement">
                                        <label>L√≠mite izquierdo:</label>
                                        <input type="text" id="limite-izquierdo" placeholder="ej: V EIC, 2 cm fuera de l√≠nea medioclavicular">
                                    </div>
                                    <div class="measurement">
                                        <label>L√≠mite superior:</label>
                                        <input type="text" id="limite-superior" placeholder="ej: III espacio intercostal">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>Otros hallazgos palpatorios:</label>
                            <div class="checkbox-grid">
                                <div class="checkbox-item">
                                    <input type="checkbox" id="fremito-sistolico">
                                    <label for="fremito-sistolico">Fr√©mito sist√≥lico</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="fremito-diastolico">
                                    <label for="fremito-diastolico">Fr√©mito diast√≥lico</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="levantamiento-paraesternal">
                                    <label for="levantamiento-paraesternal">Levantamiento paraesternal</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="p2-palpable">
                                    <label for="p2-palpable">P2 palpable</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Auscultaci√≥n Card√≠aca -->
                <div class="section">
                    <div class="section-header" onclick="toggleSection('auscultacion')">
                        <span><i class="fas fa-stethoscope section-icon"></i>Auscultaci√≥n Card√≠aca</span>
                        <div style="display: flex; align-items: center;">
                            <div class="completion-badge" id="badge-auscultacion">
                                <i class="fas fa-circle"></i>
                            </div>
                            <span class="arrow">‚ñº</span>
                        </div>
                    </div>
                    <div class="section-content" id="auscultacion">
                        <div class="heart-sounds">
                            <div class="heart-focus">
                                <h5>Foco A√≥rtico (2¬∞ EIC derecho)</h5>
                                <div class="sound-item">
                                    <span>R1</span>
                                    <div class="sound-checkboxes">
                                        <select id="r1-aortico">
                                            <option value="">-</option>
                                            <option value="abolido">Abolido</option>
                                            <option value="hipofonico">Hipofon√©tico</option>
                                            <option value="normal">Normal</option>
                                            <option value="hiperfonico">Hiperfon√©tico</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="sound-item">
                                    <span>R2</span>
                                    <div class="sound-checkboxes">
                                        <select id="r2-aortico">
                                            <option value="">-</option>
                                            <option value="abolido">Abolido</option>
                                            <option value="hipofonico">Hipofon√©tico</option>
                                            <option value="normal">Normal</option>
                                            <option value="hiperfonico">Hiperfon√©tico</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="sound-item">
                                    <span>Soplo sist√≥lico</span>
                                    <div class="sound-checkboxes">
                                        <input type="checkbox" id="soplo-sist-aortico" onchange="handleMurmurToggle('aortico', 'sist')">
                                        <select id="soplo-sist-aortico-grado">
                                            <option value="">-</option>
                                            <option value="1">I/VI</option>
                                            <option value="2">II/VI</option>
                                            <option value="3">III/VI</option>
                                            <option value="4">IV/VI</option>
                                            <option value="5">V/VI</option>
                                            <option value="6">VI/VI</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="sound-item">
                                    <span>Soplo diast√≥lico</span>
                                    <div class="sound-checkboxes">
                                        <input type="checkbox" id="soplo-diast-aortico" onchange="handleMurmurToggle('aortico', 'diast')">
                                        <select id="soplo-diast-aortico-grado">
                                            <option value="">-</option>
                                            <option value="1">I/VI</option>
                                            <option value="2">II/VI</option>
                                            <option value="3">III/VI</option>
                                            <option value="4">IV/VI</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="heart-focus">
                                <h5>Foco Pulmonar (2¬∞ EIC izquierdo)</h5>
                                <div class="sound-item">
                                    <span>R1</span>
                                    <div class="sound-checkboxes">
                                        <select id="r1-pulmonar">
                                            <option value="">-</option>
                                            <option value="abolido">Abolido</option>
                                            <option value="hipofonico">Hipofon√©tico</option>
                                            <option value="normal">Normal</option>
                                            <option value="hiperfonico">Hiperfon√©tico</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="sound-item">
                                    <span>R2</span>
                                    <div class="sound-checkboxes">
                                        <select id="r2-pulmonar">
                                            <option value="">-</option>
                                            <option value="abolido">Abolido</option>
                                            <option value="hipofonico">Hipofon√©tico</option>
                                            <option value="normal">Normal</option>
                                            <option value="hiperfonico">Hiperfon√©tico</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="sound-item">
                                    <span>Desdoblamiento R2</span>
                                    <div class="sound-checkboxes">
                                        <input type="checkbox" id="desdoblamiento-r2">
                                    </div>
                                </div>
                                <div class="sound-item">
                                    <span>Soplo sist√≥lico</span>
                                    <div class="sound-checkboxes">
                                        <input type="checkbox" id="soplo-sist-pulmonar" onchange="handleMurmurToggle('pulmonar', 'sist')">
                                        <select id="soplo-sist-pulmonar-grado">
                                            <option value="">-</option>
                                            <option value="1">I/VI</option>
                                            <option value="2">II/VI</option>
                                            <option value="3">III/VI</option>
                                            <option value="4">IV/VI</option>
                                            <option value="5">V/VI</option>
                                            <option value="6">VI/VI</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <div class="heart-focus">
                                <h5>Foco Tric√∫spide (4¬∞ EIC izquierdo)</h5>
                                <div class="sound-item">
                                    <span>R1</span>
                                    <div class="sound-checkboxes">
                                        <select id="r1-tricuspide">
                                            <option value="">-</option>
                                            <option value="abolido">Abolido</option>
                                            <option value="hipofonico">Hipofon√©tico</option>
                                            <option value="normal">Normal</option>
                                            <option value="hiperfonico">Hiperfon√©tico</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="sound-item">
                                    <span>R2</span>
                                    <div class="sound-checkboxes">
                                        <select id="r2-tricuspide">
                                            <option value="">-</option>
                                            <option value="abolido">Abolido</option>
                                            <option value="hipofonico">Hipofon√©tico</option>
                                            <option value="normal">Normal</option>
                                            <option value="hiperfonico">Hiperfon√©tico</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="sound-item">
                                    <span>Soplo sist√≥lico</span>
                                    <div class="sound-checkboxes">
                                        <input type="checkbox" id="soplo-sist-tricuspide" onchange="handleMurmurToggle('tricuspide', 'sist')">
                                        <select id="soplo-sist-tricuspide-grado">
                                            <option value="">-</option>
                                            <option value="1">I/VI</option>
                                            <option value="2">II/VI</option>
                                            <option value="3">III/VI</option>
                                            <option value="4">IV/VI</option>
                                            <option value="5">V/VI</option>
                                            <option value="6">VI/VI</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <div class="heart-focus">
                                <h5>Foco Mitral (5¬∞ EIC izquierdo)</h5>
                                <div class="sound-item">
                                    <span>R1</span>
                                    <div class="sound-checkboxes">
                                        <select id="r1-mitral">
                                            <option value="">-</option>
                                            <option value="abolido">Abolido</option>
                                            <option value="hipofonico">Hipofon√©tico</option>
                                            <option value="normal">Normal</option>
                                            <option value="hiperfonico">Hiperfon√©tico</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="sound-item">
                                    <span>R2</span>
                                    <div class="sound-checkboxes">
                                        <select id="r2-mitral">
                                            <option value="">-</option>
                                            <option value="abolido">Abolido</option>
                                            <option value="hipofonico">Hipofon√©tico</option>
                                            <option value="normal">Normal</option>
                                            <option value="hiperfonico">Hiperfon√©tico</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="sound-item">
                                    <span>Soplo sist√≥lico</span>
                                    <div class="sound-checkboxes">
                                        <input type="checkbox" id="soplo-sist-mitral" onchange="handleMurmurToggle('mitral', 'sist')">
                                        <select id="soplo-sist-mitral-grado">
                                            <option value="">-</option>
                                            <option value="1">I/VI</option>
                                            <option value="2">II/VI</option>
                                            <option value="3">III/VI</option>
                                            <option value="4">IV/VI</option>
                                            <option value="5">V/VI</option>
                                            <option value="6">VI/VI</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="sound-item">
                                    <span>Soplo diast√≥lico</span>
                                    <div class="sound-checkboxes">
                                        <input type="checkbox" id="soplo-diast-mitral" onchange="handleMurmurToggle('mitral', 'diast')">
                                        <select id="soplo-diast-mitral-grado">
                                            <option value="">-</option>
                                            <option value="1">I/VI</option>
                                            <option value="2">II/VI</option>
                                            <option value="3">III/VI</option>
                                            <option value="4">IV/VI</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- === NUEVA SECCI√ìN DIN√ÅMICA: DETALLES DE SOPLOS === -->
                        <div class="dynamic-section" id="murmur-details">
                            <h4><i class="fas fa-wave-square"></i> Caracter√≠sticas Detalladas de Soplos</h4>
                            <div class="form-group">
                                <label>Irradiaci√≥n del soplo:</label>
                                <div class="checkbox-grid">
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="irradiacion-axila">
                                        <label for="irradiacion-axila">Hacia axila</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="irradiacion-cuello-soplo">
                                        <label for="irradiacion-cuello-soplo">Hacia cuello</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="irradiacion-espalda-soplo">
                                        <label for="irradiacion-espalda-soplo">Hacia espalda</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="irradiacion-punta">
                                        <label for="irradiacion-punta">Hacia punta</label>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="form-group">
                                    <label>Relaci√≥n con respiraci√≥n:</label>
                                    <select id="soplo-respiracion">
                                        <option value="">Seleccione...</option>
                                        <option value="aumenta-inspiracion">Aumenta con inspiraci√≥n</option>
                                        <option value="disminuye-inspiracion">Disminuye con inspiraci√≥n</option>
                                        <option value="no-cambia">No cambia con respiraci√≥n</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Relaci√≥n con maniobras:</label>
                                    <select id="soplo-maniobras">
                                        <option value="">Seleccione...</option>
                                        <option value="aumenta-valsalva">Aumenta con Valsalva</option>
                                        <option value="disminuye-valsalva">Disminuye con Valsalva</option>
                                        <option value="aumenta-handgrip">Aumenta con handgrip</option>
                                        <option value="disminuye-handgrip">Disminuye con handgrip</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>Descripci√≥n adicional del soplo:</label>
                                <textarea id="soplo-descripcion-detallada" rows="3" 
                                    placeholder="Describe tono, timbre, forma del soplo (crescendo, decrescendo, holosist√≥lico, etc.)..."></textarea>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>Otros hallazgos auscultatorios:</label>
                            <div class="checkbox-grid">
                                <div class="checkbox-item">
                                    <input type="checkbox" id="r3-galope">
                                    <label for="r3-galope">R3 (galope ventricular)</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="r4-galope">
                                    <label for="r4-galope">R4 (galope auricular)</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="click-sistolico">
                                    <label for="click-sistolico">Click sist√≥lico</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="chasquido-apertura">
                                    <label for="chasquido-apertura">Chasquido de apertura</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="roce-pericardico">
                                    <label for="roce-pericardico">Roce peric√°rdico</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="arritmia-auscultacion">
                                    <label for="arritmia-auscultacion">Arritmia auscultada</label>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>Caracter√≠sticas detalladas de soplos:</label>
                            <textarea id="soplos-descripcion" rows="4" placeholder="Describa localizaci√≥n, irradiaci√≥n, intensidad, relaci√≥n con respiraci√≥n y maniobras..."></textarea>
                        </div>
                    </div>
                </div>
                
                <!-- Circulaci√≥n Perif√©rica y Edemas -->
                <div class="section">
                    <div class="section-header" onclick="toggleSection('circulacion-periferica')">
                        <span><i class="fas fa-wave-square section-icon"></i>Circulaci√≥n Perif√©rica y Edemas</span>
                        <div style="display: flex; align-items: center;">
                            <div class="completion-badge" id="badge-circulacion-periferica">
                                <i class="fas fa-circle"></i>
                            </div>
                            <span class="arrow">‚ñº</span>
                        </div>
                    </div>
                    <div class="section-content" id="circulacion-periferica">
                        <div class="form-group">
                            <label>Presencia de edemas:</label>
                            <select id="edemas-presencia" onchange="handleEdemas()">
                                <option value="">Seleccione...</option>
                                <option value="sin-edemas">Sin edemas</option>
                                <option value="edemas-perifericos">Edemas perif√©ricos</option>
                                <option value="edema-pulmonar">Signos de edema pulmonar</option>
                                <option value="anasarca">Anasarca</option>
                                <option value="ascitis">Ascitis</option>
                            </select>
                        </div>
                        
                        <div class="subsection" id="edemas-detalles">
                            <div class="form-group">
                                <label>Localizaci√≥n e intensidad de edemas:</label>
                                <div class="edema-assessment">
                                    <div class="edema-location">
                                        <label>Pies:</label>
                                        <select id="edema-pies">
                                            <option value="0">0</option>
                                            <option value="1">+</option>
                                            <option value="2">++</option>
                                            <option value="3">+++</option>
                                            <option value="4">++++</option>
                                        </select>
                                    </div>
                                    <div class="edema-location">
                                        <label>Piernas:</label>
                                        <select id="edema-piernas">
                                            <option value="0">0</option>
                                            <option value="1">+</option>
                                            <option value="2">++</option>
                                            <option value="3">+++</option>
                                            <option value="4">++++</option>
                                        </select>
                                    </div>
                                    <div class="edema-location">
                                        <label>Muslos:</label>
                                        <select id="edema-muslos">
                                            <option value="0">0</option>
                                            <option value="1">+</option>
                                            <option value="2">++</option>
                                            <option value="3">+++</option>
                                            <option value="4">++++</option>
                                        </select>
                                    </div>
                                    <div class="edema-location">
                                        <label>Regi√≥n sacra:</label>
                                        <select id="edema-sacro">
                                            <option value="0">0</option>
                                            <option value="1">+</option>
                                            <option value="2">++</option>
                                            <option value="3">+++</option>
                                            <option value="4">++++</option>
                                        </select>
                                    </div>
                                    <div class="edema-location">
                                        <label>P√°rpados:</label>
                                        <select id="edema-parpados">
                                            <option value="0">0</option>
                                            <option value="1">+</option>
                                            <option value="2">++</option>
                                            <option value="3">+++</option>
                                        </select>
                                    </div>
                                    <div class="edema-location">
                                        <label>Abdomen:</label>
                                        <select id="edema-abdomen">
                                            <option value="0">0</option>
                                            <option value="1">+</option>
                                            <option value="2">++</option>
                                            <option value="3">+++</option>
                                            <option value="4">++++</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label>Caracter√≠sticas de los edemas:</label>
                                <div class="checkbox-grid">
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="edema-simetrico">
                                        <label for="edema-simetrico">Sim√©tricos</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="edema-fovea">
                                        <label for="edema-fovea">Deja f√≥vea</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="edema-frio">
                                        <label for="edema-frio">Fr√≠o al tacto</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="edema-caliente">
                                        <label for="edema-caliente">Caliente al tacto</label>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>Estado de las venas:</label>
                            <select id="venas-estado" onchange="handleVenas()">
                                <option value="">Seleccione...</option>
                                <option value="normales">No dilatadas</option>
                                <option value="varices">Varicosamente dilatadas</option>
                                <option value="ingurgitacion-yugular">Ingurgitaci√≥n yugular</option>
                                <option value="reflujo-hepatoyugular">Reflujo hepatoyugular positivo</option>
                            </select>
                        </div>
                        
                        <div class="subsection" id="venas-detalles">
                            <div class="form-group">
                                <label>Descripci√≥n de cambios venosos:</label>
                                <textarea id="venas-descripcion" rows="3" placeholder="Describa localizaci√≥n, grado, presencia de complicaciones..."></textarea>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>Color de la piel:</label>
                            <select id="color-piel">
                                <option value="">Seleccione...</option>
                                <option value="normal">Normal</option>
                                <option value="palido">P√°lido</option>
                                <option value="cianotico">Cian√≥tico</option>
                                <option value="acrocianosis">Acrocianosis</option>
                                <option value="marmoreo">Piel marm√≥rea</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <!-- Examen Vascular Perif√©rico -->
                <div class="section">
                    <div class="section-header" onclick="toggleSection('vascular-periferico')">
                        <span><i class="fas fa-heart-pulse section-icon"></i>Examen Vascular Perif√©rico</span>
                        <div style="display: flex; align-items: center;">
                            <div class="completion-badge" id="badge-vascular-periferico">
                                <i class="fas fa-circle"></i>
                            </div>
                            <span class="arrow">‚ñº</span>
                        </div>
                    </div>
                    <div class="section-content" id="vascular-periferico">
                        <div class="bilateral-container">
                            <div class="side-container">
                                <div class="side-header">Lado Derecho</div>
                                <div class="pulse-grid">
                                    <div class="pulse-group">
                                        <h5>Miembros Superiores</h5>
                                        <div class="pulse-item">
                                            <span>Radial</span>
                                            <div class="pulse-intensity">
                                                <input type="radio" name="radial-der" id="radial-der-0" value="0"><label>0</label>
                                                <input type="radio" name="radial-der" id="radial-der-1" value="1"><label>1+</label>
                                                <input type="radio" name="radial-der" id="radial-der-2" value="2"><label>2+</label>
                                                <input type="radio" name="radial-der" id="radial-der-3" value="3"><label>3+</label>
                                                <input type="radio" name="radial-der" id="radial-der-4" value="4"><label>4+</label>
                                            </div>
                                        </div>
                                        <div class="pulse-item">
                                            <span>Cubital</span>
                                            <div class="pulse-intensity">
                                                <input type="radio" name="cubital-der" id="cubital-der-0" value="0"><label>0</label>
                                                <input type="radio" name="cubital-der" id="cubital-der-1" value="1"><label>1+</label>
                                                <input type="radio" name="cubital-der" id="cubital-der-2" value="2"><label>2+</label>
                                                <input type="radio" name="cubital-der" id="cubital-der-3" value="3"><label>3+</label>
                                                <input type="radio" name="cubital-der" id="cubital-der-4" value="4"><label>4+</label>
                                            </div>
                                        </div>
                                        <div class="pulse-item">
                                            <span>Braquial</span>
                                            <div class="pulse-intensity">
                                                <input type="radio" name="braquial-der" id="braquial-der-0" value="0"><label>0</label>
                                                <input type="radio" name="braquial-der" id="braquial-der-1" value="1"><label>1+</label>
                                                <input type="radio" name="braquial-der" id="braquial-der-2" value="2"><label>2+</label>
                                                <input type="radio" name="braquial-der" id="braquial-der-3" value="3"><label>3+</label>
                                                <input type="radio" name="braquial-der" id="braquial-der-4" value="4"><label>4+</label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="pulse-group">
                                        <h5>Miembros Inferiores</h5>
                                        <div class="pulse-item">
                                            <span>Femoral</span>
                                            <div class="pulse-intensity">
                                                <input type="radio" name="femoral-der" id="femoral-der-0" value="0"><label>0</label>
                                                <input type="radio" name="femoral-der" id="femoral-der-1" value="1"><label>1+</label>
                                                <input type="radio" name="femoral-der" id="femoral-der-2" value="2"><label>2+</label>
                                                <input type="radio" name="femoral-der" id="femoral-der-3" value="3"><label>3+</label>
                                                <input type="radio" name="femoral-der" id="femoral-der-4" value="4"><label>4+</label>
                                            </div>
                                        </div>
                                        <div class="pulse-item">
                                            <span>Popl√≠teo</span>
                                            <div class="pulse-intensity">
                                                <input type="radio" name="popliteo-der" id="popliteo-der-0" value="0"><label>0</label>
                                                <input type="radio" name="popliteo-der" id="popliteo-der-1" value="1"><label>1+</label>
                                                <input type="radio" name="popliteo-der" id="popliteo-der-2" value="2"><label>2+</label>
                                                <input type="radio" name="popliteo-der" id="popliteo-der-3" value="3"><label>3+</label>
                                                <input type="radio" name="popliteo-der" id="popliteo-der-4" value="4"><label>4+</label>
                                            </div>
                                        </div>
                                        <div class="pulse-item">
                                            <span>Tibial posterior</span>
                                            <div class="pulse-intensity">
                                                <input type="radio" name="tibial-post-der" id="tibial-post-der-0" value="0"><label>0</label>
                                                <input type="radio" name="tibial-post-der" id="tibial-post-der-1" value="1"><label>1+</label>
                                                <input type="radio" name="tibial-post-der" id="tibial-post-der-2" value="2"><label>2+</label>
                                                <input type="radio" name="tibial-post-der" id="tibial-post-der-3" value="3"><label>3+</label>
                                                <input type="radio" name="tibial-post-der" id="tibial-post-der-4" value="4"><label>4+</label>
                                            </div>
                                        </div>
                                        <div class="pulse-item">
                                            <span>Pedio</span>
                                            <div class="pulse-intensity">
                                                <input type="radio" name="pedio-der" id="pedio-der-0" value="0"><label>0</label>
                                                <input type="radio" name="pedio-der" id="pedio-der-1" value="1"><label>1+</label>
                                                <input type="radio" name="pedio-der" id="pedio-der-2" value="2"><label>2+</label>
                                                <input type="radio" name="pedio-der" id="pedio-der-3" value="3"><label>3+</label>
                                                <input type="radio" name="pedio-der" id="pedio-der-4" value="4"><label>4+</label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="side-container">
                                <div class="side-header">Lado Izquierdo</div>
                                <div class="pulse-grid">
                                    <div class="pulse-group">
                                        <h5>Miembros Superiores</h5>
                                        <div class="pulse-item">
                                            <span>Radial</span>
                                            <div class="pulse-intensity">
                                                <input type="radio" name="radial-izq" id="radial-izq-0" value="0"><label>0</label>
                                                <input type="radio" name="radial-izq" id="radial-izq-1" value="1"><label>1+</label>
                                                <input type="radio" name="radial-izq" id="radial-izq-2" value="2"><label>2+</label>
                                                <input type="radio" name="radial-izq" id="radial-izq-3" value="3"><label>3+</label>
                                                <input type="radio" name="radial-izq" id="radial-izq-4" value="4"><label>4+</label>
                                            </div>
                                        </div>
                                        <div class="pulse-item">
                                            <span>Cubital</span>
                                            <div class="pulse-intensity">
                                                <input type="radio" name="cubital-izq" id="cubital-izq-0" value="0"><label>0</label>
                                                <input type="radio" name="cubital-izq" id="cubital-izq-1" value="1"><label>1+</label>
                                                <input type="radio" name="cubital-izq" id="cubital-izq-2" value="2"><label>2+</label>
                                                <input type="radio" name="cubital-izq" id="cubital-izq-3" value="3"><label>3+</label>
                                                <input type="radio" name="cubital-izq" id="cubital-izq-4" value="4"><label>4+</label>
                                            </div>
                                        </div>
                                        <div class="pulse-item">
                                            <span>Braquial</span>
                                            <div class="pulse-intensity">
                                                <input type="radio" name="braquial-izq" id="braquial-izq-0" value="0"><label>0</label>
                                                <input type="radio" name="braquial-izq" id="braquial-izq-1" value="1"><label>1+</label>
                                                <input type="radio" name="braquial-izq" id="braquial-izq-2" value="2"><label>2+</label>
                                                <input type="radio" name="braquial-izq" id="braquial-izq-3" value="3"><label>3+</label>
                                                <input type="radio" name="braquial-izq" id="braquial-izq-4" value="4"><label>4+</label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="pulse-group">
                                        <h5>Miembros Inferiores</h5>
                                        <div class="pulse-item">
                                            <span>Femoral</span>
                                            <div class="pulse-intensity">
                                                <input type="radio" name="femoral-izq" id="femoral-izq-0" value="0"><label>0</label>
                                                <input type="radio" name="femoral-izq" id="femoral-izq-1" value="1"><label>1+</label>
                                                <input type="radio" name="femoral-izq" id="femoral-izq-2" value="2"><label>2+</label>
                                                <input type="radio" name="femoral-izq" id="femoral-izq-3" value="3"><label>3+</label>
                                                <input type="radio" name="femoral-izq" id="femoral-izq-4" value="4"><label>4+</label>
                                            </div>
                                        </div>
                                        <div class="pulse-item">
                                            <span>Popl√≠teo</span>
                                            <div class="pulse-intensity">
                                                <input type="radio" name="popliteo-izq" id="popliteo-izq-0" value="0"><label>0</label>
                                                <input type="radio" name="popliteo-izq" id="popliteo-izq-1" value="1"><label>1+</label>
                                                <input type="radio" name="popliteo-izq" id="popliteo-izq-2" value="2"><label>2+</label>
                                                <input type="radio" name="popliteo-izq" id="popliteo-izq-3" value="3"><label>3+</label>
                                                <input type="radio" name="popliteo-izq" id="popliteo-izq-4" value="4"><label>4+</label>
                                            </div>
                                        </div>
                                        <div class="pulse-item">
                                            <span>Tibial posterior</span>
                                            <div class="pulse-intensity">
                                                <input type="radio" name="tibial-post-izq" id="tibial-post-izq-0" value="0"><label>0</label>
                                                <input type="radio" name="tibial-post-izq" id="tibial-post-izq-1" value="1"><label>1+</label>
                                                <input type="radio" name="tibial-post-izq" id="tibial-post-izq-2" value="2"><label>2+</label>
                                                <input type="radio" name="tibial-post-izq" id="tibial-post-izq-3" value="3"><label>3+</label>
                                                <input type="radio" name="tibial-post-izq" id="tibial-post-izq-4" value="4"><label>4+</label>
                                            </div>
                                        </div>
                                        <div class="pulse-item">
                                            <span>Pedio</span>
                                            <div class="pulse-intensity">
                                                <input type="radio" name="pedio-izq" id="pedio-izq-0" value="0"><label>0</label>
                                                <input type="radio" name="pedio-izq" id="pedio-izq-1" value="1"><label>1+</label>
                                                <input type="radio" name="pedio-izq" id="pedio-izq-2" value="2"><label>2+</label>
                                                <input type="radio" name="pedio-izq" id="pedio-izq-3" value="3"><label>3+</label>
                                                <input type="radio" name="pedio-izq" id="pedio-izq-4" value="4"><label>4+</label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="legend">
                            <span>Escala: 0 = Ausente, 1+ = D√©bil, 2+ = Normal, 3+ = Aumentado, 4+ = Salt√≥n</span>
                        </div>

                        <div class="score-calculation">
                            <h4>√çndice Tobillo-Brazo (ITB)</h4>
                            <div class="row">
                                <div class="measurement">
                                    <label>PA sist√≥lica brazo derecho:</label>
                                    <input type="number" id="pa-brazo-der" class="input-field" min="70" max="250" onchange="calculateITB()">
                                    <span>mmHg</span>
                                </div>
                                <div class="measurement">
                                    <label>PA sist√≥lica brazo izquierdo:</label>
                                    <input type="number" id="pa-brazo-izq" class="input-field" min="70" max="250" onchange="calculateITB()">
                                    <span>mmHg</span>
                                </div>
                            </div>
                            <div class="row">
                                <div class="measurement">
                                    <label>PA sist√≥lica tobillo derecho:</label>
                                    <input type="number" id="pa-tobillo-der" class="input-field" min="50" max="250" onchange="calculateITB()">
                                    <span>mmHg</span>
                                </div>
                                <div class="measurement">
                                    <label>PA sist√≥lica tobillo izquierdo:</label>
                                    <input type="number" id="pa-tobillo-izq" class="input-field" min="50" max="250" onchange="calculateITB()">
                                    <span>mmHg</span>
                                </div>
                            </div>
                            <div class="score-item">
                                <span>ITB derecho:</span>
                                <span class="score-value" id="itb-derecho">--</span>
                            </div>
                            <div class="score-item">
                                <span>ITB izquierdo:</span>
                                <span class="score-value" id="itb-izquierdo">--</span>
                            </div>
                            <div class="score-item">
                                <span>Interpretaci√≥n:</span>
                                <span class="score-value" id="itb-interpretacion">--</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Electrocardiograma -->
                <div class="section">
                    <div class="section-header" onclick="toggleSection('electrocardiograma')">
                        <span><i class="fas fa-heartbeat section-icon"></i>Electrocardiograma</span>
                        <div style="display: flex; align-items: center;">
                            <div class="completion-badge" id="badge-electrocardiograma">
                                <i class="fas fa-circle"></i>
                            </div>
                            <span class="arrow">‚ñº</span>
                        </div>
                    </div>
                    <div class="section-content" id="electrocardiograma">
                        <div class="row">
                            <div class="form-group">
                                <label>Ritmo:</label>
                                <select id="ecg-ritmo" onchange="handleECGRitmo()">
                                    <option value="">Seleccione...</option>
                                    <option value="sinusal">Ritmo sinusal</option>
                                    <option value="fibrilacion-auricular">Fibrilaci√≥n auricular</option>
                                    <option value="flutter-auricular">Flutter auricular</option>
                                    <option value="taquicardia-supraventricular">Taquicardia supraventricular</option>
                                    <option value="taquicardia-ventricular">Taquicardia ventricular</option>
                                    <option value="marcapasos">Ritmo de marcapasos</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label>Frecuencia card√≠aca (ECG):</label>
                                <div class="measurement">
                                    <input type="number" id="ecg-frecuencia" class="input-field" min="20" max="300">
                                    <span>lpm</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="subsection" id="ecg-ritmo-detalles">
                            <div class="form-group">
                                <label>Regularidad del ritmo:</label>
                                <select id="ecg-regularidad">
                                    <option value="">Seleccione...</option>
                                    <option value="regular">Regular</option>
                                    <option value="irregular">Irregular</option>
                                    <option value="regularmente-irregular">Regularmente irregular</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>Conducci√≥n:</label>
                            <select id="ecg-conduccion" onchange="handleECGConduccion()">
                                <option value="">Seleccione...</option>
                                <option value="normal">Normal</option>
                                <option value="bloqueo-av-1">Bloqueo AV de 1er grado</option>
                                <option value="bloqueo-av-2">Bloqueo AV de 2do grado</option>
                                <option value="bloqueo-av-3">Bloqueo AV de 3er grado</option>
                                <option value="bloqueo-rama-izquierda">Bloqueo rama izquierda</option>
                                <option value="bloqueo-rama-derecha">Bloqueo rama derecha</option>
                                <option value="hemibloqueo-anterior">Hemibloqueo anterior izquierdo</option>
                                <option value="hemibloqueo-posterior">Hemibloqueo posterior izquierdo</option>
                            </select>
                        </div>
                        
                        <div class="subsection" id="ecg-conduccion-detalles">
                            <div class="row">
                                <div class="measurement">
                                    <label>Intervalo PR (ms):</label>
                                    <input type="number" id="intervalo-pr" class="input-field" min="80" max="400">
                                </div>
                                <div class="measurement">
                                    <label>Ancho QRS (ms):</label>
                                    <input type="number" id="ancho-qrs" class="input-field" min="60" max="200">
                                </div>
                                <div class="measurement">
                                    <label>Intervalo QT (ms):</label>
                                    <input type="number" id="intervalo-qt" class="input-field" min="300" max="600">
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>Signos de hipertrofia:</label>
                            <div class="checkbox-grid">
                                <div class="checkbox-item">
                                    <input type="checkbox" id="hipertrofia-vi">
                                    <label for="hipertrofia-vi">Hipertrofia ventricular izquierda</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="hipertrofia-vd">
                                    <label for="hipertrofia-vd">Hipertrofia ventricular derecha</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="hipertrofia-ai">
                                    <label for="hipertrofia-ai">Hipertrofia auricular izquierda</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="hipertrofia-ad">
                                    <label for="hipertrofia-ad">Hipertrofia auricular derecha</label>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>Cambios isqu√©micos:</label>
                            <select id="cambios-isquemicos" onchange="handleCambiosIsquemicos()">
                                <option value="">Seleccione...</option>
                                <option value="ausentes">Ausentes</option>
                                <option value="elevacion-st">Elevaci√≥n del segmento ST</option>
                                <option value="depresion-st">Depresi√≥n del segmento ST</option>
                                <option value="inversion-t">Inversi√≥n de la onda T</option>
                                <option value="ondas-q-patologicas">Ondas Q patol√≥gicas</option>
                                <option value="mala-progresion-r">Mala progresi√≥n de R</option>
                            </select>
                        </div>
                        
                        <div class="subsection" id="cambios-isquemicos-detalles">
                            <div class="form-group">
                                <label>Localizaci√≥n de los cambios:</label>
                                <div class="checkbox-grid">
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="pared-anterior">
                                        <label for="pared-anterior">Pared anterior</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="pared-inferior">
                                        <label for="pared-inferior">Pared inferior</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="pared-lateral">
                                        <label for="pared-lateral">Pared lateral</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="pared-posterior">
                                        <label for="pared-posterior">Pared posterior</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="septo">
                                        <label for="septo">Septo</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- === NUEVA SECCI√ìN: ESCALAS DE RIESGO INTERACTIVAS === -->
                <div class="section">
                    <div class="section-header" onclick="toggleSection('escalas-riesgo')">
                        <span><i class="fas fa-calculator section-icon"></i>Escalas de Riesgo Cardiovascular</span>
                        <div style="display: flex; align-items: center;">
                            <div class="completion-badge" id="badge-escalas-riesgo">
                                <i class="fas fa-circle"></i>
                            </div>
                            <span class="arrow">‚ñº</span>
                        </div>
                    </div>
                    <div class="section-content" id="escalas-riesgo">
                        <div class="risk-assessment">
                            <h4><i class="fas fa-heart-crack"></i> Escala CHA‚ÇÇDS‚ÇÇ-VASc (Fibrilaci√≥n Auricular)</h4>
                            <div class="checkbox-grid">
                                <div class="checkbox-item">
                                    <input type="checkbox" id="chads-icc" onchange="calculateCHADS()">
                                    <label for="chads-icc">Insuficiencia card√≠aca (1 punto)</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="chads-hta" onchange="calculateCHADS()">
                                    <label for="chads-hta">Hipertensi√≥n (1 punto)</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="chads-edad-75" onchange="calculateCHADS()">
                                    <label for="chads-edad-75">Edad ‚â•75 a√±os (2 puntos)</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="chads-diabetes" onchange="calculateCHADS()">
                                    <label for="chads-diabetes">Diabetes mellitus (1 punto)</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="chads-stroke" onchange="calculateCHADS()">
                                    <label for="chads-stroke">ACV/AIT previo (2 puntos)</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="chads-vascular" onchange="calculateCHADS()">
                                    <label for="chads-vascular">Enfermedad vascular (1 punto)</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="chads-edad-65" onchange="calculateCHADS()">
                                    <label for="chads-edad-65">Edad 65-74 a√±os (1 punto)</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="chads-sexo" onchange="calculateCHADS()">
                                    <label for="chads-sexo">Sexo femenino (1 punto)</label>
                                </div>
                            </div>
                            <div class="score-item">
                                <span>Puntuaci√≥n CHA‚ÇÇDS‚ÇÇ-VASc:</span>
                                <span class="score-value" id="chads-score">0</span>
                                <span>/9 puntos</span>
                            </div>
                            <div class="score-item">
                                <span>Recomendaci√≥n:</span>
                                <span class="score-value" id="chads-recomendacion">--</span>
                            </div>
                        </div>

                        <div class="risk-assessment">
                            <h4><i class="fas fa-droplet"></i> Escala HAS-BLED (Riesgo Hemorr√°gico)</h4>
                            <div class="checkbox-grid">
                                <div class="checkbox-item">
                                    <input type="checkbox" id="hasbled-hta" onchange="calculateHASBLED()">
                                    <label for="hasbled-hta">Hipertensi√≥n no controlada (1 punto)</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="hasbled-renal" onchange="calculateHASBLED()">
                                    <label for="hasbled-renal">Funci√≥n renal anormal (1 punto)</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="hasbled-hepatica" onchange="calculateHASBLED()">
                                    <label for="hasbled-hepatica">Funci√≥n hep√°tica anormal (1 punto)</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="hasbled-stroke" onchange="calculateHASBLED()">
                                    <label for="hasbled-stroke">ACV previo (1 punto)</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="hasbled-sangrado" onchange="calculateHASBLED()">
                                    <label for="hasbled-sangrado">Antecedente de sangrado (1 punto)</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="hasbled-inr" onchange="calculateHASBLED()">
                                    <label for="hasbled-inr">INR l√°bil (1 punto)</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="hasbled-edad" onchange="calculateHASBLED()">
                                    <label for="hasbled-edad">Edad >65 a√±os (1 punto)</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="hasbled-medicamentos" onchange="calculateHASBLED()">
                                    <label for="hasbled-medicamentos">Medicamentos/alcohol (1 punto)</label>
                                </div>
                            </div>
                            <div class="score-item">
                                <span>Puntuaci√≥n HAS-BLED:</span>
                                <span class="score-value" id="hasbled-score">0</span>
                                <span>/9 puntos</span>
                            </div>
                            <div class="score-item">
                                <span>Riesgo hemorr√°gico:</span>
                                <span class="score-value" id="hasbled-riesgo">--</span>
                            </div>
                        </div>

                        <div class="risk-assessment">
                            <h4><i class="fas fa-exclamation-triangle"></i> Escala TIMI (S√≠ndrome Coronario Agudo)</h4>
                            <div class="checkbox-grid">
                                <div class="checkbox-item">
                                    <input type="checkbox" id="timi-edad" onchange="calculateTIMI()">
                                    <label for="timi-edad">Edad ‚â•65 a√±os (1 punto)</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="timi-factores" onchange="calculateTIMI()">
                                    <label for="timi-factores">‚â•3 factores de riesgo (1 punto)</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="timi-estenosis" onchange="calculateTIMI()">
                                    <label for="timi-estenosis">Estenosis coronaria ‚â•50% (1 punto)</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="timi-st" onchange="calculateTIMI()">
                                    <label for="timi-st">Desviaci√≥n del ST (1 punto)</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="timi-angina" onchange="calculateTIMI()">
                                    <label for="timi-angina">‚â•2 episodios anginosos/24h (1 punto)</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="timi-aspirina" onchange="calculateTIMI()">
                                    <label for="timi-aspirina">Uso de aspirina/7 d√≠as (1 punto)</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="timi-marcadores" onchange="calculateTIMI()">
                                    <label for="timi-marcadores">Marcadores elevados (1 punto)</label>
                                </div>
                            </div>
                            <div class="score-item">
                                <span>Puntuaci√≥n TIMI:</span>
                                <span class="score-value" id="timi-score">0</span>
                                <span>/7 puntos</span>
                            </div>
                            <div class="score-item">
                                <span>Riesgo a 14 d√≠as:</span>
                                <span class="score-value" id="timi-riesgo">--</span>
                            </div>
                        </div>

                        <div class="functional-assessment">
                            <h4><i class="fas fa-walking"></i> Test de Marcha de 6 Minutos</h4>
                            <div class="measurement">
                                <label>Distancia recorrida:</label>
                                <input type="number" id="marcha-6min" class="input-field" min="0" max="800" onchange="evaluate6MWT()">
                                <span>metros</span>
                            </div>
                            <div class="measurement">
                                <label>Disnea post-ejercicio (Borg):</label>
                                <select id="borg-disnea" onchange="evaluate6MWT()">
                                    <option value="">Seleccionar</option>
                                    <option value="0">0 - Sin disnea</option>
                                    <option value="1">1 - Muy leve</option>
                                    <option value="2">2 - Leve</option>
                                    <option value="3">3 - Moderada</option>
                                    <option value="4">4 - Algo severa</option>
                                    <option value="5">5 - Severa</option>
                                    <option value="6">6</option>
                                    <option value="7">7 - Muy severa</option>
                                    <option value="8">8</option>
                                    <option value="9">9 - Muy muy severa</option>
                                    <option value="10">10 - M√°xima</option>
                                </select>
                            </div>
                            <div class="score-item">
                                <span>Capacidad funcional:</span>
                                <span class="score-value" id="capacidad-funcional">--</span>
                            </div>
                            <div class="score-item">
                                <span>Porcentaje predicho:</span>
                                <span class="score-value" id="porcentaje-predicho">--</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
                
                <!-- Conclusi√≥n -->
                <div class="conclusion" id="traditionalConclusion">
                    <h3><i class="fas fa-file-medical-alt"></i> Conclusi√≥n del Examen Cardiovascular</h3>
                    <div class="conclusion-text" id="conclusion-text-traditional">Seleccione los par√°metros del examen para generar la conclusi√≥n cardiovascular...</div>
                    
                    <div class="control-buttons">
                        <button class="btn btn-primary-old" onclick="generateConclusion()">
                            <i class="fas fa-sync-alt"></i> Generar Conclusi√≥n
                        </button>
                        <button class="btn btn-primary-old" onclick="copyToClipboard()">
                            <i class="fas fa-copy"></i> Copiar al Portapapeles
                        </button>
                        <button class="btn btn-primary-old" onclick="printConclusion()">
                            <i class="fas fa-print"></i> Imprimir Conclusi√≥n
                        </button>
                        <button class="btn btn-secondary" onclick="clearForm()">
                            <i class="fas fa-eraser"></i> Limpiar Formulario
                        </button>
                        <button class="btn btn-secondary" onclick="expandAllSections()">
                            <i class="fas fa-expand-arrows-alt"></i> Expandir Todo
                        </button>
                        <button class="btn btn-secondary" onclick="collapseAllSections()">
                            <i class="fas fa-compress-arrows-alt"></i> Contraer Todo
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // === VARIABLES GLOBALES A√ëADIDAS ===
        let examProgress = 0;
        let sectionsCompleted = 0;
        let alertCount = 0;
        let warningCount = 0;
        let findingsCount = 0;
        let vitalsStatus = 'Pendiente';

        // === FUNCIONES A√ëADIDAS PARA EL DASHBOARD ===
        
        // üåô Toggle de tema A√ëADIDO
        function toggleTheme() {
            const body = document.body;
            const themeIcon = document.getElementById('theme-icon');
            
            if (body.hasAttribute('data-theme')) {
                body.removeAttribute('data-theme');
                themeIcon.className = 'fas fa-moon';
                localStorage.setItem('theme', 'light');
            } else {
                body.setAttribute('data-theme', 'dark');
                themeIcon.className = 'fas fa-sun';
                localStorage.setItem('theme', 'dark');
            }
        }

        // üéØ Toggle panel de navegaci√≥n A√ëADIDO
        function toggleNavPanel() {
            const navPanel = document.getElementById('nav-panel');
            const body = document.body;
            
            navPanel.classList.toggle('open');
            body.classList.toggle('split-view');
        }

        // üìä FUNCIONES DEL PANEL STICKY A√ëADIDAS

        // Toggle panel lateral sticky
        function toggleStickyPanel() {
            const stickyPanel = document.getElementById('stickyConclusion');
            const body = document.body;
            const btn = document.getElementById('sticky-toggle-btn');
            
            stickyPanel.classList.toggle('active');
            body.classList.toggle('split-view-active');
            
            if (stickyPanel.classList.contains('active')) {
                btn.innerHTML = '<i class="fas fa-window-restore"></i> Vista Normal';
                btn.classList.add('btn-warning');
                btn.classList.remove('btn-primary');
                generateStickyConclusion();
            } else {
                btn.innerHTML = '<i class="fas fa-columns"></i> Vista Dividida';
                btn.classList.add('btn-primary');
                btn.classList.remove('btn-warning');
            }
        }

        // Generar conclusi√≥n para panel sticky
        function generateStickyConclusion() {
            const stickyContent = document.getElementById('stickyContent');
            const updateIndicator = document.getElementById('updateIndicator');
            
            // Mostrar indicador de actualizaci√≥n
            updateIndicator.classList.add('active');
            
            setTimeout(() => {
                // Reutilizar la funci√≥n generateConclusion existente
                const originalConclusionEl = document.getElementById('conclusion-text-traditional');
                const originalContent = originalConclusionEl ? originalConclusionEl.textContent : 'Genere una conclusi√≥n...';
                
                // Clonar contenido al panel sticky
                stickyContent.textContent = originalContent;
                
                // Ocultar indicador
                updateIndicator.classList.remove('active');
            }, 300);
        }

        // Copiar contenido del panel sticky
        function copyStickyToClipboard() {
            const stickyContent = document.getElementById('stickyContent').textContent;
            
            if (navigator.clipboard && window.isSecureContext) {
                navigator.clipboard.writeText(stickyContent).then(() => {
                    showCopyNotification();
                }).catch(err => {
                    console.error('Error al copiar con la API del portapapeles: ', err);
                    fallbackCopyToClipboard(stickyContent);
                });
            } else {
                fallbackCopyToClipboard(stickyContent);
            }
        }

        // Fallback para copiar
        function fallbackCopyToClipboard(text) {
            const textArea = document.createElement('textarea');
            textArea.value = text;
            textArea.style.position = 'fixed';
            textArea.style.opacity = '0';
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();

            try {
                document.execCommand('copy');
                showCopyNotification();
            } catch (err) {
                console.error('Error al usar el m√©todo de respaldo para copiar: ', err);
                alert('No se pudo copiar el texto. Por favor, c√≥pielo manualmente.');
            }

            document.body.removeChild(textArea);
        }

        // Mostrar notificaci√≥n de copia A√ëADIDA
        function showCopyNotification() {
            const notification = document.getElementById('copyNotification');
            notification.classList.add('show');
            setTimeout(() => {
                notification.classList.remove('show');
            }, 2500);
        }

        // Imprimir desde panel sticky
        function printStickyConclusion() {
            const conclusion = document.getElementById('stickyContent').textContent;
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                <head>
                    <title>Informe Cardiovascular</title>
                    <style>
                        body { 
                            font-family: Arial, sans-serif; 
                            margin: 20px; 
                            line-height: 1.6;
                        }
                        pre { 
                            white-space: pre-wrap; 
                            font-family: 'Courier New', monospace; 
                            font-size: 12px;
                        }
                        .header {
                            text-align: center;
                            border-bottom: 2px solid #667eea;
                            padding-bottom: 10px;
                            margin-bottom: 20px;
                        }
                        .footer {
                            text-align: center;
                            font-size: 10px;
                            color: #666;
                            margin-top: 20px;
                            border-top: 1px solid #ddd;
                            padding-top: 10px;
                        }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>Informe Cardiovascular</h1>
                        <p>Fecha: ${new Date().toLocaleDateString()}</p>
                        <p>Hora: ${new Date().toLocaleTimeString()}</p>
                    </div>
                    <pre>${conclusion}</pre>
                    <div class="footer">
                        <p>Generado por Sistema de Evaluaci√≥n Cardiovascular Premium</p>
                    </div>
                </body>
                </html>
            `);
            printWindow.document.close();
            printWindow.print();
        }

        // üß≠ Navegaci√≥n a secciones A√ëADIDA
        function scrollToSection(sectionId) {
            const section = document.getElementById(`section-${sectionId}`) || document.getElementById(sectionId);
            if (section) {
                section.scrollIntoView({ 
                    behavior: 'smooth', 
                    block: 'start',
                    inline: 'nearest'
                });
                
                // Expandir la secci√≥n si est√° colapsada
                const header = section.querySelector('.section-header');
                if (header && !header.classList.contains('expanded')) {
                    toggleSection(header.nextElementSibling.id);
                }
            }
        }

        // ‚úÖ Actualizar altura de secci√≥n A√ëADIDA
        function updateSectionHeight(contentElement) {
            if (contentElement && contentElement.classList.contains('expanded')) {
                setTimeout(() => {
                    contentElement.style.maxHeight = contentElement.scrollHeight + 'px';
                }, 50);
            }
        }

        // üìä ACTUALIZAR DASHBOARD A√ëADIDO
        function updateDashboard() {
            const sections = [
                'anamnesis', 'signos-vitales', 'examen-fisico', 'auscultacion', 
                'circulacion-periferica', 'vascular-periferico', 'electrocardiograma', 'escalas-riesgo'
            ];
            
            let completedSections = 0;
            let totalFindings = 0;
            let totalAlerts = 0;
            let totalWarnings = 0;
            
            sections.forEach(sectionId => {
                const sectionElement = document.getElementById(sectionId);
                if (sectionElement) {
                    const checkboxes = sectionElement.querySelectorAll('input[type="checkbox"]:checked, input[type="radio"]:checked');
                    const numbers = sectionElement.querySelectorAll('input[type="number"]');
                    const selects = sectionElement.querySelectorAll('select');
                    
                    let hasContent = checkboxes.length > 0;
                    
                    // Verificar campos num√©ricos
                    numbers.forEach(input => {
                        if (input.value && input.value !== '0') hasContent = true;
                    });
                    
                    // Verificar selects
                    selects.forEach(select => {
                        if (select.selectedIndex > 0) hasContent = true;
                    });
                    
                    if (hasContent) {
                        completedSections++;
                        totalFindings += checkboxes.length;
                        
                        // Marcar secci√≥n como completada
                        const badge = document.getElementById(`badge-${sectionId}`);
                        const navItem = document.getElementById(`nav-${sectionId}`);
                        
                        if (badge) {
                            badge.classList.add('completed');
                            badge.innerHTML = '<i class="fas fa-check"></i>';
                        }
                        
                        if (navItem) {
                            navItem.style.opacity = '1';
                            navItem.parentElement.classList.add('completed');
                        }
                        
                        // Contar alertas y warnings
                        checkboxes.forEach(checkbox => {
                            const label = checkbox.nextElementSibling ? checkbox.nextElementSibling.textContent.toLowerCase() : '';
                            
                            if (label.includes('emergencia') || label.includes('grave') || 
                                label.includes('severo') || label.includes('critico')) {
                                totalAlerts++;
                            }
                            else if (label.includes('moderado') || label.includes('leve') ||
                                    label.includes('alterado') || label.includes('anormal')) {
                                totalWarnings++;
                            }
                        });
                    } else {
                        // Limpiar marcas de completado
                        const badge = document.getElementById(`badge-${sectionId}`);
                        const navItem = document.getElementById(`nav-${sectionId}`);
                        
                        if (badge) {
                            badge.classList.remove('completed');
                            badge.innerHTML = '<i class="fas fa-circle"></i>';
                        }
                        
                        if (navItem) {
                            navItem.style.opacity = '0';
                            navItem.parentElement.classList.remove('completed');
                        }
                    }
                }
            });
            
            // Actualizar valores del dashboard
            const progress = Math.round((completedSections / sections.length) * 100);
            document.getElementById('exam-progress').textContent = `${progress}%`;
            document.getElementById('sections-completed').textContent = `${completedSections}/${sections.length}`;
            document.getElementById('alert-count').textContent = totalAlerts;
            document.getElementById('warning-count').textContent = totalWarnings;
            document.getElementById('findings-count').textContent = totalFindings;
            
            // Actualizar estado de signos vitales
            const pas = document.getElementById('pas-derecho')?.value;
            const pad = document.getElementById('pad-derecho')?.value;
            const fc = document.getElementById('frecuencia-cardiaca')?.value;
            
            if (pas || pad || fc) {
                document.getElementById('vitals-status').textContent = 'Completo';
            } else {
                document.getElementById('vitals-status').textContent = 'Pendiente';
            }
            
            // Guardar valores globales
            examProgress = progress;
            sectionsCompleted = completedSections;
            alertCount = totalAlerts;
            warningCount = totalWarnings;
            findingsCount = totalFindings;
        }

        // === TODAS LAS FUNCIONES ORIGINALES MANTENIDAS ===
        
        // Variables globales para el dashboard original
        let sectionsExpanded = {};
        let isDarkMode = false;
        let isSplitView = false;
        
        // === FUNCIONES PARA MODO OSCURO ORIGINAL ===
        function toggleDarkMode() {
            isDarkMode = !isDarkMode;
            document.body.classList.toggle('dark-mode', isDarkMode);
            
            const btn = document.querySelector('.control-btn-old.secondary');
            if (btn) {
                if (isDarkMode) {
                    btn.innerHTML = '<i class="fas fa-sun"></i> Modo Claro';
                } else {
                    btn.innerHTML = '<i class="fas fa-moon"></i> Modo Oscuro';
                }
            }
            
            // Guardar preferencia en localStorage
            try {
                localStorage.setItem('cardiovascular-dark-mode', isDarkMode);
            } catch (e) {
                // Silently fail if localStorage is not available
            }
        }
        
        // === FUNCIONES PARA VISTA DIVIDIDA ORIGINAL ===
        function toggleSplitView() {
            isSplitView = !isSplitView;
            const contentWrapper = document.getElementById('contentWrapper');
            const stickyConclusion = document.getElementById('stickyConclusion');
            const traditionalConclusion = document.getElementById('traditionalConclusion');
            const splitToggle = document.getElementById('splitViewToggle');
            
            if (isSplitView) {
                contentWrapper.className = 'split-view-container';
                stickyConclusion.style.display = 'block';
                traditionalConclusion.style.display = 'none';
                if (splitToggle) splitToggle.checked = true;
                
                // Actualizar bot√≥n
                const btn = document.querySelector('.control-btn-old');
                if (btn) btn.innerHTML = '<i class="fas fa-window-restore"></i> Vista Normal';
            } else {
                contentWrapper.className = 'content-wrapper';
                stickyConclusion.style.display = 'none';
                traditionalConclusion.style.display = 'block';
                if (splitToggle) splitToggle.checked = false;
                
                // Actualizar bot√≥n
                const btn = document.querySelector('.control-btn-old');
                if (btn) btn.innerHTML = '<i class="fas fa-columns"></i> Vista Dividida';
            }
            
            // Regenerar conclusi√≥n para ambas vistas
            generateConclusion();
        }
        
        // === FUNCI√ìN MEJORADA PARA COPIAR AL PORTAPAPELES ORIGINAL ===
        function copyToClipboard() {
            const conclusionText = isSplitView ? 
                document.getElementById('conclusion-text').textContent : 
                document.getElementById('conclusion-text-traditional').textContent;
            
            if (navigator.clipboard && window.isSecureContext) {
                navigator.clipboard.writeText(conclusionText).then(() => {
                    showCopyNotificationOld();
                }).catch(err => {
                    fallbackCopyToClipboard(conclusionText);
                });
            } else {
                fallbackCopyToClipboard(conclusionText);
            }
        }
        
        function showCopyNotificationOld() {
            const notification = document.getElementById('copyNotificationOld');
            if (notification) {
                notification.classList.add('show');
                setTimeout(() => {
                    notification.classList.remove('show');
                }, 2000);
            }
        }

        // === FUNCIONES PARA INDICADORES VISUALES ===
        function updateVitalIndicator(inputId, indicatorId, value, type) {
            const indicator = document.getElementById(indicatorId);
            if (!indicator) return;
            
            indicator.className = 'vital-indicator';
            
            if (type === 'bp') {
                const [systolic, diastolic] = value;
                if (systolic < 90 || diastolic < 60) {
                    indicator.className += ' danger';
                    indicator.textContent = 'HIPOTENSI√ìN';
                } else if (systolic < 120 && diastolic < 80) {
                    indicator.className += ' normal';
                    indicator.textContent = 'NORMAL';
                } else if (systolic < 140 || diastolic < 90) {
                    indicator.className += ' warning';
                    indicator.textContent = 'HTA I';
                } else {
                    indicator.className += ' danger';
                    indicator.textContent = 'HTA II-III';
                }
            } else if (type === 'hr') {
                if (value < 50) {
                    indicator.className += ' danger';
                    indicator.textContent = 'BRADICARDIA SEVERA';
                } else if (value < 60) {
                    indicator.className += ' warning';
                    indicator.textContent = 'BRADICARDIA';
                } else if (value <= 100) {
                    indicator.className += ' normal';
                    indicator.textContent = 'NORMAL';
                } else if (value <= 150) {
                    indicator.className += ' warning';
                    indicator.textContent = 'TAQUICARDIA';
                } else {
                    indicator.className += ' danger';
                    indicator.textContent = 'TAQUICARDIA SEVERA';
                }
            } else if (type === 'spo2') {
                if (value < 90) {
                    indicator.className += ' danger';
                    indicator.textContent = 'HIPOXEMIA SEVERA';
                } else if (value < 95) {
                    indicator.className += ' warning';
                    indicator.textContent = 'HIPOXEMIA LEVE';
                } else {
                    indicator.className += ' normal';
                    indicator.textContent = 'NORMAL';
                }
            }
        }

        // === NUEVAS FUNCIONES PARA SECCIONES DIN√ÅMICAS ===
        function handleChestPainToggle() {
            const chestPainChecked = document.getElementById('dolor-toracico').checked;
            const chestPainDetails = document.getElementById('chest-pain-details');
            
            if (chestPainChecked) {
                chestPainDetails.classList.add('visible');
            } else {
                chestPainDetails.classList.remove('visible');
                // Reset valores cuando se desactiva
                document.getElementById('dolor-intensidad').value = 0;
                document.getElementById('dolor-value').textContent = '0';
                document.querySelectorAll('input[name="dolor-tipo"]').forEach(radio => radio.checked = false);
            }
            
            updateSectionHeight(chestPainDetails.closest('.section-content'));
            updateDashboard();
            generateConclusion();
        }
        
        function handleDyspneaToggle() {
            const dyspneaChecked = document.getElementById('disnea').checked;
            const dyspneaDetails = document.getElementById('dyspnea-details');
            
            if (dyspneaChecked) {
                dyspneaDetails.classList.add('visible');
            } else {
                dyspneaDetails.classList.remove('visible');
                // Reset valores cuando se desactiva
                document.getElementById('disnea-intensidad').value = 0;
                document.getElementById('disnea-value').textContent = '0';
                const ejercicioTol = document.getElementById('ejercicio-tolerancia');
                if (ejercicioTol) ejercicioTol.selectedIndex = 0;
            }
            
            updateSectionHeight(dyspneaDetails.closest('.section-content'));
            updateDashboard();
            generateConclusion();
        }

        // Funci√≥n principal para expandir/contraer secciones
        function toggleSection(sectionId) {
            const content = document.getElementById(sectionId);
            if (!content) return;
            
            const header = content.previousElementSibling;
            const section = content.parentElement;
            
            const isExpanded = content.classList.contains('expanded');
            
            if (isExpanded) {
                content.classList.remove('expanded');
                header.classList.remove('expanded');
                section.classList.remove('active');
                content.style.maxHeight = '0';
            } else {
                content.classList.add('expanded');
                header.classList.add('expanded');
                section.classList.add('active');
                updateSectionHeight(content);
            }
            
            sectionsExpanded[sectionId] = !isExpanded;
        }

        // Funci√≥n para manejar subsecciones
        function handleSubsectionToggle(selectElement, detailsElementId) {
            const detailsElement = document.getElementById(detailsElementId);
            if (!detailsElement) return;
            
            const shouldBeVisible = selectElement.value && 
                                  selectElement.value !== 'none' && 
                                  selectElement.value !== 'normal' && 
                                  selectElement.value !== 'sin-quejas' &&
                                  selectElement.value !== 'normales' &&
                                  selectElement.value !== 'ausentes';
            
            if (shouldBeVisible) {
                detailsElement.classList.add('visible');
            } else {
                detailsElement.classList.remove('visible');
            }
            
            updateSectionHeight(detailsElement.closest('.section-content'));
            updateDashboard();
            generateConclusion();
        }

        // Manejadores de eventos espec√≠ficos
        function handleNoComplaints() {
            const noComplaintsCheckbox = document.getElementById('sin-quejas');
            const otherCheckboxes = document.querySelectorAll('#anamnesis input[type="checkbox"]:not(#sin-quejas)');
            
            otherCheckboxes.forEach(checkbox => {
                checkbox.disabled = noComplaintsCheckbox.checked;
                if (noComplaintsCheckbox.checked) checkbox.checked = false;
            });
            
            // Ocultar secciones din√°micas si se marca "sin quejas"
            if (noComplaintsCheckbox.checked) {
                const chestPainDetails = document.getElementById('chest-pain-details');
                const dyspneaDetails = document.getElementById('dyspnea-details');
                if (chestPainDetails) chestPainDetails.classList.remove('visible');
                if (dyspneaDetails) dyspneaDetails.classList.remove('visible');
            }
            
            updateDashboard();
            generateConclusion();
        }

        function updateDolorValue() {
            const valor = document.getElementById('dolor-intensidad').value;
            document.getElementById('dolor-value').textContent = valor;
            evaluateChestPain();
        }

        function updateDisneaValue() {
            const valor = document.getElementById('disnea-intensidad').value;
            document.getElementById('disnea-value').textContent = valor;
            updateDashboard();
            generateConclusion();
        }

        function evaluateChestPain() {
            const intensidad = document.getElementById('dolor-intensidad').value;
            let score = 0;
            
            // Factores que aumentan probabilidad coronaria
            if (document.getElementById('dolor-opresivo')?.checked) score += 2;
            if (document.getElementById('dolor-ejercicio')?.checked) score += 2;
            if (document.getElementById('alivio-reposo')?.checked) score += 1;
            if (document.getElementById('alivio-nitroglicerina')?.checked) score += 2;
            
            // Factores que disminuyen probabilidad
            if (document.getElementById('dolor-punzante')?.checked) score -= 1;
            if (document.getElementById('dolor-reposo')?.checked) score -= 1;
            if (document.getElementById('alivio-posicion')?.checked) score -= 1;
            
            let probabilidad = '';
            if (score >= 5) {
                probabilidad = 'Alta probabilidad coronaria';
            } else if (score >= 3) {
                probabilidad = 'Probabilidad intermedia';
            } else if (score >= 1) {
                probabilidad = 'Baja probabilidad coronaria';
            } else {
                probabilidad = 'Muy baja probabilidad coronaria';
            }
            
            const probEl = document.getElementById('probabilidad-coronaria');
            if (probEl) probEl.textContent = probabilidad;
            updateDashboard();
            generateConclusion();
        }

        function evaluateNYHA() {
            const tolerancia = document.getElementById('ejercicio-tolerancia').value;
            let nyhaClass = '';
            
            switch(tolerancia) {
                case '1': nyhaClass = 'NYHA I'; break;
                case '2': nyhaClass = 'NYHA II'; break;
                case '3': nyhaClass = 'NYHA III'; break;
                case '4': nyhaClass = 'NYHA IV'; break;
                default: nyhaClass = '--';
            }
            
            const nyhaEl = document.getElementById('nyha-class');
            if (nyhaEl) nyhaEl.textContent = nyhaClass;
            updateDashboard();
            generateConclusion();
        }

        function evaluateBloodPressure() {
            const pasDer = parseInt(document.getElementById('pas-derecho').value);
            const padDer = parseInt(document.getElementById('pad-derecho').value);
            const pasIzq = parseInt(document.getElementById('pas-izquierdo').value);
            const padIzq = parseInt(document.getElementById('pad-izquierdo').value);
            
            // Actualizar indicador visual
            if (pasDer && padDer) {
                updateVitalIndicator('pas-derecho', 'pa-indicator', [pasDer, padDer], 'bp');
            }
            
            const assessment = document.getElementById('pa-assessment');
            if (assessment) {
                assessment.innerHTML = '';
                
                if (pasDer && padDer) {
                    let message = '', className = '';
                    
                    if (pasDer < 90 || padDer < 60) {
                        message = 'Hipotensi√≥n arterial';
                        className = 'warning';
                    } else if (pasDer < 120 && padDer < 80) {
                        message = 'Presi√≥n arterial normal';
                        className = 'normal';
                    } else if (pasDer < 130 && padDer < 80) {
                        message = 'Presi√≥n arterial normal-alta';
                        className = 'warning';
                    } else if (pasDer < 140 || padDer < 90) {
                        message = 'Hipertensi√≥n arterial grado 1';
                        className = 'warning';
                    } else if (pasDer < 180 || padDer < 110) {
                        message = 'Hipertensi√≥n arterial grado 2';
                        className = 'error';
                    } else {
                        message = 'Hipertensi√≥n arterial grado 3';
                        className = 'error';
                    }
                    
                    // Verificar asimetr√≠a entre brazos
                    if (pasIzq && padIzq) {
                        if (Math.abs(pasDer - pasIzq) > 10 || Math.abs(padDer - padIzq) > 10) {
                            message += '. Asimetr√≠a de PA entre brazos (>10 mmHg)';
                        }
                    }
                    
                    if (message) {
                        assessment.classList.add('visible');
                        assessment.innerHTML = `<div class="form-group"><div class="${className}">${message}</div></div>`;
                    }
                }
                updateSectionHeight(assessment.closest('.section-content'));
            }
            updateDashboard();
            generateConclusion();
        }

        function evaluateHeartRate() {
            const fc = parseInt(document.getElementById('frecuencia-cardiaca').value);
            
            // Actualizar indicador visual
            if (fc) {
                updateVitalIndicator('frecuencia-cardiaca', 'fc-indicator', fc, 'hr');
            }
            
            const container = document.getElementById('frecuencia-cardiaca')?.parentElement;
            if (container) {
                const existingWarning = container.querySelector('.warning, .error, .normal');
                if (existingWarning) existingWarning.remove();
                
                if (fc) {
                    let message, className;
                    if (fc < 50) {
                        message = 'Bradicardia severa (< 50 lpm)';
                        className = 'error';
                    } else if (fc < 60) {
                        message = 'Bradicardia (< 60 lpm)';
                        className = 'warning';
                    } else if (fc <= 100) {
                        message = 'Frecuencia card√≠aca normal';
                        className = 'normal';
                    } else if (fc <= 150) {
                        message = 'Taquicardia (> 100 lpm)';
                        className = 'warning';
                    } else {
                        message = 'Taquicardia severa (> 150 lpm)';
                        className = 'error';
                    }
                    
                    const warningDiv = document.createElement('div');
                    warningDiv.className = className;
                    warningDiv.textContent = message;
                    container.appendChild(warningDiv);
                }
                updateSectionHeight(container.closest('.section-content'));
            }
            updateDashboard();
            generateConclusion();
        }

        // Funci√≥n para evaluar SpO2
        function evaluateSaturation() {
            const spo2 = parseInt(document.getElementById('saturacion-oxigeno').value);
            if (spo2) {
                updateVitalIndicator('saturacion-oxigeno', 'spo2-indicator', spo2, 'spo2');
            }
            updateDashboard();
            generateConclusion();
        }

        // Manejadores espec√≠ficos para subsecciones
        function handlePulseCharacter() { 
            const el = event?.target || document.getElementById('pulso-caracter');
            if (el) handleSubsectionToggle(el, 'pulso-detalles'); 
        }

        // üîÑ Expandir/contraer todas las secciones
        function expandAllSections() {
            document.querySelectorAll('.section-header:not(.expanded)').forEach(header => {
                const sectionId = header.nextElementSibling?.id;
                if (sectionId) toggleSection(sectionId);
            });
        }

        function collapseAllSections() {
            document.querySelectorAll('.section-header.expanded').forEach(header => {
                const sectionId = header.nextElementSibling?.id;
                if (sectionId) toggleSection(sectionId);
            });
        }

 // üìù GENERAR CONCLUSI√ìN MEJORADA (Estilo narrativo y completo con negativos)
        function generateConclusion() {
            const conclusionEl = document.getElementById('conclusion-text-traditional'); // Usamos el tradicional por defecto
            let conclusion = 'INFORME DEL EXAMEN CARDIOVASCULAR:\n\n';

            // Funciones auxiliares para simplificar el c√≥digo
            const getLabelText = (id) => document.querySelector(`label[for="${id}"]`)?.textContent.toLowerCase() || '';
            const isChecked = (id) => document.getElementById(id)?.checked;
            const getInputValue = (id) => document.getElementById(id)?.value;
            const getSelectedValue = (id) => document.getElementById(id)?.value;
            const getSelectedText = (id) => {
                const select = document.getElementById(id);
                return select ? select.options[select.selectedIndex].textContent.toLowerCase() : '';
            };
            const capitalizeFirstLetter = (string) => string.charAt(0).toUpperCase() + string.slice(1);

            // --- 1. ANAMNESIS Y QUEJAS PRINCIPALES ---
            let anamnesisAdded = false;
            let quejasText = '';
            const quejas = [];
            const noQuejasMarcado = isChecked('sin-quejas');

            if (noQuejasMarcado) {
                quejas.push('el paciente no refiere quejas cardiovasculares');
            } else {
                ['dolor-toracico', 'disnea', 'palpitaciones', 'sincope', 'presincope',
                 'edema', 'fatiga', 'ortopnea', 'disnea-paroxistica', 'claudicacion', 'cianosis'].forEach(id => {
                    if (isChecked(id)) {
                        quejas.push(getLabelText(id));
                    }
                });
            }
            
            if (quejas.length > 0) {
                anamnesisAdded = true;
                if (quejas.length === 1) {
                    quejasText += `El paciente consulta por ${quejas[0]}. `;
                } else {
                    const lastQueja = quejas.pop();
                    quejasText += `El paciente consulta por ${quejas.join(', ')} y ${lastQueja}. `;
                }

                // Evaluaci√≥n Detallada del Dolor Tor√°cico (si est√° marcada o si hay datos relevantes en subsecci√≥n)
                if (isChecked('dolor-toracico') || document.getElementById('chest-pain-details').classList.contains('visible')) {
                    const dolorIntensidad = getInputValue('dolor-intensidad');
                    const dolorTipoRadio = document.querySelector('input[name="dolor-tipo"]:checked');
                    const dolorDuracion = getSelectedText('dolor-duracion');
                    const probabilidadCoronaria = document.getElementById('probabilidad-coronaria')?.textContent;

                    let dolorDetalle = '';
                    if (dolorIntensidad && dolorIntensidad !== '0') dolorDetalle += `Presenta una intensidad de ${dolorIntensidad}/10. `;
                    if (dolorTipoRadio) dolorDetalle += `El tipo de dolor es ${getLabelText(dolorTipoRadio.id)}. `;
                    if (dolorDuracion && dolorDuracion !== 'seleccione...') dolorDetalle += `Con una duraci√≥n de ${dolorDuracion}. `;

                    const irradiaciones = [];
                    ['irradiacion-brazo-izq', 'irradiacion-mandibula', 'irradiacion-espalda', 'irradiacion-cuello'].forEach(id => {
                        if (isChecked(id)) irradiaciones.push(getLabelText(id));
                    });
                    if (irradiaciones.length > 0) {
                        const lastIrrad = irradiaciones.pop();
                        dolorDetalle += `Se irradia hacia ${irradiaciones.join(', ')} y ${lastIrrad}. `;
                    }

                    const factoresDesencadenantes = [];
                    ['dolor-ejercicio', 'dolor-emociones', 'dolor-frio', 'dolor-reposo', 'dolor-movimientos', 'dolor-palpacion'].forEach(id => {
                        if (isChecked(id)) factoresDesencadenantes.push(getLabelText(id));
                    });
                    if (factoresDesencadenantes.length > 0) {
                        const lastDesenc = factoresDesencadenantes.pop();
                        dolorDetalle += `Se desencadena por ${factoresDesencadenantes.join(', ')} y ${lastDesenc}. `;
                    }

                    const factoresAlivio = [];
                    ['alivio-reposo', 'alivio-nitroglicerina', 'alivio-antiacidos', 'alivio-posicion'].forEach(id => {
                        if (isChecked(id)) factoresAlivio.push(getLabelText(id));
                    });
                    if (factoresAlivio.length > 0) {
                        const lastAlivio = factoresAlivio.pop();
                        dolorDetalle += `Se alivia con ${factoresAlivio.join(', ')} y ${lastAlivio}. `;
                    }
                    if (probabilidadCoronaria && probabilidadCoronaria !== '--' && probabilidadCoronaria !== 'muy baja probabilidad coronaria') dolorDetalle += `La probabilidad de origen coronario es ${probabilidadCoronaria.toLowerCase()}. `;
                    else if (probabilidadCoronaria === 'muy baja probabilidad coronaria') dolorDetalle += `La probabilidad de origen coronario es muy baja. `;
                    
                    if (dolorDetalle) quejasText += `Detalles del dolor tor√°cico: ${dolorDetalle.trim()}. `;
                }

                // Evaluaci√≥n Detallada de la Disnea (si est√° marcada o si hay datos relevantes en subsecci√≥n)
                if (isChecked('disnea') || document.getElementById('dyspnea-details').classList.contains('visible')) {
                    const disneaIntensidad = getInputValue('disnea-intensidad');
                    const nyhaClass = document.getElementById('nyha-class')?.textContent;
                    const tipoDisnea = getSelectedText('disnea-tipo');

                    let disneaDetalle = '';
                    if (disneaIntensidad && disneaIntensidad !== '0') disneaDetalle += `Presenta una intensidad de ${disneaIntensidad}/10. `;
                    if (nyhaClass && nyhaClass !== '--') disneaDetalle += `La clase funcional seg√∫n NYHA es ${nyhaClass}. `;
                    if (tipoDisnea && tipoDisnea !== 'seleccione...') disneaDetalle += `Es de tipo ${tipoDisnea}. `;

                    const sintomasAsociados = [];
                    ['disnea-tos', 'disnea-esputo', 'disnea-hemoptisis', 'disnea-sibilancias'].forEach(id => {
                        if (isChecked(id)) sintomasAsociados.push(getLabelText(id));
                    });
                    if (sintomasAsociados.length > 0) {
                        const lastSintoma = sintomasAsociados.pop();
                        disneaDetalle += `S√≠ntomas asociados incluyen ${sintomasAsociados.join(', ')} y ${lastSintoma}. `;
                    }
                    if (disneaDetalle) quejasText += `Detalles de la disnea: ${disneaDetalle.trim()}. `;
                }
            }

            if (anamnesisAdded) {
                conclusion += `ANAMNESIS Y QUEJAS PRINCIPALES:\n${quejasText.trim()}\n\n`;
            }

            // Medicaci√≥n Cardiovascular Actual
            const medicacion = getInputValue('medicacion-actual');
            if (medicacion && medicacion.trim()) {
                conclusion += 'MEDICACI√ìN CARDIOVASCULAR ACTUAL:\n';
                conclusion += `${medicacion.trim()}\n\n`;
            }

            // Antecedentes Cardiovasculares
            const antecedentes = [];
            ['hipertension', 'diabetes', 'dislipidemia', 'tabaquismo',
             'iam-previo', 'icc-previa', 'fibrilacion-auricular', 'cirugia-cardiaca'].forEach(id => {
                if (isChecked(id)) antecedentes.push(getLabelText(id));
            });
            if (antecedentes.length > 0) {
                const lastAntecedente = antecedentes.pop();
                conclusion += `ANTECEDENTES CARDIOVASCULARES:\nEl paciente presenta antecedentes de ${antecedentes.join(', ')} y ${lastAntecedente}.\n\n`;
            }

            // --- 2. SIGNOS VITALES Y PAR√ÅMETROS HEMODIN√ÅMICOS ---
            let signosVitalesAdded = false;
            let vitalSignsText = '';

            const pasDer = getInputValue('pas-derecho');
            const padDer = getInputValue('pad-derecho');
            const pasIzq = getInputValue('pas-izquierdo');
            const padIzq = getInputValue('pad-izquierdo');
            
            if (pasDer && padDer) {
                signosVitalesAdded = true;
                let paStatus = document.getElementById('pa-indicator')?.textContent || 'no evaluado';
                vitalSignsText += `Presi√≥n Arterial (brazo derecho): ${pasDer}/${padDer} mmHg (${paStatus.toLowerCase()}). `;
                if (pasIzq && padIzq) {
                    vitalSignsText += `Presi√≥n Arterial (brazo izquierdo): ${pasIzq}/${padIzq} mmHg. `;
                    if (Math.abs(pasDer - pasIzq) > 10 || Math.abs(padDer - padIzq) > 10) {
                        vitalSignsText += 'Se observa asimetr√≠a de PA significativa entre brazos (>10 mmHg). ';
                    } else {
                        vitalSignsText += 'No se observa asimetr√≠a de PA significativa entre brazos. ';
                    }
                }
            } else if (getInputValue('pas-izquierdo') && getInputValue('pad-izquierdo')) {
                 signosVitalesAdded = true;
                 vitalSignsText += `Presi√≥n Arterial (brazo izquierdo): ${getInputValue('pas-izquierdo')}/${getInputValue('pad-izquierdo')} mmHg. `;
            }


            const fc = getInputValue('frecuencia-cardiaca');
            if (fc) {
                signosVitalesAdded = true;
                const fcStatus = document.getElementById('fc-indicator')?.textContent || 'no evaluado';
                vitalSignsText += `Frecuencia Card√≠aca: ${fc} lpm (${fcStatus.toLowerCase()}). `;
            }

            const fr = getInputValue('frecuencia-respiratoria');
            if (fr) {
                signosVitalesAdded = true;
                vitalSignsText += `Frecuencia Respiratoria: ${fr} rpm. `;
            }

            const spo2 = getInputValue('saturacion-oxigeno');
            if (spo2) {
                signosVitalesAdded = true;
                const spo2Status = document.getElementById('spo2-indicator')?.textContent || 'no evaluado';
                vitalSignsText += `Saturaci√≥n de Ox√≠geno: ${spo2}% (${spo2Status.toLowerCase()}). `;
            }

            const temp = getInputValue('temperatura');
            if (temp) {
                signosVitalesAdded = true;
                vitalSignsText += `Temperatura: ${temp}¬∞C. `;
            }

            // Caracter√≠sticas del Pulso
            const pulsoCaracter = getSelectedText('pulso-caracter');
            if (pulsoCaracter && pulsoCaracter !== 'seleccione...') {
                signosVitalesAdded = true;
                vitalSignsText += `Caracter√≠sticas del pulso: ${pulsoCaracter}. `;
                if (pulsoCaracter.includes('arr√≠tmico')) {
                    const arritmiaTipo = getSelectedText('arritmia-tipo');
                    const deficitPulso = getInputValue('deficit-pulso');
                    if (arritmiaTipo && arritmiaTipo !== 'seleccione...') vitalSignsText += `Tipo de arritmia: ${arritmiaTipo}. `;
                    if (deficitPulso) vitalSignsText += `D√©ficit de pulso: ${deficitPulso} lpm. `;
                }
            }

            if (signosVitalesAdded) {
                conclusion += `SIGNOS VITALES Y PAR√ÅMETROS HEMODIN√ÅMICOS:\n${vitalSignsText.trim()}\n\n`;
            }

            // --- 3. EXAMEN F√çSICO CARDIOVASCULAR ---
            let examenFisicoAdded = false;
            let examenFisicoText = '';

            // Inspecci√≥n General
            const aspectoNormal = isChecked('aspecto-normal');
            const aspectoHallazgos = [];
            ['palidez', 'cianosis-central', 'cianosis-periferica', 'diaforesis', 'ingurgitacion-yugular'].forEach(id => {
                if (isChecked(id)) aspectoHallazgos.push(getLabelText(id));
            });
            if (aspectoHallazgos.length > 0 || aspectoNormal) {
                examenFisicoAdded = true;
                if (aspectoNormal) {
                    examenFisicoText += 'Inspecci√≥n general: Aspecto general normal. ';
                } else {
                    const lastAspecto = aspectoHallazgos.pop();
                    examenFisicoText += `Inspecci√≥n general: Se observa ${aspectoHallazgos.join(', ')} y ${lastAspecto}. `;
                }
            }

            // Inspecci√≥n de la regi√≥n card√≠aca
            const inspeccionCardiaca = getSelectedText('inspeccion-cardiaca');
            if (inspeccionCardiaca && inspeccionCardiaca !== 'seleccione...') {
                examenFisicoAdded = true;
                if (inspeccionCardiaca === 'normal') {
                    examenFisicoText += 'Inspecci√≥n de la regi√≥n card√≠aca: No se observan cambios patol√≥gicos. ';
                } else {
                    examenFisicoText += `Inspecci√≥n de la regi√≥n card√≠aca: Se identifica ${inspeccionCardiaca}. `;
                    const inspeccionDescripcion = getInputValue('inspeccion-descripcion');
                    if (inspeccionDescripcion) examenFisicoText += `Descripci√≥n: ${inspeccionDescripcion.trim()}. `;
                }
            }

            // Palpaci√≥n Card√≠aca
            const latidoApical = getSelectedText('latido-apical');
            if (latidoApical && latidoApical !== 'seleccione...') {
                examenFisicoAdded = true;
                examenFisicoText += `Palpaci√≥n del latido apical: ${latidoApical}. `;
                if (latidoApical !== 'normal' && latidoApical !== 'no palpable') {
                    const latidoLocalizacion = getInputValue('latido-localizacion');
                    if (latidoLocalizacion) examenFisicoText += `Localizaci√≥n espec√≠fica: ${latidoLocalizacion}. `;
                    const latidoCaracteristicas = [];
                    ['latido-difuso', 'latido-fuerte', 'latido-prolongado', 'latido-sostenido'].forEach(id => {
                        if (isChecked(id)) latidoCaracteristicas.push(getLabelText(id));
                    });
                    if (latidoCaracteristicas.length > 0) {
                        const lastLatidoCar = latidoCaracteristicas.pop();
                        examenFisicoText += `Caracter√≠sticas: ${latidoCaracteristicas.join(', ')} y ${lastLatidoCar}. `;
                    }
                }
            }

            // Percusi√≥n Card√≠aca
            const limitesCardiacos = getSelectedText('limites-cardiacos');
            if (limitesCardiacos && limitesCardiacos !== 'seleccione...') {
                examenFisicoAdded = true;
                examenFisicoText += `Percusi√≥n de l√≠mites card√≠acos: ${limitesCardiacos}. `;
                if (limitesCardiacos !== 'normales') {
                    const limiteDerecho = getInputValue('limite-derecho');
                    const limiteIzquierdo = getInputValue('limite-izquierdo');
                    const limiteSuperior = getInputValue('limite-superior');
                    if (limiteDerecho) examenFisicoText += `L√≠mite derecho: ${limiteDerecho}. `;
                    if (limiteIzquierdo) examenFisicoText += `L√≠mite izquierdo: ${limiteIzquierdo}. `;
                    if (limiteSuperior) examenFisicoText += `L√≠mite superior: ${limiteSuperior}. `;
                }
            }

            // Otros hallazgos palpatorios
            const otrosHallazgosPalpatorios = [];
            ['fremito-sistolico', 'fremito-diastolico', 'levantamiento-paraesternal', 'p2-palpable'].forEach(id => {
                if (isChecked(id)) otrosHallazgosPalpatorios.push(getLabelText(id));
            });
            if (otrosHallazgosPalpatorios.length > 0) {
                examenFisicoAdded = true;
                const lastOtroPalp = otrosHallazgosPalpatorios.pop();
                examenFisicoText += `Otros hallazgos palpatorios: Se detecta ${otrosHallazgosPalpatorios.join(', ')} y ${lastOtroPalp}. `;
            }

            if (examenFisicoAdded) {
                conclusion += `EXAMEN F√çSICO CARDIOVASCULAR:\n${examenFisicoText.trim()}\n\n`;
            }

            // --- 4. AUSCULTACI√ìN CARD√çACA ---
            let auscultacionAdded = false;
            let auscultacionText = '';

            const focos = ['aortico', 'pulmonar', 'tricuspide', 'mitral'];
            focos.forEach(foco => {
                const r1 = getSelectedText(`r1-${foco}`);
                const r2 = getSelectedText(`r2-${foco}`);
                const soploSist = isChecked(`soplo-sist-${foco}`);
                const soploSistGrado = getSelectedText(`soplo-sist-${foco}-grado`);
                const soploDiast = isChecked(`soplo-diast-${foco}`);
                const soploDiastGrado = getSelectedText(`soplo-diast-${foco}-grado`);

                let focoHallazgos = [];
                if (r1 && r1 !== '-') focoHallazgos.push(`R1: ${capitalizeFirstLetter(r1)}`);
                if (r2 && r2 !== '-') focoHallazgos.push(`R2: ${capitalizeFirstLetter(r2)}`);
                if (foco === 'pulmonar' && isChecked('desdoblamiento-r2')) focoHallazgos.push('Desdoblamiento de R2');

                if (soploSist) focoHallazgos.push(`Soplo sist√≥lico grado ${soploSistGrado}`);
                if (soploDiast) focoHallazgos.push(`Soplo diast√≥lico grado ${soploDiastGrado}`);

                if (focoHallazgos.length > 0) {
                    auscultacionAdded = true;
                    auscultacionText += `Foco ${capitalizeFirstLetter(foco)}: ${focoHallazgos.join(', ')}. `;
                } else { // Si no hay hallazgos espec√≠ficos en el foco, indicar normalidad si todos los R son normales
                    if (r1 === 'normal' && r2 === 'normal' && !soploSist && !soploDiast && (foco !== 'pulmonar' || !isChecked('desdoblamiento-r2'))) {
                        auscultacionAdded = true;
                        auscultacionText += `Foco ${capitalizeFirstLetter(foco)}: Ritmos card√≠acos normales, sin soplos ni otros ruidos. `;
                    }
                }
            });

            // Caracter√≠sticas Detalladas de Soplos (si alg√∫n soplo est√° marcado)
            const anySoploChecked = document.querySelectorAll('input[id*="soplo-"]:checked').length > 0;
            if (anySoploChecked || document.getElementById('murmur-details').classList.contains('visible')) {
                auscultacionAdded = true;
                let soploDetalle = '';
                const irradiacionSoplo = [];
                ['irradiacion-axila', 'irradiacion-cuello-soplo', 'irradiacion-espalda-soplo', 'irradiacion-punta'].forEach(id => {
                    if (isChecked(id)) irradiacionSoplo.push(getLabelText(id));
                });
                if (irradiacionSoplo.length > 0) {
                    const lastIrradSoplo = irradiacionSoplo.pop();
                    soploDetalle += `Irradiaci√≥n: ${irradiacionSoplo.join(', ')} y ${lastIrradSoplo}. `;
                }

                const soploRespiracion = getSelectedText('soplo-respiracion');
                if (soploRespiracion && soploRespiracion !== 'seleccione...') soploDetalle += `Relaci√≥n con la respiraci√≥n: ${soploRespiracion}. `;

                const soploManiobras = getSelectedText('soplo-maniobras');
                if (soploManiobras && soploManiobras !== 'seleccione...') soploDetalle += `Relaci√≥n con maniobras: ${soploManiobras}. `;

                const soploDescripcionDetallada = getInputValue('soplo-descripcion-detallada');
                if (soploDescripcionDetallada) soploDetalle += `Descripci√≥n adicional: ${soploDescripcionDetallada.trim()}. `;

                if (soploDetalle) auscultacionText += `Caracter√≠sticas detalladas de los soplos: ${soploDetalle.trim()}. `;
            }

            // Otros hallazgos auscultatorios
            const otrosHallazgosAuscultatorios = [];
            ['r3-galope', 'r4-galope', 'click-sistolico', 'chasquido-apertura', 'roce-pericardico', 'arritmia-auscultacion'].forEach(id => {
                if (isChecked(id)) otrosHallazgosAuscultatorios.push(getLabelText(id));
            });
            if (otrosHallazgosAuscultatorios.length > 0) {
                auscultacionAdded = true;
                const lastOtroAus = otrosHallazgosAuscultatorios.pop();
                auscultacionText += `Otros hallazgos auscultatorios: Se observa ${otrosHallazgosAuscultatorios.join(', ')} y ${lastOtroAus}. `;
            }

            const soplosDescripcionGlobal = getInputValue('soplos-descripcion');
            if (soplosDescripcionGlobal && soplosDescripcionGlobal.trim()) {
                auscultacionAdded = true;
                auscultacionText += `Descripci√≥n global de soplos: ${soplosDescripcionGlobal.trim()}. `;
            }


            if (auscultacionAdded) {
                conclusion += `AUSCULTACI√ìN CARD√çACA:\n${auscultacionText.trim()}\n\n`;
            }

            // --- 5. CIRCULACI√ìN PERIF√âRICA Y EDEMAS ---
            let circulacionAdded = false;
            let circulacionText = '';

            const edemasPresencia = getSelectedText('edemas-presencia');
            if (edemasPresencia && edemasPresencia !== 'seleccione...') {
                circulacionAdded = true;
                if (edemasPresencia === 'sin-edemas') {
                    circulacionText += 'Presencia de edemas: Sin edemas. ';
                } else {
                    circulacionText += `Presencia de edemas: ${capitalizeFirstLetter(edemasPresencia)}. `;
                    const edemaLocalizaciones = ['pies', 'piernas', 'muslos', 'sacro', 'parpados', 'abdomen'];
                    let edemasDetalle = '';
                    edemaLocalizaciones.forEach(loc => {
                        const grado = getSelectedText(`edema-${loc}`);
                        if (grado && grado !== '0') {
                            edemasDetalle += `${capitalizeFirstLetter(loc)}: ${grado}; `;
                        }
                    });
                    if (edemasDetalle) circulacionText += `Localizaci√≥n e intensidad: ${edemasDetalle.trim()}. `;

                    const caracteristicasEdemas = [];
                    ['edema-simetrico', 'edema-fovea', 'edema-frio', 'edema-caliente'].forEach(id => {
                        if (isChecked(id)) caracteristicasEdemas.push(getLabelText(id));
                    });
                    if (caracteristicasEdemas.length > 0) {
                        const lastEdemaCar = caracteristicasEdemas.pop();
                        circulacionText += `Caracter√≠sticas: ${caracteristicasEdemas.join(', ')} y ${lastEdemaCar}. `;
                    }
                }
            }

            const venasEstado = getSelectedText('venas-estado');
            if (venasEstado && venasEstado !== 'seleccione...') {
                circulacionAdded = true;
                circulacionText += `Estado de las venas: ${venasEstado}. `;
                if (venasEstado !== 'normales') {
                    const venasDescripcion = getInputValue('venas-descripcion');
                    if (venasDescripcion && venasDescripcion.trim()) circulacionText += `Descripci√≥n de cambios venosos: ${venasDescripcion.trim()}. `;
                }
            } else if (getInputValue('venas-descripcion') && getInputValue('venas-descripcion').trim()) {
                 circulacionAdded = true; // Si hay descripci√≥n sin selecci√≥n, al menos a√±adirla
                 circulacionText += `Estado de las venas: Sin selecci√≥n, pero con descripci√≥n: ${getInputValue('venas-descripcion').trim()}. `;
            }

            const colorPiel = getSelectedText('color-piel');
            if (colorPiel && colorPiel !== 'seleccione...') {
                circulacionAdded = true;
                circulacionText += `Color de la piel: ${colorPiel}. `;
            }

            if (circulacionAdded) {
                conclusion += `CIRCULACI√ìN PERIF√âRICA Y EDEMAS:\n${circulacionText.trim()}\n\n`;
            }

            // --- 6. EXAMEN VASCULAR PERIF√âRICO ---
            let vascularAdded = false;
            let vascularText = '';

            const pulsosHallazgos = [];
            const pulseGrades = { '0': 'ausente', '1': 'd√©bil', '2': 'normal', '3': 'aumentado', '4': 'salt√≥n' };

            ['radial', 'cubital', 'braquial', 'femoral', 'popliteo', 'tibial-post', 'pedio'].forEach(pulso => {
                ['der', 'izq'].forEach(lado => {
                    const idBase = `${pulso}-${lado}`;
                    const radioChecked = document.querySelector(`input[name="${idBase}"]:checked`);
                    if (radioChecked) {
                        vascularAdded = true;
                        const grade = radioChecked.value;
                        pulsosHallazgos.push(`${capitalizeFirstLetter(pulso)} ${lado === 'der' ? 'Derecho' : 'Izquierdo'}: ${pulseGrades[grade]} (${grade}+)`);
                    } else { // Reportar como no evaluado si no se selecciona nada para un pulso
                        // Esto generar√≠a mucho texto. Solo reportar los que tienen valor.
                        // Opcional: si quieres reportar todos los no evaluados, descomenta:
                        // vascularAdded = true;
                        // pulsosHallazgos.push(`${capitalizeFirstLetter(pulso)} ${lado === 'der' ? 'Derecho' : 'Izquierdo'}: No evaluado`);
                    }
                });
            });
            if (pulsosHallazgos.length > 0) {
                vascularText += `Palpaci√≥n de pulsos: ${pulsosHallazgos.join('; ')}. `;
            } else {
                 vascularText += `Palpaci√≥n de pulsos: Sin hallazgos espec√≠ficos o no evaluados. `;
            }


            // √çndice Tobillo-Brazo (ITB)
            const itbDerecho = document.getElementById('itb-derecho')?.textContent;
            const itbIzquierdo = document.getElementById('itb-izquierdo')?.textContent;
            const itbInterpretacion = document.getElementById('itb-interpretacion')?.textContent;

            const paBrazoDer = getInputValue('pa-brazo-der');
            const paBrazoIzq = getInputValue('pa-brazo-izq');
            const paTobilloDer = getInputValue('pa-tobillo-der');
            const paTobilloIzq = getInputValue('pa-tobillo-izq');

            if ((itbDerecho && itbDerecho !== '--') || (itbIzquierdo && itbIzquierdo !== '--') ||
                paBrazoDer || paBrazoIzq || paTobilloDer || paTobilloIzq) {
                vascularAdded = true;
                vascularText += `√çndice Tobillo-Brazo (ITB): `;
                if (paBrazoDer) vascularText += `PA sist√≥lica brazo derecho: ${paBrazoDer} mmHg. `;
                if (paBrazoIzq) vascularText += `PA sist√≥lica brazo izquierdo: ${paBrazoIzq} mmHg. `;
                if (paTobilloDer) vascularText += `PA sist√≥lica tobillo derecho: ${paTobilloDer} mmHg. `;
                if (paTobilloIzq) vascularText += `PA sist√≥lica tobillo izquierdo: ${paTobilloIzq} mmHg. `;
                if (itbDerecho && itbDerecho !== '--') vascularText += `ITB derecho: ${itbDerecho}. `;
                if (itbIzquierdo && itbIzquierdo !== '--') vascularText += `ITB izquierdo: ${itbIzquierdo}. `;
                if (itbInterpretacion && itbInterpretacion !== '--') vascularText += `Interpretaci√≥n: ${itbInterpretacion}. `;
            }

            if (vascularAdded) {
                conclusion += `EXAMEN VASCULAR PERIF√âRICO:\n${vascularText.trim()}\n\n`;
            }

            // --- 7. ELECTROCARDIOGRAMA ---
            let ecgAdded = false;
            let ecgText = '';

            const ecgRitmo = getSelectedText('ecg-ritmo');
            const ecgFrecuencia = getInputValue('ecg-frecuencia');
            const ecgRegularidad = getSelectedText('ecg-regularidad');

            if (ecgRitmo && ecgRitmo !== 'seleccione...') {
                ecgAdded = true;
                ecgText += `Ritmo: ${capitalizeFirstLetter(ecgRitmo)}. `;
                if (ecgFrecuencia) ecgText += `Frecuencia card√≠aca: ${ecgFrecuencia} lpm. `;
                if (ecgRegularidad && ecgRegularidad !== 'seleccione...') ecgText += `Regularidad: ${ecgRegularidad}. `;
            } else if (ecgFrecuencia || (ecgRegularidad && ecgRegularidad !== 'seleccione...')) {
                ecgAdded = true;
                ecgText += `Ritmo: No especificado. `;
                if (ecgFrecuencia) ecgText += `Frecuencia card√≠aca: ${ecgFrecuencia} lpm. `;
                if (ecgRegularidad && ecgRegularidad !== 'seleccione...') ecgText += `Regularidad: ${ecgRegularidad}. `;
            }

            const ecgConduccion = getSelectedText('ecg-conduccion');
            if (ecgConduccion && ecgConduccion !== 'seleccione...') {
                ecgAdded = true;
                ecgText += `Conducci√≥n: ${capitalizeFirstLetter(ecgConduccion)}. `;
                if (ecgConduccion !== 'normal') {
                    const pr = getInputValue('intervalo-pr');
                    const qrs = getInputValue('ancho-qrs');
                    const qt = getInputValue('intervalo-qt');
                    if (pr) ecgText += `Intervalo PR: ${pr} ms. `;
                    if (qrs) ecgText += `Ancho QRS: ${qrs} ms. `;
                    if (qt) ecgText += `Intervalo QT: ${qt} ms. `;
                }
            } else {
                 const pr = getInputValue('intervalo-pr');
                 const qrs = getInputValue('ancho-qrs');
                 const qt = getInputValue('intervalo-qt');
                 if (pr || qrs || qt) {
                     ecgAdded = true;
                     ecgText += `Intervalos: PR ${pr || '--'} ms, QRS ${qrs || '--'} ms, QT ${qt || '--'} ms. `;
                 }
            }

            const hipertrofiaHallazgos = [];
            ['hipertrofia-vi', 'hipertrofia-vd', 'hipertrofia-ai', 'hipertrofia-ad'].forEach(id => {
                if (isChecked(id)) hipertrofiaHallazgos.push(getLabelText(id));
            });
            if (hipertrofiaHallazgos.length > 0) {
                ecgAdded = true;
                const lastHiper = hipertrofiaHallazgos.pop();
                ecgText += `Signos de hipertrofia: Se observa ${hipertrofiaHallazgos.join(', ')} y ${lastHiper}. `;
            }

            const cambiosIsquemicos = getSelectedText('cambios-isquemicos');
            if (cambiosIsquemicos && cambiosIsquemicos !== 'seleccione...') {
                ecgAdded = true;
                ecgText += `Cambios isqu√©micos: ${cambiosIsquemicos}. `;
                if (cambiosIsquemicos !== 'ausentes') {
                    const localizacionCambios = [];
                    ['pared-anterior', 'pared-inferior', 'pared-lateral', 'pared-posterior', 'septo'].forEach(id => {
                        if (isChecked(id)) localizacionCambios.push(getLabelText(id));
                    });
                    if (localizacionCambios.length > 0) {
                        const lastLoc = localizacionCambios.pop();
                        ecgText += `Localizaci√≥n: ${localizacionCambios.join(', ')} y ${lastLoc}. `;
                    }
                } else {
                    ecgText += `Cambios isqu√©micos: Ausentes. `;
                }
            }


            if (ecgAdded) {
                conclusion += `ELECTROCARDIOGRAMA:\n${ecgText.trim()}\n\n`;
            }

            // --- 8. ESCALAS DE RIESGO CARDIOVASCULAR ---
            let escalasAdded = false;
            let escalasText = '';

            const chadsScore = document.getElementById('chads-score')?.textContent;
            const chadsRecomendacion = document.getElementById('chads-recomendacion')?.textContent;
            const chadsFactorsChecked = document.querySelectorAll('#escalas-riesgo [id^="chads-"]:checked').length > 0;
            if (chadsFactorsChecked || (chadsScore !== '0' && chadsScore !== '--')) {
                escalasAdded = true;
                escalasText += `Escala CHA‚ÇÇDS‚ÇÇ-VASc (Fibrilaci√≥n Auricular): Puntuaci√≥n de ${chadsScore}/9 puntos. Recomendaci√≥n: ${chadsRecomendacion}. `;
            }

            const hasbledScore = document.getElementById('hasbled-score')?.textContent;
            const hasbledRiesgo = document.getElementById('hasbled-riesgo')?.textContent;
            const hasbledFactorsChecked = document.querySelectorAll('#escalas-riesgo [id^="hasbled-"]:checked').length > 0;
            if (hasbledFactorsChecked || (hasbledScore !== '0' && hasbledScore !== '--')) {
                escalasAdded = true;
                escalasText += `Escala HAS-BLED (Riesgo Hemorr√°gico): Puntuaci√≥n de ${hasbledScore}/9 puntos. Riesgo hemorr√°gico: ${hasbledRiesgo}. `;
            }

            const timiScore = document.getElementById('timi-score')?.textContent;
            const timiRiesgo = document.getElementById('timi-riesgo')?.textContent;
            const timiFactorsChecked = document.querySelectorAll('#escalas-riesgo [id^="timi-"]:checked').length > 0;
            if (timiFactorsChecked || (timiScore !== '0' && timiScore !== '--')) {
                escalasAdded = true;
                escalasText += `Escala TIMI (S√≠ndrome Coronario Agudo): Puntuaci√≥n de ${timiScore}/7 puntos. Riesgo a 14 d√≠as: ${timiRiesgo}. `;
            }

            const marcha6min = getInputValue('marcha-6min');
            const capacidadFuncional = document.getElementById('capacidad-funcional')?.textContent;
            const porcentajePredicho = document.getElementById('porcentaje-predicho')?.textContent;
            const borgDisnea = getSelectedText('borg-disnea');

            if (marcha6min) {
                escalasAdded = true;
                escalasText += `Test de Marcha de 6 Minutos: Distancia recorrida ${marcha6min} metros. Capacidad funcional: ${capacidadFuncional}. Porcentaje predicho: ${porcentajePredicho}. `;
                if (borgDisnea && borgDisnea !== 'seleccionar') escalasText += `Disnea post-ejercicio (Borg): ${borgDisnea}. `;
            } else if (borgDisnea && borgDisnea !== 'seleccionar') {
                escalasAdded = true; // Si hay Borg sin distancia, al menos reportarlo
                escalasText += `Test de Marcha de 6 Minutos: Disnea post-ejercicio (Borg): ${borgDisnea}. `;
            }


            if (escalasAdded) {
                conclusion += `ESCALAS DE RIESGO CARDIOVASCULAR:\n${escalasText.trim()}\n\n`;
            }

            // --- CONCLUSI√ìN FINAL Y PLAN ---
            if (conclusion.trim() === 'INFORME DEL EXAMEN CARDIOVASCULAR:') {
                conclusion = 'Seleccione los par√°metros del examen para generar la conclusi√≥n cardiovascular...';
            } else {
                conclusion += 'IMPRESI√ìN DIAGN√ìSTICA:\n';
                conclusion += '[Correlacionar con estudios complementarios como ECG, ecocardiograma, laboratorios, y pruebas de esfuerzo seg√∫n hallazgos cl√≠nicos y factores de riesgo.]\n\n';
                conclusion += 'PLAN DE MANEJO:\n';
                conclusion += '[El plan de manejo se determinar√° seg√∫n la impresi√≥n diagn√≥stica, la estratificaci√≥n de riesgo del paciente y la evidencia cient√≠fica actual. Puede incluir modificaciones en el estilo de vida, terapia farmacol√≥gica y/o interconsultas con especialistas.]\n\n';
                conclusion += 'SEGUIMIENTO:\n';
                conclusion += '[Se recomienda un control cardiol√≥gico peri√≥dico adaptado a la patolog√≠a sospechada o confirmada y a la evoluci√≥n cl√≠nica del paciente.]\n\n';
                conclusion += `COMPLETITUD DEL EXAMEN REGISTRADO: ${examProgress}%\n`;
                if (alertCount > 0) {
                    conclusion += `ALERTAS IDENTIFICADAS: ${alertCount} hallazgos cr√≠ticos que requieren atenci√≥n.\n`;
                }
                if (warningCount > 0) {
                    conclusion += `AVISOS IDENTIFICADOS: ${warningCount} hallazgos de consideraci√≥n.\n`;
                }
                conclusion += `TOTAL DE HALLAZGOS REGISTRADOS: ${findingsCount} elementos.`;
            }

            conclusionEl.textContent = conclusion;
            
            // Actualizar panel sticky si est√° activo
            const stickyPanel = document.getElementById('stickyConclusion');
            if (stickyPanel && stickyPanel.classList.contains('active')) {
                // Peque√±o retardo para asegurar que el DOM se actualice antes de copiar
                setTimeout(() => generateStickyConclusion(), 100); 
            }
        }
        // üñ®Ô∏è Imprimir conclusi√≥n
        function printConclusion() {
            const conclusion = isSplitView ? 
                document.getElementById('conclusion-text')?.textContent :
                document.getElementById('conclusion-text-traditional')?.textContent;
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                <head>
                    <title>Conclusi√≥n Examen Cardiovascular</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; line-height: 1.6; }
                        pre { white-space: pre-wrap; font-family: 'Courier New', monospace; font-size: 12px; }
                        .header { text-align: center; border-bottom: 2px solid #e74c3c; padding-bottom: 10px; margin-bottom: 20px; }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>Examen Cardiovascular - Conclusi√≥n</h1>
                        <p>Fecha: ${new Date().toLocaleDateString()}</p>
                    </div>
                    <pre>${conclusion}</pre>
                </body>
                </html>
            `);
            printWindow.document.close();
            printWindow.print();
        }

        // üóëÔ∏è Limpiar formulario
        function clearForm() {
            if (confirm('¬øEst√° seguro de que desea limpiar todos los datos del formulario?')) {
                document.querySelectorAll('input[type="checkbox"]').forEach(cb => {
                    cb.checked = false;
                    cb.disabled = false;
                });
                document.querySelectorAll('input[type="radio"]').forEach(rb => rb.checked = false);
                document.querySelectorAll('input[type="number"]').forEach(nb => nb.value = '');
                document.querySelectorAll('input[type="range"]').forEach(rb => rb.value = 0);
                document.querySelectorAll('select').forEach(sel => sel.selectedIndex = 0);
                document.querySelectorAll('textarea').forEach(ta => ta.value = '');
                
                // Resetear valores espec√≠ficos
                const dolorValue = document.getElementById('dolor-value');
                if (dolorValue) dolorValue.textContent = '0';
                const disneaValue = document.getElementById('disnea-value');
                if (disneaValue) disneaValue.textContent = '0';
                const probCoronaria = document.getElementById('probabilidad-coronaria');
                if (probCoronaria) probCoronaria.textContent = '--';
                const nyhaClass = document.getElementById('nyha-class');
                if (nyhaClass) nyhaClass.textContent = '--';
                
                // Limpiar indicadores visuales
                document.querySelectorAll('.vital-indicator').forEach(ind => {
                    ind.textContent = '';
                    ind.className = 'vital-indicator';
                });
                
                // Ocultar secciones din√°micas
                document.querySelectorAll('.dynamic-section.visible').forEach(section => {
                    section.classList.remove('visible');
                });
                
                // Limpiar advertencias de PA y FC
                document.querySelectorAll('.warning, .error, .normal').forEach(el => el.remove());
                
                updateDashboard();
                generateConclusion();
            }
        }
        
        // üöÄ Inicializaci√≥n del sistema MEJORADA
        document.addEventListener('DOMContentLoaded', function() {
            // Cargar preferencias guardadas
            try {
                const savedTheme = localStorage.getItem('theme');
                if (savedTheme === 'dark') {
                    document.body.setAttribute('data-theme', 'dark');
                    const themeIcon = document.getElementById('theme-icon');
                    if (themeIcon) themeIcon.className = 'fas fa-sun';
                }
                
                const savedDarkMode = localStorage.getItem('cardiovascular-dark-mode');
                if (savedDarkMode === 'true') {
                    toggleDarkMode();
                }
            } catch (e) {
                // Silently fail if localStorage is not available
            }
            
            // Expandir la primera secci√≥n por defecto
            const firstSection = document.querySelector('.section-header');
            if (firstSection) {
                const sectionId = firstSection.nextElementSibling?.id;
                if (sectionId) toggleSection(sectionId);
            }

            // Event listeners para inputs generales
            document.querySelectorAll('input, select, textarea').forEach(el => {
                el.addEventListener('change', () => {
                    updateDashboard();
                    generateConclusion();
                });
                el.addEventListener('input', () => {
                    updateDashboard();
                    generateConclusion();
                });
            });
             
            // Event listeners espec√≠ficos
            const sinQuejas = document.getElementById('sin-quejas');
            if (sinQuejas) sinQuejas.addEventListener('change', handleNoComplaints);
            
            const dolorToracico = document.getElementById('dolor-toracico');
            if (dolorToracico) dolorToracico.addEventListener('change', handleChestPainToggle);
            
            const disnea = document.getElementById('disnea');
            if (disnea) disnea.addEventListener('change', handleDyspneaToggle);
            
            const dolorIntensidad = document.getElementById('dolor-intensidad');
            if (dolorIntensidad) dolorIntensidad.addEventListener('input', updateDolorValue);
            
            const disneaIntensidad = document.getElementById('disnea-intensidad');
            if (disneaIntensidad) disneaIntensidad.addEventListener('input', updateDisneaValue);
            
            const ejercicioTolerancia = document.getElementById('ejercicio-tolerancia');
            if (ejercicioTolerancia) ejercicioTolerancia.addEventListener('change', evaluateNYHA);
            
            const pasDerecho = document.getElementById('pas-derecho');
            if (pasDerecho) pasDerecho.addEventListener('change', evaluateBloodPressure);
            
            const padDerecho = document.getElementById('pad-derecho');
            if (padDerecho) padDerecho.addEventListener('change', evaluateBloodPressure);
            
            const pasIzquierdo = document.getElementById('pas-izquierdo');
            if (pasIzquierdo) pasIzquierdo.addEventListener('change', evaluateBloodPressure);
            
            const padIzquierdo = document.getElementById('pad-izquierdo');
            if (padIzquierdo) padIzquierdo.addEventListener('change', evaluateBloodPressure);
            
            const frecuenciaCardiaca = document.getElementById('frecuencia-cardiaca');
            if (frecuenciaCardiaca) frecuenciaCardiaca.addEventListener('change', evaluateHeartRate);
            
            const saturacionOxigeno = document.getElementById('saturacion-oxigeno');
            if (saturacionOxigeno) saturacionOxigeno.addEventListener('change', evaluateSaturation);
            
            // Event listeners para subsecciones
            const pulsoCaracter = document.getElementById('pulso-caracter');
            if (pulsoCaracter) pulsoCaracter.addEventListener('change', handlePulseCharacter);
            
            // Event listeners para evaluaciones espec√≠ficas
            document.querySelectorAll('input[name$="dolor-tipo"]').forEach(el => {
                el.addEventListener('change', evaluateChestPain);
            });
            document.querySelectorAll('[id^="dolor-"], [id^="alivio-"]').forEach(el => {
                el.addEventListener('change', evaluateChestPain);
            });
             
            // Ajustar altura de secciones cuando cambian
            document.addEventListener('change', (event) => {
                const sectionContent = event.target.closest('.section-content.expanded');
                if (sectionContent) {
                    updateSectionHeight(sectionContent);
                }
            });
            
            // Inicializar evaluaciones
            updateDashboard();
            generateConclusion();

            console.log('üéâ Sistema Cardiovascular Premium cargado exitosamente!');
        });
        // === FUNCIONES FALTANTES PARA COMPLETAR EL SISTEMA ===

        // Manejadores para subsecciones del examen f√≠sico
        function handleInspeccionCardiaca() {
            const el = event?.target || document.getElementById('inspeccion-cardiaca');
            handleSubsectionToggle(el, 'inspeccion-detalles');
        }

        function handleLatidoApical() {
            const el = event?.target || document.getElementById('latido-apical');
            handleSubsectionToggle(el, 'latido-detalles');
        }

        function handleLimitesCardiacos() {
            const el = event?.target || document.getElementById('limites-cardiacos');
            handleSubsectionToggle(el, 'limites-detalles');
        }

        function handleEdemas() {
            const el = event?.target || document.getElementById('edemas-presencia');
            handleSubsectionToggle(el, 'edemas-detalles');
        }

        function handleVenas() {
            const el = event?.target || document.getElementById('venas-estado');
            handleSubsectionToggle(el, 'venas-detalles');
        }

        // Manejadores para soplos
        function handleMurmurToggle(location, timing) {
            const checkbox = document.getElementById(`soplo-${timing}-${location}`);
            const gradeSelect = document.getElementById(`soplo-${timing}-${location}-grado`);
            const murmurDetails = document.getElementById('murmur-details');
            
            if (gradeSelect) {
                gradeSelect.disabled = !checkbox.checked;
                if (!checkbox.checked) gradeSelect.selectedIndex = 0;
            }
            
            // Mostrar detalles si hay alg√∫n soplo marcado
            const anySoplo = document.querySelectorAll('input[id*="soplo-"]:checked').length > 0;
            if (murmurDetails) {
                if (anySoplo) {
                    murmurDetails.classList.add('visible');
                } else {
                    murmurDetails.classList.remove('visible');
                }
                updateSectionHeight(murmurDetails.closest('.section-content'));
            }
            
            updateDashboard();
            generateConclusion();
        }

        // Manejadores para ECG
        function handleECGRitmo() {
            const el = event?.target || document.getElementById('ecg-ritmo');
            handleSubsectionToggle(el, 'ecg-ritmo-detalles');
        }

        function handleECGConduccion() {
            const el = event?.target || document.getElementById('ecg-conduccion');
            handleSubsectionToggle(el, 'ecg-conduccion-detalles');
        }

        function handleCambiosIsquemicos() {
            const el = event?.target || document.getElementById('cambios-isquemicos');
            handleSubsectionToggle(el, 'cambios-isquemicos-detalles');
        }

        // C√°lculo del √çndice Tobillo-Brazo (ITB)
        function calculateITB() {
            const paBrazoDer = parseFloat(document.getElementById('pa-brazo-der')?.value);
            const paBrazoIzq = parseFloat(document.getElementById('pa-brazo-izq')?.value);
            const paTobilloDer = parseFloat(document.getElementById('pa-tobillo-der')?.value);
            const paTosilloIzq = parseFloat(document.getElementById('pa-tobillo-izq')?.value);
            
            const itbDerEl = document.getElementById('itb-derecho');
            const itbIzqEl = document.getElementById('itb-izquierdo');
            const interpretacionEl = document.getElementById('itb-interpretacion');
            
            if (paBrazoDer && paTobilloDer) {
                const maxBrazo = Math.max(paBrazoDer, paBrazoIzq || paBrazoDer);
                const itbDer = (paTobilloDer / maxBrazo).toFixed(2);
                if (itbDerEl) itbDerEl.textContent = itbDer;
            }
            
            if (paBrazoIzq && paTosilloIzq) {
                const maxBrazo = Math.max(paBrazoDer || paBrazoIzq, paBrazoIzq);
                const itbIzq = (paTosilloIzq / maxBrazo).toFixed(2);
                if (itbIzqEl) itbIzqEl.textContent = itbIzq;
            }
            
            // Interpretaci√≥n
            const itbDer = parseFloat(itbDerEl?.textContent || 0);
            const itbIzq = parseFloat(itbIzqEl?.textContent || 0);
            const minItb = Math.min(itbDer, itbIzq);
            
            if (interpretacionEl && minItb > 0) {
                let interpretacion = '';
                if (minItb > 1.4) {
                    interpretacion = 'Arterias no compresibles';
                } else if (minItb >= 1.0) {
                    interpretacion = 'Normal';
                } else if (minItb >= 0.9) {
                    interpretacion = 'L√≠mite';
                } else if (minItb >= 0.7) {
                    interpretacion = 'Enfermedad arterial perif√©rica leve';
                } else if (minItb >= 0.4) {
                    interpretacion = 'Enfermedad arterial perif√©rica moderada';
                } else {
                    interpretacion = 'Enfermedad arterial perif√©rica severa';
                }
                interpretacionEl.textContent = interpretacion;
            }
            
            updateDashboard();
            generateConclusion();
        }

        // Escalas de riesgo cardiovascular
        function calculateCHADS() {
            let score = 0;
            
            if (document.getElementById('chads-icc')?.checked) score += 1;
            if (document.getElementById('chads-hta')?.checked) score += 1;
            if (document.getElementById('chads-edad-75')?.checked) score += 2;
            if (document.getElementById('chads-diabetes')?.checked) score += 1;
            if (document.getElementById('chads-stroke')?.checked) score += 2;
            if (document.getElementById('chads-vascular')?.checked) score += 1;
            if (document.getElementById('chads-edad-65')?.checked) score += 1;
            if (document.getElementById('chads-sexo')?.checked) score += 1;
            
            const scoreEl = document.getElementById('chads-score');
            const recomendacionEl = document.getElementById('chads-recomendacion');
            
            if (scoreEl) scoreEl.textContent = score;
            
            if (recomendacionEl) {
                let recomendacion = '';
                if (score === 0) {
                    recomendacion = 'Sin anticoagulaci√≥n (considerar aspirina)';
                } else if (score === 1) {
                    recomendacion = 'Considerar anticoagulaci√≥n oral';
                } else {
                    recomendacion = 'Anticoagulaci√≥n oral recomendada';
                }
                recomendacionEl.textContent = recomendacion;
            }
            
            updateDashboard();
            generateConclusion();
        }

        function calculateHASBLED() {
            let score = 0;
            
            if (document.getElementById('hasbled-hta')?.checked) score += 1;
            if (document.getElementById('hasbled-renal')?.checked) score += 1;
            if (document.getElementById('hasbled-hepatica')?.checked) score += 1;
            if (document.getElementById('hasbled-stroke')?.checked) score += 1;
            if (document.getElementById('hasbled-sangrado')?.checked) score += 1;
            if (document.getElementById('hasbled-inr')?.checked) score += 1;
            if (document.getElementById('hasbled-edad')?.checked) score += 1;
            if (document.getElementById('hasbled-medicamentos')?.checked) score += 1;
            
            const scoreEl = document.getElementById('hasbled-score');
            const riesgoEl = document.getElementById('hasbled-riesgo');
            
            if (scoreEl) scoreEl.textContent = score;
            
            if (riesgoEl) {
                let riesgo = '';
                if (score <= 2) {
                    riesgo = 'Bajo riesgo hemorr√°gico';
                } else if (score === 3) {
                    riesgo = 'Riesgo hemorr√°gico moderado';
                } else {
                    riesgo = 'Alto riesgo hemorr√°gico';
                }
                riesgoEl.textContent = riesgo;
            }
            
            updateDashboard();
            generateConclusion();
        }

        function calculateTIMI() {
            let score = 0;
            
            if (document.getElementById('timi-edad')?.checked) score += 1;
            if (document.getElementById('timi-factores')?.checked) score += 1;
            if (document.getElementById('timi-estenosis')?.checked) score += 1;
            if (document.getElementById('timi-st')?.checked) score += 1;
            if (document.getElementById('timi-angina')?.checked) score += 1;
            if (document.getElementById('timi-aspirina')?.checked) score += 1;
            if (document.getElementById('timi-marcadores')?.checked) score += 1;
            
            const scoreEl = document.getElementById('timi-score');
            const riesgoEl = document.getElementById('timi-riesgo');
            
            if (scoreEl) scoreEl.textContent = score;
            
            if (riesgoEl) {
                const riesgos = {
                    0: '4.7%', 1: '8.3%', 2: '16.2%', 3: '24.2%',
                    4: '36.9%', 5: '50.8%', 6: '64.7%', 7: '70.8%'
                };
                riesgoEl.textContent = riesgos[score] || '--';
            }
            
            updateDashboard();
            generateConclusion();
        }

        function evaluate6MWT() {
            const distancia = parseFloat(document.getElementById('marcha-6min')?.value);
            const borg = document.getElementById('borg-disnea')?.value;
            
            const capacidadEl = document.getElementById('capacidad-funcional');
            const porcentajeEl = document.getElementById('porcentaje-predicho');
            
            if (distancia && capacidadEl) {
                let capacidad = '';
                if (distancia >= 500) {
                    capacidad = 'Excelente';
                } else if (distancia >= 400) {
                    capacidad = 'Buena';
                } else if (distancia >= 300) {
                    capacidad = 'Regular';
                } else {
                    capacidad = 'Limitada';
                }
                capacidadEl.textContent = capacidad;
                
                // C√°lculo aproximado del porcentaje predicho (f√≥rmula simplificada)
                const predicho = 600; // Valor promedio aproximado
                const porcentaje = Math.round((distancia / predicho) * 100);
                if (porcentajeEl) porcentajeEl.textContent = `${porcentaje}%`;
            }
            
            updateDashboard();
            generateConclusion();
        }

        // Funci√≥n para agregar event listeners adicionales
        function addAdvancedEventListeners() {
            // Event listeners para escalas de riesgo
            document.querySelectorAll('[id^="chads-"]').forEach(el => {
                el.addEventListener('change', calculateCHADS);
            });
            
            document.querySelectorAll('[id^="hasbled-"]').forEach(el => {
                el.addEventListener('change', calculateHASBLED);
            });
            
            document.querySelectorAll('[id^="timi-"]').forEach(el => {
                el.addEventListener('change', calculateTIMI);
            });
            
            // Event listeners para ITB
            document.querySelectorAll('[id^="pa-brazo-"], [id^="pa-tobillo-"]').forEach(el => {
                el.addEventListener('change', calculateITB);
            });
            
            // Event listeners para test de marcha
            const marcha6min = document.getElementById('marcha-6min');
            if (marcha6min) marcha6min.addEventListener('change', evaluate6MWT);
            
            const borgDisnea = document.getElementById('borg-disnea');
            if (borgDisnea) borgDisnea.addEventListener('change', evaluate6MWT);
            
            // Event listeners para soplos
            document.querySelectorAll('input[id*="soplo-"]').forEach(el => {
                if (el.type === 'checkbox') {
                    el.addEventListener('change', (e) => {
                        const idParts = e.target.id.split('-');
                        if (idParts.length >= 3) {
                            const timing = idParts[1];
                            const location = idParts[2];
                            handleMurmurToggle(location, timing);
                        }
                    });
                }
            });
        }

        // Mejorar la funci√≥n de inicializaci√≥n existente
        document.addEventListener('DOMContentLoaded', function() {
            // C√≥digo de inicializaci√≥n existente...
            
            // Agregar los nuevos event listeners
            addAdvancedEventListeners();
            
            // Inicializar c√°lculos
            calculateCHADS();
            calculateHASBLED();
            calculateTIMI();
            calculateITB();
            evaluate6MWT();
            
            console.log('üè• Sistema Cardiovascular Premium completamente cargado!');
        });

        // Funci√≥n adicional para exportar datos
        function exportData() {
            const data = {
                timestamp: new Date().toISOString(),
                quejas: [],
                signosVitales: {},
                examenFisico: {},
                auscultacion: {},
                escalas: {}
            };
            
            // Recopilar datos del formulario
            document.querySelectorAll('input[type="checkbox"]:checked').forEach(cb => {
                data.quejas.push({
                    id: cb.id,
                    label: document.querySelector(`label[for="${cb.id}"]`)?.textContent || cb.id
                });
            });
            
            // Guardar en localStorage para respaldo
            try {
                localStorage.setItem('cardiovascular-exam-backup', JSON.stringify(data));
                console.log('‚úÖ Datos exportados y respaldados exitosamente');
            } catch (e) {
                console.warn('‚ö†Ô∏è No se pudo guardar el respaldo autom√°tico');
            }
            
            return data;
        }

        // Funci√≥n para cargar datos exportados
        function loadBackupData() {
            try {
                const backup = localStorage.getItem('cardiovascular-exam-backup');
                if (backup) {
                    const data = JSON.parse(backup);
                    console.log('üìÅ Respaldo de datos encontrado:', data.timestamp);
                    return data;
                }
            } catch (e) {
                console.warn('‚ö†Ô∏è Error al cargar datos de respaldo');
            }
            return null;
        }

        // Auto-guardar cada 30 segundos
        setInterval(() => {
            if (document.querySelectorAll('input:checked, input[value]:not([value=""]), select:not([selectedIndex="0"])').length > 0) {
                exportData();
            }
        }, 30000);

    </script>
</body>
</html>