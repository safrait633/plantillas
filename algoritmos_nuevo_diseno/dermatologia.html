<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Examen Dermatol√≥gico - Algoritmo de Evaluaci√≥n</title>
    <link rel="stylesheet" href="assets/css/main.css">
    <link rel="stylesheet" href="assets/css/dashboard.css">
</head>
<body>
    <button class="theme-toggle" onclick="toggleTheme()" title="Cambiar tema">
        <i class="fas fa-moon" id="theme-icon"></i>
    </button>

    <a href="index.html" class="home-button" title="Inicio">
        <i class="fas fa-home"></i>
    </a>

    <div class="dashboard-fixed">
        <div class="dashboard-content">
            <div class="dashboard-grid">
                <div class="dashboard-item">
                    <i class="fas fa-user-md"></i>
                    <div>Examen</div>
                    <div id="exam-progress">0%</div>
                </div>
                <div class="dashboard-item">
                    <i class="fas fa-clipboard-list"></i>
                    <div>Secciones</div>
                    <div id="sections-completed">0/8</div> </div>
                <div class="dashboard-item dashboard-alert" id="alerts-item">
                    <i class="fas fa-exclamation-triangle"></i>
                    <div>Alertas</div>
                    <div id="alert-count">0</div>
                </div>
                <div class="dashboard-item dashboard-warning" id="warnings-item">
                    <i class="fas fa-exclamation-circle"></i>
                    <div>Avisos</div>
                    <div id="warning-count">0</div>
                </div>
                <div class="dashboard-item dashboard-normal" id="findings-item">
                    <i class="fas fa-search"></i>
                    <div>Hallazgos</div>
                    <div id="findings-count">0</div>
                </div>
                <div class="dashboard-item" id="quality-of-life-item">
                    <i class="fas fa-heart"></i>
                    <div>Calidad de Vida</div>
                    <div id="quality-of-life-status">Pendiente</div>
                </div>
            </div>
            <div class="control-bar">
                <button class="control-btn btn-primary" onclick="toggleNavPanel()">
                    <i class="fas fa-bars"></i> Navegaci√≥n
                </button>
                <button class="control-btn btn-primary" onclick="toggleStickyPanel()" id="sticky-toggle-btn">
                    <i class="fas fa-columns"></i> Vista Dividida
                </button>
                <button class="control-btn btn-success" onclick="generateConclusion()">
                    <i class="fas fa-file-medical"></i> Generar
                </button>
                <button class="control-btn btn-warning" onclick="expandAllSections()">
                    <i class="fas fa-expand-alt"></i> Expandir
                </button>
                <button class="control-btn btn-danger" onclick="clearForm()">
                    <i class="fas fa-trash"></i> Limpiar
                </button>
            </div>
        </div>
    </div>

    <div class="nav-panel" id="nav-panel">
        <h3><i class="fas fa-map"></i> Navegaci√≥n R√°pida</h3>
        <div class="nav-item" onclick="scrollToSection('antecedentes')">
            <i class="fas fa-user-injured"></i>
            <span>Antecedentes</span>
            <i class="fas fa-check" style="margin-left: auto; opacity: 0;" id="nav-antecedentes"></i>
        </div>
        <div class="nav-item" onclick="scrollToSection('anamnesis')">
            <i class="fas fa-notes-medical"></i>
            <span>Anamnesis</span>
            <i class="fas fa-check" style="margin-left: auto; opacity: 0;" id="nav-anamnesis"></i>
        </div>
        <div class="nav-item" onclick="scrollToSection('lesiones-pigmentadas')">
            <i class="fas fa-microscope"></i>
            <span>Lesiones Pig. (ABCDE)</span>
            <i class="fas fa-check" style="margin-left: auto; opacity: 0;" id="nav-lesiones-pigmentadas"></i>
        </div>
        <div class="nav-item" onclick="scrollToSection('primary-lesions')">
            <i class="fas fa-diagnoses"></i>
            <span>Lesiones Primarias</span>
            <i class="fas fa-check" style="margin-left: auto; opacity: 0;" id="nav-primary-lesions"></i>
        </div>
        <div class="nav-item" onclick="scrollToSection('secondary-lesions')">
            <i class="fas fa-virus-slash"></i>
            <span>Lesiones Secundarias</span>
            <i class="fas fa-check" style="margin-left: auto; opacity: 0;" id="nav-secondary-lesions"></i>
        </div>
        <div class="nav-item" onclick="scrollToSection('distribution')">
            <i class="fas fa-map-marked-alt"></i>
            <span>Distribuci√≥n</span>
            <i class="fas fa-check" style="margin-left: auto; opacity: 0;" id="nav-distribution"></i>
        </div>
        <div class="nav-item" onclick="scrollToSection('appendages')">
            <i class="fas fa-dna"></i>
            <span>Anexos Cut√°neos</span>
            <i class="fas fa-check" style="margin-left: auto; opacity: 0;" id="nav-appendages"></i>
        </div>
        <div class="nav-item" onclick="scrollToSection('special-tests')">
            <i class="fas fa-vials"></i>
            <span>Pruebas Especiales</span>
            <i class="fas fa-check" style="margin-left: auto; opacity: 0;" id="nav-special-tests"></i>
        </div>
        <div class="nav-item" onclick="scrollToSection('severity')">
            <i class="fas fa-chart-line"></i>
            <span>Evaluaci√≥n Severidad</span>
            <i class="fas fa-check" style="margin-left: auto; opacity: 0;" id="nav-severity"></i>
        </div>
    </div>

    <div class="sticky-panel" id="stickyConclusion">
        <div class="sticky-header">
            <span><i class="fas fa-file-medical-alt"></i> Informe en Tiempo Real</span>
            <div class="sticky-controls">
                <button class="sticky-btn" onclick="copyStickyToClipboard()" title="Copiar informe">
                    <i class="fas fa-copy"></i>
                </button>
                <button class="sticky-btn" onclick="printStickyConclusion()" title="Imprimir informe">
                    <i class="fas fa-print"></i>
                </button>
                <button class="sticky-btn" onclick="generateStickyConclusion()" title="Actualizar informe">
                    <i class="fas fa-sync-alt"></i>
                </button>
            </div>
        </div>
        <div class="sticky-content" id="stickyContent">
            Seleccione los par√°metros del examen para generar el informe en tiempo real...
        </div>
        <div class="update-indicator" id="updateIndicator">
            <div class="spinner"></div>
            <span>Actualizando informe...</span>
        </div>
    </div>

    <div class="copy-notification" id="copyNotification">
        <i class="fas fa-check-circle"></i>
        <span>¬°Informe copiado al portapapeles!</span>
    </div>

    <div class="main-container">
        <h1><i class="fas fa-user-tag"></i> Examen Dermatol√≥gico - Algoritmo de Evaluaci√≥n</h1> <div class="section" id="section-antecedentes">
            <div class="section-header" onclick="toggleSection(this)">
                <span><i class="fas fa-history"></i> Antecedentes</span> <div style="display: flex; align-items: center;">
                    <div class="completion-badge" id="badge-antecedentes">
                        <i class="fas fa-circle"></i>
                    </div>
                    <span class="arrow">‚ñº</span>
                </div>
            </div>
            <div class="section-content" id="antecedentes">
                <div class="exam-container">
                    <div class="exam-header"><i class="fas fa-notes-medical"></i> Antecedentes Personales Patol√≥gicos</div>
                    <div class="exam-section">
                        <h4>Alergias Conocidas</h4>
                        <div class="checkbox-grid">
                            <div class="checkbox-item">
                                <input type="checkbox" id="alergia-medicamentos" onchange="toggleSpecification('alergia-medicamentos', 'spec-medicamentos')">
                                <label for="alergia-medicamentos">Medicamentos</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="alergia-alimentos" onchange="toggleSpecification('alergia-alimentos', 'spec-alimentos')">
                                <label for="alergia-alimentos">Alimentos</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="alergia-contacto" onchange="toggleSpecification('alergia-contacto', 'spec-contacto')">
                                <label for="alergia-contacto">Al√©rgenos de contacto</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="sin-alergias" onchange="toggleSinAlergias()">
                                <label for="sin-alergias">Sin alergias conocidas</label>
                            </div>
                        </div>
                        <input type="text" class="specification-field" id="spec-medicamentos" placeholder="Especificar medicamentos...">
                        <input type="text" class="specification-field" id="spec-alimentos" placeholder="Especificar alimentos...">
                        <input type="text" class="specification-field" id="spec-contacto" placeholder="Especificar al√©rgenos...">
                    </div>

                    <div class="exam-section">
                        <h4>Historia de Atopia</h4>
                        <div class="checkbox-grid">
                            <div class="checkbox-item"><input type="checkbox" id="asma-bronquial"><label for="asma-bronquial">Asma bronquial</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="rinitis-alergica"><label for="rinitis-alergica">Rinitis al√©rgica</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="dermatitis-atopica"><label for="dermatitis-atopica">Dermatitis at√≥pica</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="conjuntivitis-alergica"><label for="conjuntivitis-alergica">Conjuntivitis al√©rgica</label></div>
                        </div>
                    </div>

                    <div class="exam-section">
                        <h4>Enfermedades Cr√≥nicas</h4>
                        <div class="checkbox-grid">
                            <div class="checkbox-item"><input type="checkbox" id="diabetes"><label for="diabetes">Diabetes mellitus</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="hipertension"><label for="hipertension">Hipertensi√≥n arterial</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="enf-autoinmune"><label for="enf-autoinmune">Enfermedad autoinmune</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="cancer-piel"><label for="cancer-piel">Historia de c√°ncer de piel</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="inmunodepresion"><label for="inmunodepresion">Inmunodepresi√≥n</label></div>
                        </div>
                    </div>
                </div>

                <div class="exam-container">
                    <div class="exam-header"><i class="fas fa-users"></i> Antecedentes Familiares</div>
                    <div class="exam-section">
                        <div class="checkbox-grid">
                            <div class="checkbox-item"><input type="checkbox" id="fam-psoriasis"><label for="fam-psoriasis">Psoriasis</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="fam-atopia"><label for="fam-atopia">Atopia</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="fam-melanoma"><label for="fam-melanoma">Melanoma</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="fam-cancer-piel"><label for="fam-cancer-piel">C√°ncer de piel no melanoma</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="fam-vitiligo"><label for="fam-vitiligo">Vit√≠ligo</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="sin-antec-fam" onchange="toggleSinAntecedentesFam()"><label for="sin-antec-fam">Sin antecedentes familiares relevantes</label></div>
                        </div>
                    </div>
                </div>

                <div class="exam-container">
                    <div class="exam-header"><i class="fas fa-pills"></i> Tratamientos Previos y Actuales</div>
                    <div class="exam-section">
                        <h4>Tratamientos para la Condici√≥n Actual</h4>
                        <textarea class="description-area" id="tratamientos-previos" placeholder="Detallar tratamientos utilizados (t√≥picos, sist√©micos) y resultados obtenidos..."></textarea>
                    </div>
                    <div class="exam-section">
                        <h4>Medicaci√≥n Habitual</h4>
                        <textarea class="description-area" id="medicacion-habitual" placeholder="Listar medicaci√≥n actual no relacionada directamente con la condici√≥n dermatol√≥gica..."></textarea>
                    </div>
                </div>
            </div>
        </div>

        <div class="section" id="section-anamnesis">
            <div class="section-header" onclick="toggleSection(this)">
                <span><i class="fas fa-question-circle"></i> Anamnesis y Quejas Principales</span>
                <div style="display: flex; align-items: center;">
                    <div class="completion-badge" id="badge-anamnesis">
                        <i class="fas fa-circle"></i>
                    </div>
                    <span class="arrow">‚ñº</span>
                </div>
            </div>
            <div class="section-content" id="anamnesis">
                <div class="exam-container">
                    <div class="exam-header"><i class="fas fa-hand-holding-medical"></i> Quejas Dermatol√≥gicas Principales</div>
                    <div class="checkbox-grid">
                        <div class="checkbox-item"><input type="checkbox" id="prurito"><label for="prurito">Prurito</label></div>
                        <div class="checkbox-item"><input type="checkbox" id="dolor-cutaneo"><label for="dolor-cutaneo">Dolor cut√°neo</label></div>
                        <div class="checkbox-item"><input type="checkbox" id="ardor"><label for="ardor">Ardor/Quemaz√≥n</label></div>
                        <div class="checkbox-item"><input type="checkbox" id="erupciones"><label for="erupciones">Erupciones cut√°neas</label></div>
                        <div class="checkbox-item"><input type="checkbox" id="descamacion"><label for="descamacion">Descamaci√≥n</label></div>
                        <div class="checkbox-item"><input type="checkbox" id="cambio-color"><label for="cambio-color">Cambio de coloraci√≥n</label></div>
                        <div class="checkbox-item"><input type="checkbox" id="caida-cabello"><label for="caida-cabello">Ca√≠da del cabello</label></div>
                        <div class="checkbox-item"><input type="checkbox" id="cambios-unas"><label for="cambios-unas">Cambios en u√±as</label></div>
                        <div class="checkbox-item"><input type="checkbox" id="lesiones-mucosas"><label for="lesiones-mucosas">Lesiones en mucosas</label></div>
                        <div class="checkbox-item"><input type="checkbox" id="fotosensibilidad"><label for="fotosensibilidad">Fotosensibilidad</label></div>
                        <div class="checkbox-item"><input type="checkbox" id="sin-quejas" onchange="handleNoComplaints()"><label for="sin-quejas">Sin quejas</label></div>
                    </div>
                </div>

                <div class="exam-container">
                    <div class="exam-header"><i class="fas fa-clock"></i> Caracter√≠sticas Temporales</div>
                    <div class="exam-section">
                        <h4>Tiempo de evoluci√≥n</h4>
                        <div class="checkbox-grid">
                            <div class="checkbox-item"><input type="radio" name="tiempo-evolucion" id="agudo"><label for="agudo">Agudo (&lt; 6 semanas)</label></div>
                            <div class="checkbox-item"><input type="radio" name="tiempo-evolucion" id="subagudo"><label for="subagudo">Subagudo (6 semanas - 3 meses)</label></div>
                            <div class="checkbox-item"><input type="radio" name="tiempo-evolucion" id="cronico"><label for="cronico">Cr√≥nico (&gt; 3 meses)</label></div>
                        </div>
                    </div>
                    <div class="exam-section">
                        <h4>Patr√≥n de presentaci√≥n</h4>
                        <div class="checkbox-grid">
                            <div class="checkbox-item"><input type="checkbox" id="episodico"><label for="episodico">Epis√≥dico/Recurrente</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="persistente"><label for="persistente">Persistente</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="estacional"><label for="estacional">Estacional</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="primera-vez"><label for="primera-vez">Primera vez</label></div>
                        </div>
                    </div>
                </div>

                <div class="exam-container">
                    <div class="exam-header"><i class="fas fa-exclamation-triangle"></i> Factores Desencadenantes</div>
                    <div class="checkbox-grid">
                        <div class="checkbox-item"><input type="checkbox" id="exposicion-solar"><label for="exposicion-solar">Exposici√≥n solar</label></div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="contacto-quimicos" onchange="toggleSpecification('contacto-quimicos', 'spec-quimicos')">
                            <label for="contacto-quimicos">Contacto con qu√≠micos</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="nuevos-cosmeticos" onchange="toggleSpecification('nuevos-cosmeticos', 'spec-cosmeticos')">
                            <label for="nuevos-cosmeticos">Nuevos cosm√©ticos</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="medicamentos-factor" onchange="toggleSpecification('medicamentos-factor', 'spec-medicamentos-factor')">
                            <label for="medicamentos-factor">Medicamentos</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="alimentos-factor" onchange="toggleSpecification('alimentos-factor', 'spec-alimentos-factor')">
                            <label for="alimentos-factor">Alimentos</label>
                        </div>
                        <div class="checkbox-item"><input type="checkbox" id="estres"><label for="estres">Estr√©s</label></div>
                        <div class="checkbox-item"><input type="checkbox" id="infecciones"><label for="infecciones">Infecciones previas</label></div>
                        <div class="checkbox-item"><input type="checkbox" id="cambios-hormonales"><label for="cambios-hormonales">Cambios hormonales</label></div>
                        <div class="checkbox-item"><input type="checkbox" id="picaduras"><label for="picaduras">Picaduras de insectos</label></div>
                        <div class="checkbox-item"><input type="checkbox" id="contacto-animales"><label for="contacto-animales">Contacto con animales</label></div>
                    </div>
                    <input type="text" class="specification-field" id="spec-quimicos" placeholder="Especificar qu√≠micos...">
                    <input type="text" class="specification-field" id="spec-cosmeticos" placeholder="Especificar cosm√©ticos...">
                    <input type="text" class="specification-field" id="spec-medicamentos-factor" placeholder="Especificar medicamentos...">
                    <input type="text" class="specification-field" id="spec-alimentos-factor" placeholder="Especificar alimentos...">
                </div>
            </div>
        </div>

        <div class="section" id="section-lesiones-pigmentadas">
            <div class="section-header" onclick="toggleSection(this)">
                <span><i class="fas fa-eye-dropper"></i> Evaluaci√≥n de Lesiones Pigmentadas (Regla ABCDE)</span>
                <div style="display: flex; align-items: center;">
                    <div class="completion-badge" id="badge-lesiones-pigmentadas">
                        <i class="fas fa-circle"></i>
                    </div>
                    <span class="arrow">‚ñº</span>
                </div>
            </div>
            <div class="section-content" id="lesiones-pigmentadas">
                <div class="exam-container">
                    <div class="exam-header"><i class="fas fa-sun"></i> Presencia de Lesiones Pigmentadas</div>
                    <div class="exam-section">
                        <div class="checkbox-grid">
                            <div class="checkbox-item">
                                <input type="checkbox" id="tiene-nevus" onchange="toggleABCDESection()">
                                <label for="tiene-nevus">Paciente presenta nevus/lunares para evaluar</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="lesion-sospechosa" onchange="toggleABCDESection()">
                                <label for="lesion-sospechosa">Lesi√≥n pigmentada sospechosa</label>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="abcde-section" id="abcde-evaluation" style="display: none;">
                    <h4>üîç REGLA ABCDE PARA EVALUACI√ìN DE MELANOMA</h4>
                    <div class="abcde-grid">
                        <div class="abcde-item">
                            <div class="abcde-letter">A - ASIMETR√çA</div>
                            <div class="abcde-description">Una mitad de la lesi√≥n es diferente a la otra</div>
                            <div class="checkbox-grid">
                                <div class="checkbox-item"><input type="radio" name="abcde-asimetria" id="asimetria-si"><label for="asimetria-si">Asim√©trica</label></div>
                                <div class="checkbox-item"><input type="radio" name="abcde-asimetria" id="asimetria-no"><label for="asimetria-no">Sim√©trica</label></div>
                            </div>
                        </div>

                        <div class="abcde-item">
                            <div class="abcde-letter">B - BORDES</div>
                            <div class="abcde-description">Bordes irregulares, dentados o mal definidos</div>
                            <div class="checkbox-grid">
                                <div class="checkbox-item"><input type="radio" name="abcde-bordes" id="bordes-irregulares"><label for="bordes-irregulares">Irregulares</label></div>
                                <div class="checkbox-item"><input type="radio" name="abcde-bordes" id="bordes-regulares"><label for="bordes-regulares">Regulares</label></div>
                            </div>
                        </div>

                        <div class="abcde-item">
                            <div class="abcde-letter">C - COLOR</div>
                            <div class="abcde-description">M√∫ltiples colores o color no uniforme</div>
                            <div class="checkbox-grid">
                                <div class="checkbox-item"><input type="checkbox" id="color-negro"><label for="color-negro">Negro</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="color-marron"><label for="color-marron">Marr√≥n</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="color-azul"><label for="color-azul">Azul</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="color-rojo"><label for="color-rojo">Rojo</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="color-blanco"><label for="color-blanco">Blanco</label></div>
                                <div class="checkbox-item"><input type="radio" name="abcde-color" id="color-uniforme"><label for="color-uniforme">Uniforme</label></div>
                            </div>
                        </div>

                        <div class="abcde-item">
                            <div class="abcde-letter">D - DI√ÅMETRO</div>
                            <div class="abcde-description">Mayor a 6 mm (tama√±o de borrador de l√°piz)</div>
                            <div class="measurement">
                                <label>Di√°metro mayor:</label>
                                <input type="number" class="input-field" id="abcde-diametro" min="0" max="100" onchange="evaluateDiameter()">
                                <span>mm</span>
                            </div>
                            <div class="checkbox-grid" style="margin-top: 8px;">
                                <div class="checkbox-item"><input type="radio" name="abcde-diametro-eval" id="diametro-mayor-6"><label for="diametro-mayor-6">&gt; 6 mm</label></div>
                                <div class="checkbox-item"><input type="radio" name="abcde-diametro-eval" id="diametro-menor-6"><label for="diametro-menor-6">‚â§ 6 mm</label></div>
                            </div>
                        </div>

                        <div class="abcde-item">
                            <div class="abcde-letter">E - EVOLUCI√ìN</div>
                            <div class="abcde-description">Cambios recientes en tama√±o, forma o color</div>
                            <div class="checkbox-grid">
                                <div class="checkbox-item"><input type="checkbox" id="evol-tama√±o"><label for="evol-tama√±o">Cambio de tama√±o</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="evol-forma"><label for="evol-forma">Cambio de forma</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="evol-color"><label for="evol-color">Cambio de color</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="evol-sintomas"><label for="evol-sintomas">Nuevos s√≠ntomas</label></div>
                                <div class="checkbox-item"><input type="radio" name="abcde-evolucion" id="sin-cambios"><label for="sin-cambios">Sin cambios</label></div>
                            </div>
                        </div>
                    </div>

                    <div class="score-calculation" style="margin-top: 20px;">
                        <h4>üö® EVALUACI√ìN DE RIESGO</h4>
                        <div class="score-item">
                            <span>Criterios positivos:</span>
                            <span class="score-value" id="abcde-score">0/5</span>
                        </div>
                        <div class="score-item">
                            <span>Nivel de riesgo:</span>
                            <span class="score-value" id="abcde-risk">Bajo</span>
                        </div>
                        <div style="margin-top: 10px; font-size: 12px; color: var(--text-color-light);">
                            <strong>Recomendaci√≥n:</strong> <span id="abcde-recommendation">Seguimiento de rutina</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="section" id="section-primary-lesions">
            <div class="section-header" onclick="toggleSection(this)">
                <span><i class="fas fa-viruses"></i> Elementos Primarios de las Lesiones Cut√°neas</span>
                <div style="display: flex; align-items: center;">
                    <div class="completion-badge" id="badge-primary-lesions">
                        <i class="fas fa-circle"></i>
                    </div>
                    <span class="arrow">‚ñº</span>
                </div>
            </div>
            <div class="section-content" id="primary-lesions">
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-color primary-color"></div>
                        <span>Elementos Primarios</span>
                    </div>
                </div>

                <div class="morphology-grid">
                    <div class="morphology-section">
                        <h5>Lesiones Planas</h5>
                        <div class="exam-section">
                            <h4>M√°culas y Manchas</h4>
                            <div class="checkbox-grid">
                                <div class="checkbox-item"><input type="checkbox" id="macula-hiperpigmentada"><label for="macula-hiperpigmentada">M√°cula hiperpigmentada</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="macula-hipopigmentada"><label for="macula-hipopigmentada">M√°cula hipopigmentada</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="macula-eritematosa"><label for="macula-eritematosa">M√°cula eritematosa</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="macula-purpurica"><label for="macula-purpurica">M√°cula purp√∫rica</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="petequias"><label for="petequias">Petequias</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="equimosis"><label for="equimosis">Equimosis</label></div>
                            </div>
                            <div class="measurement">
                                <label>Tama√±o promedio:</label>
                                <input type="number" class="input-field" id="macula-size" min="0" max="100">
                                <span>mm</span>
                            </div>
                        </div>
                    </div>

                    <div class="morphology-section">
                        <h5>Lesiones Elevadas S√≥lidas</h5>
                        <div class="exam-section">
                            <h4>P√°pulas</h4>
                            <div class="checkbox-grid">
                                <div class="checkbox-item"><input type="checkbox" id="papula-eritematosa"><label for="papula-eritematosa">P√°pula eritematosa</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="papula-normocromica"><label for="papula-normocromica">P√°pula normocr√≥mica</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="papula-pigmentada"><label for="papula-pigmentada">P√°pula pigmentada</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="papula-perlada"><label for="papula-perlada">P√°pula perlada</label></div>
                            </div>
                            <div class="measurement">
                                <label>Tama√±o promedio:</label>
                                <input type="number" class="input-field" id="papula-size" min="0" max="50">
                                <span>mm (&lt;5mm)</span>
                            </div>
                        </div>
                        <div class="exam-section">
                            <h4>Placas</h4>
                            <div class="checkbox-grid">
                                <div class="checkbox-item"><input type="checkbox" id="placa-eritematosa"><label for="placa-eritematosa">Placa eritematosa</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="placa-escamosa"><label for="placa-escamosa">Placa escamosa</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="placa-liquenificada"><label for="placa-liquenificada">Placa liquenificada</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="placa-infiltrada"><label for="placa-infiltrada">Placa infiltrada</label></div>
                            </div>
                            <div class="measurement">
                                <label>Tama√±o promedio:</label>
                                <input type="number" class="input-field" id="placa-size" min="5" max="200">
                                <span>mm (&gt;5mm)</span>
                            </div>
                        </div>
                        <div class="exam-section">
                            <h4>N√≥dulos</h4>
                            <div class="checkbox-grid">
                                <div class="checkbox-item"><input type="checkbox" id="nodulo-subcutaneo"><label for="nodulo-subcutaneo">N√≥dulo subcut√°neo</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="nodulo-dermico"><label for="nodulo-dermico">N√≥dulo d√©rmico</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="nodulo-doloroso"><label for="nodulo-doloroso">N√≥dulo doloroso</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="nodulo-no-doloroso"><label for="nodulo-no-doloroso">N√≥dulo no doloroso</label></div>
                            </div>
                            <div class="measurement">
                                <label>Tama√±o promedio:</label>
                                <input type="number" class="input-field" id="nodulo-size" min="5" max="50">
                                <span>mm</span>
                            </div>
                        </div>
                    </div>

                    <div class="morphology-section">
                        <h5>Lesiones con Contenido L√≠quido</h5>
                        <div class="exam-section">
                            <h4>Ves√≠culas</h4>
                            <div class="checkbox-grid">
                                <div class="checkbox-item"><input type="checkbox" id="vesicula-clara"><label for="vesicula-clara">Ves√≠cula de contenido claro</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="vesicula-turbia"><label for="vesicula-turbia">Ves√≠cula de contenido turbio</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="vesicula-hemorrhagica"><label for="vesicula-hemorrhagica">Ves√≠cula hemorr√°gica</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="vesicula-herpetiforme"><label for="vesicula-herpetiforme">Ves√≠cula herpetiforme</label></div>
                            </div>
                            <div class="measurement">
                                <label>Tama√±o promedio:</label>
                                <input type="number" class="input-field" id="vesicula-size" min="1" max="10">
                                <span>mm (&lt;5mm)</span>
                            </div>
                        </div>
                        <div class="exam-section">
                            <h4>Ampollas/Bulas</h4>
                            <div class="checkbox-grid">
                                <div class="checkbox-item"><input type="checkbox" id="ampolla-clara"><label for="ampolla-clara">Ampolla de contenido claro</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="ampolla-hemorrhagica"><label for="ampolla-hemorrhagica">Ampolla hemorr√°gica</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="ampolla-tensa"><label for="ampolla-tensa">Ampolla tensa</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="ampolla-flacida"><label for="ampolla-flacida">Ampolla fl√°ccida</label></div>
                            </div>
                            <div class="measurement">
                                <label>Tama√±o promedio:</label>
                                <input type="number" class="input-field" id="ampolla-size" min="5" max="100">
                                <span>mm (&gt;5mm)</span>
                            </div>
                        </div>
                        <div class="exam-section">
                            <h4>P√∫stulas</h4>
                            <div class="checkbox-grid">
                                <div class="checkbox-item"><input type="checkbox" id="pustula-folicular"><label for="pustula-folicular">P√∫stula folicular</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="pustula-no-folicular"><label for="pustula-no-folicular">P√∫stula no folicular</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="pustula-esteril"><label for="pustula-esteril">P√∫stula est√©ril</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="pustula-infectada"><label for="pustula-infectada">P√∫stula infectada</label></div>
                            </div>
                            <div class="measurement">
                                <label>Tama√±o promedio:</label>
                                <input type="number" class="input-field" id="pustula-size" min="1" max="20">
                                <span>mm</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="section" id="section-secondary-lesions">
            <div class="section-header" onclick="toggleSection(this)">
                <span><i class="fas fa-burn"></i> Elementos Secundarios de las Lesiones Cut√°neas</span>
                <div style="display: flex; align-items: center;">
                    <div class="completion-badge" id="badge-secondary-lesions">
                        <i class="fas fa-circle"></i>
                    </div>
                    <span class="arrow">‚ñº</span>
                </div>
            </div>
            <div class="section-content" id="secondary-lesions">
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-color secondary-color"></div>
                        <span>Elementos Secundarios</span>
                    </div>
                </div>

                <div class="morphology-grid">
                    <div class="morphology-section">
                        <h5>P√©rdida de Sustancia</h5>
                        <div class="exam-section">
                            <h4>Erosiones y Excoriaciones</h4>
                            <div class="checkbox-grid">
                                <div class="checkbox-item"><input type="checkbox" id="erosion-superficial"><label for="erosion-superficial">Erosi√≥n superficial</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="excoriacion-lineal"><label for="excoriacion-lineal">Excoriaci√≥n lineal</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="excoriacion-puntiforme"><label for="excoriacion-puntiforme">Excoriaci√≥n puntiforme</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="erosion-post-ampolla"><label for="erosion-post-ampolla">Erosi√≥n post-ampolla</label></div>
                            </div>
                        </div>
                        <div class="exam-section">
                            <h4>√ölceras</h4>
                            <div class="checkbox-grid">
                                <div class="checkbox-item"><input type="checkbox" id="ulcera-superficial"><label for="ulcera-superficial">√ölcera superficial</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="ulcera-profunda"><label for="ulcera-profunda">√ölcera profunda</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="ulcera-bordes-regulares"><label for="ulcera-bordes-regulares">Bordes regulares</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="ulcera-bordes-irregulares"><label for="ulcera-bordes-irregulares">Bordes irregulares</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="ulcera-bordes-sobreelevados"><label for="ulcera-bordes-sobreelevados">Bordes sobreelevados</label></div>
                            </div>
                            <div class="measurement">
                                <label>Tama√±o mayor:</label>
                                <input type="number" class="input-field" id="ulcera-size" min="1" max="500">
                                <span>mm</span>
                            </div>
                        </div>
                    </div>

                    <div class="morphology-section">
                        <h5>Dep√≥sitos y Acumulaciones</h5>
                        <div class="exam-section">
                            <h4>Escamas</h4>
                            <div class="checkbox-grid">
                                <div class="checkbox-item"><input type="checkbox" id="escamas-finas"><label for="escamas-finas">Escamas finas</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="escamas-gruesas"><label for="escamas-gruesas">Escamas gruesas</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="escamas-plateadas"><label for="escamas-plateadas">Escamas plateadas</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="escamas-oleosas"><label for="escamas-oleosas">Escamas oleosas</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="descamacion-en-copos"><label for="descamacion-en-copos">Descamaci√≥n en copos</label></div>
                            </div>
                        </div>
                        <div class="exam-section">
                            <h4>Costras</h4>
                            <div class="checkbox-grid">
                                <div class="checkbox-item"><input type="checkbox" id="costra-serotica"><label for="costra-serotica">Costra ser√≥tica (amarillenta)</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="costra-hemorrhagica"><label for="costra-hemorrhagica">Costra hemorr√°gica</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="costra-purulenta"><label for="costra-purulenta">Costra purulenta</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="costra-melicerica"><label for="costra-melicerica">Costra melic√©rica</label></div>
                            </div>
                        </div>
                        <div class="exam-section">
                            <h4>Hiperqueratosis</h4>
                            <div class="checkbox-grid">
                                <div class="checkbox-item"><input type="checkbox" id="hiperqueratosis-difusa"><label for="hiperqueratosis-difusa">Hiperqueratosis difusa</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="hiperqueratosis-localizada"><label for="hiperqueratosis-localizada">Hiperqueratosis localizada</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="callos"><label for="callos">Callos</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="cuernos-cutaneos"><label for="cuernos-cutaneos">Cuernos cut√°neos</label></div>
                            </div>
                        </div>
                    </div>

                    <div class="morphology-section">
                        <h5>Cambios de Textura</h5>
                        <div class="exam-section">
                            <h4>Liquenificaci√≥n</h4>
                            <div class="checkbox-grid">
                                <div class="checkbox-item"><input type="checkbox" id="liquenificacion-leve"><label for="liquenificacion-leve">Liquenificaci√≥n leve</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="liquenificacion-moderada"><label for="liquenificacion-moderada">Liquenificaci√≥n moderada</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="liquenificacion-severa"><label for="liquenificacion-severa">Liquenificaci√≥n severa</label></div>
                            </div>
                        </div>
                        <div class="exam-section">
                            <h4>Atrofia</h4>
                            <div class="checkbox-grid">
                                <div class="checkbox-item"><input type="checkbox" id="atrofia-epidermica"><label for="atrofia-epidermica">Atrofia epid√©rmica</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="atrofia-dermica"><label for="atrofia-dermica">Atrofia d√©rmica</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="atrofia-subcutanea"><label for="atrofia-subcutanea">Atrofia subcut√°nea</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="piel-papel-cigarro"><label for="piel-papel-cigarro">Piel en papel de cigarrillo</label></div>
                            </div>
                        </div>
                        <div class="exam-section">
                            <h4>Cicatrices</h4>
                            <div class="checkbox-grid">
                                <div class="checkbox-item"><input type="checkbox" id="cicatriz-atrofica"><label for="cicatriz-atrofica">Cicatriz atr√≥fica</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="cicatriz-hipertrofica"><label for="cicatriz-hipertrofica">Cicatriz hipertr√≥fica</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="queloides"><label for="queloides">Queloides</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="cicatrices-varioliformes"><label for="cicatrices-varioliformes">Cicatrices varioliformes</label></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="section" id="section-distribution">
                <div class="section-header" onclick="toggleSection(this)">
                    <span><i class="fas fa-map-marker-alt"></i> Distribuci√≥n y Localizaci√≥n de las Lesiones</span>
                    <div style="display: flex; align-items: center;">
                        <div class="completion-badge" id="badge-distribution">
                            <i class="fas fa-circle"></i>
                        </div>
                        <span class="arrow">‚ñº</span>
                    </div>
                </div>
                <div class="section-content" id="distribution">
                    <div class="exam-container">
                        <div class="exam-header"><i class="fas fa-sitemap"></i> Patr√≥n de Distribuci√≥n</div>
                        <div class="exam-section">
                            <h4>Distribuci√≥n General</h4>
                            <div class="checkbox-grid">
                                <div class="checkbox-item"><input type="checkbox" id="dist-localizada"><label for="dist-localizada">Localizada</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="dist-regional"><label for="dist-regional">Regional</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="dist-generalizada"><label for="dist-generalizada">Generalizada</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="dist-universal"><label for="dist-universal">Universal</label></div>
                            </div>
                        </div>
                        <div class="exam-section">
                            <h4>Patr√≥n Morfol√≥gico</h4>
                            <div class="checkbox-grid">
                                <div class="checkbox-item"><input type="checkbox" id="patron-simetrico"><label for="patron-simetrico">Sim√©trico</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="patron-asimetrico"><label for="patron-asimetrico">Asim√©trico</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="patron-linear"><label for="patron-linear">Lineal</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="patron-anular"><label for="patron-anular">Anular</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="patron-serpiginoso"><label for="patron-serpiginoso">Serpiginoso</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="patron-herpetiforme"><label for="patron-herpetiforme">Herpetiforme</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="patron-reticular"><label for="patron-reticular">Reticular</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="patron-corimbiforme"><label for="patron-corimbiforme">Corimbiforme</label></div>
                            </div>
                        </div>
                    </div>

                    <div class="exam-container">
                        <div class="exam-header">üó∫Ô∏è Localizaci√≥n Anat√≥mica - Mapa Corporal Interactivo</div>
                        <div class="interactive-body-map">
                            <div class="body-diagram">
                                <h6>Vista Frontal</h6>
                                <svg class="body-svg" id="body-front-svg" viewBox="0 0 240 480">
                                    <defs>
                                        <style>
                                            .body-part { fill: var(--light-bg); stroke: var(--text-color-light); stroke-width: 1; cursor: pointer; transition: fill 0.3s; }
                                            .body-part:hover { fill: var(--primary-gradient); }
                                            .body-part.selected { fill: var(--primary-gradient); } /* Usar gradiente para seleccionado */
                                            .body-text { font-size: 7px; fill: var(--text-color-light); text-anchor: middle; pointer-events: none; }
                                        </style>
                                    </defs>

                                    <circle class="body-part" data-area="Frente" cx="120" cy="25" r="18"/>
                                    <text class="body-text" x="120" y="28">Frente</text>

                                    <ellipse class="body-part" data-area="Ojo derecho" cx="110" cy="30" rx="6" ry="4"/>
                                    <text class="body-text" x="110" y="32">OD</text>

                                    <ellipse class="body-part" data-area="Ojo izquierdo" cx="130" cy="30" rx="6" ry="4"/>
                                    <text class="body-text" x="130" y="32">OI</text>

                                    <polygon class="body-part" data-area="Nariz" points="120,35 115,45 125,45"/>
                                    <text class="body-text" x="120" y="42">Nariz</text>

                                    <ellipse class="body-part" data-area="Mejilla derecha" cx="105" cy="38" rx="8" ry="6"/>
                                    <text class="body-text" x="105" y="40">MD</text>

                                    <ellipse class="body-part" data-area="Mejilla izquierda" cx="135" cy="38" rx="8" ry="6"/>
                                    <text class="body-text" x="135" y="40">MI</text>

                                    <ellipse class="body-part" data-area="Labios" cx="120" cy="48" rx="8" ry="3"/>
                                    <text class="body-text" x="120" y="50">Labios</text>

                                    <ellipse class="body-part" data-area="Barbilla" cx="120" cy="55" rx="6" ry="4"/>
                                    <text class="body-text" x="120" y="57">Barbilla</text>

                                    <rect class="body-part" data-area="Cuello anterior" x="110" y="60" width="20" height="15"/>
                                    <text class="body-text" x="120" y="70">Cuello</text>

                                    <rect class="body-part" data-area="Pecho superior" x="85" y="75" width="70" height="25"/>
                                    <text class="body-text" x="120" y="90">Pecho superior</text>

                                    <rect class="body-part" data-area="Pecho inferior" x="90" y="100" width="60" height="25"/>
                                    <text class="body-text" x="120" y="115">Pecho inferior</text>

                                    <rect class="body-part" data-area="Hombro derecho" x="70" y="75" width="15" height="20"/>
                                    <text class="body-text" x="77" y="87">HD</text>

                                    <rect class="body-part" data-area="Hombro izquierdo" x="155" y="75" width="15" height="20"/>
                                    <text class="body-text" x="162" y="87">HI</text>

                                    <rect class="body-part" data-area="Brazo derecho superior" x="50" y="95" width="20" height="35"/>
                                    <text class="body-text" x="60" y="115">BDS</text>

                                    <rect class="body-part" data-area="Brazo izquierdo superior" x="170" y="95" width="20" height="35"/>
                                    <text class="body-text" x="180" y="115">BIS</text>

                                    <circle class="body-part" data-area="Codo derecho" cx="60" cy="140" r="8"/>
                                    <text class="body-text" x="60" y="143">CD</text>

                                    <circle class="body-part" data-area="Codo izquierdo" cx="180" cy="140" r="8"/>
                                    <text class="body-text" x="180" y="143">CI</text>

                                    <rect class="body-part" data-area="Antebrazo derecho" x="55" y="148" width="15" height="40"/>
                                    <text class="body-text" x="62" y="170">ABD</text>

                                    <rect class="body-part" data-area="Antebrazo izquierdo" x="170" y="148" width="15" height="40"/>
                                    <text class="body-text" x="177" y="170">ABI</text>

                                    <circle class="body-part" data-area="Mu√±eca derecha" cx="62" cy="195" r="6"/>
                                    <text class="body-text" x="62" y="198">MuD</text>

                                    <circle class="body-part" data-area="Mu√±eca izquierda" cx="177" cy="195" r="6"/>
                                    <text class="body-text" x="177" y="198">MuI</text>

                                    <ellipse class="body-part" data-area="Mano derecha" cx="62" cy="210" rx="8" ry="12"/>
                                    <text class="body-text" x="62" y="213">MaD</text>

                                    <ellipse class="body-part" data-area="Mano izquierda" cx="177" cy="210" rx="8" ry="12"/>
                                    <text class="body-text" x="177" y="213">MaI</text>

                                    <rect class="body-part" data-area="Abdomen superior" x="95" y="125" width="50" height="20"/>
                                    <text class="body-text" x="120" y="138">Abd Sup</text>

                                    <rect class="body-part" data-area="Abdomen inferior" x="100" y="145" width="40" height="20"/>
                                    <text class="body-text" x="120" y="158">Abd Inf</text>

                                    <rect class="body-part" data-area="Regi√≥n inguinal derecha" x="100" y="165" width="15" height="15"/>
                                    <text class="body-text" x="107" y="175">RID</text>

                                    <rect class="body-part" data-area="Regi√≥n inguinal izquierda" x="125" y="165" width="15" height="15"/>
                                    <text class="body-text" x="132" y="175">RII</text>

                                    <rect class="body-part" data-area="Genitales externos" x="110" y="180" width="20" height="15"/>
                                    <text class="body-text" x="120" y="190">Genit</text>

                                    <rect class="body-part" data-area="Muslo derecho anterior" x="100" y="195" width="18" height="70"/>
                                    <text class="body-text" x="109" y="235">MDA</text>

                                    <rect class="body-part" data-area="Muslo izquierdo anterior" x="122" y="195" width="18" height="70"/>
                                    <text class="body-text" x="131" y="235">MIA</text>

                                    <circle class="body-part" data-area="Rodilla derecha anterior" cx="109" cy="275" r="10"/>
                                    <text class="body-text" x="109" y="278">RDA</text>

                                    <circle class="body-part" data-area="Rodilla izquierda anterior" cx="131" cy="275" r="10"/>
                                    <text class="body-text" x="131" y="278">RIA</text>

                                    <rect class="body-part" data-area="Pierna derecha anterior" x="104" y="285" width="15" height="70"/>
                                    <text class="body-text" x="111" y="325">PDA</text>

                                    <rect class="body-part" data-area="Pierna izquierda anterior" x="126" y="285" width="15" height="70"/>
                                    <text class="body-text" x="133" y="325">PIA</text>

                                    <circle class="body-part" data-area="Tobillo derecho anterior" cx="111" cy="365" r="8"/>
                                    <text class="body-text" x="111" y="368">TDA</text>

                                    <circle class="body-part" data-area="Tobillo izquierdo anterior" cx="133" cy="365" r="8"/>
                                    <text class="body-text" x="133" y="368">TIA</text>

                                    <ellipse class="body-part" data-area="Pie derecho dorsal" cx="111" cy="385" rx="12" ry="20"/>
                                    <text class="body-text" x="111" y="388">PDD</text>

                                    <ellipse class="body-part" data-area="Pie izquierdo dorsal" cx="133" cy="385" rx="12" ry="20"/>
                                    <text class="body-text" x="133" y="388">PID</text>

                                    <rect class="body-part" data-area="Dedos pie derecho" x="106" y="405" width="10" height="8"/>
                                    <text class="body-text" x="111" y="410">DPD</text>

                                    <rect class="body-part" data-area="Dedos pie izquierdo" x="128" y="405" width="10" height="8"/>
                                    <text class="body-text" x="133" y="410">DPI</text>
                                </svg>

                                <div class="selected-areas">
                                    <strong>√Åreas seleccionadas (Frontal):</strong>
                                    <div id="selected-areas-front"></div>
                                </div>
                            </div>

                            <div class="body-diagram">
                                <h6>Vista Posterior</h6>
                                <svg class="body-svg" id="body-back-svg" viewBox="0 0 240 480">
                                    <defs>
                                        <style>
                                            .body-part { fill: var(--light-bg); stroke: var(--text-color-light); stroke-width: 1; cursor: pointer; transition: fill 0.3s; }
                                            .body-part:hover { fill: var(--primary-gradient); }
                                            .body-part.selected { fill: var(--primary-gradient); } /* Usar gradiente para seleccionado */
                                            .body-text { font-size: 7px; fill: var(--text-color-light); text-anchor: middle; pointer-events: none; }
                                        </style>
                                    </defs>

                                    <circle class="body-part" data-area="Occipital" cx="120" cy="30" r="20"/>
                                    <text class="body-text" x="120" y="33">Occipital</text>

                                    <ellipse class="body-part" data-area="Regi√≥n auricular derecha" cx="105" cy="35" rx="6" ry="8"/>
                                    <text class="body-text" x="105" y="38">OD</text>

                                    <ellipse class="body-part" data-area="Regi√≥n auricular izquierda" cx="135" cy="35" rx="6" ry="8"/>
                                    <text class="body-text" x="135" y="38">OI</text>

                                    <rect class="body-part" data-area="Nuca" x="110" y="50" width="20" height="20"/>
                                    <text class="body-text" x="120" y="63">Nuca</text>

                                    <rect class="body-part" data-area="Espalda alta derecha" x="85" y="70" width="35" height="30"/>
                                    <text class="body-text" x="102" y="88">EAD</text>

                                    <rect class="body-part" data-area="Espalda alta izquierda" x="120" y="70" width="35" height="30"/>
                                    <text class="body-text" x="137" y="88">EAI</text>

                                    <rect class="body-part" data-area="Espalda media derecha" x="90" y="100" width="30" height="25"/>
                                    <text class="body-text" x="105" y="115">EMD</text>

                                    <rect class="body-part" data-area="Espalda media izquierda" x="120" y="100" width="30" height="25"/>
                                    <text class="body-text" x="135" y="115">EMI</text>

                                    <rect class="body-part" data-area="Regi√≥n lumbar" x="100" y="125" width="40" height="25"/>
                                    <text class="body-text" x="120" y="140">Lumbar</text>

                                    <rect class="body-part" data-area="Hombro derecho posterior" x="65" y="75" width="20" height="20"/>
                                    <text class="body-text" x="75" y="87">HDP</text>

                                    <rect class="body-part" data-area="Hombro izquierdo posterior" x="155" y="75" width="20" height="20"/>
                                    <text class="body-text" x="165" y="87">HIP</text>

                                    <rect class="body-part" data-area="Brazo derecho posterior superior" x="50" y="95" width="20" height="35"/>
                                    <text class="body-text" x="60" y="115">BDPS</text>

                                    <rect class="body-part" data-area="Brazo izquierdo posterior superior" x="170" y="95" width="20" height="35"/>
                                    <text class="body-text" x="180" y="115">BIPS</text>

                                    <circle class="body-part" data-area="Codo derecho posterior" cx="60" cy="140" r="8"/>
                                    <text class="body-text" x="60" y="143">CDP</text>

                                    <circle class="body-part" data-area="Codo izquierdo posterior" cx="180" cy="140" r="8"/>
                                    <text class="body-text" x="180" y="143">CIP</text>

                                    <rect class="body-part" data-area="Antebrazo derecho posterior" x="55" y="148" width="15" height="40"/>
                                    <text class="body-text" x="62" y="170">ABDP</text>

                                    <rect class="body-part" data-area="Antebrazo izquierdo posterior" x="170" y="148" width="15" height="40"/>
                                    <text class="body-text" x="177" y="170">ABIP</text>

                                    <ellipse class="body-part" data-area="Mano derecha posterior" cx="62" cy="200" rx="8" ry="12"/>
                                    <text class="body-text" x="62" y="203">MaDP</text>

                                    <ellipse class="body-part" data-area="Mano izquierda posterior" cx="177" cy="200" rx="8" ry="12"/>
                                    <text class="body-text" x="177" y="203">MaIP</text>

                                    <rect class="body-part" data-area="Regi√≥n sacra" x="105" y="150" width="30" height="20"/>
                                    <text class="body-text" x="120" y="163">Sacra</text>

                                    <ellipse class="body-part" data-area="Gl√∫teo derecho" cx="105" cy="185" rx="15" ry="20"/>
                                    <text class="body-text" x="105" y="188">GD</text>

                                    <ellipse class="body-part" data-area="Gl√∫teo izquierdo" cx="135" cy="185" rx="15" ry="20"/>
                                    <text class="body-text" x="135" y="188">GI</text>

                                    <rect class="body-part" data-area="Pliegue intergl√∫teo" x="118" y="170" width="4" height="30"/>
                                    <text class="body-text" x="120" y="188">PIG</text>

                                    <rect class="body-part" data-area="Muslo derecho posterior" x="100" y="205" width="18" height="70"/>
                                    <text class="body-text" x="109" y="245">MDP</text>

                                    <rect class="body-part" data-area="Muslo izquierdo posterior" x="122" y="205" width="18" height="70"/>
                                    <text class="body-text" x="131" y="245">MIP</text>

                                    <circle class="body-part" data-area="Hueco popl√≠teo derecho" cx="109" cy="285" r="10"/>
                                    <text class="body-text" x="109" y="288">HPD</text>

                                    <circle class="body-part" data-area="Hueco popl√≠teo izquierdo" cx="131" cy="285" r="10"/>
                                    <text class="body-text" x="131" y="288">HPI</text>

                                    <ellipse class="body-part" data-area="Pantorrilla derecha" cx="109" cy="320" rx="12" ry="30"/>
                                    <text class="body-text" x="109" y="325">PaD</text>

                                    <ellipse class="body-part" data-area="Pantorrilla izquierda" cx="131" cy="320" rx="12" ry="30"/>
                                    <text class="body-text" x="131" y="325">PaI</text>

                                    <rect class="body-part" data-area="Tend√≥n Aquiles derecho" x="107" y="350" width="4" height="15"/>
                                    <text class="body-text" x="109" y="360">TAD</text>

                                    <rect class="body-part" data-area="Tend√≥n Aquiles izquierdo" x="129" y="350" width="4" height="15"/>
                                    <text class="body-text" x="131" y="360">TAI</text>

                                    <circle class="body-part" data-area="Tal√≥n derecho" cx="109" cy="375" r="10"/>
                                    <text class="body-text" x="109" y="378">TD</text>

                                    <circle class="body-part" data-area="Tal√≥n izquierdo" cx="131" cy="375" r="10"/>
                                    <text class="body-text" x="131" y="378">TI</text>

                                    <ellipse class="body-part" data-area="Planta pie derecho" cx="109" cy="395" rx="12" ry="18"/>
                                    <text class="body-text" x="109" y="398">PPD</text>

                                    <ellipse class="body-part" data-area="Planta pie izquierdo" cx="131" cy="395" rx="12" ry="18"/>
                                    <text class="body-text" x="131" y="398">PPI</text>
                                </svg>

                                <div class="selected-areas">
                                    <strong>√Åreas seleccionadas (Posterior):</strong>
                                    <div id="selected-areas-back"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="exam-container">
                        <div class="exam-header">Localizaci√≥n Anat√≥mica (M√©todo tradicional)</div>
                        <div class="distribution-map">
                            <div class="anatomy-region">
                                <h6>Cabeza y Cuello</h6>
                                <div class="checkbox-grid">
                                    <div class="checkbox-item"><input type="checkbox" id="loc-cuero-cabelludo"><label for="loc-cuero-cabelludo">Cuero cabelludo</label></div>
                                    <div class="checkbox-item"><input type="checkbox" id="loc-frente"><label for="loc-frente">Frente</label></div>
                                    <div class="checkbox-item"><input type="checkbox" id="loc-parpados"><label for="loc-parpados">P√°rpados</label></div>
                                    <div class="checkbox-item"><input type="checkbox" id="loc-mejillas"><label for="loc-mejillas">Mejillas</label></div>
                                    <div class="checkbox-item"><input type="checkbox" id="loc-nariz"><label for="loc-nariz">Nariz</label></div>
                                    <div class="checkbox-item"><input type="checkbox" id="loc-labios"><label for="loc-labios">Labios</label></div>
                                    <div class="checkbox-item"><input type="checkbox" id="loc-barbilla"><label for="loc-barbilla">Barbilla</label></div>
                                    <div class="checkbox-item"><input type="checkbox" id="loc-cuello"><label for="loc-cuello">Cuello</label></div>
                                    <div class="checkbox-item"><input type="checkbox" id="loc-retroauricular"><label for="loc-retroauricular">Regi√≥n retroauricular</label></div>
                                </div>
                            </div>

                            <div class="anatomy-region">
                                <h6>Tronco</h6>
                                <div class="checkbox-grid">
                                    <div class="checkbox-item"><input type="checkbox" id="loc-pecho"><label for="loc-pecho">Pecho</label></div>
                                    <div class="checkbox-item"><input type="checkbox" id="loc-abdomen"><label for="loc-abdomen">Abdomen</label></div>
                                    <div class="checkbox-item"><input type="checkbox" id="loc-espalda"><label for="loc-espalda">Espalda</label></div>
                                    <div class="checkbox-item"><input type="checkbox" id="loc-axilas"><label for="loc-axilas">Axilas</label></div>
                                    <div class="checkbox-item"><input type="checkbox" id="loc-submamario"><label for="loc-submamario">Pliegue submamario</label></div>
                                    <div class="checkbox-item"><input type="checkbox" id="loc-inguinal"><label for="loc-inguinal">Regi√≥n inguinal</label></div>
                                </div>
                            </div>

                            <div class="anatomy-region">
                                <h6>Extremidades Superiores</h6>
                                <div class="checkbox-grid">
                                    <div class="checkbox-item"><input type="checkbox" id="loc-hombros"><label for="loc-hombros">Hombros</label></div>
                                    <div class="checkbox-item"><input type="checkbox" id="loc-brazos"><label for="loc-brazos">Brazos</label></div>
                                    <div class="checkbox-item"><input type="checkbox" id="loc-codos"><label for="loc-codos">Codos</label></div>
                                    <div class="checkbox-item"><input type="checkbox" id="loc-antebrazos"><label for="loc-antebrazos">Antebrazos</label></div>
                                    <div class="checkbox-item"><input type="checkbox" id="loc-mu√±ecas"><label for="loc-mu√±ecas">Mu√±ecas</label></div>
                                    <div class="checkbox-item"><input type="checkbox" id="loc-manos"><label for="loc-manos">Manos</label></div>
                                    <div class="checkbox-item"><input type="checkbox" id="loc-dedos-manos"><label for="loc-dedos-manos">Dedos manos</label></div>
                                    <div class="checkbox-item"><input type="checkbox" id="loc-espacios-interdigitales-manos"><label for="loc-espacios-interdigitales-manos">Espacios interdigitales</label></div>
                                </div>
                            </div>

                            <div class="anatomy-region">
                                <h6>Extremidades Inferiores</h6>
                                <div class="checkbox-grid">
                                    <div class="checkbox-item"><input type="checkbox" id="loc-gluteos"><label for="loc-gluteos">Gl√∫teos</label></div>
                                    <div class="checkbox-item"><input type="checkbox" id="loc-muslos"><label for="loc-muslos">Muslos</label></div>
                                    <div class="checkbox-item"><input type="checkbox" id="loc-rodillas"><label for="loc-rodillas">Rodillas</label></div>
                                    <div class="checkbox-item"><input type="checkbox" id="loc-piernas"><label for="loc-piernas">Piernas</label></div>
                                    <div class="checkbox-item"><input type="checkbox" id="loc-tobillos"><label for="loc-tobillos">Tobillos</label></div>
                                    <div class="checkbox-item"><input type="checkbox" id="loc-pies"><label for="loc-pies">Pies</label></div>
                                    <div class="checkbox-item"><input type="checkbox" id="loc-dedos-pies"><label for="loc-dedos-pies">Dedos pies</label></div>
                                    <div class="checkbox-item"><input type="checkbox" id="loc-espacios-interdigitales-pies"><label for="loc-espacios-interdigitales-pies">Espacios interdigitales</label></div>
                                    <div class="checkbox-item"><input type="checkbox" id="loc-plantas"><label for="loc-plantas">Plantas</label></div>
                                </div>
                            </div>

                            <div class="anatomy-region">
                                <h6>√Årea Genital</h6>
                                <div class="checkbox-grid">
                                    <div class="checkbox-item"><input type="checkbox" id="loc-genitales-externos"><label for="loc-genitales-externos">Genitales externos</label></div>
                                    <div class="checkbox-item"><input type="checkbox" id="loc-perianal"><label for="loc-perianal">Regi√≥n perianal</label></div>
                                    <div class="checkbox-item"><input type="checkbox" id="loc-perineal"><label for="loc-perineal">Regi√≥n perineal</label></div>
                                </div>
                            </div>

                            <div class="anatomy-region">
                                <h6>Mucosas</h6>
                                <div class="checkbox-grid">
                                    <div class="checkbox-item"><input type="checkbox" id="loc-mucosa-oral"><label for="loc-mucosa-oral">Mucosa oral</label></div>
                                    <div class="checkbox-item"><input type="checkbox" id="loc-mucosa-nasal"><label for="loc-mucosa-nasal">Mucosa nasal</label></div>
                                    <div class="checkbox-item"><input type="checkbox" id="loc-mucosa-genital"><label for="loc-mucosa-genital">Mucosa genital</label></div>
                                    <div class="checkbox-item"><input type="checkbox" id="loc-conjuntiva"><label for="loc-conjuntiva">Conjuntiva</label></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="exam-container">
                        <div class="exam-header">Distribuci√≥n Especial</div>
                        <div class="exam-section">
                            <h4>√Åreas de Flexi√≥n y Extensi√≥n</h4>
                            <div class="checkbox-grid">
                                <div class="checkbox-item"><input type="checkbox" id="dist-flexural"><label for="dist-flexural">Predominio en flexuras</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="dist-extensora"><label for="dist-extensora">Predominio en superficies extensoras</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="dist-photoexpuestas"><label for="dist-photoexpuestas">√Åreas fotoexpuestas</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="dist-areas-contacto"><label for="dist-areas-contacto">√Åreas de contacto</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="dist-seborreicas"><label for="dist-seborreicas">√Åreas seborreicas</label></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="section" id="section-appendages">
                <div class="section-header" onclick="toggleSection(this)">
                    <span><i class="fas fa-hand-sparkles"></i> Estado de los Anexos Cut√°neos</span>
                    <div style="display: flex; align-items: center;">
                        <div class="completion-badge" id="badge-appendages">
                            <i class="fas fa-circle"></i>
                        </div>
                        <span class="arrow">‚ñº</span>
                    </div>
                </div>
                <div class="section-content" id="appendages">
                    <div class="bilateral-container">
                        <div class="side-container">
                            <div class="side-header">Cabello y Cuero Cabelludo</div>
                            <div class="exam-section">
                                <h4>Caracter√≠sticas del Cabello</h4>
                                <div class="checkbox-grid">
                                    <div class="checkbox-item"><input type="checkbox" id="cabello-normal"><label for="cabello-normal">Aspecto normal</label></div>
                                    <div class="checkbox-item"><input type="checkbox" id="cabello-graso"><label for="cabello-graso">Cabello graso</label></div>
                                    <div class="checkbox-item"><input type="checkbox" id="cabello-seco"><label for="cabello-seco">Cabello seco</label></div>
                                    <div class="checkbox-item"><input type="checkbox" id="cabello-quebradizo"><label for="cabello-quebradizo">Cabello quebradizo</label></div>
                                    <div class="checkbox-item"><input type="checkbox" id="cabello-fino"><label for="cabello-fino">Cabello fino</label></div>
                                    <div class="checkbox-item"><input type="checkbox" id="cabello-grueso"><label for="cabello-grueso">Cabello grueso</label></div>
                                </div>
                            </div>
                            <div class="exam-section">
                                <h4>Alopecia</h4>
                                <div class="checkbox-grid">
                                    <div class="checkbox-item"><input type="checkbox" id="alopecia-areata"><label for="alopecia-areata">Alopecia areata</label></div>
                                    <div class="checkbox-item"><input type="checkbox" id="alopecia-androgenetica"><label for="alopecia-androgenetica">Alopecia androgen√©tica</label></div>
                                    <div class="checkbox-item"><input type="checkbox" id="alopecia-difusa"><label for="alopecia-difusa">Alopecia difusa</label></div>
                                    <div class="checkbox-item"><input type="checkbox" id="alopecia-cicatricial"><label for="alopecia-cicatricial">Alopecia cicatricial</label></div>
                                    <div class="checkbox-item"><input type="checkbox" id="tricotillomania"><label for="tricotillomania">Tricotiloman√≠a</label></div>
                                </div>
                            </div>
                            <div class="exam-section">
                                <h4>Cuero Cabelludo</h4>
                                <div class="checkbox-grid">
                                    <div class="checkbox-item"><input type="checkbox" id="cuero-cabelludo-normal"><label for="cuero-cabelludo-normal">Aspecto normal</label></div>
                                    <div class="checkbox-item"><input type="checkbox" id="descamacion-cuero-cabelludo"><label for="descamacion-cuero-cabelludo">Descamaci√≥n</label></div>
                                    <div class="checkbox-item"><input type="checkbox" id="eritema-cuero-cabelludo"><label for="eritema-cuero-cabelludo">Eritema</label></div>
                                    <div class="checkbox-item"><input type="checkbox" id="costras-cuero-cabelludo"><label for="costras-cuero-cabelludo">Costras</label></div>
                                    <div class="checkbox-item"><input type="checkbox" id="placas-cuero-cabelludo"><label for="placas-cuero-cabelludo">Placas</label></div>
                                </div>
                            </div>
                        </div>

                        <div class="side-container">
                            <div class="side-header">U√±as</div>
                            <div class="exam-section">
                                <h4>U√±as de las Manos</h4>
                                <div class="checkbox-grid">
                                    <div class="checkbox-item"><input type="checkbox" id="unas-manos-normales"><label for="unas-manos-normales">Aspecto normal</label></div>
                                    <div class="checkbox-item"><input type="checkbox" id="onic√≥lisis-manos"><label for="onic√≥lisis-manos">Onic√≥lisis</label></div>
                                    <div class="checkbox-item"><input type="checkbox" id="onicodistrofia-manos"><label for="onicodistrofia-manos">Onicodistrofia</label></div>
                                    <div class="checkbox-item"><input type="checkbox" id="leuconiquia-manos"><label for="leuconiquia-manos">Leuconiquia</label></div>
                                    <div class="checkbox-item"><input type="checkbox" id="melanoniquia-manos"><label for="melanoniquia-manos">Melanoniquia</label></div>
                                    <div class="checkbox-item"><input type="checkbox" id="pitting-ungueal-manos"><label for="pitting-ungueal-manos">Pitting ungueal</label></div>
                                    <div class="checkbox-item"><input type="checkbox" id="surcos-beau-manos"><label for="surcos-beau-manos">Surcos de Beau</label></div>
                                    <div class="checkbox-item"><input type="checkbox" id="onicorrexis-manos"><label for="onicorrexis-manos">Onicorrexis</label></div>
                                    <div class="checkbox-item"><input type="checkbox" id="onicomicosis-manos"><label for="onicomicosis-manos">Onicomicosis</label></div>
                                </div>
                            </div>
                            <div class="exam-section">
                                <h4>U√±as de los Pies</h4>
                                <div class="checkbox-grid">
                                    <div class="checkbox-item"><input type="checkbox" id="unas-pies-normales"><label for="unas-pies-normales">Aspecto normal</label></div>
                                    <div class="checkbox-item"><input type="checkbox" id="onic√≥lisis-pies"><label for="onic√≥lisis-pies">Onic√≥lisis</label></div>
                                    <div class="checkbox-item"><input type="checkbox" id="onicodistrofia-pies"><label for="onicodistrofia-pies">Onicodistrofia</label></div>
                                    <div class="checkbox-item"><input type="checkbox" id="onicomicosis-pies"><label for="onicomicosis-pies">Onicomicosis</label></div>
                                    <div class="checkbox-item"><input type="checkbox" id="u√±a-encarnada"><label for="u√±a-encarnada">U√±a encarnada</label></div>
                                    <div class="checkbox-item"><input type="checkbox" id="onicogrifosis"><label for="onicogrifosis">Onicogrifosis</label></div>
                                </div>
                            </div>
                            <div class="exam-section">
                                <h4>Pliegues Ungueales</h4>
                                <div class="checkbox-grid">
                                    <div class="checkbox-item"><input type="checkbox" id="pliegues-normales"><label for="pliegues-normales">Aspecto normal</label></div>
                                    <div class="checkbox-item"><input type="checkbox" id="paroniquia-aguda"><label for="paroniquia-aguda">Paroniquia aguda</label></div>
                                    <div class="checkbox-item"><input type="checkbox" id="paroniquia-cronica"><label for="paroniquia-cronica">Paroniquia cr√≥nica</label></div>
                                    <div class="checkbox-item"><input type="checkbox" id="pterigion"><label for="pterigion">Pterigion</label></div>
                                    <div class="checkbox-item"><input type="checkbox" id="hipertrofia-pliegue"><label for="hipertrofia-pliegue">Hipertrofia de pliegue</label></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="section" id="section-special-tests">
                <div class="section-header" onclick="toggleSection(this)">
                    <span><i class="fas fa-flask"></i> Pruebas Especiales y Signos Dermatol√≥gicos</span>
                    <div style="display: flex; align-items: center;">
                        <div class="completion-badge" id="badge-special-tests">
                            <i class="fas fa-circle"></i>
                        </div>
                        <span class="arrow">‚ñº</span>
                    </div>
                </div>
                <div class="section-content" id="special-tests">
                    <div class="exam-container">
                        <div class="exam-header"><i class="fas fa-hand-point-up"></i> Pruebas F√≠sicas</div>
                        <div class="test-results">
                            <div class="test-item">
                                <label>Signo de Nikolsky</label>
                                <div class="test-controls">
                                    <div class="test-checkbox"><input type="checkbox" id="nikolsky-pos" onchange="handleMutuallyExclusive('nikolsky-pos', 'nikolsky-neg', this)"><span class="positive">+</span></div>
                                    <div class="test-checkbox"><input type="checkbox" id="nikolsky-neg" onchange="handleMutuallyExclusive('nikolsky-pos', 'nikolsky-neg', this)"><span class="negative">-</span></div>
                                </div>
                            </div>
                            <div class="test-item">
                                <label>Signo de Asboe-Hansen (Nikolsky indirecto)</label>
                                <div class="test-controls">
                                    <div class="test-checkbox"><input type="checkbox" id="asboe-hansen-pos" onchange="handleMutuallyExclusive('asboe-hansen-pos', 'asboe-hansen-neg', this)"><span class="positive">+</span></div>
                                    <div class="test-checkbox"><input type="checkbox" id="asboe-hansen-neg" onchange="handleMutuallyExclusive('asboe-hansen-pos', 'asboe-hansen-neg', this)"><span class="negative">-</span></div>
                                </div>
                            </div>
                            <div class="test-item">
                                <label>Signo de Darier (urticaria pigmentosa)</label>
                                <div class="test-controls">
                                    <div class="test-checkbox"><input type="checkbox" id="darier-pos" onchange="handleMutuallyExclusive('darier-pos', 'darier-neg', this)"><span class="positive">+</span></div>
                                    <div class="test-checkbox"><input type="checkbox" id="darier-neg" onchange="handleMutuallyExclusive('darier-pos', 'darier-neg', this)"><span class="negative">-</span></div>
                                </div>
                            </div>
                            <div class="test-item">
                                <label>Dermografismo</label>
                                <div class="test-controls">
                                    <div class="test-checkbox"><input type="checkbox" id="dermografismo-pos" onchange="handleMutuallyExclusive('dermografismo-pos', 'dermografismo-neg', this)"><span class="positive">+</span></div>
                                    <div class="test-checkbox"><input type="checkbox" id="dermografismo-neg" onchange="handleMutuallyExclusive('dermografismo-pos', 'dermografismo-neg', this)"><span class="negative">-</span></div>
                                </div>
                            </div>
                            <div class="test-item">
                                <label>Signo de K√∂bner (fen√≥meno isom√≥rfico)</label>
                                <div class="test-controls">
                                    <div class="test-checkbox"><input type="checkbox" id="kobner-pos" onchange="handleMutuallyExclusive('kobner-pos', 'kobner-neg', this)"><span class="positive">+</span></div>
                                    <div class="test-checkbox"><input type="checkbox" id="kobner-neg" onchange="handleMutuallyExclusive('kobner-pos', 'kobner-neg', this)"><span class="negative">-</span></div>
                                </div>
                            </div>
                            <div class="test-item">
                                <label>Signo de la gota de roc√≠o (P√°pula de contacto)</label>
                                <div class="test-controls">
                                    <div class="test-checkbox"><input type="checkbox" id="gota-rocio-pos" onchange="handleMutuallyExclusive('gota-rocio-pos', 'gota-rocio-neg', this)"><span class="positive">+</span></div>
                                    <div class="test-checkbox"><input type="checkbox" id="gota-rocio-neg" onchange="handleMutuallyExclusive('gota-rocio-pos', 'gota-rocio-neg', this)"><span class="negative">-</span></div>
                                </div>
                            </div>
                            <div class="test-item">
                                <label>Signo del tir√≥n de vello (tricotiloman√≠a)</label>
                                <div class="test-controls">
                                    <div class="test-checkbox"><input type="checkbox" id="tiron-vello-pos" onchange="handleMutuallyExclusive('tiron-vello-pos', 'tiron-vello-neg', this)"><span class="positive">+</span></div>
                                    <div class="test-checkbox"><input type="checkbox" id="tiron-vello-neg" onchange="handleMutuallyExclusive('tiron-vello-pos', 'tiron-vello-neg', this)"><span class="negative">-</span></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="exam-container">
                        <div class="exam-header"><i class="fas fa-microscope"></i> Pruebas con KOH (Hidr√≥xido de Potasio)</div>
                        <div class="test-results">
                            <div class="test-item">
                                <label>KOH de escamas cut√°neas</label>
                                <div class="test-controls">
                                    <div class="test-checkbox"><input type="checkbox" id="koh-escamas-pos" onchange="handleMutuallyExclusive('koh-escamas-pos', 'koh-escamas-neg', this)"><span class="positive">+</span></div>
                                    <div class="test-checkbox"><input type="checkbox" id="koh-escamas-neg" onchange="handleMutuallyExclusive('koh-escamas-pos', 'koh-escamas-neg', this)"><span class="negative">-</span></div>
                                    <input type="text" class="input-field" id="koh-escamas-note" placeholder="Observaciones" style="width: 120px;">
                                </div>
                            </div>
                            <div class="test-item">
                                <label>KOH de u√±as</label>
                                <div class="test-controls">
                                    <div class="test-checkbox"><input type="checkbox" id="koh-unas-pos" onchange="handleMutuallyExclusive('koh-unas-pos', 'koh-unas-neg', this)"><span class="positive">+</span></div>
                                    <div class="test-checkbox"><input type="checkbox" id="koh-unas-neg" onchange="handleMutuallyExclusive('koh-unas-pos', 'koh-unas-neg', this)"><span class="negative">-</span></div>
                                    <input type="text" class="input-field" id="koh-unas-note" placeholder="Observaciones" style="width: 120px;">
                                </div>
                            </div>
                            <div class="test-item">
                                <label>KOH de cabello</label>
                                <div class="test-controls">
                                    <div class="test-checkbox"><input type="checkbox" id="koh-cabello-pos" onchange="handleMutuallyExclusive('koh-cabello-pos', 'koh-cabello-neg', this)"><span class="positive">+</span></div>
                                    <div class="test-checkbox"><input type="checkbox" id="koh-cabello-neg" onchange="handleMutuallyExclusive('koh-cabello-pos', 'koh-cabello-neg', this)"><span class="negative">-</span></div>
                                    <input type="text" class="input-field" id="koh-cabello-note" placeholder="Observaciones" style="width: 120px;">
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="exam-container">
                        <div class="exam-header"><i class="fas fa-lightbulb"></i> Otras Pruebas Diagn√≥sticas</div>
                        <div class="test-results">
                            <div class="test-item">
                                <label>L√°mpara de Wood</label>
                                <div class="test-controls">
                                    <div class="test-checkbox"><input type="checkbox" id="wood-pos" onchange="handleMutuallyExclusive('wood-pos', 'wood-neg', this)"><span class="positive">+</span></div>
                                    <div class="test-checkbox"><input type="checkbox" id="wood-neg" onchange="handleMutuallyExclusive('wood-pos', 'wood-neg', this)"><span class="negative">-</span></div>
                                    <input type="text" class="input-field" id="wood-color" placeholder="Color fluorescencia" style="width: 120px;">
                                </div>
                            </div>
                            <div class="test-item">
                                <label>Prueba de contacto (Patch test)</label>
                                <div class="test-controls">
                                    <div class="test-checkbox"><input type="checkbox" id="patch-test-pos" onchange="handleMutuallyExclusive('patch-test-pos', 'patch-test-neg', this)"><span class="positive">+</span></div>
                                    <div class="test-checkbox"><input type="checkbox" id="patch-test-neg" onchange="handleMutuallyExclusive('patch-test-pos', 'patch-test-neg', this)"><span class="negative">-</span></div>
                                    <input type="text" class="input-field" id="patch-test-allergen" placeholder="Al√©rgeno" style="width: 120px;">
                                </div>
                            </div>
                            <div class="test-item">
                                <label>Biopsia cut√°nea</label>
                                <div class="test-controls">
                                    <div class="test-checkbox"><input type="checkbox" id="biopsia-realizada"><span>Realizada</span></div>
                                    <div class="test-checkbox"><input type="checkbox" id="biopsia-pendiente"><span>Pendiente</span></div>
                                    <input type="text" class="input-field" id="biopsia-sitio" placeholder="Sitio" style="width: 120px;">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="section" id="section-severity">
                <div class="section-header" onclick="toggleSection(this)">
                    <span><i class="fas fa-chart-line"></i> Evaluaci√≥n de Severidad</span>
                    <div style="display: flex; align-items: center;">
                        <div class="completion-badge" id="badge-severity">
                            <i class="fas fa-circle"></i>
                        </div>
                        <span class="arrow">‚ñº</span>
                    </div>
                </div>
                <div class="section-content" id="severity">
                    <div class="exam-container">
                        <div class="exam-header"><i class="fas fa-ruler-combined"></i> Extensi√≥n de las Lesiones</div>
                        <div class="severity-section">
                            <h4>Superficie Corporal Afectada</h4>
                            <div class="measurement">
                                <label>Porcentaje estimado:</label>
                                <input type="number" class="input-field" id="superficie-afectada" min="0" max="100">
                                <span>% de superficie corporal</span>
                            </div>
                            <div class="severity-grid">
                                <div class="severity-item"><input type="radio" name="extension-severidad" id="extension-leve"><label for="extension-leve">Leve (&lt;10%)</label></div>
                                <div class="severity-item"><input type="radio" name="extension-severidad" id="extension-moderada"><label for="extension-moderada">Moderada (10-30%)</label></div>
                                <div class="severity-item"><input type="radio" name="extension-severidad" id="extension-severa"><label for="extension-severa">Severa (&gt;30%)</label></div>
                            </div>
                        </div>
                    </div>

                    <div class="exam-container">
                        <div class="exam-header"><i class="fas fa-user-injured"></i> Impacto Funcional</div>
                        <div class="exam-section">
                            <h4>Intensidad del Prurito</h4>
                            <div class="measurement">
                                <label>Escala Visual An√°loga:</label>
                                <input type="range" id="prurito-intensity" min="0" max="10" value="0" oninput="updatePruritoValue(this.value)">
                                <span id="prurito-value">0</span><span>/10</span>
                            </div>
                        </div>
                        <div class="exam-section">
                            <h4>Interferencia con Actividades</h4>
                            <div class="checkbox-grid">
                                <div class="checkbox-item"><input type="checkbox" id="interfiere-sue√±o"><label for="interfiere-sue√±o">Interfiere con el sue√±o</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="interfiere-trabajo"><label for="interfiere-trabajo">Interfiere con el trabajo</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="interfiere-social"><label for="interfiere-social">Interfiere con actividades sociales</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="interfiere-deportes"><label for="interfiere-deportes">Interfiere con deportes</label></div>
                            </div>
                        </div>
                    </div>

                    <div class="exam-container">
                        <div class="exam-header"><i class="fas fa-calculator"></i> Escalas de Severidad Espec√≠ficas</div>
                        <div class="score-calculation">
                            <div class="exam-section">
                                <h4>PASI (Psoriasis Area and Severity Index) - Si aplica</h4>
                                <div class="score-item">
                                    <span>Eritema (0-4):</span>
                                    <input type="number" class="input-field" id="pasi-eritema" min="0" max="4" onchange="calculatePASI()">
                                </div>
                                <div class="score-item">
                                    <span>Infiltraci√≥n (0-4):</span>
                                    <input type="number" class="input-field" id="pasi-infiltracion" min="0" max="4" onchange="calculatePASI()">
                                </div>
                                <div class="score-item">
                                    <span>Descamaci√≥n (0-4):</span>
                                    <input type="number" class="input-field" id="pasi-descamacion" min="0" max="4" onchange="calculatePASI()">
                                </div>
                                <div class="score-item">
                                    <span>√Årea afectada cabeza (0-6):</span>
                                    <input type="number" class="input-field" id="pasi-area-cabeza" min="0" max="6" onchange="calculatePASI()">
                                </div>
                                <div class="score-item">
                                    <span>PASI Total:</span>
                                    <span class="score-value" id="pasi-total">0</span>
                                </div>
                            </div>
                        </div>

                        <div class="scale-section">
                            <h4>SCORAD (SCORing Atopic Dermatitis) - Para Dermatitis At√≥pica</h4>
                            <div class="exam-section">
                                <h4>A. Extensi√≥n (0-100%)</h4>
                                <div class="measurement">
                                    <label>Superficie corporal afectada:</label>
                                    <input type="number" class="input-field" id="scorad-extension" min="0" max="100" onchange="calculateSCORAD()">
                                    <span>%</span>
                                </div>
                            </div>
                            <div class="exam-section">
                                <h4>B. Intensidad (0-3 cada s√≠ntoma)</h4>
                                <div class="score-item">
                                    <span>Eritema:</span>
                                    <input type="number" class="input-field" id="scorad-eritema" min="0" max="3" onchange="calculateSCORAD()">
                                </div>
                                <div class="score-item">
                                    <span>Edema/P√°pulas:</span>
                                    <input type="number" class="input-field" id="scorad-edema" min="0" max="3" onchange="calculateSCORAD()">
                                </div>
                                <div class="score-item">
                                    <span>Excoriaci√≥n:</span>
                                    <input type="number" class="input-field" id="scorad-excoriacion" min="0" max="3" onchange="calculateSCORAD()">
                                </div>
                                <div class="score-item">
                                    <span>Liquenificaci√≥n:</span>
                                    <input type="number" class="input-field" id="scorad-liquenificacion" min="0" max="3" onchange="calculateSCORAD()">
                                </div>
                                <div class="score-item">
                                    <span>Descamaci√≥n:</span>
                                    <input type="number" class="input-field" id="scorad-descamacion" min="0" max="3" onchange="calculateSCORAD()">
                                </div>
                                <div class="score-item">
                                    <span>Xerosis:</span>
                                    <input type="number" class="input-field" id="scorad-xerosis" min="0" max="3" onchange="calculateSCORAD()">
                                </div>
                            </div>
                            <div class="exam-section">
                                <h4>C. S√≠ntomas Subjetivos (0-10 cada uno)</h4>
                                <div class="score-item">
                                    <span>Prurito (0-10):</span>
                                    <input type="number" class="input-field" id="scorad-prurito" min="0" max="10" onchange="calculateSCORAD()">
                                </div>
                                <div class="score-item">
                                    <span>P√©rdida de sue√±o (0-10):</span>
                                    <input type="number" class="input-field" id="scorad-sue√±o" min="0" max="10" onchange="calculateSCORAD()">
                                </div>
                            </div>
                            <div class="score-calculation">
                                <div class="score-item">
                                    <span>SCORAD Total:</span>
                                    <span class="score-value" id="scorad-total">0</span>
                                </div>
                                <div style="font-size: 11px; margin-top: 5px; color: var(--text-color-light);">
                                    F√≥rmula: A/5 + 7B/2 + C
                                </div>
                            </div>
                        </div>

                        <div class="scale-section">
                            <h4>üìä DLQI (Dermatology Life Quality Index)</h4>
                            <p style="font-size: 12px; color: var(--text-color-light); margin-bottom: 15px;">
                                Cuestionario para evaluar el impacto de la condici√≥n dermatol√≥gica en la calidad de vida del paciente.
                            </p>

                            <div class="dlqi-question">
                                <label>1. En la √∫ltima semana, ¬øcu√°nto le ha picado, dolido, escozido o molestado la piel?</label>
                                <div class="dlqi-options">
                                    <div class="dlqi-option"><input type="radio" name="dlqi-1" value="3" onchange="calculateDLQI()"><label>Much√≠simo (3)</label></div>
                                    <div class="dlqi-option"><input type="radio" name="dlqi-1" value="2" onchange="calculateDLQI()"><label>Mucho (2)</label></div>
                                    <div class="dlqi-option"><input type="radio" name="dlqi-1" value="1" onchange="calculateDLQI()"><label>Un poco (1)</label></div>
                                    <div class="dlqi-option"><input type="radio" name="dlqi-1" value="0" onchange="calculateDLQI()"><label>Nada (0)</label></div>
                                </div>
                            </div>

                            <div class="dlqi-question">
                                <label>2. En la √∫ltima semana, ¬øcu√°nto le ha dado verg√ºenza o le ha hecho sentirse cohibido su problema de piel?</label>
                                <div class="dlqi-options">
                                    <div class="dlqi-option"><input type="radio" name="dlqi-2" value="3" onchange="calculateDLQI()"><label>Much√≠simo (3)</label></div>
                                    <div class="dlqi-option"><input type="radio" name="dlqi-2" value="2" onchange="calculateDLQI()"><label>Mucho (2)</label></div>
                                    <div class="dlqi-option"><input type="radio" name="dlqi-2" value="1" onchange="calculateDLQI()"><label>Un poco (1)</label></div>
                                    <div class="dlqi-option"><input type="radio" name="dlqi-2" value="0" onchange="calculateDLQI()"><label>Nada (0)</label></div>
                                </div>
                            </div>

                            <div class="dlqi-question">
                                <label>3. En la √∫ltima semana, ¬øcu√°nto le ha impedido su problema de piel ir de compras o cuidar su casa o jard√≠n?</label>
                                <div class="dlqi-options">
                                    <div class="dlqi-option"><input type="radio" name="dlqi-3" value="3" onchange="calculateDLQI()"><label>Much√≠simo (3)</label></div>
                                    <div class="dlqi-option"><input type="radio" name="dlqi-3" value="2" onchange="calculateDLQI()"><label>Mucho (2)</label></div>
                                    <div class="dlqi-option"><input type="radio" name="dlqi-3" value="1" onchange="calculateDLQI()"><label>Un poco (1)</label></div>
                                    <div class="dlqi-option"><input type="radio" name="dlqi-3" value="0" onchange="calculateDLQI()"><label>Nada (0)</label></div>
                                </div>
                            </div>

                            <div class="dlqi-question">
                                <label>4. En la √∫ltima semana, ¬øcu√°nto ha influido su problema de piel en la ropa que se pone?</label>
                                <div class="dlqi-options">
                                    <div class="dlqi-option"><input type="radio" name="dlqi-4" value="3" onchange="calculateDLQI()"><label>Much√≠simo (3)</label></div>
                                    <div class="dlqi-option"><input type="radio" name="dlqi-4" value="2" onchange="calculateDLQI()"><label>Mucho (2)</label></div>
                                    <div class="dlqi-option"><input type="radio" name="dlqi-4" value="1" onchange="calculateDLQI()"><label>Un poco (1)</label></div>
                                    <div class="dlqi-option"><input type="radio" name="dlqi-4" value="0" onchange="calculateDLQI()"><label>Nada (0)</label></div>
                                </div>
                            </div>

                            <div class="dlqi-question">
                                <label>5. En la √∫ltima semana, ¬øcu√°nto ha afectado su problema de piel a alguna actividad social o de ocio?</label>
                                <div class="dlqi-options">
                                    <div class="dlqi-option"><input type="radio" name="dlqi-5" value="3" onchange="calculateDLQI()"><label>Much√≠simo (3)</label></div>
                                    <div class="dlqi-option"><input type="radio" name="dlqi-5" value="2" onchange="calculateDLQI()"><label>Mucho (2)</label></div>
                                    <div class="dlqi-option"><input type="radio" name="dlqi-5" value="1" onchange="calculateDLQI()"><label>Un poco (1)</label></div>
                                    <div class="dlqi-option"><input type="radio" name="dlqi-5" value="0" onchange="calculateDLQI()"><label>Nada (0)</label></div>
                                </div>
                            </div>

                            <div class="dlqi-question">
                                <label>6. En la √∫ltima semana, ¬øcu√°nto le ha impedido su problema de piel hacer deporte?</label>
                                <div class="dlqi-options">
                                    <div class="dlqi-option"><input type="radio" name="dlqi-6" value="3" onchange="calculateDLQI()"><label>Much√≠simo (3)</label></div>
                                    <div class="dlqi-option"><input type="radio" name="dlqi-6" value="2" onchange="calculateDLQI()"><label>Mucho (2)</label></div>
                                    <div class="dlqi-option"><input type="radio" name="dlqi-6" value="1" onchange="calculateDLQI()"><label>Un poco (1)</label></div>
                                    <div class="dlqi-option"><input type="radio" name="dlqi-6" value="0" onchange="calculateDLQI()"><label>Nada (0)</label></div>
                                </div>
                            </div>

                            <div class="dlqi-question">
                                <label>7. En la √∫ltima semana, ¬øle ha impedido su problema de piel trabajar o estudiar?</label>
                                <div class="dlqi-options">
                                    <div class="dlqi-option"><input type="radio" name="dlqi-7" value="3" onchange="calculateDLQI()"><label>Much√≠simo (3)</label></div>
                                    <div class="dlqi-option"><input type="radio" name="dlqi-7" value="2" onchange="calculateDLQI()"><label>Mucho (2)</label></div>
                                    <div class="dlqi-option"><input type="radio" name="dlqi-7" value="1" onchange="calculateDLQI()"><label>Un poco (1)</label></div>
                                    <div class="dlqi-option"><input type="radio" name="dlqi-7" value="0" onchange="calculateDLQI()"><label>Nada (0)</label></div>
                                </div>
                            </div>

                            <div class="dlqi-question">
                                <label>8. En la √∫ltima semana, ¬øcu√°ntos problemas le ha causado su problema de piel con su pareja o con amigos √≠ntimos o familiares?</label>
                                <div class="dlqi-options">
                                    <div class="dlqi-option"><input type="radio" name="dlqi-8" value="3" onchange="calculateDLQI()"><label>Much√≠simos (3)</label></div>
                                    <div class="dlqi-option"><input type="radio" name="dlqi-8" value="2" onchange="calculateDLQI()"><label>Muchos (2)</label></div>
                                    <div class="dlqi-option"><input type="radio" name="dlqi-8" value="1" onchange="calculateDLQI()"><label>Algunos (1)</label></div>
                                    <div class="dlqi-option"><input type="radio" name="dlqi-8" value="0" onchange="calculateDLQI()"><label>Ninguno (0)</label></div>
                                </div>
                            </div>

                            <div class="dlqi-question">
                                <label>9. En la √∫ltima semana, ¬øcu√°ntas dificultades le ha causado su problema de piel en su vida sexual?</label>
                                <div class="dlqi-options">
                                    <div class="dlqi-option"><input type="radio" name="dlqi-9" value="3" onchange="calculateDLQI()"><label>Much√≠simas (3)</label></div>
                                    <div class="dlqi-option"><input type="radio" name="dlqi-9" value="2" onchange="calculateDLQI()"><label>Muchas (2)</label></div>
                                    <div class="dlqi-option"><input type="radio" name="dlqi-9" value="1" onchange="calculateDLQI()"><label>Algunas (1)</label></div>
                                    <div class="dlqi-option"><input type="radio" name="dlqi-9" value="0" onchange="calculateDLQI()"><label>Ninguna (0)</label></div>
                                </div>
                            </div>

                            <div class="dlqi-question">
                                <label>10. En la √∫ltima semana, ¬øcu√°nto problema le ha supuesto el tratamiento de su piel?</label>
                                <div class="dlqi-options">
                                    <div class="dlqi-option"><input type="radio" name="dlqi-10" value="3" onchange="calculateDLQI()"><label>Much√≠simo (3)</label></div>
                                    <div class="dlqi-option"><input type="radio" name="dlqi-10" value="2" onchange="calculateDLQI()"><label>Mucho (2)</label></div>
                                    <div class="dlqi-option"><input type="radio" name="dlqi-10" value="1" onchange="calculateDLQI()"><label>Un poco (1)</label></div>
                                    <div class="dlqi-option"><input type="radio" name="dlqi-10" value="0" onchange="calculateDLQI()"><label>Nada (0)</label></div>
                                </div>
                            </div>

                            <div class="score-calculation">
                                <div class="score-item">
                                    <span>DLQI Total:</span>
                                    <span class="score-value" id="dlqi-total">0</span><span>/30</span>
                                </div>
                                <div class="score-item">
                                    <span>Interpretaci√≥n:</span>
                                    <span class="score-value" id="dlqi-interpretation">Sin impacto</span>
                                </div>
                                <div style="font-size: 11px; margin-top: 8px; color: var(--text-color-light);">
                                    <strong>Rangos:</strong> 0-1: Sin impacto | 2-5: Impacto peque√±o | 6-10: Impacto moderado | 11-20: Impacto muy grande | 21-30: Impacto extremadamente grande
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="conclusion">
            <h3><i class="fas fa-file-medical-alt"></i> Conclusi√≥n del Examen Dermatol√≥gico</h3>
            <div class="conclusion-text" id="conclusion-text">Seleccione los par√°metros del examen para generar la conclusi√≥n dermatol√≥gica...</div>
        </div>

        <div class="control-buttons">
            <button class="btn btn-primary" onclick="generateConclusion()">
                <i class="fas fa-file-medical"></i> Generar Conclusi√≥n
            </button>
            <button class="btn btn-primary" onclick="printConclusion()">
                <i class="fas fa-print"></i> Imprimir Conclusi√≥n
            </button>
            <button class="btn btn-secondary" onclick="clearForm()">
                <i class="fas fa-trash"></i> Limpiar Formulario
            </button>
            <button class="btn btn-secondary" onclick="expandAllSections()">
                <i class="fas fa-expand-alt"></i> Expandir Todo
            </button>
            <button class="btn btn-secondary" onclick="collapseAllSections()">
                <i class="fas fa-compress-alt"></i> Contraer Todo
            </button>
        </div>
    </div>

    <script>
        // Variables globales para el dashboard (Copiado de gastro.html)
        let examProgress = 0;
        let sectionsCompleted = 0;
        let alertCount = 0;
        let warningCount = 0;
        let findingsCount = 0;
        let qualityOfLifeStatus = 'Pendiente'; // Nuevo status para el dashboard

        // Variables globales para el mapa corporal
        let selectedBodyAreas = new Set();

        // üåô Toggle de tema (Copiado de gastro.html)
        function toggleTheme() {
            const body = document.body;
            const themeIcon = document.getElementById('theme-icon');

            if (body.hasAttribute('data-theme')) {
                body.removeAttribute('data-theme');
                themeIcon.className = 'fas fa-moon';
                localStorage.setItem('theme', 'light');
            } else {
                body.setAttribute('data-theme', 'dark');
                themeIcon.className = 'fas fa-sun';
                localStorage.setItem('theme', 'dark');
            }
        }

        // üéØ Toggle panel de navegaci√≥n (Copiado de gastro.html)
        function toggleNavPanel() {
            const navPanel = document.getElementById('nav-panel');
            const body = document.body;

            navPanel.classList.toggle('open');
            body.classList.toggle('split-view'); // Aplica al body para afectar el main-container
        }

        // üìä FUNCIONES DEL PANEL STICKY (Copiado de gastro.html)

        // Toggle panel lateral sticky
        function toggleStickyPanel() {
            const stickyPanel = document.getElementById('stickyConclusion');
            const body = document.body; // Se aplica al body para afectar el main-container
            const btn = document.getElementById('sticky-toggle-btn');

            stickyPanel.classList.toggle('active');
            body.classList.toggle('split-view-active'); // Aplica al body para afectar el main-container

            if (stickyPanel.classList.contains('active')) {
                btn.innerHTML = '<i class="fas fa-window-restore"></i> Vista Normal';
                btn.classList.add('btn-warning');
                btn.classList.remove('btn-primary');
                generateStickyConclusion();
            } else {
                btn.innerHTML = '<i class="fas fa-columns"></i> Vista Dividida';
                btn.classList.add('btn-primary');
                btn.classList.remove('btn-warning');
            }
        }

        // Generar conclusi√≥n para panel sticky
        function generateStickyConclusion() {
            const stickyContent = document.getElementById('stickyContent');
            const updateIndicator = document.getElementById('updateIndicator');

            updateIndicator.classList.add('active');

            setTimeout(() => {
                const originalConclusionEl = document.getElementById('conclusion-text');
                const originalContent = originalConclusionEl.textContent;

                stickyContent.textContent = originalContent;

                updateIndicator.classList.remove('active');
            }, 300);
        }

        // Copiar contenido del panel sticky
        function copyStickyToClipboard() {
            const stickyContent = document.getElementById('stickyContent').textContent;

            if (navigator.clipboard && window.isSecureContext) {
                navigator.clipboard.writeText(stickyContent).then(() => {
                    showCopyNotification();
                }).catch(err => {
                    console.error('Error al copiar con la API del portapapeles: ', err);
                    fallbackCopyToClipboard(stickyContent);
                });
            } else {
                fallbackCopyToClipboard(stickyContent);
            }
        }

        // Fallback para copiar
        function fallbackCopyToClipboard(text) {
            const textArea = document.createElement('textarea');
            textArea.value = text;
            textArea.style.position = 'fixed';
            textArea.style.opacity = '0';
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();

            try {
                document.execCommand('copy');
                showCopyNotification();
            } catch (err) {
                console.error('Error al usar el m√©todo de respaldo para copiar: ', err);
                alert('No se pudo copiar el texto. Por favor, c√≥pielo manualmente.');
            }

            document.body.removeChild(textArea);
        }

        // Mostrar notificaci√≥n de copia
        function showCopyNotification() {
            const notification = document.getElementById('copyNotification');
            notification.classList.add('show');
            setTimeout(() => {
                notification.classList.remove('show');
            }, 2500);
        }

        // Imprimir desde panel sticky
        function printStickyConclusion() {
            const conclusion = document.getElementById('stickyContent').textContent;
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                <head>
                    <title>Informe Dermatol√≥gico</title>
                    <style>
                        body {
                            font-family: Arial, sans-serif;
                            margin: 20px;
                            line-height: 1.6;
                        }
                        pre {
                            white-space: pre-wrap;
                            font-family: 'Courier New', monospace;
                            font-size: 12px;
                        }
                        .header {
                            text-align: center;
                            border-bottom: 2px solid #3498db; /* Adaptado al color dermatol√≥gico */
                            padding-bottom: 10px;
                            margin-bottom: 20px;
                        }
                        .footer {
                            text-align: center;
                            font-size: 10px;
                            color: #666;
                            margin-top: 20px;
                            border-top: 1px solid #ddd;
                            padding-top: 10px;
                        }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>Informe Dermatol√≥gico</h1>
                        <p>Fecha: ${new Date().toLocaleDateString()}</p>
                        <p>Hora: ${new Date().toLocaleTimeString()}</p>
                    </div>
                    <pre>${conclusion}</pre>
                    <div class="footer">
                        <p>Generado por Sistema de Evaluaci√≥n Dermatol√≥gica Premium</p>
                    </div>
                </body>
                </html>
            `);
            printWindow.document.close();
            printWindow.print();
        }

        // üß≠ Navegaci√≥n a secciones (Copiado y adaptado de gastro.html)
        function scrollToSection(sectionId) {
            const section = document.getElementById(`section-${sectionId}`); // Usa el ID de la secci√≥n principal
            if (section) {
                section.scrollIntoView({
                    behavior: 'smooth',
                    block: 'start',
                    inline: 'nearest'
                });

                const header = section.querySelector('.section-header');
                if (header && !header.classList.contains('expanded')) {
                    toggleSection(header);
                }
            }
        }

        // ‚úÖ Actualizar altura de secci√≥n (Copiado de gastro.html)
        function updateSectionHeight(contentElement) {
            if (contentElement && contentElement.classList.contains('expanded')) {
                setTimeout(() => {
                    contentElement.style.maxHeight = contentElement.scrollHeight + 'px';
                }, 50);
            }
        }

        // üìÇ Toggle de secciones mejorado (Copiado de gastro.html)
        function toggleSection(headerElement) {
            const content = headerElement.nextElementSibling;
            const section = headerElement.parentElement;

            headerElement.classList.toggle('expanded');
            section.classList.toggle('active');

            if (content.classList.toggle('expanded')) {
                content.style.maxHeight = content.scrollHeight + 'px';
                content.classList.add('slide-in');
            } else {
                content.style.maxHeight = '0';
                content.classList.remove('slide-in');
            }
        }

        // üîÑ Expandir/contraer todas las secciones (Copiado de gastro.html)
        function expandAllSections() {
            document.querySelectorAll('.section-header:not(.expanded)').forEach(header => {
                toggleSection(header);
            });
        }

        function collapseAllSections() {
            document.querySelectorAll('.section-header.expanded').forEach(header => {
                toggleSection(header);
            });
        }

        // üö´ Manejo de "Sin quejas" (Existente, pero modificado para llamar a updateDashboard)
        function handleNoComplaints() {
            const noComplaintsCheckbox = document.getElementById('sin-quejas');
            const otherCheckboxes = document.querySelectorAll('#anamnesis input[type="checkbox"]:not(#sin-quejas)');

            otherCheckboxes.forEach(checkbox => {
                checkbox.disabled = noComplaintsCheckbox.checked;
                if (noComplaintsCheckbox.checked) checkbox.checked = false;
            });
            updateDashboard(); // Llamada a updateDashboard
        }

        // Manejo de "Sin Alergias" (Nuevo para `derma.html`)
        function toggleSinAlergias() {
            const sinAlergiasCheckbox = document.getElementById('sin-alergias');
            const otherAllergyCheckboxes = document.querySelectorAll('#antecedentes .exam-section:first-of-type input[type="checkbox"]:not(#sin-alergias)');

            otherAllergyCheckboxes.forEach(checkbox => {
                checkbox.disabled = sinAlergiasCheckbox.checked;
                if (sinAlergiasCheckbox.checked) {
                    checkbox.checked = false;
                    // Tambi√©n ocultar y limpiar campos de especificaci√≥n asociados
                    const specId = `spec-${checkbox.id.replace('alergia-', '')}`;
                    const specField = document.getElementById(specId);
                    if (specField) {
                        specField.classList.remove('show');
                        specField.value = '';
                    }
                }
            });
            updateDashboard();
        }

        // Manejo de "Sin Antecedentes Familiares" (Nuevo para `derma.html`)
        function toggleSinAntecedentesFam() {
            const sinAntecedentesFamCheckbox = document.getElementById('sin-antec-fam');
            const otherFamCheckboxes = document.querySelectorAll('#antecedentes .exam-section:nth-of-type(2) input[type="checkbox"]:not(#sin-antec-fam)');

            otherFamCheckboxes.forEach(checkbox => {
                checkbox.disabled = sinAntecedentesFamCheckbox.checked;
                if (sinAntecedentesFamCheckbox.checked) checkbox.checked = false;
            });
            updateDashboard();
        }

        // ‚öñÔ∏è Manejo de checkboxes mutuamente excluyentes (Existente, pero modificado para llamar a updateDashboard)
        function handleMutuallyExclusive(positiveId, negativeId, checkbox) {
            if (checkbox.checked) {
                const oppositeId = checkbox.id === positiveId ? negativeId : positiveId;
                const oppositeCheckbox = document.getElementById(oppositeId);
                if (oppositeCheckbox) oppositeCheckbox.checked = false;
            }
            updateDashboard(); // Llamada a updateDashboard
        }

        // Funci√≥n para mostrar/ocultar campos de especificaci√≥n (Existente, modificado para llamar a updateDashboard)
        function toggleSpecification(checkboxId, specFieldId) {
            const checkbox = document.getElementById(checkboxId);
            const specField = document.getElementById(specFieldId);

            if (checkbox && specField) {
                if (checkbox.checked) {
                    specField.classList.add('show');
                    specField.focus();
                } else {
                    specField.classList.remove('show');
                    specField.value = '';
                }
            }
            updateDashboard(); // Llamada a updateDashboard
        }

        // Funci√≥n para mostrar/ocultar la secci√≥n ABCDE (Existente, modificado para llamar a updateDashboard)
        function toggleABCDESection() {
            const tieneNevus = document.getElementById('tiene-nevus').checked;
            const lesionSospechosa = document.getElementById('lesion-sospechosa').checked;
            const abcdeSection = document.getElementById('abcde-evaluation');

            if (tieneNevus || lesionSospechosa) {
                abcdeSection.style.display = 'block';
            } else {
                abcdeSection.style.display = 'none';
                // Limpiar campos ABCDE
                document.querySelectorAll('#abcde-evaluation input[type="radio"]').forEach(input => {
                    input.checked = false;
                });
                document.querySelectorAll('#abcde-evaluation input[type="checkbox"]').forEach(input => {
                    input.checked = false;
                });
                document.getElementById('abcde-diametro').value = '';
            }
            evaluateABCDE(); // Llama a la evaluaci√≥n ABCDE para limpiar/actualizar su estado
            updateDashboard(); // Llama a updateDashboard
        }

        // Funci√≥n para evaluar el di√°metro autom√°ticamente (Existente, modificado para llamar a updateDashboard)
        function evaluateDiameter() {
            const diameter = parseFloat(document.getElementById('abcde-diametro').value) || 0;
            const mayor6 = document.getElementById('diametro-mayor-6');
            const menor6 = document.getElementById('diametro-menor-6');

            if (diameter > 6) {
                mayor6.checked = true;
                menor6.checked = false;
            } else if (diameter > 0) {
                mayor6.checked = false;
                menor6.checked = true;
            } else { // Si el campo est√° vac√≠o o es 0, desmarcar ambos
                mayor6.checked = false;
                menor6.checked = false;
            }
            evaluateABCDE(); // Llama a la evaluaci√≥n ABCDE
        }

        // Funci√≥n para evaluar la regla ABCDE completa (Existente, modificado para llamar a updateDashboard)
        function evaluateABCDE() {
            let score = 0;

            // A - Asimetr√≠a
            if (document.getElementById('asimetria-si') && document.getElementById('asimetria-si').checked) {
                score++;
            }

            // B - Bordes
            if (document.getElementById('bordes-irregulares') && document.getElementById('bordes-irregulares').checked) {
                score++;
            }

            // C - Color
            const colores = ['color-negro', 'color-marron', 'color-azul', 'color-rojo', 'color-blanco'];
            const coloresPresentes = colores.filter(id => document.getElementById(id) && document.getElementById(id).checked);
            if (coloresPresentes.length > 1) { // Si hay m√°s de un color seleccionado
                score++;
            }

            // D - Di√°metro
            if (document.getElementById('diametro-mayor-6') && document.getElementById('diametro-mayor-6').checked) {
                score++;
            }

            // E - Evoluci√≥n
            const evoluciones = ['evol-tama√±o', 'evol-forma', 'evol-color', 'evol-sintomas'];
            const evolucionesPresentes = evoluciones.filter(id => document.getElementById(id) && document.getElementById(id).checked);
            if (evolucionesPresentes.length > 0) {
                score++;
            }

            // Actualizar la interfaz
            document.getElementById('abcde-score').textContent = score + '/5';

            let riskLevel, recommendation;
            if (score === 0) {
                riskLevel = 'Muy bajo';
                recommendation = 'Seguimiento de rutina anual';
            } else if (score === 1) {
                riskLevel = 'Bajo';
                recommendation = 'Seguimiento en 6-12 meses';
            } else if (score === 2) {
                riskLevel = 'Moderado';
                recommendation = 'Seguimiento en 3-6 meses, considerar dermatoscopia';
            } else if (score >= 3) {
                riskLevel = 'Alto';
                recommendation = 'üö® DERIVACI√ìN URGENTE a dermatolog√≠a/oncolog√≠a';
            }

            document.getElementById('abcde-risk').textContent = riskLevel;
            document.getElementById('abcde-recommendation').textContent = recommendation;

            updateDashboard(); // Llama a updateDashboard
        }

        // Funci√≥n para manejar clics en el mapa corporal (Existente, modificado para llamar a updateDashboard)
        function initializeBodyMap() {
            const bodySvgs = document.querySelectorAll('.body-svg');

            bodySvgs.forEach(svg => {
                const bodyParts = svg.querySelectorAll('.body-part');

                bodyParts.forEach(part => {
                    part.addEventListener('click', function() {
                        const area = this.getAttribute('data-area');

                        if (selectedBodyAreas.has(area)) {
                            selectedBodyAreas.delete(area);
                            this.classList.remove('selected');
                        } else {
                            selectedBodyAreas.add(area);
                            this.classList.add('selected');
                        }

                        updateSelectedAreasDisplay();
                        updateDashboard(); // Llama a updateDashboard
                    });
                });
            });
        }

        // Funci√≥n para actualizar la visualizaci√≥n de √°reas seleccionadas (Existente)
        function updateSelectedAreasDisplay() {
            const frontDisplay = document.getElementById('selected-areas-front');
            const backDisplay = document.getElementById('selected-areas-back');

            frontDisplay.innerHTML = '';
            backDisplay.innerHTML = '';

            // Definir qu√© √°reas pertenecen a la vista posterior (se pueden refinar si hay superposici√≥n)
            const posteriorAreas = [
                'Occipital', 'Regi√≥n auricular derecha', 'Regi√≥n auricular izquierda', 'Nuca',
                'Espalda alta derecha', 'Espalda alta izquierda', 'Espalda media derecha', 'Espalda media izquierda', 'Regi√≥n lumbar',
                'Hombro derecho posterior', 'Hombro izquierdo posterior', 'Brazo derecho posterior superior', 'Brazo izquierdo posterior superior',
                'Codo derecho posterior', 'Codo izquierdo posterior', 'Antebrazo derecho posterior', 'Antebrazo izquierdo posterior',
                'Mano derecha posterior', 'Mano izquierda posterior', 'Regi√≥n sacra', 'Gl√∫teo derecho', 'Gl√∫teo izquierdo',
                'Pliegue intergl√∫teo', 'Muslo derecho posterior', 'Muslo izquierdo posterior', 'Hueco popl√≠teo derecho',
                'Hueco popl√≠teo izquierdo', 'Pantorrilla derecha', 'Pantorrilla izquierda', 'Tend√≥n Aquiles derecho',
                'Tend√≥n Aquiles izquierdo', 'Tal√≥n derecho', 'Tal√≥n izquierdo', 'Planta pie derecho', 'Planta pie izquierdo'
            ];

            selectedBodyAreas.forEach(area => {
                const tag = document.createElement('span');
                tag.className = 'selected-area-tag';
                tag.textContent = area;
                tag.onclick = (event) => { event.stopPropagation(); removeBodyArea(area); }; // Detener propagaci√≥n

                if (posteriorAreas.includes(area)) {
                    backDisplay.appendChild(tag);
                } else {
                    frontDisplay.appendChild(tag);
                }
            });
        }

        // Funci√≥n para remover √°rea del mapa corporal (Existente, modificado para llamar a updateDashboard)
        function removeBodyArea(area) {
            selectedBodyAreas.delete(area);

            document.querySelectorAll(`[data-area="${area}"]`).forEach(part => {
                part.classList.remove('selected');
            });

            updateSelectedAreasDisplay();
            updateDashboard(); // Llama a updateDashboard
        }

        // Funci√≥n para calcular SCORAD (Existente, modificado para llamar a updateDashboard)
        function calculateSCORAD() {
            const extension = parseFloat(document.getElementById('scorad-extension').value) || 0;
            const eritema = parseInt(document.getElementById('scorad-eritema').value) || 0;
            const edema = parseInt(document.getElementById('scorad-edema').value) || 0;
            const excoriacion = parseInt(document.getElementById('scorad-excoriacion').value) || 0;
            const liquenificacion = parseInt(document.getElementById('scorad-liquenificacion').value) || 0;
            const descamacion = parseInt(document.getElementById('scorad-descamacion').value) || 0;
            const xerosis = parseInt(document.getElementById('scorad-xerosis').value) || 0;
            const prurito = parseInt(document.getElementById('scorad-prurito').value) || 0;
            const sue√±o = parseInt(document.getElementById('scorad-sue√±o').value) || 0;

            const A = extension;
            const B = eritema + edema + excoriacion + liquenificacion + descamacion + xerosis;
            const C = prurito + sue√±o;

            const scoradTotal = (A/5 + 7*B/2 + C).toFixed(1);
            document.getElementById('scorad-total').textContent = scoradTotal;

            updateDashboard(); // Llama a updateDashboard
        }

        // Funci√≥n para calcular DLQI (Existente, modificado para llamar a updateDashboard)
        function calculateDLQI() {
            let total = 0;

            for (let i = 1; i <= 10; i++) {
                const selected = document.querySelector(`input[name="dlqi-${i}"]:checked`);
                if (selected) {
                    total += parseInt(selected.value);
                }
            }

            document.getElementById('dlqi-total').textContent = total;

            let interpretation;
            if (total <= 1) {
                interpretation = 'Sin impacto en la calidad de vida';
            } else if (total <= 5) {
                interpretation = 'Impacto peque√±o en la calidad de vida';
            } else if (total <= 10) {
                interpretation = 'Impacto moderado en la calidad de vida';
            } else if (total <= 20) {
                interpretation = 'Impacto muy grande en la calidad de vida';
            } else {
                interpretation = 'Impacto extremadamente grande en la calidad de vida';
            }

            document.getElementById('dlqi-interpretation').textContent = interpretation;

            // Actualizar estado de Calidad de Vida en el Dashboard
            const qualityOfLifeItem = document.getElementById('quality-of-life-item');
            if (total > 0) {
                qualityOfLifeStatus = interpretation;
                if (total >= 6) { // Moderado o m√°s
                    qualityOfLifeItem.className = 'dashboard-item dashboard-warning';
                } else {
                    qualityOfLifeItem.className = 'dashboard-item dashboard-normal';
                }
            } else {
                qualityOfLifeStatus = 'Sin impacto';
                qualityOfLifeItem.className = 'dashboard-item dashboard-normal';
            }
            document.getElementById('quality-of-life-status').textContent = qualityOfLifeStatus;

            updateDashboard(); // Llama a updateDashboard
        }

        // Funci√≥n para actualizar indicadores de completitud (Antigua, ahora se usar√° updateDashboard)
        // La funcionalidad de `updateCompletionIndicators` ha sido integrada en `updateDashboard` para simplificar.


        // üìä ACTUALIZAR DASHBOARD (Copiado y adaptado de gastro.html)
        function updateDashboard() {
            const sections = [
                'antecedentes', 'anamnesis', 'lesiones-pigmentadas', 'primary-lesions',
                'secondary-lesions', 'distribution', 'appendages', 'special-tests', 'severity'
            ];

            let currentCompletedSections = 0;
            let currentAlertCount = 0;
            let currentWarningCount = 0;
            let currentFindingsCount = 0;

            sections.forEach(sectionId => {
                const sectionElement = document.getElementById(sectionId);
                if (sectionElement) {
                    const checkboxes = sectionElement.querySelectorAll('input[type="checkbox"]:checked');
                    const radios = sectionElement.querySelectorAll('input[type="radio"]:checked');
                    const numbers = sectionElement.querySelectorAll('input[type="number"]');
                    const textareas = sectionElement.querySelectorAll('textarea');
                    const texts = sectionElement.querySelectorAll('input[type="text"]'); // Para campos de especificaci√≥n

                    let hasContent = false;
                    if (checkboxes.length > 0 || radios.length > 0) hasContent = true;
                    numbers.forEach(input => {
                        if (input.value && input.value !== '0') hasContent = true;
                    });
                    textareas.forEach(textarea => {
                        if (textarea.value.trim() !== '') hasContent = true;
                    });
                    texts.forEach(input => {
                        if (input.value.trim() !== '' && input.classList.contains('show')) hasContent = true; // Solo si est√° visible
                    });
                    // Comprobar si hay √°reas seleccionadas en el mapa corporal (parte de 'distribution')
                    if (sectionId === 'distribution' && selectedBodyAreas.size > 0) {
                        hasContent = true;
                    }

                    if (hasContent) {
                        currentCompletedSections++;
                        currentFindingsCount += (checkboxes.length + radios.length + (numbers.length > 0 ? 1 : 0) + (textareas.length > 0 ? 1 : 0));

                        const badge = document.getElementById(`badge-${sectionId}`);
                        const navItem = document.getElementById(`nav-${sectionId}`);

                        if (badge) {
                            badge.classList.add('completed');
                            badge.innerHTML = '<i class="fas fa-check"></i>';
                        }
                        if (navItem) {
                            navItem.style.opacity = '1';
                            navItem.parentElement.classList.add('completed');
                        }

                        // Criterios de alerta y warning espec√≠ficos para dermatolog√≠a
                        // Alert: requiere acci√≥n inmediata/urgente (melanoma alto riesgo, p√©nfigo, etc.)
                        // Warning: requiere atenci√≥n, seguimiento (dermatitis moderada/severa, √∫lceras, etc.)

                        // ABCDE Score
                        const abcdeRisk = document.getElementById('abcde-risk').textContent;
                        if (abcdeRisk === 'Alto') currentAlertCount++;
                        else if (abcdeRisk === 'Moderado') currentWarningCount++;

                        // Signos f√≠sicos (positivos)
                        const nikolskyPos = document.getElementById('nikolsky-pos').checked;
                        const asboeHansenPos = document.getElementById('asboe-hansen-pos').checked;
                        if (nikolskyPos || asboeHansenPos) currentAlertCount += 2; // Muy cr√≠ticos

                        // Quejas (Dolor severo, prurito severo)
                        const pruritoIntensity = parseInt(document.getElementById('prurito-intensity').value) || 0;
                        if (pruritoIntensity >= 7) currentWarningCount++; // Prurito severo
                        if (document.getElementById('dolor-cutaneo').checked) currentWarningCount++;


                        // Escalas de severidad
                        const scoradTotal = parseFloat(document.getElementById('scorad-total').textContent) || 0;
                        if (scoradTotal >= 50) currentAlertCount++; // SCORAD severo
                        else if (scoradTotal >= 25) currentWarningCount++; // SCORAD moderado

                        const pasiTotal = parseFloat(document.getElementById('pasi-total').textContent) || 0;
                        if (pasiTotal >= 10) currentWarningCount++; // PASI significativo

                        const superficieAfectada = parseFloat(document.getElementById('superficie-afectada').value) || 0;
                        if (superficieAfectada >= 30) currentAlertCount++; // Gran superficie afectada
                        else if (superficieAfectada >= 10) currentWarningCount++;

                        // Hallazgos primarios/secundarios cr√≠ticos
                        if (document.getElementById('ulcera-profunda').checked) currentAlertCount++;
                        if (document.getElementById('ampolla-tensa').checked) currentAlertCount++;
                        if (document.getElementById('pustula-infectada').checked) currentWarningCount++;

                    } else {
                        const badge = document.getElementById(`badge-${sectionId}`);
                        const navItem = document.getElementById(`nav-${sectionId}`);

                        if (badge) {
                            badge.classList.remove('completed');
                            badge.innerHTML = '<i class="fas fa-circle"></i>';
                        }
                        if (navItem) {
                            navItem.style.opacity = '0';
                            navItem.parentElement.classList.remove('completed');
                        }
                    }
                }
            });

            const totalSections = sections.length;
            const progress = Math.round((currentCompletedSections / totalSections) * 100);
            document.getElementById('exam-progress').textContent = `${progress}%`;
            document.getElementById('sections-completed').textContent = `${currentCompletedSections}/${totalSections}`;
            document.getElementById('alert-count').textContent = currentAlertCount;
            document.getElementById('warning-count').textContent = currentWarningCount;
            document.getElementById('findings-count').textContent = currentFindingsCount;

            const alertsItem = document.getElementById('alerts-item');
            const warningsItem = document.getElementById('warnings-item');
            const findingsItem = document.getElementById('findings-item');
            const qualityOfLifeItem = document.getElementById('quality-of-life-item'); // Asegurarse de que est√© aqu√≠

            // Si quieres que siempre se muestren, no necesitas el display='flex' condicional
            alertsItem.style.display = 'flex';
            warningsItem.style.display = 'flex';
            findingsItem.style.display = 'flex';
            qualityOfLifeItem.style.display = 'flex';

            alertsItem.classList.toggle('dashboard-alert', currentAlertCount > 0);
            warningsItem.classList.toggle('dashboard-warning', currentWarningCount > 0);
            findingsItem.classList.toggle('dashboard-normal', currentFindingsCount > 0);
            // El estado de qualityOfLifeItem se actualiza en calculateDLQI()

            // Guardar valores globales
            examProgress = progress;
            sectionsCompleted = currentCompletedSections;
            alertCount = currentAlertCount;
            warningCount = currentWarningCount;
            findingsCount = currentFindingsCount;

            generateConclusion(); // Llama a generateConclusion al final de updateDashboard
        }

        // üìù GENERAR CONCLUSI√ìN MEJORADA (Adaptada para dermatolog√≠a)
        // Funci√≥n mejorada de generaci√≥n de conclusi√≥n con formato narrativo
        function generateConclusion() {
            const conclusionEl = document.getElementById('conclusion-text');
            const realTimeEl = document.getElementById('stickyContent'); // Apunta al sticky-content
            let conclusion = 'INFORME DEL EXAMEN DERMATOL√ìGICO\n\n';

            // Funciones auxiliares para simplificar el c√≥digo y la legibilidad
            const getLabelText = (id) => document.querySelector(`label[for="${id}"]`)?.textContent.toLowerCase() || '';
            const isChecked = (id) => document.getElementById(id)?.checked;
            const getInputValue = (id) => document.getElementById(id)?.value;
            const getSelectedValue = (id) => document.getElementById(id)?.value;
            const getSelectedText = (id) => {
                const select = document.getElementById(id);
                return select && select.selectedIndex > -1 ? select.options[select.selectedIndex].textContent.toLowerCase() : '';
            };
            const capitalizeFirstLetter = (string) => string.charAt(0).toUpperCase() + string.slice(1);
            const getRadioButtonValue = (name) => {
                const radio = document.querySelector(`input[name="${name}"]:checked`);
                return radio ? getLabelText(radio.id) : '';
            };
            // Funci√≥n para formatear listas de hallazgos
            const formatList = (arr) => {
                if (arr.length === 0) return '';
                if (arr.length === 1) return arr[0];
                const last = arr.pop();
                return arr.join(', ') + ' y ' + last;
            };

            // --- 1. ANTECEDENTES ---
            let antecedentesAdded = false;
            let antecedentesText = '';

            // Alergias
            const alergiasReport = [];
            const alergiaMedicamentosChecked = isChecked('alergia-medicamentos');
            const alergiaMedicamentosSpec = getInputValue('spec-medicamentos');
            const alergiaAlimentosChecked = isChecked('alergia-alimentos');
            const alergiaAlimentosSpec = getInputValue('spec-alimentos');
            const alergiaContactoChecked = isChecked('alergia-contacto');
            const alergiaContactoSpec = getInputValue('spec-contacto');
            const sinAlergiasChecked = isChecked('sin-alergias');

            if (alergiaMedicamentosChecked) alergiasReport.push(`medicamentos (${alergiaMedicamentosSpec || 'no especificado'})`);
            else if (alergiaMedicamentosSpec) alergiasReport.push(`medicamentos no marcados (${alergiaMedicamentosSpec})`);

            if (alergiaAlimentosChecked) alergiasReport.push(`alimentos (${alergiaAlimentosSpec || 'no especificado'})`);
            else if (alergiaAlimentosSpec) alergiasReport.push(`alimentos no marcados (${alergiaAlimentosSpec})`);

            if (alergiaContactoChecked) alergiasReport.push(`al√©rgenos de contacto (${alergiaContactoSpec || 'no especificado'})`);
            else if (alergiaContactoSpec) alergiasReport.push(`al√©rgenos de contacto no marcados (${alergiaContactoSpec})`);

            if (alergiasReport.length > 0) {
                antecedentesAdded = true;
                antecedentesText += `Alergias conocidas: Refiere alergia a ${formatList(alergiasReport)}. `;
            } else if (sinAlergiasChecked) {
                antecedentesAdded = true;
                antecedentesText += `Alergias conocidas: Niega alergias conocidas. `;
            } else if (document.querySelectorAll('#antecedentes .exam-section:first-of-type input[type="checkbox"]').length > 0 || alergiaMedicamentosSpec || alergiaAlimentosSpec || alergiaContactoSpec) {
                // Si hay campos de alergia con alg√∫n input (marcado o no), pero sin texto final, indicamos "no refiere"
                antecedentesAdded = true;
                antecedentesText += `Alergias conocidas: No refiere. `;
            }


            // Historia de Atopia
            const atopiaReport = [];
            ['asma-bronquial', 'rinitis-alergica', 'dermatitis-atopica', 'conjuntivitis-alergica'].forEach(id => {
                if (isChecked(id)) atopiaReport.push(getLabelText(id));
            });
            if (atopiaReport.length > 0) {
                antecedentesAdded = true;
                antecedentesText += `Historia de atopia: Antecedente personal de ${formatList(atopiaReport)}. `;
            } else if (document.querySelectorAll('#antecedentes .exam-section:nth-of-type(2) input[type="checkbox"]').length > 0) {
                antecedentesAdded = true;
                antecedentesText += `Historia de atopia: No refiere. `;
            }


            // Enfermedades Cr√≥nicas
            const comorbilidadesReport = [];
            ['diabetes', 'hipertension', 'enf-autoinmune', 'cancer-piel', 'inmunodepresion'].forEach(id => {
                if (isChecked(id)) comorbilidadesReport.push(getLabelText(id));
            });
            if (comorbilidadesReport.length > 0) {
                antecedentesAdded = true;
                antecedentesText += `Enfermedades cr√≥nicas: ${formatList(comorbilidadesReport)}. `;
            } else if (document.querySelectorAll('#antecedentes .exam-section:nth-of-type(3) input[type="checkbox"]').length > 0) {
                antecedentesAdded = true;
                antecedentesText += `Enfermedades cr√≥nicas: No refiere. `;
            }


            // Antecedentes Familiares
            const familiarHxReport = [];
            ['fam-psoriasis', 'fam-atopia', 'fam-melanoma', 'fam-cancer-piel', 'fam-vitiligo'].forEach(id => {
                if (isChecked(id)) familiarHxReport.push(getLabelText(id));
            });
            const sinAntecFamChecked = isChecked('sin-antec-fam');

            if (familiarHxReport.length > 0) {
                antecedentesAdded = true;
                antecedentesText += `Antecedentes familiares: ${formatList(familiarHxReport)}. `;
            } else if (sinAntecFamChecked) {
                antecedentesAdded = true;
                antecedentesText += 'Antecedentes familiares: Niega antecedentes familiares de importancia dermatol√≥gica. ';
            } else if (document.querySelectorAll('#antecedentes .exam-container:nth-of-type(2) input[type="checkbox"]').length > 0) {
                antecedentesAdded = true;
                antecedentesText += `Antecedentes familiares: No refiere. `;
            }


            // Tratamientos Previos y Actuales
            const tratamientosPrevios = getInputValue('tratamientos-previos');
            const medicacionHabitual = getInputValue('medicacion-habitual');

            if (tratamientosPrevios && tratamientosPrevios.trim()) {
                antecedentesAdded = true;
                antecedentesText += `Tratamientos previos para la condici√≥n actual: ${tratamientosPrevios.trim()}. `;
            } else if (document.getElementById('tratamientos-previos')) {
                 antecedentesAdded = true;
                 antecedentesText += `Tratamientos previos para la condici√≥n actual: No refiere. `;
            }

            if (medicacionHabitual && medicacionHabitual.trim()) {
                antecedentesAdded = true;
                antecedentesText += `Medicaci√≥n habitual: ${medicacionHabitual.trim()}. `;
            } else if (document.getElementById('medicacion-habitual')) {
                 antecedentesAdded = true;
                 antecedentesText += `Medicaci√≥n habitual: No refiere. `;
            }

            if (antecedentesAdded) {
                conclusion += `ANTECEDENTES:\n${antecedentesText.trim()}\n\n`;
            }

            // --- 2. ANAMNESIS Y QUEJAS PRINCIPALES ---
            let quejasPrincipalesAdded = false;
            let quejasPrincipalesText = '';
            const quejasReport = [];
            const sinQuejasMarcado = isChecked('sin-quejas');

            if (sinQuejasMarcado) {
                quejasReport.push('el paciente no refiere quejas');
            } else {
                ['prurito', 'dolor-cutaneo', 'ardor', 'erupciones', 'descamacion', 'cambio-color', 'caida-cabello', 'cambios-unas', 'lesiones-mucosas', 'fotosensibilidad'].forEach(id => {
                    if (isChecked(id)) {
                        quejasReport.push(getLabelText(id));
                    }
                });
            }

            if (quejasReport.length > 0) {
                quejasPrincipalesAdded = true;
                if (sinQuejasMarcado) {
                    quejasPrincipalesText += `Motivo de consulta: Consulta de rutina dermatol√≥gica, ${formatList(quejasReport)}. `;
                } else {
                    quejasPrincipalesText += `Motivo de consulta: Paciente consulta por ${formatList(quejasReport)}. `;

                    // Caracter√≠sticas Temporales
                    const tiempoEvolucion = getRadioButtonValue('tiempo-evolucion');
                    if (tiempoEvolucion) {
                        quejasPrincipalesText += `Tiempo de evoluci√≥n: ${tiempoEvolucion}. `;
                    } else if (document.querySelector('input[name="tiempo-evolucion"]')) {
                        quejasPrincipalesText += `Tiempo de evoluci√≥n: No especificado. `;
                    }

                    const patronPresentacionReport = [];
                    ['episodico', 'persistente', 'estacional', 'primera-vez'].forEach(id => {
                        if (isChecked(id)) patronPresentacionReport.push(getLabelText(id));
                    });
                    if (patronPresentacionReport.length > 0) {
                        quejasPrincipalesText += `Patr√≥n de presentaci√≥n: ${formatList(patronPresentacionReport)}. `;
                    } else if (document.querySelectorAll('#anamnesis .exam-section:nth-of-type(2) input[type="checkbox"]').length > 0) {
                         quejasPrincipalesText += `Patr√≥n de presentaci√≥n: No especificado. `;
                    }


                    // Factores Desencadenantes
                    const factoresDesencadenantesReport = [];
                    const specQuimicos = getInputValue('spec-quimicos');
                    const specCosmeticos = getInputValue('spec-cosmeticos');
                    const specMedicamentosFactor = getInputValue('spec-medicamentos-factor');
                    const specAlimentosFactor = getInputValue('spec-alimentos-factor');

                    if (isChecked('exposicion-solar')) factoresDesencadenantesReport.push(getLabelText('exposicion-solar'));
                    if (isChecked('contacto-quimicos')) factoresDesencadenantesReport.push('contacto con qu√≠micos' + (specQuimicos ? ` (${specQuimicos})` : ''));
                    else if (specQuimicos) factoresDesencadenantesReport.push(`qu√≠micos no marcados (${specQuimicos})`);

                    if (isChecked('nuevos-cosmeticos')) factoresDesencadenantesReport.push('nuevos cosm√©ticos' + (specCosmeticos ? ` (${specCosmeticos})` : ''));
                    else if (specCosmeticos) factoresDesencadenantesReport.push(`cosm√©ticos no marcados (${specCosmeticos})`);

                    if (isChecked('medicamentos-factor')) factoresDesencadenantesReport.push('medicamentos' + (specMedicamentosFactor ? ` (${specMedicamentos-factor})` : ''));
                    else if (specMedicamentosFactor) factoresDesencadenantesReport.push(`medicamentos no marcados (${specMedicamentosFactor})`);

                    if (isChecked('alimentos-factor')) factoresDesencadenantesReport.push('alimentos' + (specAlimentosFactor ? ` (${specAlimentosFactor})` : ''));
                    else if (specAlimentosFactor) factoresDesencadenantesReport.push(`alimentos no marcados (${specAlimentosFactor})`);

                    if (isChecked('estres')) factoresDesencadenantesReport.push(getLabelText('estres'));
                    if (isChecked('infecciones')) factoresDesencadenantesReport.push(getLabelText('infecciones'));
                    if (isChecked('cambios-hormonales')) factoresDesencadenantesReport.push(getLabelText('cambios-hormonales'));
                    if (isChecked('picaduras')) factoresDesencadenantesReport.push(getLabelText('picaduras'));
                    if (isChecked('contacto-animales')) factoresDesencadenantesReport.push(getLabelText('contacto-animales'));

                    if (factoresDesencadenantesReport.length > 0) {
                        quejasPrincipalesText += `Factores desencadenantes posibles: ${formatList(factoresDesencadenantesReport)}. `;
                    } else if (document.querySelectorAll('#anamnesis .exam-container:nth-of-type(3) input').length > 0) {
                         quejasPrincipalesText += `Factores desencadenantes posibles: No refiere. `;
                    }
                }
            }
            if (quejasPrincipalesAdded) {
                conclusion += `ANAMNESIS Y QUEJAS PRINCIPALES:\n${quejasPrincipalesText.trim()}\n\n`;
            }

            // --- 3. EVALUACI√ìN DE LESIONES PIGMENTADAS (Regla ABCDE) ---
            let abcdeAdded = false;
            let abcdeText = '';

            const tieneNevus = isChecked('tiene-nevus');
            const lesionSospechosa = isChecked('lesion-sospechosa');
            const abcdeSectionVisible = document.getElementById('abcde-evaluation').style.display !== 'none';

            if (tieneNevus || lesionSospechosa || abcdeSectionVisible) {
                abcdeAdded = true;
                abcdeText += `Evaluaci√≥n de lesiones pigmentadas: `;
                if(tieneNevus && lesionSospechosa) {
                    abcdeText += `El paciente presenta nevus/lunares para evaluar y lesi√≥n pigmentada sospechosa. `;
                } else if (tieneNevus) {
                    abcdeText += `El paciente presenta nevus/lunares para evaluar. `;
                } else if (lesionSospechosa) {
                    abcdeText += `El paciente presenta una lesi√≥n pigmentada sospechosa. `;
                } else {
                    abcdeText += `Se observa una lesi√≥n pigmentada no categorizada. `; // Si la secci√≥n est√° visible pero no se marc√≥ ninguna de las dos
                }


                const abcdeScore = document.getElementById('abcde-score')?.textContent;
                const abcdeRisk = document.getElementById('abcde-risk')?.textContent;

                if (abcdeScore && abcdeScore !== '--') { // No se usa 0/5 porque puede no haber inputs
                    abcdeText += `Aplicando la regla ABCDE: `;

                    const criteriosReport = [];
                    const asimetria = getRadioButtonValue('abcde-asimetria');
                    if(asimetria) criteriosReport.push(`Asimetr√≠a: ${asimetria}`);

                    const bordes = getRadioButtonValue('abcde-bordes');
                    if(bordes) criteriosReport.push(`Bordes: ${bordes}`);

                    const coloresMarcados = ['color-negro', 'color-marron', 'color-azul', 'color-rojo', 'color-blanco'].filter(id => isChecked(id)).map(id => getLabelText(id).replace('color ', ''));
                    const colorUniformeChecked = isChecked('color-uniforme');
                    if(coloresMarcados.length > 0 && !colorUniformeChecked) { // M√∫ltiples colores, o un color espec√≠fico y no uniforme
                        criteriosReport.push(`Color: M√∫ltiples (${formatList(coloresMarcados)})`);
                    } else if (colorUniformeChecked) {
                        criteriosReport.push(`Color: Uniforme`);
                    } else if (coloresMarcados.length === 1 && !colorUniformeChecked) { // Un solo color pero no uniforme, no deber√≠a pasar si no hay radio
                         criteriosReport.push(`Color: No uniforme (${formatList(coloresMarcados)})`);
                    }

                    const diametro = getInputValue('abcde-diametro');
                    const diametroEval = getRadioButtonValue('abcde-diametro-eval');
                    if(diametroEval) criteriosReport.push(`Di√°metro: ${diametroEval}${diametro ? ` (${diametro}mm)` : ''}`);
                    else if (diametro) criteriosReport.push(`Di√°metro: ${diametro}mm (evaluaci√≥n no marcada)`);


                    const evolucionesMarcadas = ['evol-tama√±o', 'evol-forma', 'evol-color', 'evol-sintomas'].filter(id => isChecked(id)).map(id => getLabelText(id));
                    const sinCambiosChecked = isChecked('sin-cambios');
                    if(evolucionesMarcadas.length > 0) {
                        criteriosReport.push(`Evoluci√≥n: Reciente (${formatList(evolucionesMarcadas)})`);
                    } else if (sinCambiosChecked) {
                        criteriosReport.push(`Evoluci√≥n: Sin cambios`);
                    }

                    if (criteriosReport.length > 0) {
                        abcdeText += `Hallazgos de ABCDE: ${criteriosReport.join('; ')}. `;
                    } else if (abcdeSectionVisible) { // Secci√≥n visible, pero no hay nada marcado
                        abcdeText += `No se han marcado hallazgos espec√≠ficos seg√∫n la regla ABCDE. `;
                    }

                    abcdeText += `Puntuaci√≥n de criterios: ${abcdeScore}. Nivel de riesgo: ${abcdeRisk}. Recomendaci√≥n: ${document.getElementById('abcde-recommendation').textContent}. `;

                } else if (abcdeScore === '--' && abcdeSectionVisible) { // Si no hay ning√∫n input relevante marcado en ABCDE
                    abcdeText += `No se ha realizado una evaluaci√≥n completa de la regla ABCDE. `;
                }
            }
            if (abcdeAdded) {
                conclusion += `EVALUACI√ìN DE LESIONES PIGMENTADAS:\n${abcdeText.trim()}\n\n`;
            }

            // --- 4. ELEMENTOS PRIMARIOS DE LAS LESIONES CUT√ÅNEAS ---
            let primaryLesionsAdded = false;
            let primaryLesionsText = '';

            // M√°culas y Manchas
            const maculasReport = [];
            const maculaSize = getInputValue('macula-size');
            ['macula-hiperpigmentada', 'macula-hipopigmentada', 'macula-eritematosa',
             'macula-purpurica', 'petequias', 'equimosis'].forEach(id => {
                if (isChecked(id)) maculasReport.push(getLabelText(id));
            });
            if (maculasReport.length > 0 || maculaSize) {
                primaryLesionsAdded = true;
                primaryLesionsText += `M√°culas y Manchas: ${formatList(maculasReport)}. `;
                if (maculaSize) primaryLesionsText += `Tama√±o promedio: ${maculaSize} mm. `;
            }

            // P√°pulas
            const papulasReport = [];
            const papulaSize = getInputValue('papula-size');
            ['papula-eritematosa', 'papula-normocromica', 'papula-pigmentada', 'papula-perlada'].forEach(id => {
                if (isChecked(id)) papulasReport.push(getLabelText(id));
            });
            if (papulasReport.length > 0 || papulaSize) {
                primaryLesionsAdded = true;
                primaryLesionsText += `P√°pulas: ${formatList(papulasReport)}. `;
                if (papulaSize) primaryLesionsText += `Tama√±o promedio: ${papulaSize} mm. `;
            }

            // Placas
            const placasReport = [];
            const placaSize = getInputValue('placa-size');
            ['placa-eritematosa', 'placa-escamosa', 'placa-liquenificada', 'placa-infiltrada'].forEach(id => {
                if (isChecked(id)) placasReport.push(getLabelText(id));
            });
            if (placasReport.length > 0 || placaSize) {
                primaryLesionsAdded = true;
                primaryLesionsText += `Placas: ${formatList(placasReport)}. `;
                if (placaSize) primaryLesionsText += `Tama√±o promedio: ${placaSize} mm. `;
            }

            // N√≥dulos
            const nodulosReport = [];
            const noduloSize = getInputValue('nodulo-size');
            ['nodulo-subcutaneo', 'nodulo-dermico', 'nodulo-doloroso', 'nodulo-no-doloroso'].forEach(id => {
                if (isChecked(id)) nodulosReport.push(getLabelText(id));
            });
            if (nodulosReport.length > 0 || noduloSize) {
                primaryLesionsAdded = true;
                primaryLesionsText += `N√≥dulos: ${formatList(nodulosReport)}. `;
                if (noduloSize) primaryLesionsText += `Tama√±o promedio: ${noduloSize} mm. `;
            }

            // Ves√≠culas
            const vesiculasReport = [];
            const vesiculaSize = getInputValue('vesicula-size');
            ['vesicula-clara', 'vesicula-turbia', 'vesicula-hemorrhagica', 'vesicula-herpetiforme'].forEach(id => {
                if (isChecked(id)) vesiculasReport.push(getLabelText(id));
            });
            if (vesiculasReport.length > 0 || vesiculaSize) {
                primaryLesionsAdded = true;
                primaryLesionsText += `Ves√≠culas: ${formatList(vesiculasReport)}. `;
                if (vesiculaSize) primaryLesionsText += `Tama√±o promedio: ${vesiculaSize} mm. `;
            }

            // Ampollas/Bulas
            const ampollasReport = [];
            const ampollaSize = getInputValue('ampolla-size');
            ['ampolla-clara', 'ampolla-hemorrhagica', 'ampolla-tensa', 'ampolla-flacida'].forEach(id => {
                if (isChecked(id)) ampollasReport.push(getLabelText(id));
            });
            if (ampollasReport.length > 0 || ampollaSize) {
                primaryLesionsAdded = true;
                primaryLesionsText += `Ampollas/Bulas: ${formatList(ampollasReport)}. `;
                if (ampollaSize) primaryLesionsText += `Tama√±o promedio: ${ampollaSize} mm. `;
            }

            // P√∫stulas
            const pustulasReport = [];
            const pustulaSize = getInputValue('pustula-size');
            ['pustula-folicular', 'pustula-no-folicular', 'pustula-esteril', 'pustula-infectada'].forEach(id => {
                if (isChecked(id)) pustulasReport.push(getLabelText(id));
            });
            if (pustulasReport.length > 0 || pustulaSize) {
                primaryLesionsAdded = true;
                primaryLesionsText += `P√∫stulas: ${formatList(pustulasReport)}. `;
                if (pustulaSize) primaryLesionsText += `Tama√±o promedio: ${pustulaSize} mm. `;
            }

            if (primaryLesionsAdded) {
                conclusion += `ELEMENTOS PRIMARIOS DE LAS LESIONES CUT√ÅNEAS:\n${primaryLesionsText.trim()}\n\n`;
            }

            // --- 5. ELEMENTOS SECUNDARIOS DE LAS LESIONES CUT√ÅNEAS ---
            let secondaryLesionsAdded = false;
            let secondaryLesionsText = '';

            // Erosiones y Excoriaciones
            const erosionesExcoriacionesReport = [];
            ['erosion-superficial', 'excoriacion-lineal', 'excoriacion-puntiforme', 'erosion-post-ampolla'].forEach(id => {
                if (isChecked(id)) erosionesExcoriacionesReport.push(getLabelText(id));
            });
            if (erosionesExcoriacionesReport.length > 0) {
                secondaryLesionsAdded = true;
                secondaryLesionsText += `Erosiones y Excoriaciones: ${formatList(erosionesExcoriacionesReport)}. `;
            }

            // √ölceras
            const ulcerasReport = [];
            const ulceraSize = getInputValue('ulcera-size');
            ['ulcera-superficial', 'ulcera-profunda', 'ulcera-bordes-regulares', 'ulcera-bordes-irregulares', 'ulcera-bordes-sobreelevados'].forEach(id => {
                if (isChecked(id)) ulcerasReport.push(getLabelText(id));
            });
            if (ulcerasReport.length > 0 || ulceraSize) {
                secondaryLesionsAdded = true;
                secondaryLesionsText += `√ölceras: ${formatList(ulcerasReport)}. `;
                if (ulceraSize) secondaryLesionsText += `Tama√±o mayor: ${ulceraSize} mm. `;
            }

            // Escamas
            const escamasReport = [];
            ['escamas-finas', 'escamas-gruesas', 'escamas-plateadas', 'escamas-oleosas', 'descamacion-en-copos'].forEach(id => {
                if (isChecked(id)) escamasReport.push(getLabelText(id));
            });
            if (escamasReport.length > 0) {
                secondaryLesionsAdded = true;
                secondaryLesionsText += `Escamas: ${formatList(escamasReport)}. `;
            }

            // Costras
            const costrasReport = [];
            ['costra-serotica', 'costra-hemorrhagica', 'costra-purulenta', 'costra-melicerica'].forEach(id => {
                if (isChecked(id)) costrasReport.push(getLabelText(id));
            });
            if (costrasReport.length > 0) {
                secondaryLesionsAdded = true;
                secondaryLesionsText += `Costras: ${formatList(costrasReport)}. `;
            }

            // Hiperqueratosis
            const hiperqueratosisReport = [];
            ['hiperqueratosis-difusa', 'hiperqueratosis-localizada', 'callos', 'cuernos-cutaneos'].forEach(id => {
                if (isChecked(id)) hiperqueratosisReport.push(getLabelText(id));
            });
            if (hiperqueratosisReport.length > 0) {
                secondaryLesionsAdded = true;
                secondaryLesionsText += `Hiperqueratosis: ${formatList(hiperqueratosisReport)}. `;
            }

            // Liquenificaci√≥n
            const liquenificacionReport = [];
            ['liquenificacion-leve', 'liquenificacion-moderada', 'liquenificacion-severa'].forEach(id => {
                if (isChecked(id)) liquenificacionReport.push(getLabelText(id));
            });
            if (liquenificacionReport.length > 0) {
                secondaryLesionsAdded = true;
                secondaryLesionsText += `Liquenificaci√≥n: ${formatList(liquenificacionReport)}. `;
            }

            // Atrofia
            const atrofiaReport = [];
            ['atrofia-epidermica', 'atrofia-dermica', 'atrofia-subcutanea', 'piel-papel-cigarro'].forEach(id => {
                if (isChecked(id)) atrofiaReport.push(getLabelText(id));
            });
            if (atrofiaReport.length > 0) {
                secondaryLesionsAdded = true;
                secondaryLesionsText += `Atrofia: ${formatList(atrofiaReport)}. `;
            }

            // Cicatrices
            const cicatricesReport = [];
            ['cicatriz-atrofica', 'cicatriz-hipertrofica', 'queloides', 'cicatrices-varioliformes'].forEach(id => {
                if (isChecked(id)) cicatricesReport.push(getLabelText(id));
            });
            if (cicatricesReport.length > 0) {
                secondaryLesionsAdded = true;
                secondaryLesionsText += `Cicatrices: ${formatList(cicatricesReport)}. `;
            }

            if (secondaryLesionsAdded) {
                conclusion += `ELEMENTOS SECUNDARIOS DE LAS LESIONES CUT√ÅNEAS:\n${secondaryLesionsText.trim()}\n\n`;
            }

            // --- 6. DISTRIBUCI√ìN Y LOCALIZACI√ìN DE LAS LESIONES ---
            let distributionAdded = false;
            let distributionText = '';

            // Patr√≥n de Distribuci√≥n General
            const distGeneralReport = [];
            ['dist-localizada', 'dist-regional', 'dist-generalizada', 'dist-universal'].forEach(id => {
                if (isChecked(id)) distGeneralReport.push(getLabelText(id));
            });
            if (distGeneralReport.length > 0) {
                distributionAdded = true;
                distributionText += `Patr√≥n de distribuci√≥n general: ${formatList(distGeneralReport)}. `;
            } else if (document.querySelectorAll('#distribution .exam-container:nth-of-type(1) .exam-section:nth-of-type(1) input[type="checkbox"]').length > 0) {
                 distributionAdded = true; // Si hay checkboxes, pero nada marcado
                 distributionText += `Patr√≥n de distribuci√≥n general: No especificado. `;
            }

            // Patr√≥n Morfol√≥gico
            const patronMorfologicoReport = [];
            ['patron-simetrico', 'patron-asimetrico', 'patron-linear', 'patron-anular', 'patron-serpiginoso', 'patron-herpetiforme', 'patron-reticular', 'patron-corimbiforme'].forEach(id => {
                if (isChecked(id)) patronMorfologicoReport.push(getLabelText(id));
            });
            if (patronMorfologicoReport.length > 0) {
                distributionAdded = true;
                distributionText += `Patr√≥n morfol√≥gico: ${formatList(patronMorfologicoReport)}. `;
            } else if (document.querySelectorAll('#distribution .exam-container:nth-of-type(1) .exam-section:nth-of-type(2) input[type="checkbox"]').length > 0) {
                 distributionAdded = true;
                 distributionText += `Patr√≥n morfol√≥gico: No especificado. `;
            }


            // Localizaci√≥n del mapa corporal
            if (selectedBodyAreas.size > 0) {
                distributionAdded = true;
                const areasArray = Array.from(selectedBodyAreas);
                distributionText += `Localizaci√≥n anat√≥mica (mapa corporal): ${formatList(areasArray)}. `;
            } else if (document.querySelectorAll('.body-part').length > 0) { // Si el mapa corporal existe
                distributionAdded = true;
                distributionText += `Localizaci√≥n anat√≥mica (mapa corporal): No se han seleccionado √°reas espec√≠ficas. `;
            }


            // Localizaci√≥n Anat√≥mica (M√©todo tradicional)
            const locTradicionalReport = [];
            // Cabeza y Cuello
            ['loc-cuero-cabelludo', 'loc-frente', 'loc-parpados', 'loc-mejillas', 'loc-nariz', 'loc-labios', 'loc-barbilla', 'loc-cuello', 'loc-retroauricular'].forEach(id => { if (isChecked(id)) locTradicionalReport.push(getLabelText(id)); });
            // Tronco
            ['loc-pecho', 'loc-abdomen', 'loc-espalda', 'loc-axilas', 'loc-submamario', 'loc-inguinal'].forEach(id => { if (isChecked(id)) locTradicionalReport.push(getLabelText(id)); });
            // Extremidades Superiores
            ['loc-hombros', 'loc-brazos', 'loc-codos', 'loc-antebrazos', 'loc-mu√±ecas', 'loc-manos', 'loc-dedos-manos', 'loc-espacios-interdigitales-manos'].forEach(id => { if (isChecked(id)) locTradicionalReport.push(getLabelText(id)); });
            // Extremidades Inferiores
            ['loc-gluteos', 'loc-muslos', 'loc-rodillas', 'loc-piernas', 'loc-tobillos', 'loc-pies', 'loc-dedos-pies', 'loc-espacios-interdigitales-pies', 'loc-plantas'].forEach(id => { if (isChecked(id)) locTradicionalReport.push(getLabelText(id)); });
            // √Årea Genital
            ['loc-genitales-externos', 'loc-perianal', 'loc-perineal'].forEach(id => { if (isChecked(id)) locTradicionalReport.push(getLabelText(id)); });
            // Mucosas
            ['loc-mucosa-oral', 'loc-mucosa-nasal', 'loc-mucosa-genital', 'loc-conjuntiva'].forEach(id => { if (isChecked(id)) locTradicionalReport.push(getLabelText(id)); });

            if (locTradicionalReport.length > 0) {
                distributionAdded = true;
                distributionText += `Localizaci√≥n anat√≥mica (tradicional): ${formatList(locTradicionalReport)}. `;
            } else if (document.querySelectorAll('.anatomy-region input[type="checkbox"]').length > 0) {
                 distributionAdded = true;
                 distributionText += `Localizaci√≥n anat√≥mica (tradicional): No especificada. `;
            }


            // Distribuci√≥n Especial
            const distEspecialReport = [];
            ['dist-flexural', 'dist-extensora', 'dist-photoexpuestas', 'dist-areas-contacto', 'dist-seborreicas'].forEach(id => {
                if (isChecked(id)) distEspecialReport.push(getLabelText(id));
            });
            if (distEspecialReport.length > 0) {
                distributionAdded = true;
                distributionText += `Distribuci√≥n especial: Predominio en ${formatList(distEspecialReport)}. `;
            } else if (document.querySelectorAll('#distribution .exam-container:nth-of-type(3) input[type="checkbox"]').length > 0) {
                 distributionAdded = true;
                 distributionText += `Distribuci√≥n especial: No especificada. `;
            }


            if (distributionAdded) {
                conclusion += `DISTRIBUCI√ìN Y LOCALIZACI√ìN DE LAS LESIONES:\n${distributionText.trim()}\n\n`;
            }

            // --- 7. ESTADO DE LOS ANEXOS CUT√ÅNEOS ---
            let appendagesAdded = false;
            let appendagesText = '';

            // Cabello y Cuero Cabelludo
            const cabelloCaracteristicasReport = [];
            ['cabello-graso', 'cabello-seco', 'cabello-quebradizo', 'cabello-fino', 'cabello-grueso'].forEach(id => {
                if (isChecked(id)) cabelloCaracteristicasReport.push(getLabelText(id));
            });
            if (cabelloCaracteristicasReport.length > 0) {
                appendagesAdded = true;
                appendagesText += `Cabello: ${formatList(cabelloCaracteristicasReport)}. `;
            } else if (isChecked('cabello-normal')) {
                appendagesAdded = true;
                appendagesText += `Cabello: Aspecto normal. `;
            } else if (document.querySelectorAll('#appendages .exam-container:nth-of-type(1) .exam-section:nth-of-type(1) input[type="checkbox"]').length > 0) {
                 appendagesAdded = true;
                 appendagesText += `Cabello: No especificado. `;
            }


            const alopeciaTiposReport = [];
            ['alopecia-areata', 'alopecia-androgenetica', 'alopecia-difusa', 'alopecia-cicatricial', 'tricotillomania'].forEach(id => {
                if (isChecked(id)) alopeciaTiposReport.push(getLabelText(id));
            });
            if (alopeciaTiposReport.length > 0) {
                appendagesAdded = true;
                appendagesText += `Alopecia: Se evidencia ${formatList(alopeciaTiposReport)}. `;
            } else if (document.querySelectorAll('#appendages .exam-container:nth-of-type(1) .exam-section:nth-of-type(2) input[type="checkbox"]').length > 0) {
                 appendagesAdded = true;
                 appendagesText += `Alopecia: No especificada. `;
            }


            const cueroCabelludoHallazgosReport = [];
            ['descamacion-cuero-cabelludo', 'eritema-cuero-cabelludo', 'costras-cuero-cabelludo', 'placas-cuero-cabelludo'].forEach(id => {
                if (isChecked(id)) cueroCabelludoHallazgosReport.push(getLabelText(id));
            });
            if (cueroCabelludoHallazgosReport.length > 0) {
                appendagesAdded = true;
                appendagesText += `Cuero Cabelludo: ${formatList(cueroCabelludoHallazgosReport)}. `;
            } else if (isChecked('cuero-cabelludo-normal')) {
                appendagesAdded = true;
                appendagesText += `Cuero Cabelludo: Aspecto normal. `;
            } else if (document.querySelectorAll('#appendages .exam-container:nth-of-type(1) .exam-section:nth-of-type(3) input[type="checkbox"]').length > 0) {
                 appendagesAdded = true;
                 appendagesText += `Cuero Cabelludo: No especificado. `;
            }


            // U√±as de las Manos
            const unasManosReport = [];
            ['onic√≥lisis-manos', 'onicodistrofia-manos', 'leuconiquia-manos', 'melanoniquia-manos', 'pitting-ungueal-manos', 'surcos-beau-manos', 'onicorrexis-manos', 'onicomicosis-manos'].forEach(id => {
                if (isChecked(id)) unasManosReport.push(getLabelText(id));
            });
            if (unasManosReport.length > 0) {
                appendagesAdded = true;
                appendagesText += `U√±as de las Manos: ${formatList(unasManosReport)}. `;
            } else if (isChecked('unas-manos-normales')) {
                appendagesAdded = true;
                appendagesText += `U√±as de las Manos: Aspecto normal. `;
            } else if (document.querySelectorAll('#appendages .exam-container:nth-of-type(2) .exam-section:nth-of-type(1) input[type="checkbox"]').length > 0) {
                 appendagesAdded = true;
                 appendagesText += `U√±as de las Manos: No especificado. `;
            }


            // U√±as de los Pies
            const unasPiesReport = [];
            ['onic√≥lisis-pies', 'onicodistrofia-pies', 'onicomicosis-pies', 'u√±a-encarnada', 'onicogrifosis'].forEach(id => {
                if (isChecked(id)) unasPiesReport.push(getLabelText(id));
            });
            if (unasPiesReport.length > 0) {
                appendagesAdded = true;
                appendagesText += `U√±as de los Pies: ${formatList(unasPiesReport)}. `;
            } else if (isChecked('unas-pies-normales')) {
                appendagesAdded = true;
                appendagesText += `U√±as de los Pies: Aspecto normal. `;
            } else if (document.querySelectorAll('#appendages .exam-container:nth-of-type(2) .exam-section:nth-of-type(2) input[type="checkbox"]').length > 0) {
                 appendagesAdded = true;
                 appendagesText += `U√±as de los Pies: No especificado. `;
            }


            // Pliegues Ungueales
            const plieguesReport = [];
            ['paroniquia-aguda', 'paroniquia-cronica', 'pterigion', 'hipertrofia-pliegue'].forEach(id => {
                if (isChecked(id)) plieguesReport.push(getLabelText(id));
            });
            if (plieguesReport.length > 0) {
                appendagesAdded = true;
                appendagesText += `Pliegues Ungueales: ${formatList(plieguesReport)}. `;
            } else if (isChecked('pliegues-normales')) {
                appendagesAdded = true;
                appendagesText += `Pliegues Ungueales: Aspecto normal. `;
            } else if (document.querySelectorAll('#appendages .exam-container:nth-of-type(2) .exam-section:nth-of-type(3) input[type="checkbox"]').length > 0) {
                 appendagesAdded = true;
                 appendagesText += `Pliegues Ungueales: No especificado. `;
            }


            if (appendagesAdded) {
                conclusion += `ESTADO DE LOS ANEXOS CUT√ÅNEOS:\n${appendagesText.trim()}\n\n`;
            }

            // --- 8. PRUEBAS ESPECIALES Y SIGNOS DERMATOL√ìGICOS ---
            let specialTestsAdded = false;
            let specialTestsText = '';

            // Pruebas F√≠sicas
            const pruebasFisicasReport = [];
            const pruebaMap = {
                'nikolsky': 'Signo de Nikolsky',
                'asboe-hansen': 'Signo de Asboe-Hansen',
                'darier': 'Signo de Darier',
                'dermografismo': 'Dermografismo',
                'kobner': 'Signo de K√∂bner',
                'gota-rocio': 'Signo de la gota de roc√≠o',
                'tiron-vello': 'Signo del tir√≥n de vello'
            };
            Object.keys(pruebaMap).forEach(key => {
                if (isChecked(`${key}-pos`)) {
                    specialTestsAdded = true;
                    pruebasFisicasReport.push(`${pruebaMap[key]}: Positivo`);
                } else if (isChecked(`${key}-neg`)) {
                    specialTestsAdded = true;
                    pruebasFisicasReport.push(`${pruebaMap[key]}: Negativo`);
                }
            });
            if (pruebasFisicasReport.length > 0) {
                specialTestsText += `Pruebas f√≠sicas: ${pruebasFisicasReport.join('; ')}. `;
            } else if (document.querySelectorAll('#special-tests .exam-container:nth-of-type(1) input[type="checkbox"]').length > 0) {
                 specialTestsAdded = true;
                 specialTestsText += `Pruebas f√≠sicas: No evaluadas o negativas. `;
            }


            // Pruebas con KOH
            const kohPruebasReport = [];
            ['koh-escamas', 'koh-unas', 'koh-cabello'].forEach(idPrefix => {
                const posChecked = isChecked(`${idPrefix}-pos`);
                const negChecked = isChecked(`${idPrefix}-neg`);
                const note = getInputValue(`${idPrefix}-note`);
                let result = '';
                if (posChecked) result = 'Positivo';
                else if (negChecked) result = 'Negativo';

                if (result || note) { // Si hay un resultado o una nota, la incluimos
                    specialTestsAdded = true;
                    kohPruebasReport.push(`${capitalizeFirstLetter(idPrefix.replace('koh-', 'KOH de ')).replace('Unas', 'U√±as').replace('Escamas', 'Escamas cut√°neas')}: ${result || 'Sin resultado'}${note ? ` (${note})` : ''}`);
                }
            });
            if (kohPruebasReport.length > 0) {
                specialTestsText += `Pruebas con KOH: ${kohPruebasReport.join('; ')}. `;
            } else if (document.querySelectorAll('#special-tests .exam-container:nth-of-type(2) input').length > 0) {
                 specialTestsAdded = true;
                 specialTestsText += `Pruebas con KOH: No evaluadas o no concluyentes. `;
            }


            // Otras Pruebas Diagn√≥sticas
            const otrasPruebasReport = [];
            // L√°mpara de Wood
            const woodPos = isChecked('wood-pos');
            const woodNeg = isChecked('wood-neg');
            const woodColor = getInputValue('wood-color');
            if (woodPos || woodNeg || woodColor) {
                specialTestsAdded = true;
                let woodResult = '';
                if (woodPos) woodResult = 'Positiva';
                else if (woodNeg) woodResult = 'Negativa';
                otrasPruebasReport.push(`L√°mpara de Wood: ${woodResult || 'Sin resultado'}${woodColor ? ` (Color: ${woodColor})` : ''}`);
            } else if (document.querySelectorAll('#special-tests #wood-pos').length > 0) {
                 specialTestsAdded = true;
                 otrasPruebasReport.push(`L√°mpara de Wood: No evaluada o no concluyente. `);
            }


            // Prueba de contacto (Patch test)
            const patchPos = isChecked('patch-test-pos');
            const patchNeg = isChecked('patch-test-neg');
            const patchAllergen = getInputValue('patch-test-allergen');
            if (patchPos || patchNeg || patchAllergen) {
                specialTestsAdded = true;
                let patchResult = '';
                if (patchPos) patchResult = 'Positiva';
                else if (patchNeg) patchResult = 'Negativa';
                otrasPruebasReport.push(`Prueba de contacto (Patch test): ${patchResult || 'Sin resultado'}${patchAllergen ? ` (Al√©rgeno: ${patchAllergen})` : ''}`);
            } else if (document.querySelectorAll('#special-tests #patch-test-pos').length > 0) {
                 specialTestsAdded = true;
                 otrasPruebasReport.push(`Prueba de contacto (Patch test): No evaluada o no concluyente. `);
            }


            // Biopsia cut√°nea
            const biopsiaRealizada = isChecked('biopsia-realizada');
            const biopsiaPendiente = isChecked('biopsia-pendiente');
            const biopsiaSitio = getInputValue('biopsia-sitio');
            if (biopsiaRealizada || biopsiaPendiente || biopsiaSitio) {
                specialTestsAdded = true;
                let biopsiaStatus = '';
                if (biopsiaRealizada) biopsiaStatus = 'Realizada';
                else if (biopsiaPendiente) biopsiaStatus = 'Pendiente';
                otrasPruebasReport.push(`Biopsia cut√°nea: ${biopsiaStatus || 'No especificado'}${biopsiaSitio ? ` (Sitio: ${biopsiaSitio})` : ''}`);
            } else if (document.querySelectorAll('#special-tests #biopsia-realizada').length > 0) {
                 specialTestsAdded = true;
                 otrasPruebasReport.push(`Biopsia cut√°nea: No realizada o no especificada. `);
            }

            if (otrasPruebasReport.length > 0) {
                specialTestsText += `Otras pruebas diagn√≥sticas: ${otrasPruebasReport.join('; ')}. `;
            }


            if (specialTestsAdded) {
                conclusion += `PRUEBAS ESPECIALES Y SIGNOS DERMATOL√ìGICOS:\n${specialTestsText.trim()}\n\n`;
            }

            // --- 9. EVALUACI√ìN DE SEVERIDAD ---
            let severityAdded = false;
            let severityText = '';

            // Extensi√≥n de las Lesiones
            const superficieAfectada = parseFloat(getInputValue('superficie-afectada')) || 0;
            const extensionSeveridad = getRadioButtonValue('extension-severidad');
            if (superficieAfectada > 0 || extensionSeveridad) {
                severityAdded = true;
                severityText += `Extensi√≥n de las lesiones: `;
                if (superficieAfectada > 0) severityText += `Superficie corporal afectada estimada: ${superficieAfectada}%. `;
                if (extensionSeveridad) severityText += `Clasificaci√≥n de severidad por extensi√≥n: ${extensionSeveridad}. `;
            } else if (document.querySelectorAll('#severity .exam-container:nth-of-type(1) input').length > 0) {
                 severityAdded = true;
                 severityText += `Extensi√≥n de las lesiones: No especificada. `;
            }


            // Impacto Funcional
            const pruritoIntensity = parseInt(getInputValue('prurito-intensity')) || 0;
            const interfiereActividadesReport = [];
            ['interfiere-sue√±o', 'interfiere-trabajo', 'interfiere-social', 'interfiere-deportes'].forEach(id => {
                if (isChecked(id)) interfiereActividadesReport.push(getLabelText(id));
            });
            if (pruritoIntensity > 0 || interfiereActividadesReport.length > 0) {
                severityAdded = true;
                severityText += `Impacto funcional: `;
                if (pruritoIntensity > 0) {
                    severityText += `Intensidad del prurito (EVA): ${pruritoIntensity}/10. `;
                } else if (document.getElementById('prurito-intensity')) {
                     severityText += `Intensidad del prurito (EVA): No especificada. `;
                }

                if (interfiereActividadesReport.length > 0) {
                    severityText += `Interferencia con actividades: ${formatList(interfiereActividadesReport)}. `;
                } else if (document.querySelectorAll('#severity .exam-container:nth-of-type(2) .exam-section:nth-of-type(2) input[type="checkbox"]').length > 0) {
                     severityText += `Interferencia con actividades: No refiere. `;
                }
            } else if (document.querySelectorAll('#severity .exam-container:nth-of-type(2) input').length > 0) {
                 severityAdded = true;
                 severityText += `Impacto funcional: No evaluado. `;
            }


            // PASI
            const pasiTotal = document.getElementById('pasi-total').textContent;
            const pasiEritema = getInputValue('pasi-eritema');
            const pasiInfiltracion = getInputValue('pasi-infiltracion');
            const pasiDescamacion = getInputValue('pasi-descamacion');
            const pasiAreaCabeza = getInputValue('pasi-area-cabeza');

            if (pasiTotal !== '0' || pasiEritema || pasiInfiltracion || pasiDescamacion || pasiAreaCabeza) {
                severityAdded = true;
                severityText += `PASI (Psoriasis Area and Severity Index): Puntuaci√≥n total: ${pasiTotal}. `;
                severityText += `(Eritema: ${pasiEritema || 'N/A'}, Infiltraci√≥n: ${pasiInfiltracion || 'N/A'}, Descamaci√≥n: ${pasiDescamacion || 'N/A'}, √Årea cabeza: ${pasiAreaCabeza || 'N/A'}). `;
            } else if (document.querySelectorAll('#severity .score-calculation:nth-of-type(1) input').length > 0) {
                 severityAdded = true;
                 severityText += `PASI: No evaluado o sin hallazgos. `;
            }


            // SCORAD
            const scoradTotal = document.getElementById('scorad-total').textContent;
            const scoradExtension = getInputValue('scorad-extension');
            const scoradEritema = getInputValue('scorad-eritema');
            const scoradEdema = getInputValue('scorad-edema');
            const scoradExcoriacion = getInputValue('scorad-excoriacion');
            const scoradLiquenificacion = getInputValue('scorad-liquenificacion');
            const scoradDescamacion = getInputValue('scorad-descamacion');
            const scoradXerosis = getInputValue('scorad-xerosis');
            const scoradPrurito = getInputValue('scorad-prurito');
            const scoradSue√±o = getInputValue('scorad-sue√±o');

            if (scoradTotal !== '0' || scoradExtension || scoradEritema || scoradEdema || scoradExcoriacion || scoradLiquenificacion || scoradDescamacion || scoradXerosis || scoradPrurito || scoradSue√±o) {
                severityAdded = true;
                severityText += `SCORAD (SCORing Atopic Dermatitis): Puntuaci√≥n total: ${scoradTotal}. `;
                if (scoradExtension) severityText += `Extensi√≥n: ${scoradExtension}%. `;
                severityText += `Intensidad (Eritema: ${scoradEritema || 'N/A'}, Edema/P√°pulas: ${scoradEdema || 'N/A'}, Excoriaci√≥n: ${scoradExcoriacion || 'N/A'}, Liquenificaci√≥n: ${scoradLiquenificacion || 'N/A'}, Descamaci√≥n: ${scoradDescamacion || 'N/A'}, Xerosis: ${scoradXerosis || 'N/A'}). `;
                severityText += `S√≠ntomas subjetivos (Prurito: ${scoradPrurito || 'N/A'}, P√©rdida de sue√±o: ${scoradSue√±o || 'N/A'}). `;
            } else if (document.querySelectorAll('#severity .scale-section:nth-of-type(1) input').length > 0) {
                 severityAdded = true;
                 severityText += `SCORAD: No evaluado o sin hallazgos. `;
            }


            // DLQI
            const dlqiTotal = document.getElementById('dlqi-total').textContent;
            const dlqiInterpretation = document.getElementById('dlqi-interpretation').textContent;
            const dlqiQuestionsAnswered = Array.from(document.querySelectorAll('[name^="dlqi-"]:checked')).length > 0;

            if (dlqiTotal !== '0' || dlqiQuestionsAnswered) {
                severityAdded = true;
                severityText += `DLQI (Dermatology Life Quality Index): Puntuaci√≥n total: ${dlqiTotal}/30. Interpretaci√≥n: ${dlqiInterpretation}. `;
            } else if (document.querySelectorAll('#severity .scale-section:nth-of-type(2) input').length > 0) {
                 severityAdded = true;
                 severityText += `DLQI: No evaluado o sin impacto. `;
            }


            if (severityAdded) {
                conclusion += `EVALUACI√ìN DE SEVERIDAD:\n${severityText.trim()}\n\n`;
            }

            // --- CONCLUSI√ìN FINAL Y PLAN ---
            if (conclusion.trim() === 'EXAMEN DERMATOL√ìGICO') {
                conclusion = 'Complete los campos del examen para generar la conclusi√≥n dermatol√≥gica...';
            } else {
                conclusion += 'RESUMEN GENERAL:\n';
                if (alertCount > 0) {
                    conclusion += `Se identifican ${alertCount} **alertas cr√≠ticas** que requieren atenci√≥n inmediata. `;
                } else if (warningCount > 0 || findingsCount > 0) {
                    conclusion += `No se identifican alertas cr√≠ticas. `;
                }

                if (warningCount > 0) {
                    conclusion += `Existen ${warningCount} **hallazgos importantes** que deben ser considerados. `;
                } else if (alertCount > 0 || findingsCount > 0) {
                     conclusion += `No se identifican hallazgos de atenci√≥n. `;
                }

                conclusion += `Un total de ${findingsCount} hallazgos relevantes han sido registrados en este examen. `;
                conclusion += `La evaluaci√≥n de calidad de vida indica un ${qualityOfLifeStatus.toLowerCase()}.`;

                conclusion += '\n\n';

                conclusion += 'IMPRESI√ìN DIAGN√ìSTICA:\n';
                conclusion += '[Pendiente de correlaci√≥n cl√≠nico-patol√≥gica, considerando la historia, hallazgos f√≠sicos y resultados de pruebas especiales. Se requiere diagn√≥stico diferencial.]\n\n';
                conclusion += 'PLAN DE MANEJO:\n';
                conclusion += '[El plan de manejo se adaptar√° a la impresi√≥n diagn√≥stica definitiva, incluyendo opciones terap√©uticas t√≥picas, sist√©micas, procedimientos o medidas preventivas, y se ajustar√° seg√∫n la respuesta y la evoluci√≥n cl√≠nica.]\n\n';
                conclusion += 'SEGUIMIENTO:\n';
                conclusion += '[Se recomienda un seguimiento dermatol√≥gico peri√≥dico para monitorear la evoluci√≥n de las lesiones y la respuesta al tratamiento, as√≠ como para detectar posibles recurrencias o complicaciones.]\n\n';
                conclusion += `COMPLETITUD DEL EXAMEN: ${examProgress}%`;
            }

            conclusionEl.textContent = conclusion;
            realTimeEl.textContent = conclusion;
        }
        // Funci√≥n para copiar al portapapeles (original del derma.html, pero con nueva l√≥gica de notificaci√≥n)
        function copyConclusion() {
            const conclusion = document.getElementById('conclusion-text').textContent;

            if (navigator.clipboard && window.isSecureContext) {
                // Usar la API moderna del portapapeles
                navigator.clipboard.writeText(conclusion).then(() => {
                    showCopyNotification(); // Usa la funci√≥n de gastro.html
                }).catch(err => {
                    console.error('Error al copiar: ', err);
                    fallbackCopyTextToClipboard(conclusion);
                });
            } else {
                // Fallback para navegadores m√°s antiguos
                fallbackCopyTextToClipboard(conclusion);
            }
        }

        // Funci√≥n fallback para copiar texto (se mantiene como la original)
        function fallbackCopyTextToClipboard(text) {
            const textArea = document.createElement("textarea");
            textArea.value = text;
            textArea.style.top = "0";
            textArea.style.left = "0";
            textArea.style.position = "fixed";
            textArea.style.opacity = "0"; // Asegurarse que es invisible
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();

            try {
                const successful = document.execCommand('copy');
                if (successful) {
                    showCopyNotification();
                } else {
                    alert('Error al copiar el texto. Por favor, c√≥pielo manualmente.');
                }
            } catch (err) {
                console.error('Fallback: Error al copiar: ', err);
                alert('Error al copiar el texto. Por favor, seleccione el texto manualmente.');
            }

            document.body.removeChild(textArea);
        }

        // Funci√≥n para mostrar mensaje de copia (original, pero ahora se usar√° la de gastro.html)
        // La funci√≥n `showCopyMessage` se elimina para usar `showCopyNotification` del gastro.html.

        // Limpiar formulario (Existente, ampliado para los nuevos elementos y dashboard)
        function clearForm() {
            if (confirm('¬øEst√° seguro de que desea limpiar todos los datos del formulario?')) {
                document.querySelectorAll('input[type="checkbox"]').forEach(cb => {
                    cb.checked = false;
                    cb.disabled = false; // Habilitar checkboxes de "sin quejas"
                });
                document.querySelectorAll('input[type="radio"]').forEach(rb => rb.checked = false);
                document.querySelectorAll('input[type="number"]').forEach(nb => nb.value = '');
                document.querySelectorAll('input[type="text"]').forEach(tb => tb.value = '');
                document.querySelectorAll('input[type="range"]').forEach(rb => rb.value = 0);
                document.querySelectorAll('textarea').forEach(ta => ta.value = '');

                // Resetear valores espec√≠ficos
                document.getElementById('prurito-value').textContent = '0';
                document.getElementById('pasi-total').textContent = '0';
                document.getElementById('scorad-total').textContent = '0';
                document.getElementById('dlqi-total').textContent = '0';
                document.getElementById('dlqi-interpretation').textContent = 'Sin impacto';
                document.getElementById('abcde-score').textContent = '0/5';
                document.getElementById('abcde-risk').textContent = 'Bajo';
                document.getElementById('abcde-recommendation').textContent = 'Seguimiento de rutina';

                // Limpiar mapa corporal
                selectedBodyAreas.clear();
                document.querySelectorAll('.body-part.selected').forEach(part => {
                    part.classList.remove('selected');
                });
                updateSelectedAreasDisplay();

                // Ocultar campos de especificaci√≥n
                document.querySelectorAll('.specification-field').forEach(field => {
                    field.classList.remove('show');
                    field.value = ''; // Asegurarse de que se borra el texto
                });

                // Ocultar secci√≥n ABCDE
                document.getElementById('abcde-evaluation').style.display = 'none';

                // Habilitar checkboxes de "sin quejas" y "sin alergias" si estaban deshabilitados
                document.getElementById('sin-quejas').disabled = false;
                document.getElementById('sin-alergias').disabled = false;
                document.getElementById('sin-antec-fam').disabled = false;

                document.querySelectorAll('#antecedentes .exam-section:first-of-type input[type="checkbox"]:not(#sin-alergias)').forEach(cb => cb.disabled = false);
                document.querySelectorAll('#antecedentes .exam-section:nth-of-type(2) input[type="checkbox"]:not(#sin-antec-fam)').forEach(cb => cb.disabled = false);


                // Resetear dashboard variables y display
                examProgress = 0;
                sectionsCompleted = 0;
                alertCount = 0;
                warningCount = 0;
                findingsCount = 0;
                qualityOfLifeStatus = 'Pendiente';

                document.getElementById('exam-progress').textContent = '0%';
                document.getElementById('sections-completed').textContent = '0/8'; // Ajusta el total de secciones
                document.getElementById('alert-count').textContent = '0';
                document.getElementById('warning-count').textContent = '0';
                document.getElementById('findings-count').textContent = '0';
                document.getElementById('quality-of-life-status').textContent = 'Pendiente';

                document.getElementById('alerts-item').classList.remove('dashboard-alert');
                document.getElementById('warnings-item').classList.remove('dashboard-warning');
                document.getElementById('findings-item').classList.remove('dashboard-normal');
                document.getElementById('quality-of-life-item').classList.remove('dashboard-normal', 'dashboard-warning'); // Limpiar clases
                document.getElementById('quality-of-life-item').classList.add('dashboard-item');


                // Re-evaluar todas las escalas para limpiar el estado visual y del modelo
                evaluateABCDE();
                calculatePASI();
                calculateSCORAD();
                calculateDLQI();

                updateDashboard(); // Forzar actualizaci√≥n del dashboard y conclusi√≥n
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            // Cargar tema guardado
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark') {
                document.body.setAttribute('data-theme', 'dark');
                document.getElementById('theme-icon').className = 'fas fa-sun';
            }

            // Inicializar mapa corporal
            initializeBodyMap();

            // Event listeners para actualizar dashboard y conclusi√≥n
            document.querySelectorAll('input, select, textarea').forEach(el => {
                el.addEventListener('change', updateDashboard);
                el.addEventListener('input', updateDashboard);
            });

            // Event listeners espec√≠ficos para ABCDE
            document.querySelectorAll('[name^="abcde-"], [id^="color-"], [id^="evol-"]').forEach(input => {
                input.addEventListener('change', evaluateABCDE);
            });

            // Ajustar altura de secciones al cambiar contenido
            document.querySelector('.main-container').addEventListener('change', (event) => {
                const sectionContent = event.target.closest('.section-content.expanded');
                if (sectionContent) {
                    updateSectionHeight(sectionContent);
                }
            });

            // Expandir la primera secci√≥n por defecto
            toggleSection(document.querySelector('.section-header'));

            // Inicializar todas las evaluaciones y c√°lculos al cargar la p√°gina
            evaluateABCDE();
            calculatePASI();
            calculateSCORAD();
            calculateDLQI();

            // Forzar una actualizaci√≥n inicial completa del dashboard y la conclusi√≥n
            updateDashboard();

            // Mostrar mensaje de bienvenida
            setTimeout(() => {
                console.log('üéâ Sistema de Evaluaci√≥n Dermatol√≥gica Premium con Panel Sticky cargado exitosamente!');
            }, 1000);
        });
    </script>
</body>
</html>
